Ext.define("Ext.ux.grid.FiltersFeature",{extend:"Ext.grid.feature.Feature",alias:"feature.filters",uses:"Ext.ux.grid.menu.ListMenu Ext.ux.grid.menu.RangeMenu Ext.ux.grid.filter.BooleanFilter Ext.ux.grid.filter.DateFilter Ext.ux.grid.filter.DateTimeFilter Ext.ux.grid.filter.ListFilter Ext.ux.grid.filter.NumericFilter Ext.ux.grid.filter.StringFilter".split(" "),autoReload:!0,filterCls:"ux-filtered-column",local:!1,menuFilterText:"Filters",paramPrefix:"filter",showMenu:!0,stateId:void 0,updateBuffer:500,
hasFeatureEvent:!1,constructor:function(a){this.callParent(arguments);this.deferredUpdate=Ext.create("Ext.util.DelayedTask",this.reload,this);this.filters=this.createFiltersCollection();this.filterConfigs=a.filters},init:function(a){var b=this.view,c=b.headerCt;this.bindStore(b.getStore(),!0);c.on("menucreate",this.onMenuCreate,this);b.on("refresh",this.onRefresh,this);a.on({scope:this,beforestaterestore:this.applyState,beforestatesave:this.saveState,beforedestroy:this.destroy});a.filters=this;a.addEvents("filterupdate");
this.createFilters()},createFiltersCollection:function(){return Ext.create("Ext.util.MixedCollection",!1,function(a){return a?a.dataIndex:null})},createFilters:function(){function a(a,b,c){a&&(c||b)&&(g=f.get(a),h={dataIndex:a,type:g&&g.type&&g.type.type||"auto"},Ext.isObject(b)&&Ext.apply(h,b),e.replace(h))}var b=this.filters.getCount(),c=this.getGridPanel(),e=this.createFiltersCollection(),f=c.store.model.prototype.fields,g,h,k;b&&(k={},this.saveState(null,k));Ext.Array.each(this.filterConfigs,
function(b){a(b.dataIndex,b)});Ext.Array.each(c.columnManager.getColumns(),function(b){!1===b.filterable?e.removeAtKey(b.dataIndex):a(b.dataIndex,b.filter,b.filterable)});this.removeAll();e.items&&this.initializeFilters(e.items);b&&this.applyState(null,k)},initializeFilters:function(a){var b=a.length,c,e,f;for(c=0;c<b;c++)if(e=a[c])f=this.getFilterClass(e.type),e=e.menu?e:new f(Ext.apply({grid:this.grid},e)),this.filters.add(e),Ext.util.Observable.capture(e,this.onStateChange,this)},onMenuCreate:function(a,
b){this.filtersNeedReCreating&&(this.createFilters(),this.filtersNeedReCreating=!1);b.on({beforeshow:this.onMenuBeforeShow,destroy:this.onMenuDestroy,scope:this})},onMenuDestroy:function(){this.filtersNeedReCreating=!0},onMenuBeforeShow:function(a){var b;if(this.showMenu){b=this.menuItem;if(!b||b.isDestroyed)this.createMenuItem(a),b=this.menuItem;if(a=this.getMenuFilter())b.setMenu(a.menu,!1),b.setChecked(a.active),b.setDisabled(!0===a.disabled);b.setVisible(!!a);this.sep.setVisible(!!a)}},createMenuItem:function(a){this.sep=
a.add("-");this.menuItem=a.add({checked:!1,itemId:"filters",text:this.menuFilterText,listeners:{scope:this,checkchange:this.onCheckChange,beforecheckchange:this.onBeforeCheck}})},getGridPanel:function(){return this.grid},applyState:function(a,b){var c,e;this.applyingState=!0;this.clearFilters();if(b.filters)for(c in b.filters)b.filters.hasOwnProperty(c)&&(e=this.filters.get(c))&&(e.setValue(b.filters[c]),e.setActive(!0));this.deferredUpdate.cancel();this.local&&this.reload();delete this.applyingState;
delete b.filters},saveState:function(a,b){var c={};this.filters.each(function(a){a.active&&(c[a.dataIndex]=a.getValue())});return b.filters=c},destroy:function(){Ext.destroyMembers(this,"menuItem","sep");this.removeAll();this.clearListeners()},removeAll:function(){this.filters&&(Ext.destroy.apply(Ext,this.filters.items),this.filters.clear())},bindStore:function(a){this.store&&this.storeListeners&&this.store.un(this.storeListeners);a?(this.storeListeners={scope:this},this.local?this.storeListeners.load=
this.onLoad:this.storeListeners["before"+(a.buffered?"prefetch":"load")]=this.onBeforeLoad,a.on(this.storeListeners)):delete this.storeListeners;this.store=a},getMenuFilter:function(){var a=this.view.headerCt.getMenu().activeHeader;return a?this.filters.get(a.dataIndex):null},onCheckChange:function(a,b){this.getMenuFilter().setActive(b)},onBeforeCheck:function(a,b){return!b||this.getMenuFilter().isActivatable()},onStateChange:function(a,b){if("serialize"!==a){var c=this.getGridPanel();b==this.getMenuFilter()&&
this.menuItem.setChecked(b.active,!1);!this.autoReload&&!this.local||this.applyingState||this.deferredUpdate.delay(this.updateBuffer);this.updateColumnHeadings();this.applyingState||c.saveState();c.fireEvent("filterupdate",this,b)}},onBeforeLoad:function(a,b){var c;b.params=b.params||{};this.cleanParams(b.params);c=this.buildQuery(this.getFilterData());a.getProxy().isSynchronous&&this.hasActiveFilter()&&(b.filters=[new Ext.util.Filter({filterFn:this.getRecordFilter()})]);Ext.apply(b.params,c)},onLoad:function(a){this.filters.length&&
a.filterBy(this.getRecordFilter())},onRefresh:function(){this.updateColumnHeadings()},updateColumnHeadings:function(){var a=this,b=a.view.headerCt;b&&b.items.each(function(b){var e=a.getFilter(b.dataIndex);b[e&&e.active?"addCls":"removeCls"](a.filterCls)})},reload:function(){var a=this.view.getStore();this.local?(a.clearFilter(!0),a.filterBy(this.getRecordFilter()),a.sort()):(this.deferredUpdate.cancel(),a.buffered&&a.data.clear(),a.loadPage(1))},getRecordFilter:function(){var a=[],b,c,e=this.lockingPartner;
this.filters.each(function(b){b.active&&a.push(b)});e&&e.filters.each(function(b){b.active&&a.push(b)});b=a.length;return function(e){for(c=0;c<b;c++)if(!a[c].validateRecord(e))return!1;return!0}},hasActiveFilter:function(){var a=!1;this.filters.each(function(b){if(b.active)return a=!0,!1});return a},addFilter:function(a){var b=this.getGridPanel().columnManager.getColumns(),c,e,f;c=0;for(e=b.length;c<e;c++)f=b[c],f.dataIndex===a.dataIndex&&(f.filter=a);this.view.headerCt.menu?this.createFilters():
this.view.headerCt.getMenu();c=0;for(b=this.filters.items.length;c<b;c++)if(e=this.filters.items[c],e.dataIndex===a.dataIndex)return e},addFilters:function(a){if(a){var b,c;b=0;for(c=a.length;b<c;b++)this.addFilter(a[b])}},getFilter:function(a){return this.filters.get(a)},clearFilters:function(){this.filters.each(function(a){a.setActive(!1)})},getFilterItems:function(){return this.lockingPartner?this.filters.items.concat(this.lockingPartner.filters.items):this.filters.items},getFilterData:function(){var a=
this.getFilterItems(),b=[],c,e,f,g,h,k;c=0;for(e=a.length;c<e;c++)if(f=a[c],f.active)for(g=[].concat(f.serialize()),h=0,k=g.length;h<k;h++)b.push({field:f.dataIndex,data:g[h]});return b},buildQuery:function(a){var b={},c,e,f,g,h=a.length;if(this.encode){g=[];for(c=0;c<h;c++)e=a[c],g.push(Ext.apply({},{field:e.field},e.data));0<g.length&&(b[this.paramPrefix]=Ext.JSON.encode(g))}else for(c=0;c<h;c++)for(g in e=a[c],f=[this.paramPrefix,"[",c,"]"].join(""),b[f+"[field]"]=e.field,f+="[data]",e.data)b[[f,
"[",g,"]"].join("")]=e.data[g];return b},cleanParams:function(a){if(this.encode)delete a[this.paramPrefix];else{var b,c;b=RegExp("^"+this.paramPrefix+"[[0-9]+]");for(c in a)b.test(c)&&delete a[c]}},getFilterClass:function(a){switch(a){case "auto":a="string";break;case "int":case "float":a="numeric";break;case "bool":a="boolean"}return Ext.ClassManager.getByAlias("gridfilter."+a)}});
Ext.define("Ext.ux.grid.menu.ListMenu",{extend:"Ext.menu.Menu",idField:"id",labelField:"text",loadingText:"Loading...",loadOnShow:!0,single:!1,plain:!0,constructor:function(a){var b;this.selected=[];this.addEvents("checkchange");this.callParent(arguments);b=this.grid.store;if(this.store)this.add({text:this.loadingText,iconCls:"loading-indicator"}),this.store.on("load",this.onLoad,this);else if(b.data.length)this.createMenuStore();else b.on("load",this.createMenuStore,this,{single:!0})},destroy:function(){var a=
this.store;a&&(this.autoStore?a.destroyStore():a.un("unload",this.onLoad,this));this.callParent()},show:function(){!this.loadOnShow||this.loaded||this.store.loading||this.store.load();this.callParent()},onLoad:function(a,b){var c,e,f,g,h={checkchange:this.checkChange,scope:this};Ext.suspendLayouts();this.removeAll(!0);c=this.single?Ext.id():null;f=0;for(g=b.length;f<g;f++)e=b[f].get(this.idField),this.add(Ext.create("Ext.menu.CheckItem",{text:b[f].get(this.labelField),group:c,checked:Ext.Array.contains(this.selected,
e),hideOnClick:!1,value:e,listeners:h}));this.loaded=!0;Ext.resumeLayouts(!0);this.fireEvent("load",this,b)},createMenuStore:function(){var a=[],b,c,e;this.options=this.grid.store.collect(this.dataIndex,!1,!0);b=0;for(c=this.options.length;b<c;b++)switch(e=this.options[b],Ext.type(e)){case "array":a.push(e);break;case "object":a.push([e[this.idField],e[this.labelField]]);break;default:null!=e&&a.push([e,e])}this.store=Ext.create("Ext.data.ArrayStore",{fields:[this.idField,this.labelField],data:a,
listeners:{load:this.onLoad,scope:this}});this.autoStore=this.loaded=!0},getSelected:function(){return this.selected},setSelected:function(a){a=this.selected=[].concat(a);this.loaded&&this.items.each(function(b){b.setChecked(!1,!0);for(var c=0,e=a.length;c<e;c++)b.value==a[c]&&b.setChecked(!0,!0)})},checkChange:function(a,b){var c=[];this.items.each(function(a){a.checked&&c.push(a.value)});this.selected=c;this.fireEvent("checkchange",a,b)}});
Ext.define("Ext.ux.grid.menu.RangeMenu",{extend:"Ext.menu.Menu",fieldCls:"Ext.form.field.Number",itemIconCls:{gt:"ux-rangemenu-gt",lt:"ux-rangemenu-lt",eq:"ux-rangemenu-eq"},fieldLabels:{gt:"Greater Than",lt:"Less Than",eq:"Equal To"},menuItemCfgs:{emptyText:"Enter Number...",selectOnFocus:!1,width:155},menuItems:["lt","gt","-","eq"],plain:!0,constructor:function(a){var b,c,e,f,g,h,k;this.callParent(arguments);b=this.fields=this.fields||{};c=this.fieldCfg=this.fieldCfg||{};this.addEvents("update");
this.updateTask=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this);e=0;for(f=this.menuItems.length;e<f;e++)g=this.menuItems[e],"-"!==g&&(h={itemId:"range-"+g,enableKeyEvents:!0,hideEmptyLabel:!1,labelCls:"ux-rangemenu-icon "+this.itemIconCls[g],labelSeparator:"",labelWidth:29,listeners:{scope:this,change:this.onInputChange,keyup:this.onInputKeyUp,el:{click:this.stopFn}},activate:Ext.emptyFn,deactivate:Ext.emptyFn},Ext.apply(h,Ext.applyIf(b[g]||{},c[g]),this.menuItemCfgs),k=h.fieldCls||this.fieldCls,
g=b[g]=Ext.create(k,h)),this.add(g)},stopFn:function(a){a.stopPropagation()},fireUpdate:function(){this.fireEvent("update",this)},getValue:function(){var a={},b=this.fields,c,e;for(c in b)b.hasOwnProperty(c)&&(e=b[c],e.isValid()&&null!==e.getValue()&&(a[c]=e.getValue()));return a},setValue:function(a){var b=this.fields,c,e;for(c in b)b.hasOwnProperty(c)&&(e=b[c],e.suspendEvents(),e.setValue(c in a?a[c]:""),e.resumeEvents());this.fireEvent("update",this)},onInputKeyUp:function(a,b){b.getKey()===b.RETURN&&
a.isValid()&&(b.stopEvent(),this.hide())},onInputChange:function(a){var b=this.fields,c=b.eq,e=b.gt,b=b.lt;a==c?(e&&e.setValue(null),b&&b.setValue(null)):c.setValue(null);this.updateTask.delay(this.updateBuffer)}});
Ext.define("Ext.ux.grid.filter.Filter",{extend:"Ext.util.Observable",active:!1,dataIndex:null,menu:null,updateBuffer:500,constructor:function(a){Ext.apply(this,a);this.addEvents("activate","deactivate","serialize","update");Ext.ux.grid.filter.Filter.superclass.constructor.call(this);this.menu=this.createMenu(a);this.init(a);a&&a.value&&(this.setValue(a.value),this.setActive(!1!==a.active,!0),delete a.value)},destroy:function(){this.menu&&this.menu.destroy();this.clearListeners()},init:Ext.emptyFn,
createMenu:function(a){a.plain=!0;return Ext.create("Ext.menu.Menu",a)},getValue:Ext.emptyFn,setValue:Ext.emptyFn,isActivatable:function(){return!0},getSerialArgs:Ext.emptyFn,validateRecord:function(){return!0},serialize:function(){var a=this.getSerialArgs();this.fireEvent("serialize",a,this);return a},fireUpdate:function(){this.active&&this.fireEvent("update",this);this.setActive(this.isActivatable())},setActive:function(a,b){this.active!=a&&(this.active=a,!0!==b&&this.fireEvent(a?"activate":"deactivate",
this))}});
Ext.define("Ext.ux.grid.filter.BooleanFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.boolean",defaultValue:!1,yesText:"Yes",noText:"No",init:function(a){a=Ext.id();this.options=[Ext.create("Ext.menu.CheckItem",{text:this.yesText,group:a,checked:!0===this.defaultValue}),Ext.create("Ext.menu.CheckItem",{text:this.noText,group:a,checked:!1===this.defaultValue})];this.menu.add(this.options[0],this.options[1]);for(a=0;a<this.options.length;a++)this.options[a].on("click",this.fireUpdate,this),
this.options[a].on("checkchange",this.fireUpdate,this)},getValue:function(){return this.options[0].checked},setValue:function(a){this.options[a?0:1].setChecked(!0)},getSerialArgs:function(){return{type:"boolean",value:this.getValue()}},validateRecord:function(a){return a.get(this.dataIndex)==this.getValue()}});
Ext.define("Ext.ux.grid.filter.DateFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.date",uses:["Ext.picker.Date","Ext.menu.Menu"],afterText:"After",beforeText:"Before",compareMap:{before:"lt",after:"gt",on:"eq"},dateFormat:"m/d/Y",menuItems:["before","after","-","on"],menuItemCfgs:{selectOnFocus:!0,width:125},onText:"On",pickerOpts:{},init:function(a){var b,c,e,f;a=Ext.apply(this.pickerOpts,{xtype:"datepicker",minDate:this.minDate,maxDate:this.maxDate,format:this.dateFormat,listeners:{scope:this,
select:this.onMenuSelect}});this.fields={};b=0;for(c=this.menuItems.length;b<c;b++)e=this.menuItems[b],"-"!==e&&(f={itemId:"range-"+e,text:this[e+"Text"],menu:Ext.create("Ext.menu.Menu",{plain:!0,items:[Ext.apply(a,{itemId:e})]}),listeners:{scope:this,checkchange:this.onCheckChange}},e=this.fields[e]=Ext.create("Ext.menu.CheckItem",f)),this.menu.add(e);this.values={}},onCheckChange:function(a,b){var c=a.menu.items.first(),e=c.itemId,f=this.values;b?f[e]=c.getValue():delete f[e];this.setActive(this.isActivatable());
this.fireEvent("update",this)},onInputKeyUp:function(a,b){b.getKey()===b.RETURN&&a.isValid()&&(b.stopEvent(),this.menu.hide())},onMenuSelect:function(a,b){var c=this.fields,e=this.fields[a.itemId];e.setChecked(!0);e===c.on?(c.before.setChecked(!1,!0),c.after.setChecked(!1,!0)):(c.on.setChecked(!1,!0),e===c.after&&this.getFieldValue("before")<b?c.before.setChecked(!1,!0):e===c.before&&this.getFieldValue("after")>b&&c.after.setChecked(!1,!0));this.values[a.itemId]=b;this.fireEvent("update",this);a.up("menu").hide()},
getValue:function(){var a,b={};for(a in this.fields)this.fields[a].checked&&(b[a]=this.getFieldValue(a));return b},setValue:function(a,b){for(var c in this.fields)a[c]?(this.getPicker(c).setValue(a[c]),this.fields[c].setChecked(!0)):b||this.fields[c].setChecked(!1);this.fireEvent("update",this)},isActivatable:function(){for(var a in this.fields)if(this.fields[a].checked)return!0;return!1},getSerialArgs:function(){var a=[],b;for(b in this.fields)this.fields[b].checked&&a.push({type:"date",comparison:this.compareMap[b],
value:Ext.Date.format(this.getFieldValue(b),this.dateFormat)});return a},getFieldValue:function(a){return this.values[a]},getPicker:function(a){return this.fields[a].menu.items.first()},validateRecord:function(a){var b,c=a.get(this.dataIndex),e=Ext.Date.clearTime;if(!Ext.isDate(c))return!1;c=e(c,!0).getTime();for(b in this.fields)if(this.fields[b].checked&&(a=e(this.getFieldValue(b),!0).getTime(),"before"===b&&a<=c||"after"===b&&a>=c||"on"===b&&a!=c))return!1;return!0}});
Ext.define("Ext.ux.grid.filter.DateTimeFilter",{extend:"Ext.ux.grid.filter.DateFilter",alias:"gridfilter.datetime",dateDefaults:{xtype:"datepicker",format:"m/d/Y"},timeDefaults:{xtype:"timepicker",width:100,height:200,format:"g:i A"},dockDefaults:{dock:"top",buttonText:"Filter"},selectDateToFilter:!0,positionDatepickerFirst:!0,reTime:/\s(am|pm)/i,addTimeSelection:function(a,b){var c=b.getSelectionModel().getSelection(),e,f,g,h=0;e=[];var k=["setHours","setMinutes","setSeconds","setMilliseconds"];
if(c.length)for(e=c[0].get("disp"),e=e.replace(this.reTime,"").split(":"),c=e.length;h<c;h++)if(f=k[h],g=e[h])a[f](parseInt(g,10));return a},init:function(a){var b=Ext.applyIf(this.date||{},this.dateDefaults),c=Ext.applyIf(this.time||{},this.timeDefaults),e=this.dock,f={scope:this,click:this.onMenuSelect},g={scope:this,select:this.onMenuSelect},h;h=[b,c];a=0;this.positionDatepickerFirst||(h=h.reverse(),a=1);h=Ext.apply(this.pickerOpts,{xtype:e?"panel":"container",layout:"hbox",items:h});e?e&&(this.selectDateToFilter=
null,e.dockedItems?(h.dockedItems=e.dockedItems,h.dockedItems.items[e.bindToItem||0].listeners=f):(Ext.isBoolean(e)&&(e={}),e=Ext.applyIf(e,this.dockDefaults),h.dockedItems={xtype:"toolbar",dock:e.dock,items:[{xtype:"button",text:e.buttonText,flex:1,listeners:f}]})):this.selectDateToFilter?b.listeners=g:c.listeners=g;this.fields={};b=0;for(c=this.menuItems.length;b<c;b++)e=this.menuItems[b],"-"!==e&&(h.items[a].itemId=e,f={itemId:e,text:this[e+"Text"],menu:Ext.create("Ext.menu.Menu",{items:h}),listeners:{scope:this,
checkchange:this.onCheckChange}},e=this.fields[e]=Ext.create("Ext.menu.CheckItem",f)),this.menu.add(e);this.values={}},onCheckChange:function(a,b){var c=a.menu,e=c.down("timepicker"),c=c.down("datepicker"),f=c.itemId,g=this.values;b?g[f]=this.addTimeSelection(c.value,e):delete g[f];this.setActive(this.isActivatable());this.fireEvent("update",this)},onMenuSelect:function(a,b){var c=this.menu,e=this.fields;this.dock&&(a=c.getFocusEl().down("datepicker"));c=this.fields[a.itemId];c.setChecked(!0);c===
e.on?(e.before.setChecked(!1,!0),e.after.setChecked(!1,!0)):(e.on.setChecked(!1,!0),c===e.after&&this.getFieldValue("before")<b?e.before.setChecked(!1,!0):c===e.before&&this.getFieldValue("after")>b&&e.after.setChecked(!1,!0));this.fireEvent("update",this);a.ownerCt.ownerCt.hide()},getSerialArgs:function(){var a,b=this.fields,c=[],e=Ext.apply(this.dateDefaults,this.date||{}),f=Ext.apply(this.timeDefaults,this.time||{});for(a in b)b[a].checked&&c.push({type:"datetime",comparison:this.compareMap[a],
value:Ext.Date.format(this.getFieldValue(a),e.format+" "+f.format)});return c},setValue:function(a,b){var c=this.fields,e,f,g;for(e in c)(f=a[e])?(g=this.menu.down('datepicker[itemId\x3d"'+e+'"]'),g.update(f),g.value=f,c[e].setChecked(!0)):b||c[e].setChecked(!1);this.fireEvent("update",this)},validateRecord:function(a){var b,c=a.get(this.dataIndex);if(!Ext.isDate(c))return!1;c=c.getTime();for(b in this.fields)if(this.fields[b].checked&&(a=this.getFieldValue(b).getTime(),"before"===b&&a<=c||"after"===
b&&a>=c||"on"===b&&a!=c))return!1;return!0}});
Ext.define("Ext.ux.grid.filter.ListFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.list",phpMode:!1,init:function(a){this.dt=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},createMenu:function(a){a=Ext.create("Ext.ux.grid.menu.ListMenu",a);a.on("checkchange",this.onCheckChange,this);return a},getValue:function(){return this.menu.getSelected()},setValue:function(a){this.menu.setSelected(a);this.fireEvent("update",this)},isActivatable:function(){return 0<this.getValue().length},
getSerialArgs:function(){return{type:"list",value:this.phpMode?this.getValue().join(","):this.getValue()}},onCheckChange:function(){this.dt.delay(this.updateBuffer)},validateRecord:function(a){var b=this.getValue();return-1<Ext.Array.indexOf(b,a.get(this.dataIndex))}});
Ext.define("Ext.ux.grid.filter.NumericFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.numeric",uses:["Ext.form.field.Number"],createMenu:function(a){a=Ext.create("Ext.ux.grid.menu.RangeMenu",a);a.on("update",this.fireUpdate,this);return a},getValue:function(){return this.menu.getValue()},setValue:function(a){this.menu.setValue(a)},isActivatable:function(){var a=this.getValue(),b;for(b in a)if(void 0!==a[b])return!0;return!1},getSerialArgs:function(){var a,b=[],c=this.menu.getValue();
for(a in c)b.push({type:"numeric",comparison:a,value:c[a]});return b},validateRecord:function(a){a=a.get(this.dataIndex);var b=this.getValue(),c=Ext.isNumber;return c(b.eq)&&a!=b.eq||c(b.lt)&&a>=b.lt||c(b.gt)&&a<=b.gt?!1:!0}});
Ext.define("Ext.ux.grid.filter.StringFilter",{extend:"Ext.ux.grid.filter.Filter",alias:"gridfilter.string",iconCls:"ux-gridfilter-text-icon",emptyText:"Enter Filter Text...",selectOnFocus:!0,width:125,init:function(a){Ext.applyIf(a,{enableKeyEvents:!0,labelCls:"ux-rangemenu-icon "+this.iconCls,hideEmptyLabel:!1,labelSeparator:"",labelWidth:29,listeners:{scope:this,keyup:this.onInputKeyUp,el:{click:function(a){a.stopPropagation()}}}});this.inputItem=Ext.create("Ext.form.field.Text",a);this.menu.add(this.inputItem);
this.menu.showSeparator=!1;this.updateTask=Ext.create("Ext.util.DelayedTask",this.fireUpdate,this)},getValue:function(){return this.inputItem.getValue()},setValue:function(a){this.inputItem.setValue(a);this.fireEvent("update",this)},isActivatable:function(){return 0<this.inputItem.getValue().length},getSerialArgs:function(){return{type:"string",value:this.getValue()}},validateRecord:function(a){a=a.get(this.dataIndex);return"string"!=typeof a?0===this.getValue().length:-1<a.toLowerCase().indexOf(this.getValue().toLowerCase())},
onInputKeyUp:function(a,b){b.getKey()==b.RETURN&&a.isValid()?(b.stopEvent(),this.menu.hide()):this.updateTask.delay(this.updateBuffer)}});
Ext.define("Ext.ux.CheckColumn",{extend:"Ext.grid.column.Column",alias:"widget.checkcolumn",stopSelection:!0,tdCls:Ext.baseCSSPrefix+"grid-cell-checkcolumn",constructor:function(){this.addEvents("beforecheckchange","checkchange");this.callParent(arguments)},processEvent:function(a,b,c,e,f,g,h,k){var l="keydown"===a&&g.getKey(),m="mousedown"==a;if(m||l==g.ENTER||l==g.SPACE){var l=this.dataIndex,n=!h.get(l);return!1!==this.fireEvent("beforecheckchange",this,e,n)?(h.set(l,n),this.fireEvent("checkchange",
this,e,n),m&&g.stopEvent(),this.stopSelection||b.selModel.selectByPosition({row:e,column:f}),!1):!this.stopSelection}return this.callParent(arguments)},renderer:function(a){var b=Ext.baseCSSPrefix,c=[b+"grid-checkheader"];a&&c.push(b+"grid-checkheader-checked");return'\x3cdiv class\x3d"'+c.join(" ")+'"\x3e\x26#160;\x3c/div\x3e'}});
Ext.define("com.trackplus.util.HelpWrapperComponent",{extend:"Ext.container.Container",config:{inputComp:null,helpStr:null,helpExpanded:!1,flexInputComp:!1},layout:"anchor",defaults:{anchor:"100%"},border:!1,bodyBorder:!1,btnHelp:null,helpArea:null,panWrapper:null,initComponent:function(){null==this.helpExpanded&&(this.helpExpanded=!1);null==this.flexInputComp&&(this.flexInputComp=!1);this.callParent();var a=this.createChildren(this.disabled||this.inputComp.disabled);this.add(a);this.setDisabled(this.disabled||
this.inputComp.disabled)},createChildren:function(a){var b=[];this.btnHelp=Ext.create("Ext.button.Button",{style:{marginBottom:"5px",marginLeft:"5px",border:"none",background:"none"},iconCls:"help16",enableToggle:!1,scale:"small",handler:this.showHideHelpArea,disabled:a,scope:this});this.btnHelp.focusable=!1;!0==this.flexInputComp&&(this.inputComp.flex=1);this.panWrapper=Ext.create("Ext.container.Container",{border:!1,itemId:"panWrapper",layout:"hbox",items:[this.inputComp,this.btnHelp]});this.helpArea=
Ext.create("Ext.Component",{html:this.helpStr,margin:"0 5 5 5",border:!0,disabled:a,cls:"infoBox2",hidden:!1===this.helpExpanded});b.push(this.panWrapper);b.push(this.helpArea);return b},showHideHelpArea:function(){this.helpArea.setVisible(!this.helpArea.isVisible())},setDisabled:function(a){this.callParent(!1);null!=this.inputComp.setDisabled&&Ext.isFunction(this.inputComp.setDisabled)&&this.inputComp.setDisabled(a);this.btnHelp.setDisabled(a);this.helpArea.setDisabled(a)},getInputComponent:function(){return this.inputComp},
getHelpButton:function(){return this.btnHelp}});Ext.define("com.trackplus.SpellCheckTextField",{extend:"Ext.form.field.Text",initComponent:function(){this.addListener("afterrender",this.initSpellCheck,this);this.callParent()},initSpellCheck:function(){this.inputEl.dom.setAttribute("spellcheck","true");this.inputEl.on("contextmenu",function(a){a.stopPropagation();return!1},this)}});
Ext.define("util.ControlWithHelpFactory",{extend:"Ext.Base",singleton:!0,constructor:function(a){},labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:700,getControl:function(){var a=this;Ext.Array.each(arguments,function(b,c,e){a=a.getComponent(b);if(null==a)return!1},this);return a},getHelpWrapper:function(){var a=this;Ext.Array.each(arguments,function(b,c,e){a=c==e.length-1?a.getComponent(CWHF.getWrapperItemId(b)):a.getComponent(b);if(null==a)return!1},this);
return a},getWrapperItemId:function(a){return a+".wrp"},getWrappedControl:function(){var a=this;Ext.Array.each(arguments,function(b,c,e){a=c==e.length-1?a.getComponent(CWHF.getWrapperItemId(b)):a.getComponent(b);if(null==a)return!1},this);return null!=a?a.getInputComponent():null},getLabel:function(a,b){var c="";null!=a&&""!=a&&(c=null!=b&&b.labelIsLocalized?a:getText(a));return c},addOtherSettings:function(a,b,c){if(null!=b)for(propertyName in null!=c&&this.addBlankText(a,b,c),b)a[propertyName]=
b[propertyName]},addBlankText:function(a,b,c){null!=b&&null!=b.allowBlank&&!1==b.allowBlank&&null==b.blankText&&(a.blankText=getText("common.err.required",c))},createHiddenField:function(a,b,c){a={xtype:"hiddenfield",name:a,itemId:a};if(null!=b)for(propertyName in b)a[propertyName]=b[propertyName];null!=c&&(a.listeners=c);return Ext.create("Ext.form.field.Hidden",a)},createTextField:function(a,b,c,e){a=this.getLabel(a,c);b={xtype:"textfield",fieldLabel:a,name:b,itemId:b,msgTarget:"under",labelStyle:{overflow:"hidden"},
labelWidth:this.labelWidth,labelAlign:this.alignR,width:this.textFieldWidth};null!=e&&(b.listeners=e);this.addOtherSettings(b,c,a);return Ext.create("Ext.form.field.Text",b)},createTextFieldWithHelp:function(a,b,c,e,f){b=this.createTextField(a,b,c,e);a=getText(a+".help");if(null==a)return b;null==f&&(f=this.getWrapperItemId(b.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:f})},getTreeWithLabel:function(a,b,c,e,f){null==e&&(e=150);null==f&&(f=
"right");if(null==a)return b;b.flex=1;a=this.getLabelCmp(a,f,e);return this.wrapLabelAndTree(a,b,c)},getLabelCmp:function(a,b,c){return Ext.create("Ext.Component",{cls:"right"==b?"x-form-item-label-right x-form-item-label":"x-form-item-label",style:{marginRight:"5px"},html:a+":",width:c})},wrapLabelAndTree:function(a,b,c){return Ext.create("Ext.container.Container",{itemId:c,border:!1,layout:{type:"hbox",pack:"start",align:"stretch"},items:[a,b]})},createColorPicker:function(a,b,c){a=this.getLabel(a,
c);b={xtype:"textfield",fieldLabel:a,name:b,itemId:b,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,width:this.textFieldWidth};this.addOtherSettings(b,c,a);return Ext.create("com.trackplus.util.ColorField",b)},createNumberField:function(a,b,c,e,f,g){var h=this.getLabel(a,g);a={xtype:"numberfield",fieldLabel:h,hideLabel:null==a,msgTarget:"under",name:b,itemId:b,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,width:this.textFieldWidth,
decimalSeparator:com.trackplus.TrackplusConfig.DecimalSeparator};null!=c&&(a.decimalPrecision=c);null!=e&&(a.minValue=e);null!=f&&(a.maxValue=f);this.addOtherSettings(a,g,h);return Ext.create("Ext.form.field.Number",a)},createNumberFieldWithHelp:function(a,b,c,e,f,g,h){b=this.createNumberField(a,b,c,e,f,g);a=getText(a+".help");if(null==a)return b;null==h&&(h=this.getWrapperItemId(b.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:h})},createDateField:function(a,
b,c){a=this.getLabel(a,c);b={xtype:"datefield",fieldLabel:a,name:b,itemId:b,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,width:this.textFieldWidth,format:com.trackplus.TrackplusConfig.DateFormat,submitFormat:com.trackplus.TrackplusConfig.DateSubmitFormat};this.addOtherSettings(b,c,a);return Ext.create("Ext.form.field.Date",b)},createTimeField:function(a,b,c){a=this.getLabel(a,c);b={xtype:"timefield",fieldLabel:a,name:b,itemId:b,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,
labelAlign:this.alignR,width:this.textFieldWidth,format:com.trackplus.TrackplusConfig.TimeFormatNoSeconds};this.addOtherSettings(b,c,a);return Ext.create("Ext.form.field.Time",b)},createTimeFieldWithHelp:function(a,b,c,e){b=this.createTimeField(a,b,c);a=getText(a+".help");if(null==a)return b;null==e&&(e=this.getWrapperItemId(b.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:e})},createDateTimeField:function(a,b,c,e,f,g){a=this.getLabel(a,e);
b=CWHF.createDateField(null,b,e);c=CWHF.createTimeField(null,c,f);c={xtype:"fieldcontainer",fieldLabel:a,layout:"hbox",labelWidth:this.labelWidth,labelAlign:this.alignR,labelStyle:{overflow:"hidden"},items:[b,c]};this.addOtherSettings(c,g,a);return Ext.create("Ext.form.FieldContainer",c)},createTextAreaField:function(a,b,c){var e=this.getLabel(a,c);a={xtype:"textareafield",fieldLabel:this.getLabel(a,c),name:b,itemId:b,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,
width:this.textFieldWidth};this.addOtherSettings(a,c,e);return Ext.create("Ext.form.field.TextArea",a)},createTextAreaFieldWithHelp:function(a,b,c,e){b=this.createTextAreaField(a,b,c);a=getText(a+".help");if(null==a)return b;null==e&&(e=this.getWrapperItemId(b.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:e})},createHtmlEditorField:function(a,b,c){a=this.getLabel(a,c);b={fieldLabel:a,name:b,itemId:b,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,
labelAlign:this.alignR,defaultValue:""};this.addOtherSettings(b,c,a);return Ext.create("Ext.form.field.HtmlEditor",b)},txtRTEIndex:0,RTEInstanceReady:{},createRichTextEditorField:function(a,b,c,e,f){var g;this.txtRTEIndex++;g="rte"+this.txtRTEIndex;a={name:a,id:g};this.addOtherSettings(a,b);b=Ext.create("Ext.form.field.TextArea",a);b.addListener("afterrender",this.initRTEditor,this,{id:g,focus:c,resize:e,ckeditorCfg:f});return b},resizeRTEditor:function(a,b,c,e,f,g){e=CKEDITOR.instances[g.id+"-inputEl"];
g=!0==this.RTEInstanceReady[g.id];null!=a.fieldLabel&&(b-=a.labelWidth);e&&g&&e.resize(b,c)},destroyRTEditor:function(a,b){var c=b.id+"-inputEl";this.RTEInstanceReady[b.id]=!1;if(c=CKEDITOR.instances[c])CKEDITOR.remove(c),c.destroy()},initRTEditor:function(a,b){var c=this,e=b.id+"-inputEl",f=b.resize,g=getLocale();null==g&&(g="en");var h=CKEDITOR.instances[e];null!=h&&(c.RTEInstanceReady[b.id]=!1,CKEDITOR.remove(h));if(null!=a&&a.isDisabled())return!1;var k="",l="",m="",h=b.ckeditorCfg;null!=h&&null!=
h.workItemID&&(k="browseFile.action?type\x3dImages\x26workItemID\x3d"+h.workItemID,l="browseFile!uploadFile.action?Type\x3dFile\x26workItemID\x3d"+h.workItemID,m="browseFile!uploadFile.action?Type\x3dImage\x26workItemID\x3d"+h.workItemID);g={customConfig:sBasePath+"cktrackplusconfig.js",contentsCss:com.trackplus.TrackplusConfig.htmlEditorCSS,filebrowserUploadUrl:l,filebrowserImageBrowseUrl:k,filebrowserImageUploadUrl:m,simpleuploads_maxFileSize:com.trackplus.TrackplusConfig.MAXFILESIZE,language:g};
if(null!=h)for(propertyName in h)g[propertyName]=h[propertyName];var n=CKEDITOR.replace(e,g);if(!0==b.focus)n.on("instanceReady",function(a){n.focus()});n.on("blur",function(a){n.updateElement()});!0==f&&null!=a&&(a.addListener("resize",c.resizeRTEditor,c,b),n.on("instanceReady",function(e){c.RTEInstanceReady[b.id]=!0;e=a.getWidth();null!=a.fieldLabel&&(e-=a.labelWidth);var f=a.getHeight();n.resize(e,f)}));CKEDITOR.on("instanceReady",function(a){a=a.editor;a.on("simpleuploads.startUpload",function(a){});
a.on("simpleuploads.endUpload",function(a){a.data.ok||alert("Upload of "+a.data.name+" has failed.")});a.on("simpleuploads.finishedUpload",function(a){})})},submitRTEditor:function(a){(a=CKEDITOR.instances[a.id+"-inputEl"])&&a.updateElement()},refreshRTEditorValue:function(a,b){a.setValue(b);var c=CKEDITOR.instances[a.id+"-inputEl"];c&&c.setData(b,function(){this.checkDirty()})},createCheckbox:function(a,b,c,e){a={xtype:"checkbox",inputValue:!0,fieldLabel:this.getLabel(a,c),name:b,itemId:b,labelStyle:{overflow:"hidden"},
labelWidth:this.labelWidth,labelAlign:this.alignR,width:this.textFieldWidth};null!=c&&null!=c.value&&(a.checked=c.value,delete c.value);this.addOtherSettings(a,c);null!=e&&(a.listeners=e);return Ext.create("Ext.form.field.Checkbox",a)},createCheckboxWithHelp:function(a,b,c,e,f){b=this.createCheckbox(a,b,c,e);a=getText(a+".help");if(null==a)return b;null==f&&(f=this.getWrapperItemId(b.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:f})},createCombo:function(a,
b,c,e,f){var g=[],h=!1;null!=c&&null!=c.data&&(g=c.data,delete c.data);null!=c&&null!=c.includeEmpty&&(h=c.includeEmpty,delete c.includeEmpty);var k="int";null!=c&&null!=c.idType&&(k=c.idType,delete c.idType);var l="label";null!=c&&null!=c.displayField&&(l=c.displayField);a=this.getLabel(a,c);b={xtype:"combo",store:Ext.create("Ext.data.Store",{data:g,fields:[{name:"id",type:k,useNull:!0},{name:"label",type:"string"}],autoLoad:!1}),displayField:"label",valueField:"id",queryMode:"local",triggerAction:"all",
name:b,itemId:b,editable:!1,fieldLabel:a,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,width:this.textFieldWidth};!0==h&&(b.tpl=new Ext.XTemplate('\x3ctpl for\x3d"."\x3e\x3cli style\x3d"min-height:22px;" class\x3d"x-boundlist-item" role\x3d"option"\x3e{'+l+"}\x3c/li\x3e\x3c/tpl\x3e"));null!=f&&(b.itemId=f);null!=e&&(b.listeners=e);this.addOtherSettings(b,c,a);return Ext.create("Ext.form.field.ComboBox",b)},createComboWithHelp:function(a,b,c,e,f,g){b=this.createCombo(a,
b,c,e,f);a=getText(a+".help");if(null==a)return b;null==g&&(g=this.getWrapperItemId(b.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:g})},createMultiSelect:function(a,b,c,e,f){var g=[];if(null!=c){null!=c.data&&(g=c.data,delete c.data);var h="int";null!=c.idType&&(h=c.idType,delete c.idType);var k="";null!=c.fieldLabel&&(k=this.getLabel(c.fieldLabel,c),delete c.fieldLabel)}a={xtype:"multiselect",itemId:f,listTitle:this.getLabel(a,c),fieldLabel:k,
store:Ext.create("Ext.data.Store",{data:g,fields:[{name:"id",type:h},{name:"label",type:"string"}],autoLoad:!1}),displayField:"label",valueField:"id",labelAlign:this.alignR,name:b};null!=e&&(a.listeners=e);null!=f&&(a.itemId=f);if(null!=c)for(property in c)a[property]=c[property];return Ext.create("Ext.ux.form.MultiSelect",a)},createMultiSelectWithHelp:function(a,b,c,e,f,g,h,k,l){b=this.createMultiSelect(a,b,c,e,f,g,h,k);a=getText(a+".help");if(null==a)return b;null==l&&(l=this.getWrapperItemId(b.getItemId()));
return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:l})},getRadioGroup:function(a,b,c,e,f,g){a={xtype:"radiogroup",itemId:a,layout:"hbox",defaults:{margin:"0 5 0 0"},labelStyle:{overflow:"hidden"},labelAlign:this.alignR,width:c};null==e&&(e=[]);a.items=e;null!=g&&(a.listeners=g);null==b?(a.fieldLabel="",a.labelSeparator="",a.labelWidth=0):(a.fieldLabel=this.getLabel(b,f),a.labelWidth=this.labelWidth);this.addOtherSettings(a,f);return Ext.create("Ext.form.RadioGroup",
a)},getRadioGroupWithHelp:function(a,b,c,e,f,g,h){a=this.getRadioGroup(a,b,c,e,f,g);b=getText(b+".help");if(null==b)return a;null==h&&(h=this.getWrapperItemId(a.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:a,helpStr:b,itemId:h})},getRadioButtonItems:function(a,b,c,e,f,g,h){var k=[];Ext.Array.each(a,function(a){k.push({name:b,inputValue:a[c],boxLabel:this.getLabel(a[e],{labelIsLocalized:h}),checked:a[c]==f,disabled:g})},this);return k},getSelectedRadioButtonValue:function(a){a=
a.getChecked();var b=null;0<a.length&&(checkedRadio=a[0],null!=checkedRadio&&(b=checkedRadio.getSubmitValue()));return b},createLabelComponent:function(a,b,c){a={xtype:"displayfield",fieldLabel:this.getLabel(a,c),name:b,itemId:b,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,fieldStyle:{height:"auto"}};this.addOtherSettings(a,c);return a},createFileField:function(a,b,c,e){a=this.getLabel(a,c);b={xtype:"filefield",fieldLabel:a,itemId:b,name:b,buttonText:getText("common.btn.browse"),
labelWidth:this.labelWidth,labelAlign:this.alignR};null!=e&&(b.listeners=e);this.addOtherSettings(b,c,a);return Ext.create("Ext.form.field.File",b)},createMultipleSelectPicker:function(a,b,c,e,f){a=this.getLabel(a,f);b={localizedLabel:a,name:b,data:c,value:e,width:200,margin:"0 5 0 0",useRemoveBtn:!0};this.addOtherSettings(b,f,a);return Ext.create("com.trackplus.util.MultipleSelectPicker",b)},createSingleTreePicker:function(a,b,c,e,f,g){a=this.getLabel(a,f);b={fieldLabel:a,name:b,itemId:b,data:c,
value:e,width:200,margin:"0 5 0 0",labelAlign:this.alignR,useRemoveBtn:!1};this.addOtherSettings(b,f,a);null!=g&&(b.listeners=g);return Ext.create("com.trackplus.util.SingleTreePicker",b)},createSingleTreePickerWithHelp:function(a,b,c,e,f,g){b=this.createSingleTreePicker(a,b,c,e,f,g);a=getText(a+".help");if(null==a)return b;wrapperItemId=this.getWrapperItemId(b.getItemId());return Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:b,helpStr:a,itemId:wrapperItemId})},createMultipleTreePicker:function(a,
b,c,e,f,g){a=this.getLabel(a,f);b={localizedLabel:a,name:b,itemId:b,data:c,value:e,width:200,margin:"0 5 0 0",useRemoveBtn:!0};null!=f&&f.useNull&&(b.fieldLabel=a);this.addOtherSettings(b,f,a);null!=g&&(b.listeners=g);return Ext.create("com.trackplus.util.MultipleTreePicker",b)},createMultipleTreePickerWithHelp:function(a,b,c,e,f,g,h){b=this.createMultipleTreePicker(a,b,c,e,f,g);a=getText(a+".help");if(null==a)return b;null==h&&(h=this.getWrapperItemId(b.getItemId()));return Ext.create("com.trackplus.util.HelpWrapperComponent",
{inputComp:b,helpStr:a,itemId:h})},msgCt:null,showMsgInfo:function(a,b){this.showMsg(a,"info",b)},showMsgError:function(a){this.showMsg(a,"error")},showMsg:function(a,b,c){var e="msg-div";null!=c&&void 0!=c&&(e=c?"msg-div":"msg-div-bottom");this.msgCt?this.msgCt.id!=e&&(this.msgCt.remove(),this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:e},!0)):this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:e},!0);var e=null,f=Ext.WindowManager.getActive();null!=f&&(e=parseInt(f.el.getStyle("zIndex"),
10));null!=e&&this.msgCt.setStyle("z-index",""+(e+1));a=Ext.DomHelper.append(this.msgCt,'\x3cdiv class\x3d"msg msg-'+b+'"\x3cp\x3e'+a+"\x3c/p\x3e\x3c/div\x3e",!0);a.hide();b="t";null!=c&&void 0!=c&&(c||(b="b"));a.slideIn("t",{easing:"ease",duration:400}).ghost(b,{delay:3E3,duration:600,easing:"ease",remove:!0})},log1:function(a){com.trackplus.TrackplusConfig.isDebugEnabled&&console.log(a)}},function(){CWHF=this});
Ext.define("util.Upload",{extend:"Ext.Base",singleton:!0,constructor:function(a){},validateUpload:function(a){if(!this.formEdit.getForm().isValid())return Ext.MessageBox.show({title:getText("common.lbl.import"),msg:getText("common.err.fileNotSpecified"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR}),!1;var b=this.formEdit.getComponent("uploadFile"),c=a.expectedFileType;if(null!=c&&!c.test(b.getRawValue()))return Ext.MessageBox.alert(this.getTitle("common.lbl.import"),getText("common.err.fileExpectedType",
a.expectedFileType)),!1}},function(){Upload=this});com.trackplus.util.errorWin=null;
com.trackplus.util.showErrorMessage=function(a,b){null!=com.trackplus.util.errorWin&&com.trackplus.util.errorWin.destroy();var c=new Ext.Panel({collapsible:!1,region:"center",bodyBorder:!0,border:!1,layout:"fit",html:b});com.trackplus.util.errorWin=new Ext.Window({layout:"border",width:425,height:215,minWidth:425,closeAction:"hide",plain:!0,title:a,modal:!0,items:c,autoScroll:!0,buttons:[{text:closeLabel,handler:function(){com.trackplus.util.errorWin.hide()}}]});com.trackplus.util.errorWin.show()};
com.trackplus.util.win=null;
com.trackplus.util.showHtmlDetail=function(a,b){null!=com.trackplus.util.win&&com.trackplus.util.win.destroy();htmlDinamicContent=b;var c=new Ext.Panel({collapsible:!1,autoWidth:!0,autoHeight:!0,bodyBorder:!1,border:!1,id:"panelContent",html:'\x3cdiv class\x3d"containerRow1" style\x3d"width:100%;height:100%;border:medium none;"\x3e\x3ciframe allowtransparency\x3d"true" frameborder\x3d"0" width\x3d"100%" style\x3d"height:250px;background-color: transparent;"  src\x3d"richTextPreview.action"\x3e\x3c/iframe\x3e\x3c/div\x3e'});com.trackplus.util.win=
new Ext.Window({layout:"fit",width:550,height:350,closeAction:"hide",plain:!0,title:a,modal:!0,items:c,autoScroll:!0,buttons:[{text:getText("common.btn.close"),handler:function(){com.trackplus.util.win.hide()}}]});com.trackplus.util.win.show()};
Ext.define("com.trackplus.util.ColorField",{extend:"Ext.form.field.Trigger",triggerTip:"Please select a color.",onTriggerClick:function(){var a=this;picker=Ext.create("Ext.picker.Color",{ownerCt:this,renderTo:Ext.getBody(),floating:!0,hidden:!0,focusOnShow:!0,defaultAlign:"tl-bl?",style:{backgroundColor:"#fff"},listeners:{scope:this,select:function(b,c,e){a.setValue(c);a.setFieldStyle("background-color:#"+c+"; background-image: none;");picker.hide()},show:function(a,c){a.getEl().monitorMouseLeave(500,
a.hide,a)}}});picker.showBy(a.inputEl)}});
Ext.define("com.trackplus.util.AbstractMultiplePicker",{extend:"Ext.form.field.Picker",config:{localizedLabel:"",data:null,value:null,store:null,displayField:"label",valueField:"id",includeClear:!0,useNull:!1,useTooltip:!0,extraComponent:null,useRemoveBtn:!1,removeHandler:null,pickerWidth:null,maxSelectionCount:null,includeSearch:!0},displayValue:null,editable:!1,tip:null,allText:getText("common.btn.all"),lblClearSelection:getText("common.lbl.clearSelectedItems"),lblSelectAll:getText("common.lbl.selectAll"),
allItemSelected:!1,initComponent:function(){this.tooltip=this.emptyText=!0==this.useNull?null:this.localizedLabel+":"+this.allText;!0==this.useRemoveBtn&&(this.trigger2Cls=Ext.baseCSSPrefix+"form-clear-trigger");this.callParent(arguments);null==this.store&&(this.store=this.createStore());if(this.useTooltip)this.on("afterrender",this.updateTooltip,this)},onTrigger2Click:function(){null!=this.removeHandler&&Ext.isFunction(this.removeHandler)?this.removeHandler.call(this):this.ownerCt.remove(this)},
initEvents:function(){this.callParent();this.mon(this.inputEl,"keyup",this.onKeyUpHandler,this)},onKeyUpHandler:function(a,b){a.getKey();if(!a.isSpecialKey()&&!this.isExpanded&&(this.onTriggerClick(),this.includeSearch)){a.getCharCode();var c=String.fromCharCode(a.keyCode);this.searchField.setValue(c);this.searchField.focus()}},createStore:function(){return null},createBoundList:function(){return null},addBoundListListeners:function(){},syncSelection:function(){},clearOrSelectAll:function(){null!=
this.maxSelectionCount&&0<this.maxSelectionCount||!0==this.allItemSelected?this.clearSelection():this.selectAll()},selectAll:function(){},updateData:function(a){},updateTooltip:function(){!0==this.useTooltip&&null!=this.tooltip&&this.setToolTip(this.tooltip)},createSearchField:function(){var a=this,b=Ext.create("Ext.form.field.Text",{emptyText:getText("common.btn.search")+" "+a.localizedLabel+"...",cls:"searchfield",paramName:a.displayField,width:null==a.pickerWidth?a.inputEl.getWidth()-5:a.pickerWidth-
15,margin:"5 15 5 5"});b.on("change",function(b,e){a.filter.call(a,e)});return b},filter:function(a){0<a.length?this.store.filter({id:this.displayField,property:this.displayField,value:a}):this.clearFilter()},clearFilter:function(){this.store.clearFilter()},getClearSelectionLabel:function(){if(null!=this.maxSelectionCount&&0<this.maxSelectionCount){var a=this.getSelectedItemsCount();return this.lblClearSelection+" ("+a+" from "+this.maxSelectionCount+")"}return!0==this.allItemSelected?this.lblClearSelection:
this.lblSelectAll},createPicker:function(){this.boundList=this.createBoundList();this.linkClearSelection=Ext.create("Ext.ux.LinkComponent",{handler:this.clearOrSelectAll,clsLink:"link_blue",margin:"2 5 7 5",scope:this,label:this.getClearSelectionLabel()});var a=[];null!=this.extraComponent&&a.push(this.extraComponent);!0==this.includeSearch&&(this.searchField=this.createSearchField(),a.push(this.searchField));!0==this.includeClear&&a.push(this.linkClearSelection);a.push(this.boundList);this.picker=
Ext.create("Ext.panel.Panel",{hidden:!0,floating:!0,width:this.pickerWidth,items:a});this.addBoundListListeners();return this.picker},onListRefresh:function(){this.setValue(this.getValue(),!0)},selectionChange:function(a){this.isExpanded&&this.setValue(a,!1)},getDisplayValue:function(){return this.displayValue},getSelectableItemsCount:function(){null==this.store&&(this.store=this.createStore());return this.store.getRange().length},getSelectedItemsCount:function(){return 0},findRecord:function(a,b){null==
this.store&&(this.store=this.createStore());var c=this.store,e=c.findExact(a,b);return-1!==e?c.getAt(e):!1},findRecordByValue:function(a){return this.findRecord(this.valueField,a)},getRecordDisplayValue:function(a){return a.get(this.displayField)},getRecordValue:function(a){return a.get(this.valueField)},setValue:function(a,b){var c=[],e=[];this.valueModels=[];if(null==a||""==a)this.displayValue=this.value=null;else{a=Ext.Array.from(a);var f;i=0;for(len=a.length;i<len;i++)(f=a[i])&&f.isModel||(f=
this.findRecordByValue(f)),f&&(this.valueModels.push(f),e.push(this.getRecordDisplayValue(f)),c.push(this.getRecordValue(f)));0<c.length?(this.value=c,this.displayValue=e.join(", ")):this.displayValue=this.value=null}!1!==b&&this.syncSelection();c="";null!=this.localizedLabel&&""!=this.localizedLabel&&(c=this.localizedLabel+":");null==this.value?(this.tooltip=c+this.allText,this.allItemSelected=!1):(this.tooltip=c+this.displayValue,this.getSelectableItemsCount()==this.value.length?this.allItemSelected=
!0:this.allItemSelected=!1);null!=this.linkClearSelection&&(c=this.linkClearSelection.getMyLabel(),e=this.getClearSelectionLabel(),c!=e&&(this.linkClearSelection.suspendLayout=!0,this.linkClearSelection.setLabel(e),this.linkClearSelection.suspendLayout=!1));this.updateTooltip();this.setRawValue(this.getDisplayValue());this.checkChange();this.applyEmptyText();return this},clearSelection:function(){null!=this.boundList&&this.boundList.getSelectionModel().deselectAll(!0);this.setValue(null)},getSubmitValue:function(){var a=
this.getValue();null!=a&&(a=a.join());return a},getValue:function(){return this.value},setToolTip:function(a){if(null==a)null==this.tip&&(this.tip.destroy(),delete this.tip);else{var b=this.getEl();null!=b&&(null==this.tip?this.tip=Ext.create("Ext.tip.ToolTip",{target:b,html:a}):this.tip.update(a))}}});
Ext.define("com.trackplus.util.MultipleSelectPicker",{extend:"com.trackplus.util.AbstractMultiplePicker",config:{multiSelect:!0,iconUrlPrefix:null,useIconCls:!1},displayField:"label",valueField:"id",ignoreSelection:0,createStore:function(){return Ext.create("Ext.data.Store",{data:null==this.data?[]:this.data,fields:[{name:"id",type:"int",useNull:!0},{name:"label",type:"string"},{name:"icon",type:"string"},{name:"iconCls",type:"string"}],autoLoad:!1})},updateData:function(a){this.data=a;null!=this.store&&
this.store.loadData.call(this.store,a,!1)},createBoundList:function(){var a="";!0==this.multiSelect&&(a+='\x3cdiv class\x3d"x-combo-list-item"\x3e\x3cimg src\x3d"'+Ext.BLANK_IMAGE_URL+'" class\x3d"chkCombo-default-icon chkCombo" /\x3e ');null!=this.iconUrlPrefix?a+='\x3cimg  style\x3d"width:16px;height:16px;vertical-align: bottom; margin-bottom: 2px;margin-right: 5px;" src\x3d"'+(this.iconUrlPrefix+"{"+this.valueField+"}")+'"/\x3e':this.useIconCls&&(a+='\x3cimg  style\x3d"width:16px;height:16px;vertical-align: bottom; margin-bottom: 2px;margin-right: 5px;" src\x3d"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw\x3d\x3d" class\x3d"{iconCls}"/\x3e');
a+="{"+this.displayField+"} \x3c/div\x3e";return Ext.widget({xtype:"boundlist",region:"center",autoScroll:!0,border:!1,selModel:{mode:this.multiSelect?"SIMPLE":"SINGLE"},store:this.store,displayField:this.displayField,focusOnToFront:!1,pageSize:this.pageSize,getInnerTpl:function(){return a},maxHeight:200})},getSelectedItemsCount:function(){return this.boundList.getSelectionModel().getCount()},addBoundListListeners:function(){this.boundList.getSelectionModel().on("beforeselect",this.onListBeforeSelect,
this);this.boundList.getSelectionModel().on("selectionchange",this.onListSelectionChange,this);this.boundList.on("refresh",this.onListRefresh,this)},onListBeforeSelect:function(){return null!=this.maxSelectionCount&&0<this.maxSelectionCount?this.getSelectedItemsCount()<this.maxSelectionCount:!0},onListSelectionChange:function(a,b){this.selectionChange(b)},findRecord:function(a,b){null==this.store&&(this.store=this.createStore());var c=this.store,e=c.findExact(a,b);return-1!==e?c.getAt(e):!1},syncSelection:function(){var a=
this.boundList,b,c=this.valueModels||[],e=c.length,f,g;if(a){b=[];for(f=0;f<e;f++)(g=c[f])&&g.isModel&&0<=this.store.indexOf(g)&&b.push(g);this.ignoreSelection++;a=a.getSelectionModel();a.deselectAll();b.length&&a.select(b,!1,!0);this.ignoreSelection--}},clearSelection:function(){null!=this.boundList&&this.boundList.getSelectionModel().deselectAll(!0);this.setValue(null)},selectAll:function(){null!=this.boundList&&this.boundList.getSelectionModel().selectAll()},filter:function(a){if(Ext.isEmpty(a))this.clearFilter();
else{var b=this.displayField,c=Ext.String.escapeRegex;a=c(a);a=RegExp(a,"ig");for(c=0;c<this.store.getCount();c++){var e=this.store.getAt(c),f=Ext.fly(this.boundList.getNode(e));f.setVisibilityMode(Ext.Element.DISPLAY);e.get(b).match(a)?f.setVisible(!0):f.setVisible(!1)}}this.picker.doLayout()},clearFilter:function(){for(var a=0;a<this.store.getCount();a++){var b=this.store.getAt(a),b=Ext.fly(this.boundList.getNode(b));b.setVisibilityMode(Ext.Element.DISPLAY);b.setVisible(!0)}}});
Ext.define("com.trackplus.util.SingleSelectPicker",{extend:"com.trackplus.util.MultipleSelectPicker",useNull:!0,useTooltip:!1,multiSelect:!1,includeClear:!1,onListSelectionChange:function(a,b){0<this.ignoreSelection||(this.setValue(b,!1),this.collapse())},clearSelection:function(){this.callParent(arguments);this.collapse()},getSubmitValue:function(){return this.getValue()},getValue:function(){if(null!=this.value){var a=Ext.Array.from(this.value);if(0<a.length)return a[0]}return null}});
Ext.define("com.trackplus.util.MultipleTreePicker",{extend:"com.trackplus.util.AbstractMultiplePicker",displayField:"text",valueField:"id",createStore:function(){return Ext.create("Ext.data.TreeStore",{fields:[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"},{name:"selectable",mapping:"selectable",type:"boolean",useNull:!0}],root:{expanded:!0,children:null==this.data?[]:this.data},
originalData:null==this.data?[]:this.data})},updateData:function(a){this.data=Ext.clone(a);null!=this.store&&(a=this.store.getRootNode(),a.removeAll(!1),null!=this.data&&0<this.data.length&&a.appendChild(this.data))},createBoundList:function(){return Ext.create("Ext.tree.Panel",{maxHeight:200,height:200,store:this.store,rootVisible:!1,containerScroll:!0,autoScroll:!0,cls:"simpleTree",border:!1,plugins:[{ptype:"treefilter",allowParentFolders:!0}]})},addBoundListListeners:function(){this.boundList.addListener("checkchange",
this.treeCheckChange,this);this.boundList.on("afterrender",this.onListRefresh,this)},findRecord:function(a,b){null==this.store&&(this.store=this.createStore());var c=this.store.getNodeById(b);return null!=c?c:!1},getRecordDisplayValue:function(a){return a.data.text},getRecordValue:function(a){return a.data.id},syncSelection:function(){var a=[];if(null!=this.valueModels)for(var b=0;b<this.valueModels.length;b++)a.push(this.getRecordValue(this.valueModels[b]));null!=this.boundList&&this.boundList.getRootNode().cascadeBy(function(){void 0!=
this.get("checked")&&this.set("checked",Ext.Array.contains(a,this.data.id))})},treeCheckChange:function(a,b,c){a=this.boundList.getView().getChecked();this.selectionChange(a)},selectAll:function(){var a=[];null!=this.boundList&&(this.boundList.getRootNode().cascadeBy(function(){void 0!=this.get("checked")&&(this.set("checked",!0),a.push(this))}),this.boundList.expandAll());this.setValue(a)},getSelectableItemsCount:function(){var a=0;null!=this.boundList&&this.boundList.getRootNode().cascadeBy(function(){void 0!=
this.get("checked")&&a++});return a},clearSelection:function(){null!=this.boundList&&this.boundList.getRootNode().cascadeBy(function(){void 0!=this.get("checked")&&this.set("checked",!1)});this.setValue(null);null!=this.searchField&&this.searchField.setValue(null)},filter:function(a){0<a.length?this.boundList.filter(a):this.clearFilter()},clearFilter:function(){this.boundList.clearFilter()}});
Ext.define("TreeFilter",{extend:"Ext.AbstractPlugin",alias:"plugin.treefilter",collapseOnClear:!0,allowParentFolders:!1,init:function(a){this.tree=a;a.filter=Ext.Function.bind(this.filter,this);a.clearFilter=Ext.Function.bind(this.clearFilter,this)},filter:function(a,b,c){var e=this;if(Ext.isEmpty(a))e.clearFilter();else{var f=Ext.String.escapeRegex;a=f(a);var g=e.tree,h=[],k=g.getRootNode();b=b||"text";c=c||RegExp(a,"ig");var l=[],m;g.expandAll();k.cascadeBy(function(a){a.get(b).match(c)&&h.push(a)});
!1===e.allowParentFolders&&Ext.each(h,function(a){a.isLeaf()||Ext.Array.remove(h,a)});Ext.each(h,function(a,b,c){k.cascadeBy(function(b){!0==b.contains(a)&&l.push(b)});!0!==e.allowParentFolders||a.isLeaf()||a.cascadeBy(function(a){l.push(a)});l.push(a)});k.cascadeBy(function(a){if(m=Ext.fly(g.getView().getNode(a)))m.setVisibilityMode(Ext.Element.DISPLAY),m.setVisible(Ext.Array.contains(l,a))})}},clearFilter:function(){var a=this.tree,b=a.getRootNode();this.collapseOnClear&&a.collapseAll();b.cascadeBy(function(b){(viewNode=
Ext.fly(a.getView().getNode(b)))&&viewNode.show()})}});
Ext.define("com.trackplus.util.SingleTreePicker",{extend:"com.trackplus.util.MultipleTreePicker",useNull:!0,useTooltip:!1,includeClear:!1,addBoundListListeners:function(){this.callParent(arguments);this.boundList.addListener("select",this.treeSelect,this)},treeSelect:function(a,b){var c=b.data.selectable;if(null==c||!1!=c)this.setValue(b,!1),this.collapse(),this.fireEvent("select",this,b)},getClearSelectionLabel:function(){return this.lblClearSelection},clearSelection:function(){this.callParent(arguments);
this.collapse()},getSubmitValue:function(){return this.getValue()},getValue:function(){return null!=this.value&&0<this.value.length?this.value[0]:null}});
Ext.define("com.trackplus.util.PersonPickerDialog",{extend:"Ext.Base",config:{title:"",data:null,includeEmail:!1,includeGroups:!1,handler:null,scope:null,ajaxContext:null,width:250,height:400},controller:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},showDialog:function(){var a=this;a.view=Ext.create("com.trackplus.util.PersonPickerDialogView",{data:a.data});null!=a.win&&a.win.destroy();a.win=Ext.create("Ext.window.Window",{layout:"fit",cls:"bottomButtonsDialog",border:!1,
bodyBorder:!0,margin:"0 0 0 0",style:{padding:"5px 0px 0px 0px"},bodyPadding:"0px",iconCls:"user16",width:a.width,height:a.height,closeAction:"destroy",title:a.title,modal:!0,items:[a.view],autoScroll:!1,buttons:[{text:getText("common.btn.ok"),formBind:!0,handler:function(){a.okHandler.call(a)}},{text:getText("common.btn.cancel"),handler:function(){a.win.hide();a.win.destroy()}}]});a.win.show();null==a.data&&a.refreshData()},refreshData:function(){var a=this;a.view.setLoading(!0);Ext.Ajax.request({url:"personPicker.action",
disableCaching:!0,success:function(b){a.view.setLoading(!1);b=Ext.decode(b.responseText).data;a.view.replaceData.call(a.view,b)},failure:function(){a.view.setLoading(!1)},method:"POST",params:{includeEmail:a.includeEmail,includeGroups:a.includeGroups}})},okHandler:function(){var a=this.view.getValue.call(this.view),b=this.view.getDisplayValue.call(this.view);this.win.hide();this.win.destroy();null!=this.handler&&this.handler.call(this.scope,a,b)}});
Ext.define("com.trackplus.util.PersonPickerDialogView",{extend:"Ext.panel.Panel",config:{data:[],maxSelectionCount:null},layout:"border",border:!1,bodyBorder:!1,bodyStyle:{padding:"0px 0px 0px 0px"},lblSelectAll:getText("common.lbl.selectAll"),lblClearSelection:getText("common.lbl.clearSelectedItems"),allItemSelected:!1,initComponent:function(){null==this.selectedDatasourceType&&(this.selectedDatasourceType=1);this.store=this.createStore();this.items=this.createChildren();this.callParent()},createChildren:function(){var a=
this;a.searchField=Ext.create("Ext.form.field.Text",{emptyText:getText("common.btn.search")+"...",cls:"searchfield",anchor:"100%",margin:"5 15 5 5"});a.searchField.on("change",function(b,c){a.filter.call(a,c)});a.linkClearSelection=Ext.create("Ext.ux.LinkComponent",{handler:a.clearOrSelectAll,anchor:"100%",clsLink:"link_blue",margin:"2 5 7 5",scope:a,label:a.getClearSelectionLabel()});var b=Ext.create("Ext.panel.Panel",{border:!1,bodyBorder:!1,region:"north",layout:"anchor",items:[a.searchField,a.linkClearSelection]});
a.boundList=a.createBoundList();a.boundList.addListener("checkchange",a.treeCheckChange,a);var c=[];c.push(b);c.push(a.boundList);return c},replaceData:function(a){var b=this.store.getRootNode();b.removeAll();null!=a&&0<a.length&&b.appendChild(a)},treeCheckChange:function(a,b,c){a=this.boundList.getView().getChecked();null==a||0==a.length?this.allItemSelected=!1:this.getSelectableItemsCount()==a.length?this.allItemSelected=!0:this.allItemSelected=!1;null!=this.linkClearSelection&&(a=this.linkClearSelection.getMyLabel(),
b=this.getClearSelectionLabel(),a!=b&&(this.linkClearSelection.suspendLayout=!0,this.linkClearSelection.setLabel(b),this.linkClearSelection.suspendLayout=!1))},getSelectableItemsCount:function(){var a=0;null!=this.boundList&&this.boundList.getRootNode().cascadeBy(function(){void 0!=this.get("checked")&&a++});return a},getClearSelectionLabel:function(){return!0==this.allItemSelected?this.lblClearSelection:this.lblSelectAll},clearOrSelectAll:function(){null!=this.maxSelectionCount&&0<this.maxSelectionCount||
!0==this.allItemSelected?this.clearSelection():this.selectAll()},clearSelection:function(){this.boundList.getRootNode().cascadeBy(function(){void 0!=this.get("checked")&&this.set("checked",!1)});this.searchField.setValue(null);this.allItemSelected=!1;this.changeLinkClearSelection()},selectAll:function(){var a=[];null!=this.boundList&&(this.boundList.getRootNode().cascadeBy(function(){void 0!=this.get("checked")&&(this.set("checked",!0),a.push(this))}),this.boundList.expandAll());this.searchField.setValue(null);
this.allItemSelected=!0;this.changeLinkClearSelection()},changeLinkClearSelection:function(){if(null!=this.linkClearSelection){var a=this.linkClearSelection.getMyLabel(),b=this.getClearSelectionLabel();a!=b&&(this.linkClearSelection.suspendLayout=!0,this.linkClearSelection.setLabel(b),this.linkClearSelection.suspendLayout=!1)}},filter:function(a){0<a.length?this.boundList.filter(a):this.clearFilter()},clearFilter:function(){this.boundList.clearFilter()},createStore:function(){return Ext.create("Ext.data.TreeStore",
{fields:[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"},{name:"selectable",mapping:"selectable",type:"boolean"}],autoLoad:!1,root:{expanded:!0,children:null==this.data?[]:this.data},originalData:null==this.data?[]:this.data})},createBoundList:function(){return Ext.create("Ext.tree.Panel",{store:this.store,rootVisible:!1,containerScroll:!0,autoScroll:!0,cls:"simpleTree",border:!1,
region:"center",plugins:[{ptype:"treefilter",allowParentFolders:!0}]})},findRecord:function(a,b){var c=this.store.getNodeById(b);return null!=c?c:!1},getValue:function(){return this.boundList.getView().getChecked()},getDisplayValue:function(){var a=this.boundList.getView().getChecked();if(null==a||0==a.length)return null;for(var b=[],c=0;c<a.length;c++)b.push(a[c].data.text);return b}});
Ext.define("Ext.ux.LinkColumn",{extend:"Ext.grid.column.Column",alias:["widget.linkcolumn"],config:{handler:null,scope:null,isLink:null,suffix:null,postProcessRenderer:null,clsLink:"synopsis_blue"},constructor:function(a){var b=this;a=Ext.apply({},a);b.callParent([a]);b.renderer=function(a,e,f,g,h,k,l){var m=!0;null!=b.isLink&&Ext.isFunction(b.isLink)&&(m=b.isLink.call(b.scope||b,a,e,f,g,h,k,l));var n="",n=m?'\x3ca class\x3d"'+b.clsLink+'" href\x3d"javascript:void(0)"\x3e'+a+"\x3c/a\x3e":a;null!=
b.suffix&&(n+=b.suffix);null!=b.postProcessRenderer&&(n=b.postProcessRenderer.call(b.scope||b,n,e,f,g,h,k,l));return n}},processEvent:function(a,b,c,e,f,g){if(-1!=g.getTarget().className.indexOf(this.clsLink)){if("click"==a){if(null!=this.handler){var h=b.panel.store.getAt(e);this.handler.call(this.scope||this,h,f)}g.stopEvent();return!1}if("mousedown"==a)return!1}return this.callParent(arguments)}});
Ext.define("com.trackplus.util.IssuePicker",{extend:"Ext.Base",config:{workItemID:null,parent:!1,projectID:null,title:"",handler:null,scope:null,ajaxContext:null,width:600,height:400,stateId:null},controller:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.controller=Ext.create("com.trackplus.util.IssuePickerController",{workItemID:this.workItemID,parent:this.parent,selectedProjectOrRelease:this.projectID,title:this.title,handler:this.handler,scope:this.scope,ajaxContext:this.ajaxContext,
width:this.width,height:this.height,stateId:this.stateId})},showDialog:function(){this.controller.showDialog.call(this.controller)}});
Ext.define("com.trackplus.util.IssuePickerView",{extend:"Ext.panel.Panel",config:{controller:null,selectedProjectOrReleaseName:null,selectedProjectOrRelease:null,selectedQueryName:null,selectedQueryID:null,selectedDatasourceType:1},margin:"0 0 0 0",border:!1,bodyBorder:!1,baseCls:"x-plain",layout:"border",bodyStyle:{padding:"0px 0px 0px 0px"},initComponent:function(){null==this.selectedDatasourceType&&(this.selectedDatasourceType=1);this.items=this.createChildren();this.callParent()},createChildren:function(){var a=
this,b=[];a.dataSourceType=CWHF.getRadioGroup(null,null,500,[{boxLabel:getText("common.lbl.projectRelease"),name:"dataSourceType",inputValue:"1",checked:!0},{boxLabel:getText("common.lbl.filter"),name:"dataSourceType",inputValue:"2"}],{anchor:"100%",style:{marginLeft:"155px",marginTop:"5px"},labelWidth:150,hideLabel:!0},{change:{fn:a.datasourceTypeChanged,scope:a}});b.push(a.dataSourceType);a.cmbProjects=CWHF.createSingleTreePicker("common.lbl.projectRelease","projectOrRelease",[],a.selectedProjectOrRelease,
{labelStyle:{overflow:"hidden"},labelWidth:150,labelAlign:"right",style:{marginRight:"5px"},anchor:"100%",margin:"0 5 5 0"});Ext.Ajax.request({url:"releasePicker.action",scope:a,success:function(b){b=Ext.decode(b.responseText);a.cmbProjects.updateData(b);a.cmbProjects.setValue(a.selectedProjectOrRelease)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}});b.push(a.cmbProjects);a.cmbQueries=CWHF.createSingleTreePicker("common.lbl.filter","query",[],a.selectedQueryID,{labelStyle:{overflow:"hidden"},
labelWidth:150,labelAlign:"right",style:{marginRight:"5px"},anchor:"100%",margin:"0 5 5 0"});Ext.Ajax.request({url:"categoryPicker.action",params:{node:"issueFilter"},success:function(b){b=Ext.decode(b.responseText);a.cmbQueries.updateData(b);a.cmbQueries.setValue(a.selectedQueryID)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}});b.push(a.cmbQueries);a.cmbProjects.setDisabled(1!=a.selectedDatasourceType);a.cmbQueries.setDisabled(1==a.selectedDatasourceType);a.chkIncludeClosed=
Ext.create("Ext.form.field.Checkbox",{name:"includeClosed",fieldLabel:getText("item.lbl.includeClosed"),labelStyle:{overflow:"hidden"},labelWidth:150,labelAlign:"right"});b.push(a.chkIncludeClosed);a.txtIssueNumber=Ext.create("Ext.form.field.Text",{name:"searchIssueKey",fieldLabel:getText("item.lbl.itemNumber"),labelStyle:{overflow:"hidden"},labelWidth:150,width:250,labelAlign:"right"});b.push(a.txtIssueNumber);a.btnSearch=Ext.create("Ext.button.Button",{text:getText("common.btn.search"),margin:"0 5 10 155",
formBind:!0,handler:function(){a.controller.search.call(a.controller)}});b.push(a.btnSearch);a.storeIssues=Ext.create("Ext.data.Store",{fields:["id","title","objectID"],data:[],proxy:{type:"ajax",url:"issuePicker!search.action",reader:{type:"json"}}});a.gridIssues=Ext.create("Ext.grid.Panel",{store:a.storeIssues,columns:[{xtype:"linkcolumn",header:getText("item.lbl.itemNumber"),dataIndex:"id",width:75,align:"right",handler:a.controller.clickOnItem,scope:a.controller},{xtype:"linkcolumn",header:getText("item.prompt.synopsys"),
dataIndex:"title",width:420,handler:a.controller.clickOnItem,scope:a.controller}],minHeight:75,border:!0,margin:"0 0 0 0",bodyBorder:!1,cls:"gridNoBorder",bodyStyle:{border:"none"},region:"center",forceFit:!0,viewConfig:{stripeRows:!0,forceFit:!0}});var c=[],b=Ext.create("Ext.panel.Panel",{border:!1,bodyBorder:!1,region:"north",layout:"anchor",items:b});c.push(b);c.push(a.gridIssues);return c},datasourceTypeChanged:function(a,b,c,e){a=a.getChecked();1==a.length&&(a=a[0],a=a.getSubmitValue(),this.cmbProjects.setDisabled(1!=
a),this.cmbQueries.setDisabled(1==a))}});
Ext.define("com.trackplus.util.IssuePickerController",{extend:"Ext.Base",config:{workItemID:null,parent:!1,title:"",handler:null,scope:null,ajaxContext:null,selectedProjectOrReleaseName:null,selectedProjectOrRelease:null,selectedQueryName:null,selectedQueryID:null,selectedDatasourceType:1,width:600,height:400,stateId:null},view:null,win:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},showDialog:function(){this.view=Ext.create("com.trackplus.util.IssuePickerView",{controller:this,
selectedProjectOrReleaseName:this.selectedProjectOrReleaseName,selectedProjectOrRelease:this.selectedProjectOrRelease,selectedQueryName:this.selectedQueryName,selectedQueryID:this.selectedQueryID,selectedDatasourceType:this.selectedDatasourceType});null!=this.win&&this.win.destroy();this.win=Ext.create("Ext.window.Window",{layout:"fit",width:this.width,minWidth:350,minHeight:300,height:this.height,closeAction:"destroy",plain:!0,title:this.title,modal:!0,items:[this.view],border:!1,bodyBorder:!0,margin:"0 0 0 0",
style:{padding:"5px 0px 0px 0px"},autoScroll:!1,stateId:this.stateId,stateful:null!=this.stateId,listeners:{staterestore:{fn:function(a,b){var c=b.width,e=b.height,f=borderLayout.ensureSize(b.width,b.height);0>a.x&&(a.x=10);0>a.y&&(a.y=10);c!=f.width&&(a.width=f.width,a.x=10);e!=f.height&&(a.height=f.height,a.y=10)}}}});this.win.show();null!=this.selectedProjectOrRelease&&this.search()},search:function(){var a=null,b=null,c=this.view.dataSourceType.getChecked(),e=!0;1==c.length&&(c=c[0],2==c.getSubmitValue()&&
(e=!1));e?(a=this.view.cmbProjects.getValue(),null==a&&(a=this.selectedProjectOrRelease)):b=this.view.cmbQueries.getSubmitValue();this.view.storeIssues.load({url:"issuePicker!search.action",params:{workItemID:this.workItemID,parent:this.parent,projectID:a,queryID:b,includeClosed:this.view.chkIncludeClosed.value,searchIssueKey:this.view.txtIssueNumber.value},callback:function(a,b,c){}})},clickOnItem:function(a,b){var c=a.data;null!=this.ajaxContext?this.ajaxPick(c):(this.win.close(),this.win.destroy(),
null!=this.handler&&this.handler.call(this.scope,c))},ajaxPick:function(a){var b=this;b.view.setLoading(!0);var c=b.ajaxContext.url,e=b.ajaxContext.params,f=b.ajaxContext.pickItemName;null==f&&(f="workItemID");null==e&&(e={});e[f]=a.objectID;Ext.Ajax.request({url:c,scope:b,params:e,success:function(c){b.view.setLoading(!1);c=Ext.decode(c.responseText);!0==c.success?(b.win.close(),b.win.destroy(),null!=b.ajaxContext.successHandler&&(null!=b.ajaxContext.successHandlerScope?b.ajaxContext.successHandler.call(b.ajaxContext.successHandlerScope,
a):b.ajaxContext.successHandler.call(b,a))):null!=c.errorMessage?Ext.MessageBox.show({title:getText("common.warning"),msg:c.errorMessage,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING}):Ext.MessageBox.show({title:getText("common.err.invalid.item"),msg:errorMessage,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})},failure:function(){b.view.setLoading(!1);alert("failure")}})}});
Ext.define("com.trackplus.util.NameAndPathPicker",{extend:"Ext.Base",config:{title:"",loadUrl:null,loadParams:null,pathTree:null,handler:null,scope:null,width:400,height:170},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},showDialog:function(){items=[];this.filterName=CWHF.createTextField("common.lbl.name","label",{labelWidth:80,allowBlank:!1,msgTarget:"qtip"});this.pathPicker=CWHF.createSingleTreePicker("common.lbl.path","path",this.pathTree,null,{labelWidth:80,allowBlank:!1});
this.includeInMenu=CWHF.createCheckbox("admin.customize.queryFilter.lbl.menu","includeInMenu",{labelWidth:80,width:100});items.push(this.filterName,this.pathPicker,this.includeInMenu);Ext.create("com.trackplus.util.WindowConfig",{title:this.title,width:this.width,height:this.height,load:{loadUrl:this.loadUrl,loadUrlParams:this.loadParams},postDataProcess:this.loadPath,submit:{submitHandler:this.submitSaveAs,validateHandler:this.validateHandler},items:items}).showWindowByConfig(this)},submitSaveAs:function(a,
b,c){this.handler.call(this.scope,a,this.filterName.getValue(),this.pathPicker.getValue(),this.includeInMenu.getValue())},loadPath:function(a,b,c){this.pathPicker.setData(a)},validateHandler:function(a,b){return this.formEdit.isValid()}});
Ext.define("com.aurel.trackplus.itemDetail.Tab",{extend:"Ext.panel.Panel",border:!1,bodyBorder:!1,cls:"gridNoBorder",config:{workItemID:null,projectID:null,issueTypeID:null,tabNo:null,jsonData:{},labelHAlign:"right",decimalSeparator:".",decimalFormat:"0,000.00",jsDateFormat:"d/m/Y",keepSelection:!1,lastModified:null},margin:"0 0 0 0",bodyPadding:0,TAB_HISTORY:1,TAB_COMMENTS:2,TAB_ATTACHMENTS:3,TAB_WORKLOG:4,TAB_WATCHERS:5,TAB_VERSION_CONTROL:6,TAB_LINKS:7,TAB_MIGRATIONS:8,initComponent:function(){this.addEvents("itemChange",
"clickOnLink");this.callParent()},fireItemChange:function(a,b,c){null!=b&&(this.lastModified=b);this.fireEvent.call(this,"itemChange",a,b,c)},refresh:function(){}});
Ext.define("com.aurel.trackplus.itemDetail.TabGrid",{extend:"com.aurel.trackplus.itemDetail.Tab",config:{urlDeleteItems:null,handlerDeleteItem:null},gridConfig:null,gridLayoutData:null,grid:null,fieldsToNotifyOnDelete:null,COLUMN_TYPE:{STRING:0,DATETIME:1,INTEGER:2,DOUBLE:3,BYTES:4,IMAGE:5,DATE:6},createGrid:function(a,b,c){for(var e=[],f,g=null,h=0;h<b.layout.length;h++){f=b.layout[h];colCfg={header:f.header,dataIndex:f.dataIndex,itemId:a.id+"_"+f.id,sortable:f.sortable,hidden:f.hidden};colCfg.width=
f.width;var k="Ext.grid.column.Column",k=this.gridConfig.updateColCfg.call(this.gridConfig,colCfg,f,h),k=Ext.create(k,colCfg);f.type==this.COLUMN_TYPE.DATETIME&&(k.renderer=Ext.util.Format.dateRenderer(com.trackplus.TrackplusConfig.DateTimeFormat));f.type==this.COLUMN_TYPE.DATE&&(k.renderer=Ext.util.Format.dateRenderer(com.trackplus.TrackplusConfig.DateFormat));f.type==this.COLUMN_TYPE.BYTES&&(k.renderer=this.formatBytes);f.type==this.COLUMN_TYPE.IMAGE&&(k.renderer=this.thumbnailRenderer(this.workItemID));
if("newValues"==f.dataIndex||"oldValues"==f.dataIndex||"comment"==f.dataIndex||"diff"==f.dataIndex)k.renderer=function(a,b,c,e,f,g){if(!0==this.isHidden())return b.tdCls="";b.tdCls="wordWrapTd";return a},k.scope=k;this.gridConfig.updateCol.call(this.gridConfig,k,f,h);e.push(k);f.grouping&&(g=f.dataIndex)}b=Ext.create("Ext.data.Store",{groupField:g,sortInfo:{field:a.sortField,direction:a.sortDirection},fields:a.fields,proxy:{type:"ajax",url:a.urlStore,reader:{type:"json"}}});null!=c&&b.loadData(c);
var l=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} Item{[values.rows.length \x3e 1 ? "s" : ""]})'});c=this.gridConfig.features;null==c&&(c=[]);c.push(l);this.grid=Ext.create("Ext.grid.Panel",{cls:"itemDetailGrid",store:b,selModel:a.selectionModel,columns:e,border:!1,bodyBorder:!1,columnLines:!0,features:c,viewConfig:this.getViewConfig(),dockedItems:[{xtype:"toolbar",dock:"top",items:a.tbar}]});null==g&&this.grid.addListener("afterrender",function(){l.disable()});this.grid.addListener("itemdblclick",
this.gridOnClickHandler,this);this.grid.addListener("cellclick",this.gridOnCellClickHandler,this);this.grid.addListener("columnmove",this.handleColChange,this);this.grid.addListener("columnresize",this.handleColChange,this);this.grid.addListener("sortchange",this.handleColChange,this);this.grid.addListener("columnhide",this.handleColChange,this);this.grid.addListener("columnshow",this.handleColChange,this);return this.grid},formatBytes:function(a){return Ext.util.Format.fileSize(a)},thumbnailRenderer:function(a){var b=
this;return function(c,e,f,g,h,k){return b.formatThumbnail(c,e,f,g,h,k,a)}},formatThumbnail:function(a,b,c,e,f,g,h){b="";a?(b='\x3cdiv style\x3d"text-align: center;',null!=c.data.imgHeight&&(b+=" height:"+c.data.imgHeight+"px;"),b+='"\x3e\x3cimg src\x3d"thumbnailAttachment.action?attachKey\x3d'+c.data.id,null!=h&&(b=b+"\x26workItemID\x3d"+h),b+='"\x3e\x3c/div\x3e'):b="...";return b},getViewConfig:function(){return{stripeRows:!0}},handleColChange:function(a,b){var c=null,e=null,f=this.grid.getStore().sorters;
null!=f&&0<f.getCount()&&(e=f.getAt(0),c=e.property,e=e.direction);for(var f="",g=a.getGridColumns(),h=g.length,k=0,k=0;k<h;k++){var l=g[k],m=null,n=l.getItemId();if(null!=n){var p=n.indexOf("_");0<p&&(m=n.substring(p+1))}if(null!=m){var n=l.getWidth(),p=l.dataIndex,l=l.isHidden(),q="-";null!=c&&p==c&&(q="ASC"==e?"Y":"N");f=f+m+":"+l+":"+n+":"+q+":false;"}}Ext.Ajax.request({url:"saveGridConfig.action",disableCaching:!0,success:function(a){},failure:function(){},method:"POST",params:{columns:f,gridID:this.gridConfig.id}})},
initComponent:function(){this.items=this.createChildren();this.callParent()},createChildren:function(){var a=[];if(null!=this.gridConfig&&null!=this.jsonData&&null!=this.jsonData.gridLayoutData){var b=this.createGrid.call(this,this.gridConfig,this.jsonData.gridLayoutData,this.jsonData.items);this.gridConfig.grid=b;a.push(b)}return a},refresh:function(){var a=this;Ext.suspendLayouts();null==a.gridConfig.grid?Ext.Ajax.request({url:a.gridConfig.urlStore,disableCaching:!0,success:function(b){b=Ext.decode(b.responseText).data;
var c=a.createGrid.call(a,a.gridConfig,b.gridLayoutData,b.items);a.gridConfig.grid=c;a.add(c);b=[];c=c.store.data;if(null!=c)for(var e=0;e<c.getCount();e++)b.push(c.getAt(e));a.refreshCallback.call(a,b,{},!0);Ext.resumeLayouts(!0)},failure:function(){Ext.resumeLayouts(!0)},method:"POST",params:{includeLayout:!0,tabID:a.gridConfig.id}}):(a.keepSelection||a.gridConfig.grid.getSelectionModel().deselectAll(),a.gridConfig.grid.store.load({params:{tabID:a.gridConfig.id},callback:function(b,c,e){a.refreshCallback.call(a,
b,c,e);Ext.resumeLayouts(!0)}}))},replaceTitleNumber:function(a,b){var c=a.search(" ");return a.substr(0,c)+" ("+b+")"},refreshCallback:function(a,b,c){},gridOnClickHandler:function(){null!=this.gridConfig.dblClickHandler&&this.gridConfig.dblClickHandler.call(this)},gridOnCellClickHandler:function(a,b,c,e,f,g,h,k){null!=this.gridConfig.cellClickHandler&&this.gridConfig.cellClickHandler.call(this,a,b,c,e,f,g,h,k)},deleteItems:function(){var a=this,b=a.gridConfig.selectionModel.getSelection(),c=com.trackplus.TrackplusConfig.getText("common.lbl.messageBox.title.notSelected"),
e=com.trackplus.TrackplusConfig.getText("common.lbl.messageBox.removeSelected.confirm"),f=com.trackplus.TrackplusConfig.getText("common.lbl.messageBox.removeSelected.notSelected"),g=com.trackplus.TrackplusConfig.getText("common.btn.delete"),h=com.trackplus.TrackplusConfig.getText("common.btn.ok");null==b||0==b.length?Ext.MessageBox.show({title:c,msg:f,buttons:{ok:h},icon:Ext.MessageBox.WARNING}):Ext.MessageBox.show({title:g,msg:e,buttons:Ext.MessageBox.YESNO,fn:function(b){if("yes"==b)if(null!=a.handlerDeleteItem)a.handlerDeleteItem();
else{b=a.gridConfig.selectionModel.getSelection();var c="",e,f;for(f=0;f<b.length;f++)e=b[f].data,!0==e.editable&&(c=c+e.id+";");Ext.Ajax.request({url:a.urlDeleteItems,disableCaching:!0,success:function(b){null!=a.fieldsToNotifyOnDelete&&(b=Ext.decode(b.responseText).data.lastModified,a.fireItemChange(a.fieldsToNotifyOnDelete,b));a.refresh.call(a)},failure:function(){},method:"POST",params:{deletedItems:c,workItemID:a.workItemID,projectID:a.projectID,issueTypeID:a.issueTypeID,lastModified:a.lastModified}})}},
icon:Ext.MessageBox.QUESTION})}});com.trackplus.itemDetail.GridConfig=function(){};com.trackplus.itemDetail.GridConfig.prototype.id=null;com.trackplus.itemDetail.GridConfig.prototype.tabId=null;com.trackplus.itemDetail.GridConfig.prototype.urlStore=null;com.trackplus.itemDetail.GridConfig.prototype.fields=null;com.trackplus.itemDetail.GridConfig.prototype.tbar=null;com.trackplus.itemDetail.GridConfig.prototype.grid=null;com.trackplus.itemDetail.GridConfig.prototype.dblClickHandler=null;
com.trackplus.itemDetail.GridConfig.prototype.cellClickHandler=null;com.trackplus.itemDetail.GridConfig.prototype.oldGroupField=null;com.trackplus.itemDetail.GridConfig.prototype.updateCol=function(a,b,c){};com.trackplus.itemDetail.GridConfig.prototype.updateColCfg=function(a,b,c){return"Ext.grid.column.Column"};com.trackplus.itemDetail.instanceID=0;
com.trackplus.itemDetail.ItemDetailComponent=function(a,b,c,e,f,g,h,k){this.workItemID=a;this.projectID=b;this.issueTypeID=c;com.trackplus.itemDetail.instanceID++;this.instanceID=com.trackplus.itemDetail.instanceID;this.tabs=e;this.activeTab=f;this.fireEventFunction=g;this.fireEventScope=h;this.lastModified=k};com.trackplus.itemDetail.ItemDetailComponent.prototype.instanceID=0;com.trackplus.itemDetail.ItemDetailComponent.prototype.workItemID=null;
com.trackplus.itemDetail.ItemDetailComponent.prototype.projectID=null;com.trackplus.itemDetail.ItemDetailComponent.prototype.issueTypeID=null;com.trackplus.itemDetail.ItemDetailComponent.prototype.fireEventFunction=null;com.trackplus.itemDetail.ItemDetailComponent.prototype.fireEventScope=null;com.trackplus.itemDetail.ItemDetailComponent.prototype.lastModified=null;com.trackplus.itemDetail.ItemDetailComponent.prototype.tabs=null;com.trackplus.itemDetail.ItemDetailComponent.prototype.activeTab=1;
com.trackplus.itemDetail.ItemDetailComponent.prototype.tabPanel=null;com.trackplus.itemDetail.ItemDetailComponent.prototype.getTabID=function(a){return"tabItemDetail."+this.instanceID+a};
com.trackplus.itemDetail.ItemDetailComponent.prototype.createComponent=function(){for(var a=this,b=[],c,e=0;e<this.tabs.length;e++)c=this.tabs[e],c=Ext.create(c.extClassName,{id:this.getTabID(c.id),workItemID:this.workItemID,tabNo:c.id,projectID:this.projectID,issueTypeID:this.issueTypeID,lastModified:a.lastModified,jsonData:c.jsonData}),null!=a.fireEventFunction&&(c.addListener("itemChange",function(){a.fireEventFunction.call(a.fireEventScope,"itemChange",arguments)},a),c.addListener("clickOnLink",
function(){a.fireEventFunction.call(a.fireEventScope,"clickOnLink",arguments)},a)),b.push(c),c.addListener("activate",this.activateTab,this);return this.tabPanel=Ext.create("Ext.tab.Panel",{cls:"itemDetailTabPanel",margin:"0 0 0 0",autoHeight:!0,plain:!0,border:!0,bodyBorder:!1,deferredRender:!0,defaults:{autoScroll:!1,border:!1,bodyBorder:!1},tabPosition:"top",items:b,activeTab:this.activeTab})};
com.trackplus.itemDetail.ItemDetailComponent.prototype.activateTab=function(a){this.activeTab=this.tabPanel.items.indexOf(a);a.refresh.call(a)};com.trackplus.itemDetail.DialogConfig=function(a,b,c){this.workItemID=a;this.projectID=b;this.issueTypeID=c};com.trackplus.itemDetail.DialogConfig.prototype.workItemID=null;com.trackplus.itemDetail.DialogConfig.prototype.projectID=null;com.trackplus.itemDetail.DialogConfig.prototype.issueTypeID=null;com.trackplus.itemDetail.DialogConfig.prototype.title="";
com.trackplus.itemDetail.DialogConfig.prototype.formPanel=null;com.trackplus.itemDetail.DialogConfig.prototype.w=400;com.trackplus.itemDetail.DialogConfig.prototype.h=300;com.trackplus.itemDetail.DialogConfig.prototype.layout="fit";com.trackplus.itemDetail.DialogConfig.prototype.autoScroll=!1;com.trackplus.itemDetail.DialogConfig.prototype.iconCls=null;com.trackplus.itemDetail.DialogConfig.prototype.okLabel=com.trackplus.TrackplusConfig.getText("common.btn.ok");
com.trackplus.itemDetail.DialogConfig.prototype.resetLabel=com.trackplus.TrackplusConfig.getText("common.btn.reset");com.trackplus.itemDetail.DialogConfig.prototype.closeLabel=com.trackplus.TrackplusConfig.getText("common.btn.close");com.trackplus.itemDetail.DialogConfig.prototype.validate=function(){return this.formPanel.getForm().isValid()};
com.trackplus.itemDetail.DialogConfig.prototype.okHandler=function(){if(!this.validate())return!1;var a=this.formPanel.getForm(),b=this;com.trackplus.itemDetail.modalDialog.setLoading(!0);a.submit({method:"POST",params:{workItemID:this.workItemID,projectID:this.projectID,issueTypeID:this.issueTypeID},scope:b,success:function(a,e){com.trackplus.itemDetail.modalDialog.setLoading(!1);com.trackplus.itemDetail.modalDialog.hide();com.trackplus.itemDetail.modalDialog.destroy();b.successHandler.call(b,e.result)},
failure:function(a,e){com.trackplus.itemDetail.modalDialog.setLoading(!1);b.failureHandler.call(b,a,e)}})};com.trackplus.itemDetail.DialogConfig.prototype.successHandler=function(){};com.trackplus.itemDetail.DialogConfig.prototype.failureHandler=function(a,b){var c=b.result.errorMessage;if(null==c||""==c)c=getText("common.err.failure.validate");CWHF.showMsgError(c)};com.trackplus.itemDetail.enterOnForm=function(a){"textarea"!=a.getTarget().type&&this.okHandler.call(this)};
com.trackplus.itemDetail.openDialog=function(a){null!=com.trackplus.itemDetail.modalDialog&&com.trackplus.itemDetail.modalDialog.destroy();var b=a.w,c=a.h,e=null,f=null;null!=a.minw&&(f=a.minw);null!=a.minh&&(e=a.minh);c=borderLayout.ensureSize(b,c);b=c.width;c=c.height;a.formPanel.addListener("afterRender",function(b,c){this.keyNav=Ext.create("Ext.util.KeyNav",{target:this.el,enter:{fn:com.trackplus.itemDetail.enterOnForm,defaultEventAction:!1},scope:a})});com.trackplus.itemDetail.modalDialog=Ext.create("Ext.window.Window",
{layout:a.layout,width:b,height:c,minHeight:e,minWidth:f,iconCls:a.iconCls,closeAction:"destroy",cls:"bottomButtonsDialog",bodyBorder:!0,margin:"0 0 0 0",style:{padding:"5px 0px 0px 0px"},bodyPadding:"0px",title:a.title,modal:!0,items:[a.formPanel],autoScroll:a.autoScroll,buttons:[{text:a.okLabel,handler:function(){a.okHandler.call(a)}},{text:a.closeLabel,handler:function(){com.trackplus.itemDetail.modalDialog.destroy()}}]});com.trackplus.itemDetail.modalDialog.show()};
Ext.define("com.aurel.trackplus.itemDetail.AttachmentsTab",{extend:"com.aurel.trackplus.itemDetail.TabGrid",urlDeleteItems:"deletedAttachments.action",readOnly:!1,dropFileSupported:!1,fieldsToNotifyOnDelete:[-1001,15],initComponent:function(){var a=0;null!=this.jsonData.attachmentNumber&&(a=this.jsonData.attachmentNumber);this.title=getText("item.printItem.lbl.tab.attachments")+" ("+a+")";this.dropFileSupported="undefined"===typeof window.FileReader?!1:!0;this.gridConfig=this.createAttachmentsConfig();
this.callParent();this.addListener("render",this.onReadyHandler,this)},onReadyHandler:function(){var a=this;if(!1==a.dropFileSupported)return!1;var b=a.getEl().dom;b.addEventListener("dragenter",function(b){b.stopPropagation();b.preventDefault();parseInt(b.clientX);parseInt(b.clientY);a.addCls("attachmentsTabBody");b=a.gridConfig.grid.down("#dragDropAttachemnt");b.setIconCls("dragOver");b.setText(getText("item.tabs.attachment.drop"));b.setDisabled(!1)},!1);b.addEventListener("dragexit",function(b){b.stopPropagation();
b.preventDefault();a.removeCls("attachmentsTabBody");b=a.gridConfig.grid.down("#dragDropAttachemnt");b.setIconCls("drag");b.setText(getText("item.tabs.attachment.dragDrop"));b.setDisabled(!0)},!1);b.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault()},!1);b.addEventListener("drop",function(b){b.stopPropagation();b.preventDefault();a.removeCls("attachmentsTabBody");var e=a.gridConfig.grid.down("#dragDropAttachemnt");e.setIconCls("drag");e.setDisabled(!0);e.setText(getText("item.tabs.attachment.dragDrop"));
b=b.dataTransfer.files;null!=b&&0<b.length&&a.sendingFile(b)},!1)},sendingFile:function(a){for(var b=this,c=new FormData,e=0;e<a.length;e++)c.append("theFile",a[e]);var f=new XMLHttpRequest;a="saveAttachment.action"+("?workItemID\x3d"+b.workItemID+"\x26lastModified\x3d"+b.lastModified);a+="\x26projectID\x3d"+b.projectID;a+="\x26issueTypeID\x3d"+b.issueTypeID;f.open("POST",a);f.onload=function(){200===f.status?(b.setLoading("Uploading: 100%"),b.setLoading(!1),b.refresh()):(alert("Something went terribly wrong..."),
b.setLoading(!1))};f.onerror=function(a){b.setLoading(!1);alert("error:"+a)};f.upload.onprogress=function(a){a.lengthComputable&&b.setLoading("Uploading: "+(a.loaded/a.total*100|0)+"%")};f.onerror=function(a){b.setLoading(!1);alert("error:"+a)};b.setLoading("Uploading...");f.send(c)},createAttachmentsConfig:function(){var a=this;null!=a.jsonData&&(a.readOnly=a.jsonData.readOnly);var b=new com.trackplus.itemDetail.GridConfig;b.tabID="attachmentsTab";b.id=3;b.urlStore="itemAttachments.action?workItemID\x3d"+
a.workItemID+"\x26projectID\x3d"+a.projectID+"\x26issueTypeID\x3d"+a.issueTypeID;b.fields=[{name:"id",type:"int"},{name:"fileName",type:"string"},{name:"fileSize",type:"int"},{name:"description",type:"string"},{name:"date",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateTimeFormat},{name:"author",type:"string"},{name:"authorID",type:"string"},{name:"editable",type:"boolean"},{name:"imgHeight",type:"int"},{name:"thumbnail",type:"boolean"},{name:"isURL",type:"boolean"}];b.selectionModel=
Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:function(b,c){var g=a.gridConfig.grid.down("#deleteAttachmentBtn"),h=a.gridConfig.grid.down("#editAttachmentBtn"),k=a.gridConfig.grid.down("#downloadAttachmentBtn");if(null==c||0==c.length)g.setDisabled(!0),h.setDisabled(!0),k.setDisabled(!0);else if(k.setDisabled(!1),1==c.length){var l=c[0].data;h.setDisabled(a.readOnly||!1==l.editable);g.setDisabled(a.readOnly||!1==l.editable);c[0].data.isURL&&k.setDisabled(!0)}else{h.setDisabled(!0);
for(var m=h=!1,n=0;n<c.length;n++)l=c[n].data,a.readOnly||!0!=l.editable||(h=!0),l.isURL&&(m=!0);g.setDisabled(!h);k.setDisabled(m)}}}});var c=[];c.push({text:getText("common.btn.add"),itemId:"addAttachmentBtn",disabled:a.readOnly,iconCls:"add16",handler:function(){a.addAttachment.call(a)}});c.push({text:getText("item.tabs.attachment.addScreenshot"),itemId:"addScreenshotBtn",disabled:a.readOnly,iconCls:"add16",handler:function(){a.addScreenshot.call(a)}});c.push({text:getText("item.tabs.attachment.addLink"),
itemId:"addLinkBtn",disabled:a.readOnly,iconCls:"add16",handler:function(){a.addLink.call(a)}});c.push({text:getText("common.btn.delete"),itemId:"deleteAttachmentBtn",disabled:!0,iconCls:"delete16",handler:function(){a.deleteItems.call(a)}});c.push({text:getText("common.btn.edit"),itemId:"editAttachmentBtn",disabled:!0,iconCls:"edit16",handler:function(){a.editAttachment.call(a)}});c.push("-");c.push({text:getText("common.btn.download"),itemId:"downloadAttachmentBtn",disabled:!0,iconCls:"download16",
handler:function(){a.downloadAttachment.call(a)}});!0==a.dropFileSupported&&c.push({text:getText("item.tabs.attachment.dragDrop"),itemId:"dragDropAttachemnt",iconCls:"drag",disabled:!0});b.tbar=c;b.dblClickHandler=a.editAttachment;b.updateCol=function(a,b,c){"description"==b.dataIndex&&(a.flex=1);"fileName"==b.dataIndex&&(a.renderer=function(a,b,c,e,f,g,q){return c.data.isURL?'\x3ca href\x3d"'+c.data.fileName+'" class\x3d"synopsis_blue newWindow" target \x3d "_blank"\x3e'+c.data.fileName+"\x3c/a\x3e":
c.data.fileName})};return b},refreshCallback:function(a,b,c){this.setTitle(this.replaceTitleNumber(this.title,a.length))},addAttachment:function(){var a=this,b=new com.trackplus.itemDetail.DialogConfig(a.workItemID,a.projectID,a.issueTypeID);b.title=getText("item.tabs.attachment.lbl.add");b.formPanel=Ext.create("Ext.form.Panel",{itemId:"editAttachment",layout:"anchor",border:!1,url:"saveAttachment.action?lastModified\x3d"+a.lastModified,margin:"0 0 0 0",padding:0,bodyPadding:0,fileUpload:!0,items:[{xtype:"component",
html:getText("item.tabs.attachment.explanation",a.jsonData.maxSize),anchor:"100%",border:!0,cls:"infoBox_bottomBorder"},{xtype:"filefield",name:"theFile",fieldLabel:getText("item.tabs.attachment.lbl.file"),labelWidth:75,labelAlign:a.labelHAlign,msgTarget:"side",allowBlank:!1,anchor:"100%",buttonText:getText("common.btn.choose"),style:{marginTop:"5px",marginLeft:"10px",marginRight:"10px"}},{xtype:"textarea",fieldLabel:getText("common.lbl.description"),name:"description",labelWidth:75,labelAlign:a.labelHAlign,
height:75,anchor:"100% -90",style:{marginLeft:"10px",marginRight:"10px"}}]});b.layout="fit";b.w=500;b.h=275;b.minw=450;b.minh=200;b.autoScroll=!1;b.iconCls="attachment16";b.successHandler=function(b){a.fireItemChange([-1001,15],b.data.lastModified);a.refresh.call(a)};com.trackplus.itemDetail.openDialog(b)},editAttachment:function(){var a=this,b=a.gridConfig.grid.getSelectionModel().getSelection();if(null!=b){var c=b[0].data;if(!a.readOnly&&!1!=c.editable){var b=c.description,c=c.id,e=new com.trackplus.itemDetail.DialogConfig(a.workItemID,
a.projectID,a.issueTypeID);e.title=com.trackplus.TrackplusConfig.getText("item.tabs.attachment.lbl.edit");e.formPanel=Ext.create("Ext.form.Panel",{itemId:"editAttachment",region:"center",layout:"anchor",url:"editAttachment.action?attachmentID\x3d"+c+"\x26lastModified\x3d"+a.lastModified,autoScroll:!1,fileUpload:!0,margin:"0 0 0 0",border:!1,bodyStyle:{padding:"10px"},items:[{xtype:"textarea",fieldLabel:getText("common.lbl.description"),name:"description",labelWidth:75,labelAlign:"right",value:b,height:75,
anchor:"100%"}]});e.w=500;e.h=175;e.autoScroll=!1;e.iconCls="attachment16";e.successHandler=function(b){a.fireItemChange([-1001,15],b.data.lastModified);a.refresh.call(a)};com.trackplus.itemDetail.openDialog(e)}}},downloadAttachment:function(){var a=this.gridConfig.grid.getSelectionModel().getSelection();if(null!=a&&0!=a.length){var b,c;for(c=0;c<a.length;c++)b=a[c],b=b.data.id,b=null==this.workItemID?"downloadAttachment.action?attachKey\x3d"+b:"downloadAttachment.action?workItemID\x3d"+this.workItemID+
"\x26attachKey\x3d"+b,0==c?window.open(b,"attachmentWindow"):window.open(b)}},addScreenshot:function(){var a=this,b=new com.trackplus.itemDetail.DialogConfig(a.workItemID,a.projectID,a.issueTypeID);b.title=getText("item.tabs.attachment.addScreenshot");b.formPanel=Ext.create("Ext.form.Panel",{url:"saveScreenshot.action",border:!1,autoScroll:!0,margin:"0 0 0 0",bodyPadding:0,bodyStyle:{padding:"0px"},defaults:{minWidth:550},items:[{xtype:"hidden",name:"bytes",id:"input_bytes"},{xtype:"component",cls:"infoBox_bottomBorder",
border:!0,html:getText("item.tabs.attachment.addScreenshot.explanation")},{xtype:"panel",layout:{type:"hbox"},border:!1,bodyBorder:!1,anchor:"100%",margin:"0 0 0 0",padding:0,items:[{xtype:"panel",border:!1,bodyBorder:!1,layout:"anchor",width:320,items:[Ext.create("Ext.form.FieldSet",{margin:"5 10 0 10",padding:3,width:310,title:getText("item.tabs.attachment.lbl.preview"),html:'\x3capplet id\x3d"AddScreenshotApplet" code\x3d"com.trackplus.screenshot.AddScreenshotApplet"archive\x3d"Screenshot.jar,commons-codec-1.5.jar" codebase\x3d"applet"\twidth\x3d"300" height\x3d"200" style\x3d"background-color:white"\x3e\x3cparam name\x3d"prefWidth" value\x3d"300"\x3e\x3cparam name\x3d"prefHeight" value\x3d"200"\x3e\x3cparam name\x3d"permissions" value\x3d"all-permissions" /\x3e'+
getText("item.tabs.attachment.addScreenshot.appletNotSupported")+"\x3c/applet\x3e"}),Ext.create("Ext.panel.Panel",{layout:{type:"hbox"},border:!1,bodyBorder:!1,margin:"0 10 0 10",items:[Ext.create("Ext.Button",{text:getText("common.btn.paste"),iconCls:"copy16",handler:a.paste,margin:"5 5 5 0",scope:a}),Ext.create("Ext.Button",{text:getText("common.btn.clear"),iconCls:"delete16",handler:a.clearApplet,margin:"5 5 5 5",scope:a})]})]},{xtype:"panel",border:!1,bodyBorder:!1,flex:1,layout:"anchor",height:235,
items:[{xtype:"textfield",fieldLabel:getText("item.tabs.attachment.lbl.file"),labelWidth:75,labelAlign:"right",margin:"15 10 5 10",anchor:"100%",value:"screenshot",name:"file"},{xtype:"textarea",fieldLabel:getText("common.lbl.description"),name:"description",labelWidth:75,margin:"5 10 10 10",labelAlign:"right",anchor:"100% -35"}]}]}]});b.w=750;b.h=400;b.autoScroll=!1;b.layout="fit";b.iconCls="attachment16";b.validate=a.updateBytes;b.successHandler=function(b){a.fireItemChange([-1001,15],b.data.lastModified);
a.refresh.call(a)};com.trackplus.itemDetail.openDialog(b)},paste:function(){var a=navigator.javaEnabled(),b=getText("item.tabs.attachment.addScreenshot.appletNotSupported"),c=getText("item.tabs.attachment.addScreenshot.emptyClipbaord"),e=getText("item.tabs.attachment.addScreenshot.clipboardNotSupported"),f=getText("item.tabs.attachment.addScreenshot.unknownError");if(!1==a)return CWHF.showMsgError(b),!1;try{var g=document.getElementById("AddScreenshotApplet").pasteFromClipboard();switch(g){case 0:break;
case 1:CWHF.showMsgError(c);break;case 2:CWHF.showMsgError(e);break;case 3:CWHF.showMsgError(f);break;default:CWHF.showMsgError("Unknown error code: "+g)}}catch(h){throw CWHF.showMsgError(h),h;}return!1},clearApplet:function(){if(!1==navigator.javaEnabled())return CWHF.showMsgError(msgAppletNotSupported),!1;document.getElementById("AddScreenshotApplet").clear();return!1},updateBytes:function(){var a=getText("item.tabs.attachment.addScreenshot.noData"),b=Ext.getCmp("input_bytes");b.setValue(null);
var c=document.getElementById("AddScreenshotApplet").getEncodedString();if(null==c||""==c)return CWHF.showMsgError(a),!1;b.setValue(c);return!0},addLink:function(){var a=this,b=new com.trackplus.itemDetail.DialogConfig(a.workItemID,a.projectID,a.issueTypeID);b.title=getText("item.tabs.attachment.lbl.add");b.formPanel=Ext.create("Ext.form.Panel",{itemId:"editAttachment",layout:"anchor",border:!1,url:"saveAttachment!saveLink.action?lastModified\x3d"+a.lastModified,margin:"0 0 0 0",padding:0,bodyPadding:0,
fileUpload:!0,items:[{xtype:"textfield",fieldLabel:"Url",name:"theUrl",labelWidth:75,labelAlign:a.labelHAlign,anchor:"100%",allowBlank:!1,margin:"18 15 0 0",vtype:"url",style:{marginLeft:"10px",marginRight:"10px"}},{xtype:"textarea",fieldLabel:getText("common.lbl.description"),name:"description",labelWidth:75,labelAlign:a.labelHAlign,height:75,anchor:"100% -90",margin:"10 15 0 0",style:{marginLeft:"10px",marginRight:"10px"}}]});b.layout="fit";b.w=500;b.h=275;b.minw=450;b.minh=200;b.autoScroll=!1;
b.iconCls="attachment16";b.successHandler=function(b){a.fireItemChange([-1001,15],b.data.lastModified);a.refresh.call(a)};com.trackplus.itemDetail.openDialog(b)}});
Ext.define("com.aurel.trackplus.itemDetail.CommentsTab",{extend:"com.aurel.trackplus.itemDetail.TabGrid",readOnly:!1,cls:"ulist",urlDeleteItems:"deleteComments.action",fieldsToNotifyOnDelete:[23,15],initComponent:function(){var a=0;null!=this.jsonData.commentNumber&&(a=this.jsonData.commentNumber);this.title=getText("item.tabs.comment.lbl.title")+" ("+a+")";this.gridConfig=this.createCommentsConfig();this.callParent()},refreshCallback:function(a,b,c){this.setTitle(this.replaceTitleNumber(this.title,
a.length))},createCommentsConfig:function(){var a=this;null!=a.jsonData&&(a.readOnly=a.jsonData.readOnly);var b=new com.trackplus.itemDetail.GridConfig;b.tabID="commentsTab";b.id=2;b.urlStore="itemComments.action?workItemID\x3d"+a.workItemID+"\x26projectID\x3d"+a.projectID+"\x26issueTypeID\x3d"+a.issueTypeID;b.fields=[{name:"id",type:"int"},{name:"date",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateTimeFormat},{name:"author",type:"string"},{name:"authorID",type:"string"},{name:"comment",
type:"string"},{name:"editable",type:"bool"}];b.selectionModel=Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:function(b,e){var f=a.gridConfig.grid.down("#deleteCommentBtn"),g=a.gridConfig.grid.down("#editCommentBtn");if(null==e||0==e.length)f.setDisabled(!0),g.setDisabled(!0);else if(1==e.length){var h=e[0].data;g.setDisabled(!1==h.editable);f.setDisabled(!1==h.editable)}else{g.setDisabled(!0);for(var g=!1,k=0;k<e.length;k++)if(h=e[k].data,!0==h.editable){g=!0;break}f.setDisabled(!g)}}}});
b.tbar=[{text:com.trackplus.TrackplusConfig.getText("common.btn.add"),disabled:a.readOnly,iconCls:"add16",handler:function(){a.addComment.call(a)}},{text:com.trackplus.TrackplusConfig.getText("common.btn.delete"),itemId:"deleteCommentBtn",disabled:!0,iconCls:"delete16",handler:function(){a.deleteItems.call(a)}},{text:com.trackplus.TrackplusConfig.getText("common.btn.edit"),itemId:"editCommentBtn",disabled:!0,iconCls:"edit16",handler:function(){a.editComment.call(a)}}];b.dblClickHandler=a.editComment;
b.updateCol=function(a,b,f){"comment"==b.dataIndex&&(a.flex=1)};return b},addComment:function(){this.openEditComment()},editComment:function(){this.gridConfig.grid.getStore().getCount();var a=this.gridConfig.grid.getSelectionModel().getSelection();if(null!=a){var a=a[0].data,b=com.trackplus.TrackplusConfig.getText("common.history.lbl.comment");!1==a.editable?com.trackplus.util.showHtmlDetail(b,a.comment):this.openEditComment(a.comment,a.id)}},openEditComment:function(a,b){var c=this,e={anchor:"100%",
allowBlank:!1,cls:"ckeField100Percent"};null!=a&&(e.value=a);c.txtArea=CWHF.createRichTextEditorField("comment",e,!0,!0);e=new com.trackplus.itemDetail.DialogConfig(c.workItemID,c.projectID,c.issueTypeID);e.title=com.trackplus.TrackplusConfig.getText("item.tabs.comment.lbl.edit");var f="saveComment.action?lastModified\x3d"+c.lastModified;null!=b&&(f+="\x26commentID\x3d"+b);e.formPanel=Ext.create("Ext.form.Panel",{cls:"ckeditor100Percent-noBorder",itemId:"editCommentForm",border:!1,bodyBorder:!1,layout:"fit",
margin:"0 0 0 0",bodyStyle:{padding:"0px"},url:f,items:[c.txtArea]});e.w=850;e.h=300;e.layout="fit";e.autoScrol=!1;e.iconCls="comment16";e.successHandler=function(a){c.fireItemChange([23,15],a.data.lastModified);c.refresh()};e.validate=function(){var a=CKEDITOR.instances[c.txtArea.id+"-inputEl"];null!=a&&a.updateElement();return this.formPanel.getForm().isValid()};com.trackplus.itemDetail.openDialog(e)}});
Ext.define("com.aurel.trackplus.itemDetail.HistoryTab",{extend:"com.aurel.trackplus.itemDetail.TabGrid",cls:"ulist",historyFull:!0,showCommentsHistory:!0,showFlatHistory:!1,flatPanel:null,initComponent:function(){var a=this;a.title=getText("item.printItem.lbl.tab.commonHistory");a.gridConfig=a.createHistoryConfig();var b=[],c=a.createViewButton("gridHistory","gridHistory",getText("common.history.lbl.gridHistory"),getText("common.history.lbl.gridHistory.tlt"));c.pressed=!0==a.showFlatHistory?!1:!0;
b.push(c);a.historyFull?(btnLabel=com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.collapse"),iconCls="collapse16"):(btnLabel=com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.expand"),iconCls="expand16");a.btnExpandCollapse=Ext.create("Ext.button.Button",{itemId:"expandCollapseHistoryBtn",text:btnLabel,iconCls:iconCls,handler:function(){a.expandCollapseHistory.call(a)},hidden:a.showFlatHistory});b.push(a.btnExpandCollapse);a.showCommentsHistory?(btnLabel=com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.hideComments"),
iconCls="collapse16"):(btnLabel=com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.showComments"),iconCls="expand16");a.btnComments=Ext.create("Ext.button.Button",{itemId:"showHideCommentsBtn",text:btnLabel,iconCls:iconCls,handler:function(){a.showHideCommentsHistory.call(a)},hidden:a.showFlatHistory});b.push(a.btnComments);a.dockedItems=[{xtype:"toolbar",dock:"top",items:b,border:!1}];a.callParent()},createChildren:function(){var a=[];if(!0==this.showFlatHistory)this.initFlatPanel(),a.push(this.flatPanel);
else if(null!=this.gridConfig&&null!=this.jsonData&&null!=this.jsonData.gridLayoutData){var b=this.createGrid.call(this,this.gridConfig,this.jsonData.gridLayoutData);this.gridConfig.grid=b;a.push(b)}return a},createHistoryConfig:function(){null!=this.jsonData&&(this.historyFull=this.jsonData.historyFull,this.showCommentsHistory=this.jsonData.showCommentsHistory,this.showFlatHistory=this.jsonData.showFlatHistory);var a=new com.trackplus.itemDetail.GridConfig;a.tabID="historyTab";a.id=1;a.urlStore=
"itemHistory.action?workItemID\x3d"+this.workItemID+"\x26projectID\x3d"+this.projectID+"\x26issueTypeID"+this.issueTypeID;a.fields=[{name:"id",type:"int"},{name:"date",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateTimeFormat},{name:"author",type:"string"},{name:"authorID",type:"string"},{name:"typeOfChange",type:"string"},{name:"newValues",type:"string"},{name:"newValuesFull",type:"string"},{name:"oldValues",type:"string"},{name:"oldValuesFull",type:"string"},{name:"comment",type:"string"},
{name:"commentFull",type:"string"},{name:"diff",type:"string"},{name:"diffFull",type:"string"}];a.cellClickHandler=this.cellClickHistory;return a},createViewButton:function(a,b,c,e){var f=this;return Ext.create("Ext.button.Button",{iconCls:b,enableToggle:!0,allowDepress:!0,toggleGroup:"itemDetailHistoryViewGroup",text:c,overflowText:c,tooltip:e,handler:function(){f.changeViewMode()},scope:f})},changeViewMode:function(a){!1==this.showFlatHistory?(this.showFlatHistory=!0,null!=this.gridConfig.grid&&
(this.remove(this.gridConfig.grid,!0),this.gridConfig.grid=null),this.initFlatPanel(),this.add(this.flatPanel),this.refreshFlatHistory()):(this.showFlatHistory=!1,null!=this.flatPanel&&(this.remove(this.flatPanel),this.flatPanel=null),this.refresh(),this.add(this.gridConfig.grid));this.btnExpandCollapse.setVisible(!this.showFlatHistory);this.btnComments.setVisible(!this.showFlatHistory);this.showHideFlatHistory()},refreshFlatHistory:function(){var a=this;null!=a.flatPanel&&a.flatPanel.setLoading(!0);
Ext.suspendLayouts();Ext.Ajax.request({url:"itemDetailHistory.action?workItemID\x3d"+a.workItemID,disableCaching:!0,success:function(b){a.flatData=b.responseText;null!=a.flatPanel&&a.flatPanel.setLoading(!1);a.initFlatPanel();Ext.resumeLayouts(!0)},failure:function(){Ext.resumeLayouts(!0)},method:"POST",params:{includeLayout:!1,tabID:a.gridConfig.id}})},cellClickHistory:function(a,b,c,e,f,g,h,k){b=a.getStore().getAt(g);a=a.getHeaderCt().getHeaderAtIndex(c).dataIndex;"oldValues"==a&&null!=b.data.oldValuesFull&&
0<b.data.oldValuesFull.length&&this.showHtmlDetail(getText("common.history.lbl.oldValue"),b.data.oldValuesFull);"newValues"==a&&null!=b.data.newValuesFull&&0<b.data.newValuesFull.length&&this.showHtmlDetail(getText("common.history.lbl.newValue"),b.data.newValuesFull);"comment"==a&&null!=b.data.commentFull&&0<b.data.commentFull.length&&this.showHtmlDetail(getText("common.history.lbl.comment"),b.data.commentFull);"diff"==a&&null!=b.data.diffFull&&0<b.data.diffFull.length&&this.showHtmlDetail(getText("common.history.lbl.comment"),
b.data.diffFull)},win:null,showHtmlDetail:function(a,b){var c=this;null!=c.win&&c.win.destroy();htmlDinamicContent=b;var e=Ext.create("Ext.panel.Panel",{collapsible:!1,autoWidth:!0,autoHeight:!0,bodyBorder:!1,bodyPadding:"5 5 5 5",autoScroll:!0,border:!1,id:"panelContent",html:'\x3ciframe allowtransparency\x3d"true" frameborder\x3d"0" width\x3d"100%" style\x3d"height:100%;background-color: transparent;"  src\x3d"richTextPreview.action"\x3e\x3c/iframe\x3e'});c.win=new Ext.Window({layout:"fit",iconCls:"history16",
width:550,height:350,closeAction:"destroy",plain:!0,title:a,modal:!0,items:e,autoScroll:!0,buttons:[{text:getText("common.btn.close"),itemId:"btnClose",handler:function(){c.win.hide();c.win.destroy()}}],listeners:{show:function(a,b){a.down("#btnClose").focus(!1,150)}}});c.win.show()},expandCollapseHistory:function(){var a=this;a.historyFull=!a.historyFull;Ext.Ajax.request({url:"userPreferences.action?property\x3dhistoryFull\x26value\x3d"+a.historyFull,disableCaching:!0,success:function(b){a.refresh()},
failure:function(a,c){}})},showHideCommentsHistory:function(){var a=this;a.showCommentsHistory=!a.showCommentsHistory;Ext.Ajax.request({url:"userPreferences.action?property\x3dshowCommentsHistory\x26value\x3d"+a.showCommentsHistory,disableCaching:!0,success:function(b){a.refresh()},failure:function(a,c){}})},showHideFlatHistory:function(){Ext.Ajax.request({url:"userPreferences.action?property\x3dshowFlatHistory\x26value\x3d"+this.showFlatHistory,disableCaching:!0,success:function(a){},failure:function(a,
b){}})},refresh:function(){!0==this.showFlatHistory?this.refreshFlatHistory():this.callParent()},refreshCallback:function(a,b,c){!1!=c&&(this.historyFull?(this.btnExpandCollapse.setText(com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.collapse")),this.btnExpandCollapse.setIconCls("collapse16")):(this.btnExpandCollapse.setText(com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.expand")),this.btnExpandCollapse.setIconCls("expand16")),this.gridConfig.grid.down("#showHideCommentsBtn"),
this.showCommentsHistory?(this.btnComments.setText(com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.hideComments")),this.btnComments.setIconCls("collapse16")):(this.btnComments.setText(com.trackplus.TrackplusConfig.getText("item.tabs.history.lbl.showComments")),this.btnComments.setIconCls("expand16")))},initFlatPanel:function(){var a="";null!=this.flatData&&(a=this.flatData);null==this.flatPanel?this.flatPanel=Ext.create("Ext.Component",{style:{borderTop:"1px solid #D0D0D0"},cls:"flatHistoryPanel",
html:a}):this.flatPanel.update(a)}});
Ext.define("com.aurel.trackplus.itemDetail.LinksTab",{extend:"com.aurel.trackplus.itemDetail.TabGrid",urlDeleteItems:"itemLink!deleteLinks.action",fieldsToNotifyOnDelete:[19,20,-1009],readOnly:!1,cmbLinkType:null,formPanel:null,txtIssueNo:null,hiddenIssueNo:null,txtSynopsis:null,keepSelection:!1,btnAddLink:null,btnDeleteLink:null,btnEditLink:null,initComponent:function(){var a=0;null!=this.jsonData.linkNumber&&(a=this.jsonData.linkNumber);this.title=getText("item.printItem.lbl.tab.links")+" ("+a+
")";this.gridConfig=this.createLinkConfig();this.callParent()},refreshCallback:function(a,b,c){this.setTitle(this.replaceTitleNumber(this.title,a.length));this.onSelectionChange(this.gridConfig.grid,this.gridConfig.grid.getSelectionModel().getSelection())},createLinkConfig:function(){var a=this;null!=a.jsonData&&(a.readOnly=a.jsonData.readOnly);var b=new com.trackplus.itemDetail.GridConfig;b.tabID="linksTab";b.id=7;b.urlStore="itemLink.action?workItemID\x3d"+a.workItemID+"\x26projectID\x3d"+a.projectID+
"\x26issueTypeID\x3d"+a.issueTypeID;b.fields=[{name:"id",type:"int"},{name:"linkTypeID",type:"int"},{name:"linkType",type:"string"},{name:"workItemID",type:"int"},{name:"itemID",type:"string"},{name:"itemTitle",type:"string"},{name:"itemStatus",type:"string"},{name:"itemResponsible",type:"string"},{name:"parameters",type:"string"},{name:"comment",type:"string"},{name:"editable",type:"boolean"}];a.btnAddLink=Ext.create("Ext.button.Button",{text:getText("common.btn.add"),disabled:a.readOnly,iconCls:"add16",
tooltip:getText("item.tabs.itemLink.lbl.add"),handler:function(){a.addLink.call(a)}});a.btnDeleteLink=Ext.create("Ext.button.Button",{text:getText("common.btn.delete"),itemId:"deleteLinkBtn",disabled:!0,iconCls:"delete16",handler:function(){a.deleteItems.call(a)}});a.btnEditLink=Ext.create("Ext.button.Button",{text:getText("common.btn.edit"),itemId:"editLinkBtn",disabled:!0,iconCls:"edit16",handler:function(){a.editLink.call(a)}});a.btnUpLink=Ext.create("Ext.button.Button",{text:getText("common.btn.up"),
tooltip:getText("item.tabs.itemLink.lbl.moveUp"),itemId:"moveUpBtn",disabled:!0,iconCls:"moveUp",handler:function(){a.onMoveUpGridRow.call(a)}});a.btnDownLink=Ext.create("Ext.button.Button",{text:getText("common.btn.down"),tooltip:getText("item.tabs.itemLink.lbl.moveDown"),itemId:"moveDownBtn",disabled:!0,iconCls:"moveDown",handler:function(){a.onMoveDownGridRow.call(a)}});b.tbar=[a.btnAddLink,a.btnDeleteLink,a.btnEditLink,a.btnUpLink,a.btnDownLink];b.dblClickHandler=a.editLink;b.selectionModel=Ext.create("Ext.selection.CheckboxModel",
{listeners:{selectionchange:{fn:this.onSelectionChange,scope:a}}});b.updateColCfg=function(b,e,f){return"itemID"==e.dataIndex||"itemTitle"==e.dataIndex?(b.xtype="linkcolumn",b.handler=a.clickOnLinkItem,b.scope=a,"Ext.ux.LinkColumn"):"Ext.grid.column.Column"};return b},getViewConfig:function(){return{stripeRows:!0,plugins:{ptype:"gridviewdragdrop",dragGroup:"itemLinkgridDDGroup",dropGroup:"itemLinkgridDDGroup",enableDrag:!0,enableDrop:!0},listeners:{drop:{scope:this,fn:function(a,b,c,e){this.onGridDrop(a,
b,c,e)}}}}},onSelectionChange:function(a,b){if(null==b||0==b.length)this.btnDeleteLink.setDisabled(!0),this.btnEditLink.setDisabled(!0),this.btnUpLink.setDisabled(!0),this.btnDownLink.setDisabled(!0);else if(1==b.length){var c=b[0].data,e=c.editable;this.btnEditLink.setDisabled(!e);this.btnDeleteLink.setDisabled(!e);var f=this.gridConfig.grid,f=f.getStore();null!=f&&(this.btnDownLink.setDisabled(c.id==f.last().data.id||!e),this.btnUpLink.setDisabled(c.id==f.first().data.id||!e))}else{this.btnEditLink.setDisabled(!0);
this.btnUpLink.setDisabled(!0);this.btnDownLink.setDisabled(!0);for(var e=!1,g=!0,h=!0,f=this.gridConfig.grid,f=f.getStore(),k=0;k<b.length;k++)if(c=b[k].data,!0==c.editable)e=!0,c.id==f.first().data.id&&(g=!1),c.id==f.last().data.id&&(h=!1);else{h=g=!1;break}this.btnDeleteLink.setDisabled(!e);this.btnUpLink.setDisabled(!g);this.btnDownLink.setDisabled(!h)}},getSelectedIDs:function(){var a=null,b=this.gridConfig.grid.getSelectionModel().getSelection();if(null!=b&&0<b.length)for(var a=[],c=0;c<b.length;c++)a.push(b[c].data.id);
return a},clickOnLinkItem:function(a,b){this.fireEvent("clickOnLink",a.data.workItemID)},createFormPanel:function(a){var b=this;b.cmbLinkType=CWHF.createCombo("item.tabs.itemLink.lbl.thisIssue","linkTypeWithDirection",{labelWidth:150,anchor:"100%",idType:"string"},{select:{fn:b.selectLinkType,scope:b,linkID:a,workItemID:b.workItemID}});b.txtIssueNo=CWHF.createTextField(null,"linkedNumber",{width:100,margin:"0 5 0 0",readOnly:!0});b.hiddenIssueNo=CWHF.createHiddenField("linkedWorkItemID");b.txtSynopsis=
CWHF.createTextField(null,"linkedWorkItemTitle",{margin:"0 10 0 0",readOnly:!0,columnWidth:1});b.txtDescription=CWHF.createTextAreaField("item.tabs.itemLink.lbl.comment","description",{height:125,anchor:"100%",labelWidth:150});var c={xtype:"button",text:getText("common.btn.search"),handler:function(){b.chooseItem.call(b)}},e="itemLink!saveItemLink.action";null!=a&&(e=e+"?linkID\x3d"+a);b.formPanel=Ext.create("Ext.form.Panel",{itemId:"editLink",region:"center",layout:"anchor",url:e,autoScroll:!0,border:!1,
margins:"0 0 0 0",bodyStyle:{padding:"10px"},items:[b.cmbLinkType,{xtype:"fieldcontainer",itemId:"linkedItem",fieldLabel:getText("item.tabs.itemLink.lbl.issue"),labelWidth:150,labelStyle:"overflow:hidden;",labelAlign:"right",layout:"column",anchor:"100%",defaults:{hideLabel:!0},items:[b.hiddenIssueNo,b.txtIssueNo,b.txtSynopsis,c]},b.txtDescription]});return b.formPanel},chooseItem:function(){Ext.create("com.trackplus.util.IssuePicker",{workItemID:this.workItemID,projectID:-1*this.projectID,title:getText("common.btn.chooseItem"),
handler:this.setIssue,scope:this}).showDialog()},selectLinkType:function(a,b,c){Ext.Ajax.request({url:"itemLink!getSpecificPart.action",params:{linkTypeWithDirection:a.getValue(),linkID:c.linkID,workItemID:c.workItemID},disableCaching:!0,scope:this,success:function(a,b){var c=Ext.decode(a.responseText);this.replaceSpecificPart(this.formPanel,c.linkTypeJSClass,c.specificData)},failure:function(a,b){},method:"POST"})},setIssue:function(a){var b=a.title;this.txtIssueNo.setValue(a.id);this.hiddenIssueNo.setValue(a.objectID);
this.txtSynopsis.setValue(b)},addLink:function(){var a=this,b=new com.trackplus.itemDetail.DialogConfig(a.workItemID,a.projectID,a.issueTypeID);b.title=getText("item.tabs.itemLink.lbl.add");var c=a.createFormPanel();b.formPanel=c;b.w=700;b.h=330;b.autoScroll=!1;b.iconCls="links16";c.getForm().load({url:"itemLink!editItemLink.action",params:{workItemID:a.workItemID},scope:a,success:function(b,f){var g=f.result.data;a.cmbLinkType.store.loadData(g.linkTypesList,!1);a.cmbLinkType.setValue(g.linkTypeWithDirection);
this.replaceSpecificPart(c,g.linkTypeJSClass,g.specificData)},failure:function(){alert("failure")}});b.successHandler=function(b){a.refresh.call(a)};com.trackplus.itemDetail.openDialog(b)},replaceSpecificPart:function(a,b,c){var e=a.getComponent("specificPart");null!=e&&(e.setDisabled(!0),a.remove(e,!0));null!=b&&(e=Ext.create(b,{margin:"0 5 5 0"}),null!=e&&(a.insert(2,e),e.onDataReady(c),a.doLayout()))},editLink:function(){var a=this,b=a.gridConfig.grid.getSelectionModel().getSelection();if(null!=
b){var c=b[0].data,b=null;null!=c&&(b=c.id);if(!1!=c.editable){c=new com.trackplus.itemDetail.DialogConfig(a.workItemID,a.projectID,a.issueTypeID);c.title=getText("item.tabs.itemLink.lbl.edit");var e=a.createFormPanel(b);c.formPanel=e;c.w=700;c.h=330;c.autoScroll=!1;c.iconCls="links16";e.getForm().load({url:"itemLink!editItemLink.action",params:{workItemID:a.workItemID,linkID:b},scope:a,success:function(b,c){var h=c.result.data;a.cmbLinkType.store.loadData(h.linkTypesList,!1);a.cmbLinkType.setValue(h.linkTypeWithDirection);
a.txtIssueNo.setValue(h.linkedWorkItemID);a.hiddenIssueNo.setValue(h.linkedWorkItemObjectID);a.txtSynopsis.setValue(h.linkedWorkItemTitle);a.txtDescription.setValue(h.description);this.replaceSpecificPart(e,h.linkTypeJSClass,h.specificData)},failure:function(){alert("failure")}});c.successHandler=function(b){a.refresh.call(a)};c.failureHandler=function(a,b){var c=b.result.errors["itemov.ganttView.dependency.violation"];if(null!=c||void 0!=c)c=getText("itemov.ganttView.dependency.violationTitle"),
Ext.Msg.show({title:c,msg:b.result.errors["itemov.ganttView.dependency.violation"],icon:Ext.Msg.ERROR,buttonText:{ok:getText("common.btn.ok")}});c=b.result.errorMessage;if(null==c||""==c)c=getText("common.err.failure.validate");CWHF.showMsgError(c)};com.trackplus.itemDetail.openDialog(c)}}},onGridDrop:function(a,b,c,e){a=!1;"before"==e&&(a=!0);e=this.getSelectedIDs();null!=e&&(c={workItemID:this.workItemID,draggedLinkIDs:e.join(),droppedToLinkID:c.get("id"),before:a},this.onOrderChange("itemLink!droppedNear.action",
c))},onMoveUpGridRow:function(){var a=this.getSelectedIDs();if(null!=a)this.onOrderChange("itemLink!moveUp.action",{workItemID:this.workItemID,draggedLinkIDs:a.join()})},onMoveDownGridRow:function(){var a=this.getSelectedIDs();if(null!=a)this.onOrderChange("itemLink!moveDown.action",{workItemID:this.workItemID,draggedLinkIDs:a.join()})},onOrderChange:function(a,b){Ext.Ajax.request({url:a,disableCaching:!0,scope:this,success:function(a){a=Ext.decode(a.responseText);!0!==a.success&&Ext.MessageBox.alert(this.failureTitle,
a.errorMessage);null!=this.workItemID&&(this.keepSelection=!0);this.refresh.call(this);null!=this.workItemID&&(this.keepSelection=!1)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},isUpload:!1,method:"POST",params:b})}});
Ext.define("com.aurel.trackplus.itemDetail.VersionControlTab",{extend:"com.aurel.trackplus.itemDetail.TabGrid",readOnly:!1,showFlat:!1,flatPanel:null,flatData:null,initComponent:function(){this.title=getText("item.tabs.versionControl.lbl");this.gridConfig=this.createVersionConfig();var a=[],b=this.createViewButton("gridHistory","gridHistory",getText("common.history.lbl.gridHistory"),getText("common.history.lbl.gridHistory.tlt"));b.pressed=!0==this.showFlat?!1:!0;a.push(b);this.dockedItems=[{xtype:"toolbar",
dock:"top",items:a,border:!1}];this.callParent()},createChildren:function(){var a=[];if(!0==this.showFlat)this.initFlatPanel(),a.push(this.flatPanel);else if(null!=this.gridConfig&&null!=this.jsonData&&null!=this.jsonData.gridLayoutData){var b=this.createGrid.call(this,this.gridConfig,this.jsonData.gridLayoutData);this.gridConfig.grid=b;a.push(b)}return a},createVersionConfig:function(){var a="string";null!=this.jsonData&&(this.readOnly=this.jsonData.readOnly,a=this.jsonData.versionControlRevNoType,
this.showFlat=this.jsonData.showFlat);var b=new com.trackplus.itemDetail.GridConfig;b.tabID="versionControlTab";b.id=6;b.urlStore="itemVersionControl.action?workItemID\x3d"+this.workItemID+"\x26projectID\x3d"+this.projectID+"\x26issueTypeID\x3d"+this.issueTypeID;b.fields=[{name:"revision",type:a},{name:"revisionURL",type:"string"},{name:"repository",type:"string"},{name:"date",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateTimeFormat},{name:"user",type:"string"},{name:"message",type:"string"}];
return b},createViewButton:function(a,b,c,e){var f=this;return Ext.create("Ext.button.Button",{iconCls:b,enableToggle:!0,allowDepress:!0,toggleGroup:"itemDetailHistoryViewGroup",text:c,overflowText:c,tooltip:e,handler:function(){f.changeViewMode()},scope:f})},changeViewMode:function(a){!1==this.showFlat?(this.showFlat=!0,null!=this.gridConfig.grid&&(this.remove(this.gridConfig.grid,!0),this.gridConfig.grid=null),this.initFlatPanel(),this.add(this.flatPanel),this.refreshFlat()):(this.showFlat=!1,null!=
this.flatPanel&&(this.remove(this.flatPanel),this.flatPanel=null),this.refresh(),this.add(this.gridConfig.grid));this.showHideFlat()},showHideFlat:function(){Ext.Ajax.request({url:"userPreferences.action?property\x3dshowFlatVersionControl\x26value\x3d"+this.showFlat,disableCaching:!0,success:function(a){},failure:function(a,b){}})},refresh:function(){!0==this.showFlat?this.refreshFlat():this.callParent()},refreshFlat:function(){var a=this;null!=a.flatPanel&&a.flatPanel.setLoading(!0);Ext.Ajax.request({url:"itemDetailVersionControl.action?workItemID\x3d"+
a.workItemID,disableCaching:!0,success:function(b){a.flatData=b.responseText;null!=a.flatPanel&&a.flatPanel.setLoading(!1);a.initFlatPanel()},failure:function(){},method:"POST",params:{includeLayout:!1,tabID:a.gridConfig.id}})},initFlatPanel:function(){var a="";null!=this.flatData&&(a=this.flatData);null==this.flatPanel?this.flatPanel=Ext.create("Ext.panel.Panel",{style:{borderTop:"1px solid #D0D0D0"},bodyBorder:!1,cls:"flatHistoryPanel",html:a}):this.flatPanel.update(a)}});
Ext.define("com.aurel.trackplus.itemDetail.WatchersTab",{extend:"com.aurel.trackplus.itemDetail.TabGrid",urlDeleteItems:"deleteWatchers.action",myID:0,meAsC:!1,meAsI:!1,watcherAddDeleteDisabled:!1,watcherMeConsultedDisabled:!1,watcherMeInformedDisabled:!1,fieldsToNotifyOnDelete:[-1003,-1004],initComponent:function(){var a=0;null!=this.jsonData.watchersNumber&&(a=this.jsonData.watchersNumber);this.title=getText("item.printItem.lbl.watchers")+" ("+a+")";this.gridConfig=this.createWatchersConfig();this.callParent()},
createWatchersConfig:function(){var a=this;null!=a.jsonData&&(a.myID=a.jsonData.myID,a.meAsC=a.jsonData.meAsC,a.meAsI=a.jsonData.meAsI,a.watcherAddDeleteDisabled=a.jsonData.watcherAddDeleteDisabled,a.watcherMeConsultedDisabled=a.jsonData.watcherMeConsultedDisabled,a.watcherMeInformedDisabled=a.jsonData.watcherMeInformedDisabled);var b=new com.trackplus.itemDetail.GridConfig;b.tabID="watchersTab";b.id=5;b.urlStore="itemWatcher.action?workItemID\x3d"+a.workItemID+"\x26projectID\x3d"+a.projectID+"\x26issueTypeID\x3d"+
a.issueTypeID;b.fields=[{name:"objectID",type:"int"},{name:"type",type:"string"},{name:"raciRole",type:"string"},{name:"person",type:"string"},{name:"isGroup",type:"string"},{name:"editable",type:"boolean"}];a.watcherAddDeleteDisabled||(b.selectionModel=Ext.create("Ext.selection.CheckboxModel",{listeners:{selectionchange:function(b,e){e=a.gridConfig.selectionModel.getSelection();var f=a.gridConfig.grid.down("#deleteWatcherBtn");null==e||0==e.length?f.setDisabled(!0):f.setDisabled(!1)}}}));b.tbar=
[{text:getText("common.btn.addConsultant"),disabled:a.watcherAddDeleteDisabled,iconCls:"add16",handler:function(){a.addRole.call(a,"c",getText("item.tabs.watchers.lbl.header.consultants"),400,300)}},{text:getText("common.btn.addInformant"),disabled:a.watcherAddDeleteDisabled,iconCls:"add16",handler:function(){a.addRole.call(a,"i",getText("item.tabs.watchers.lbl.header.informants"),400,300)}},{text:com.trackplus.TrackplusConfig.getText("common.btn.delete"),itemId:"deleteWatcherBtn",disabled:!0,iconCls:"delete16",
handler:function(){a.deleteItems.call(a)}},{text:com.trackplus.TrackplusConfig.getText("common.btn.addMeConsultant"),itemId:"addMeAsC",disabled:a.watcherMeConsultedDisabled,iconCls:"add16",handler:function(){a.addRemoveMeAsConsultant.call(a)}},"-",{text:com.trackplus.TrackplusConfig.getText("common.btn.addMeInformant"),itemId:"addMeAsI",disabled:a.watcherMeInformedDisabled,iconCls:"add16",handler:function(){a.addRemoveMeAsInformant.call(a)}}];return b},addRole:function(a,b,c,e){var f=this;c={projectID:f.projectID,
issueTypeID:f.issueTypeID};null!=f.workItemID&&(c.workItemID=f.workItemID);Ext.Ajax.request({url:"addRaciRole!load.action?raciRole\x3d"+a,params:c,encoding:"utf-8",sync:!0,success:function(c){var e=Ext.decode(c.responseText);c=[];var k=e.persons;if(null!=k)for(var l=0;l<k.length;l++)c.push(k[l]);e=e.groups;if(null!=e)for(l=0;l<e.length;l++)c.push(e[l]);Ext.create("com.trackplus.util.PersonPickerDialog",{title:b,data:c,width:300,height:250,includeEmail:!1,handler:function(b,c){f.addPersonHandler.call(f,
b,a)},scope:f}).showDialog()}})},addPersonHandler:function(a,b){var c=this;if(null!=a||0!=a.length){for(var e="",f=0;f<a.length;f++)var g=a[f].data.id,e=0==f?g:e+(","+g);Ext.Ajax.request({url:"addRaciRole!save.action",disableCaching:!0,success:function(){c.fireItemChange([-1003,-1004]);c.refresh.call(c)},failure:function(){},method:"POST",params:{raciRole:b,"consInfEdit.selectedPersonsStr":e,issueTypeID:c.issueTypeID,projectID:c.projectID,workItemID:c.workItemID}})}},handlerDeleteItem:function(){var a=
this,b=a.gridConfig.selectionModel.getSelection(),c="",e="",f="",g="",h,k;for(k=0;k<b.length;k++)h=b[k].data,"i"==h.raciRole?"true"==h.isGroup?g=g+h.objectID+";":e=e+h.objectID+";":"true"==h.isGroup?f=f+h.objectID+";":c=c+h.objectID+";";b="deleteWatchers.action?projectID\x3d"+a.projectID+"\x26issueTypeID\x3d"+a.issueTypeID;null!=a.workItemID&&(b=b+"\x26workItemID\x3d"+a.workItemID);Ext.Ajax.request({url:b,disableCaching:!0,success:function(){a.fireItemChange([-1003,-1004]);a.refresh.call(a)},failure:function(){},
method:"POST",params:{deletedConsultants:c,deletedInformants:e,deletedInformantGroups:g,deletedConsultantGroups:f}})},addRemoveMeAsConsultant:function(){var a="";this.meAsC?(a="r",this.meAsC=!1):(a="a",this.meAsC=!0);this.doMe(a,"c")},doMe:function(a,b){var c=this,e="editConsultants.action?projectID\x3d"+c.projectID+"\x26issueTypeID\x3d"+c.issueTypeID;null!=c.workItemID&&(e=e+"\x26workItemID\x3d"+c.workItemID);Ext.Ajax.request({url:e,disableCaching:!0,success:function(){c.fireItemChange([-1003,-1004]);
c.refresh.call(c)},failure:function(){},method:"POST",params:{raciRole:b,operation:a}})},addRemoveMeAsInformant:function(){var a="";this.meAsI?(a="r",this.meAsI=!1):(a="a",this.meAsI=!0);this.doMe(a,"i")},refreshCallback:function(a,b,c){if(!1!=c){this.meAsI=this.meAsC=!1;for(b=b=0;b<a.length;b++)a[b].data.objectID===this.myID&&("i"==a[b].data.raciRole?this.meAsI=!0:this.meAsC=!0);b=this.gridConfig.grid.down("#addMeAsC");c=this.gridConfig.grid.down("#addMeAsI");this.meAsC?(b.setText(getText("common.btn.deleteMeConsultant")),
b.setIconCls("delete16")):(b.setText(getText("common.btn.addMeConsultant")),b.setIconCls("add16"));this.meAsI?(c.setText(getText("common.btn.deleteMeInformant")),c.setIconCls("delete16")):(c.setText(getText("common.btn.addMeInformant")),c.setIconCls("add16"));this.setTitle(this.replaceTitleNumber(this.title,a.length))}}});
Ext.define("com.trackplus.item.action.StepRenderer",{extend:"Ext.Base",config:{issueNoLabel:"",workItemID:"",statusDisplay:"",synopsis:""},labelWidth:150,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},createFormPanel:function(a){return Ext.create("Ext.form.Panel",{padding:"5 5 5 5",bodyPadding:0})},showErrorMessage:function(a,b){CWHF.showMsgError(getText(a.localizedErrorKey))},createItemTitleHtml:function(a,b,c,e){return a+'\x3cstrong\x3e\x3cspan class\x3d"emphasize"\x3e\x26nbsp;'+
b+'\x3c/span\x3e : \x3cspan class\x3d"dataEmphasize"\x3e'+c+"\x3c/span\x3e :\x26nbsp;"+e+"\x3c/strong\x3e"},createItemTitleSection:function(a,b,c,e,f){a=this.createItemTitleHtml(a,b,c,e,f);return{xtype:"box",style:{border:"none",paddingTop:"2px"},region:f,margin:"0 0 0 0",border:!1,height:22,html:a}}});
Ext.define("com.trackplus.item.action.CopyItem1StepRenderer",{extend:"com.trackplus.item.action.StepRenderer",createFormPanel:function(a){var b=this.createItemTitleSection(a.issueNoLabel,a.workItemID,a.statusDisplay,a.synopsis);return Ext.create("Ext.form.Panel",{region:"center",layout:"anchor",padding:"5 5 5 5",bodyPadding:0,border:!1,url:"item!saveInFirstStep.action",items:[b,{xtype:"checkboxgroup",columns:1,labelWidth:1,items:[{boxLabel:getText("item.action.copy.deepCopy"),inputValue:!0,name:"params.deepCopy",
checked:a.deepCopy},{boxLabel:getText("item.action.copy.copyAttachments"),inputValue:!0,name:"params.copyAttachments",checked:a.copyAttachments},{boxLabel:getText("item.action.copy.copyChildren"),inputValue:!0,name:"params.copyChildren",checked:a.copyChildren,disabled:!a.hasChildren}]}]})}});
Ext.define("com.trackplus.item.action.ItemLocationStepRenderer",{extend:"com.trackplus.item.action.StepRenderer",cmbIssueType:null,createCmbIssueType:function(a){var b=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},{name:"label",type:"string"}],data:a.issueTypeList}),b=Ext.create("Ext.form.ComboBox",{id:"IssueTypeList",fieldLabel:a.issueTypeLabel,store:b,displayField:"label",valueField:"id",typeAhead:!0,queryMode:"local",triggerAction:"all",name:"params.issueTypeID",allowBlank:!1,editable:!1,
disabled:!0==a.fixedIssueType,hiddenId:"issueTypeID",labelWidth:this.labelWidth,labelAlign:"right",width:400});b.setValue(a.issueTypeID);return b},createFormPanel:function(a){this.jsonData=a;return this.form=Ext.create("Ext.form.Panel",{border:!1,bodyBorder:!1,region:"center",url:"item!next.action",padding:"5 5 5 5",bodyPadding:0,layout:"anchor",items:this.createFormItems(a)})},createFormItems:function(a){if(null==a)return[{xtype:"component",html:"no right to create items"}];var b=null,b=!0==a.fixedIssueType?
null:{select:{fn:this.projectChange,scope:this}};this.cmbProject=CWHF.createSingleTreePicker(a.projectLabel,"params.projectID",a.projectTree,a.projectID,{allowBlank:!1,labelIsLocalized:!0,labelWidth:this.labelWidth,width:400,margin:"0 0 5 0"},b);b=[];this.cmbIssueType=this.createCmbIssueType(a);b=[];b.push(this.cmbProject);b.push(this.cmbIssueType);!0==a.fixedIssueType&&b.push({xtype:"hiddenfield",name:"params.issueTypeID",value:a.issueTypeID});return b},projectChange:function(){var a=this,b=a.cmbProject.getSubmitValue(),
c=a.cmbIssueType.getValue();a.form.setLoading(!0);Ext.Ajax.request({url:"item!reloadIssueTypes.action",disableCaching:!0,params:{projectID:b,issueTypeID:c,workItemID:a.jsonData.parentID},success:function(b){b=Ext.decode(b.responseText);a.cmbIssueType.store.loadData(b.issueTypeList);a.cmbIssueType.setValue(b.issueTypeID);a.cmbIssueType.setFieldLabel(b.issueTypeLabel);a.form.setLoading(!1)},failure:function(b){a.form.setLoading(!1);alert("error refresh issue type: "+b.message)},method:"POST"})}});
Ext.define("com.trackplus.item.action.MoveItemStepRenderer",{extend:"com.trackplus.item.action.ItemLocationStepRenderer",createOldLocationPanel:function(a){var b=a.projectLabel+": \x3cb\x3e"+a.oldProject+"\x3c/b\x3e \x26nbsp;",b=b+(a.issueTypeLabel+": \x3cb\x3e"+a.oldIssueType+"\x3c/b\x3e");return{xtype:"component",html:b,anchor:"100%",cls:"infoBox",margin:"0 0 10 0",border:!0}},createCmbStatus:function(a){Ext.define("Status",{extend:"Ext.data.Model",fields:[{name:"id",type:"int"},{name:"label",type:"string"}]});
var b=Ext.create("Ext.data.Store",{model:"Status",data:a.statusList}),b=Ext.create("Ext.form.ComboBox",{id:"StatusList",fieldLabel:a.statusLabel,store:b,displayField:"label",valueField:"id",typeAhead:!0,queryMode:"local",triggerAction:"all",name:"params.statusID",allowBlank:!1,hiddenId:"statusID"});b.setValue(a.statusID);return b},createFormItems:function(a){var b=this.superclass.createFormItems.call(this,a.issueLocation);b.unshift(this.createOldLocationPanel(a));var c=this.createItemTitleSection(a.issueNoLabel,
a.workItemID,a.statusDisplay,a.synopsis);b.unshift(c);a.statusNeeded&&b.push(this.createCmbStatus(a));this.moveChildren=CWHF.createCheckbox("item.action.move.moveChildren","params.moveChildren",{value:a.moveChildren,labelWidth:150,disabled:!a.hasChildren});b.push(this.moveChildren);return b}});
com.trackplus.item.ItemErrorHandler={handleErrors:function(a,b){var c=a.itemComponent.screenFacade.controller.fieldTypeRenderersMap,e=a.itemComponent.txtTitleHeader;switch(b.errorCode){case 0:case 1:for(var f="",g=b.errors,h=0;h<g.length;h++){var k=g[h].id;if(null!=k){var l=c["f"+k];null!=l?l.markInvalid(g[h].label):17==k&&null!=e&&e.markInvalid(g[h].label)}f+=g[h].label+"\x3c/BR\x3e"}c=getText(getText("item.err.saveFailed",a.itemComponent.synopsis));0<f.length&&(c=f);CWHF.showMsgError(c);break;case 2:com.trackplus.item.ItemErrorHandler.outOfDateHandler(a,
b)}},outOfDateHandler:function(a,b){Ext.MessageBox.show({title:getText("item.err.wasModified"),msg:getText("item.err.modified"),buttons:Ext.MessageBox.YESNOCANCEL,buttonText:{yes:getText("item.err.btn.ignore"),no:getText("item.err.btn.overwrite"),cancel:getText("item.err.btn.merge")},fn:function(c){"yes"==c?com.trackplus.item.ItemErrorHandler.outOfDateHandler_ignore(a,b):"no"==c?com.trackplus.item.ItemErrorHandler.outOfDateHandler_overwrite(a,b):"cancel"==c&&com.trackplus.item.ItemErrorHandler.outOfDateHandler_merge(a,
b)},icon:Ext.MessageBox.QUESTION})},outOfDateHandler_ignore:function(a,b){a.lastModified=b.lastModified},outOfDateHandler_overwrite:function(a,b){var c=a.itemComponent.screenFacade.controller.fieldTypeRenderersMap,e=b.workItemContext,f=e.fieldConfigs,g=e.fieldValues,e=e.fieldDisplayValues,h;for(h in f){var k=f[h],l=c[h];null!=l&&l.update.call(l,{fieldConfig:k,value:g[h],displayValue:e[h]})}a.lastModified=b.lastModified},outOfDateHandler_merge:function(a,b){var c=a.itemComponent.screenFacade.controller.fieldTypeRenderersMap,
e=b.workItemContext,f=e.fieldConfigs,e=e.fieldValues,g;for(g in f)if(f=c[g],null!=f){var h=e[g],k=f.getValue(),l=f.getOriginalValue();h!=l?k!=l?f.markConflict(h):f.markModifiedByOther(h):k!=l&&f.markModifiedByMe()}a.lastModified=b.lastModified}};
Ext.define("com.trackplus.item.ItemAction",{extend:"Ext.util.Observable",config:{workItemID:null,actionID:null,screenID:null,parentID:null,projectID:null,releaseID:null,issueTypeID:null,synopsis:null,description:null,successHandler:null,successExtra:null,readOnlyMode:!1,scope:null,title:null,disabledNext:!0,disabledPrev:!0},lastModified:null,parentContainer:null,centerPanelCls:"itemscreen",constructor:function(a){this.initialConfig=a=a||{};this.events=[];this.addEvents("activate","deactivate","close",
"itemChange","navigateToItem","clickOnChild","clickOnLink","clickOnParent");this.listeners=a.listeners;this.callParent(arguments)},execute:function(){var a=this;a.setLoading(!0);Ext.Ajax.request({url:"item!executeAJAX.action",scope:a,params:{workItemID:a.workItemID,parentID:a.parentID,synopsis:a.synopsis,description:a.description,readOnlyMode:a.readOnlyMode,issueTypeID:a.issueTypeID,projectID:a.projectID,releaseID:a.releaseID,actionID:a.actionID},success:function(b){b=Ext.decode(b.responseText);a.setLoading(!1);
!0==b.success?a.loadSuccess.call(a,b.data):a.loadFailure.call(a,b)},failure:function(b){a.setLoading(!1);Ext.MessageBox.show({title:getText("common.err.sorry"),msg:b.responseText,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}})},reExecute:function(){this.execute()},setLoading:function(a){borderLayout.setLoading(a)},createChildren:function(){this.initToolbar("0 0 0 0");this.parentPanel=Ext.create("Ext.panel.Panel",{margin:"0 0 0 0",cls:this.centerPanelCls,bodyPadding:0,border:!1,layout:"fit",region:"center"});
return[Ext.create("Ext.panel.Panel",{border:!1,bodyBorder:!1,margin:"0 0 0 0",region:"north",layout:{type:"hbox",padding:"0",align:"top"},items:[this.toolbar,this.extraToolbar]}),this.parentPanel]},initToolbar:function(){this.toolbar=Ext.create("Ext.toolbar.Toolbar",{layout:{overflowHandler:"Menu"},enableOverflow:!0,flex:1,cls:"toolbarActions",border:"1 0 1 0",defaults:{cls:"toolbarItemAction",overCls:"toolbarItemAction-over",scale:"small",iconAlign:"left",enableToggle:!1}});this.extraToolbar=Ext.create("Ext.toolbar.Toolbar",
{enableOverflow:!1,cls:"toolbarActions",border:"1 0 1 0",defaults:{cls:"toolbarItemAction",overCls:"toolbarItemAction-over",scale:"small",iconAlign:"left",enableToggle:!1}})},loadSuccess:function(a){Ext.suspendLayouts();this.lastModified=a.lastModified;var b=a.useWizard;null!=this.toolbar&&(this.toolbar.removeAll(),this.toolbar.doLayout());b?(this.title1=a.title1,this.title=a.title,this.openWizardItem.call(this,a)):(this.title=a.title,this.openSimpleItem.call(this,a));this.updateTitle.call(this,a);
this.addToolbarButtons.call(this,a.toolbar,b);Ext.resumeLayouts(!0)},loadFailure:function(a){null!=a.localizedErrorKey&&CWHF.showMsgError(getText(a.localizedErrorKey));null!=a.message&&CWHF.showMsgError(a.message);null!=a.errorMessage&&CWHF.showMsgError(a.errorMessage)},updateTitle:function(a){},openSimpleItem:function(a){this.editItemScreen.call(this,a,this.parentPanel,!0)},createParentContainer:function(){return Ext.create("Ext.panel.Panel",{layout:"border",margin:"0 0 0 0",border:!1,bodyBorder:!1,
cls:"printItem",items:[{region:"center"}]})},addToolbarButtons:function(a,b){var c=this;if(null!=c.toolbar&&null!=a){for(var e=[],f=[],g=0;g<a.length;g++)if(c.isVisibleAction(a[g])){var h=a[g],k=h.isMore,h=c.createToolbarAction(h);k?f.push(h):e.push(h)}c.toolbar.add(e);0<f.length&&(e=Ext.create("Ext.button.Split",{text:getText("common.btn.moreActions"),overflowText:getText("common.btn.moreActions"),tooltip:getText("common.btn.moreActions.tt"),iconCls:"extraActions",disabled:!1,menu:f}),c.toolbar.add(e))}null!=
c.extraToolbar&&(c.extraToolbar.removeAll(),e=[],-2==c.actionID&&(e.push("-"),e.push(Ext.create("Ext.button.Button",{itemId:"prevItem",overflowText:getText("common.btn.backward"),tooltip:getText("common.btn.backward.tt"),iconCls:"itemAction_upward16",cls:"toolbarItemAction-noText",disabled:c.disabledPrev,handler:function(){c.executeToolbarAction.call(c,{id:com.trackplus.item.ToolbarItem.NAVIGATION_PREV})},scope:c})),e.push("-"),e.push(Ext.create("Ext.button.Button",{itemId:"nextItem",overflowText:getText("common.btn.forward"),
tooltip:getText("common.btn.forward.tt"),iconCls:"itemAction_downward16",cls:"toolbarItemAction-noText",disabled:c.disabledNext,handler:function(){c.executeToolbarAction.call(c,{id:com.trackplus.item.ToolbarItem.NAVIGATION_NEXT})},scope:c}))),!0!=com.trackplus.TrackplusConfig.user.sys||null!=b&&!1!=b||(e.push("-"),e.push(Ext.create("Ext.button.Button",{overflowText:getText("common.btn.config"),tooltip:getText("common.btn.config"),iconCls:"btnConfig",cls:"toolbarItemAction-noText",handler:c.onScreenConfig,
scope:c}))),c.extraToolbar.add(e))},setDisabledNextButton:function(a){this.disabledNext=a;if(null!=this.extraToolbar){var b=this.extraToolbar.getComponent("nextItem");null!=b&&b.setDisabled(a)}},setDisabledPrevButton:function(a){this.disabledPrev=a;if(null!=this.extraToolbar){var b=this.extraToolbar.getComponent("prevItem");null!=b&&b.setDisabled(a)}},onScreenConfig:function(){var a="screenEdit.action?componentID\x3d"+this.screenID+"\x26backAction\x3ditemNavigator.action%3FactionID%3D"+this.actionID;
null!=this.workItemID&&(a=a+"%26workItemID%3D"+this.workItemID);window.location.href=a},isVisibleAction:function(a){return a.id==com.trackplus.item.ToolbarItem.BACK?!1:!0},createToolbarAction:function(a){var b=this;return{overflowText:getText(a.labelKey),tooltip:getText(a.tooltipKey),iconCls:a.cssClass+"20",cls:"toolbarItemAction-noText",disabled:!1==a.condition,text:getText(a.labelKey),handler:function(c){b.executeToolbarAction.call(b,a)}}},openWizardItem:function(a){var b=this;b.canFinish=a.canFinish;
b.step1Renderer=Ext.create(a.extClassName);b.form1=b.step1Renderer.createFormPanel(a.jsonData);var c=Ext.create("Ext.form.Panel",{region:"center",url:"item!save.action",margins:"0 0 0 0",bodyPadding:0,border:!1,baseCls:"x-plain",layout:"fit"});b.form2=c;b.btnPrev=Ext.create("Ext.Button",{text:getText("common.btn.backward"),iconCls:"itemAction_navigate_left",cls:"toolbarItemAction-noImage",disabled:!0,scope:b,handler:function(c){b.prev.call(b,a)}});b.btnNext=Ext.create("Ext.Button",{text:getText("common.btn.forward"),
iconCls:"itemAction_navigate_right",disabled:!1,scope:b,formBind:!0,iconAlign:"right",cls:"toolbarItemAction-noImage",handler:function(c){b.next.call(b,a)}});b.btnFinish=Ext.create("Ext.Button",{text:a.finishLabel,iconCls:null==a.cssClass?"save":a.cssClass+"20",hidden:!a.canFinish,scope:b,handler:function(c){b.finish.call(b,a)}});b.btnReset=Ext.create("Ext.Button",{text:"Reset",scope:b,handler:function(a){}});b.btnCancel=Ext.create("Ext.Button",{text:"Cancel",scope:b,handler:function(a){null!=b.dialogItemAction&&
(b.dialogItemAction.close(),b.dialogItemAction.destroy())}});b.centerPanelWizard=Ext.create("Ext.panel.Panel",{layout:"card",border:!1,bodyBorder:!1,autoScroll:!0,defaults:{margins:"0 0 0 0",bodyStyle:{padding:"5px"}},items:[b.form1,c]});b.toolbar.add(b.btnPrev);b.toolbar.add(borderLayout.createItemToolbarSeparator());b.toolbar.add(b.btnNext);b.toolbar.add(borderLayout.createItemToolbarSeparator());b.toolbar.add(b.btnFinish);b.toolbar.doLayout();b.parentPanel.removeAll();b.parentPanel.add(b.centerPanelWizard);
b.parentPanel.doLayout();null!=b.addLinkFromContextMenu&&b.addLinkDetailsToForm()},addLinkDetailsToForm:function(){var a=this,b=Ext.create("com.aurel.trackplus.itemDetail.LinksTab",{workItemID:a.workItemID,projectID:a.addLinkFromContextMenu.projectID,issueTypeID:a.addLinkFromContextMenu.issueTypeID});a.linkFormPanel=b.createFormPanel();a.linkFormPanel.getForm().load({url:"itemLink!editItemLink.action",params:{workItemID:a.workItemID},scope:a,success:function(c,e){var f=e.result.data;b.cmbLinkType.store.loadData(f.linkTypesList,
!1);b.cmbLinkType.setValue(f.linkTypeWithDirection);b.txtIssueNo.setValue(a.workItemID);b.hiddenIssueNo.setValue(a.workItemID);b.txtSynopsis.setValue(a.addLinkFromContextMenu.workItemName);b.txtDescription.setValue("");b.replaceSpecificPart(a.linkFormPanel,f.linkTypeJSClass,f.specificData)},failure:function(){alert("failure")}});a.linkFormPanel.margin="0 0 0 -12";a.form1.items.add(a.linkFormPanel)},prev:function(a){this.navigate.call(this,"prev",a);for(a=this.toolbar.items;5<a.getCount();)this.toolbar.remove(a.getAt(5));
null!=this.extraToolbar&&this.extraToolbar.removeAll();this.btnFinish.setVisible(this.canFinish);this.toolbar.doLayout()},next:function(a){var b=this;if(!b.form1.getForm().isValid())return!1;a={};null!=b.addLinkFromContextMenu&&(a=b.linkFormPanel.getForm().getValues());a.workItemID=b.workItemID;a.parentID=b.parentID;a.synopsis=b.synopsis;a.description=b.description;a.actionID=b.actionID;b.setLoading(!0);b.form1.getForm().submit({url:"item!next.action",params:a,success:function(a,e){b.navigate.call(b,
"next",e.result.data);b.btnFinish.setVisible(!1);b.editItemScreen(e.result.data,b.form2,!0);b.addToolbarButtons.call(b,e.result.data.toolbar);b.setLoading(!1)},failure:function(a,e){b.setLoading(!1);b.step1Renderer.showErrorMessage(e.result,b.form1)}})},navigate:function(a,b){var c=this.centerPanelWizard.getLayout();c[a]();this.btnPrev.setDisabled(!c.getPrev());this.btnNext.setDisabled(!c.getNext());b.canFinish||this.btnFinish.setDisabled(c.getNext())},finish:function(){!1==this.centerPanelWizard.getLayout().getNext()?
this.save.call(this):this.saveInFirstStep.call(this)},saveInFirstStep:function(){var a=this;if(null!=a.successExtra)for(var b in a.successExtra);a.form1.getForm().submit({url:"item!saveInFirstStep.action",params:{workItemID:a.workItemID,projectID:a.projectID,issueTypeID:a.issueTypeID,actionID:a.actionID},success:function(b,e){a.saveSuccess.call(a,b,e)},scope:a,failure:a.saveFailure})},saveSuccess:function(a,b){var c=null;null!=b&&(c=b.result.data);null!=this.successHandler&&this.successHandler.call(null!=
this.scope?this.scope:this,c,this.successExtra)},saveFailure:function(a,b){alert("failure")},itemChangeHandler:function(a){this.fireEvent("itemChange",a)},clickOnChild:function(a){this.fireEvent("clickOnChild",a)},clickOnLink:function(a){this.fireEvent("clickOnLink",a)},clickOnParent:function(a){this.fireEvent("clickOnParent",a)},changeToEditMode:function(){var a=this;null==a.successExtra&&(a.successExtra={});a.successExtra.actionID=a.actionID;a.successExtra.workItemID=a.workItemID;Ext.Ajax.request({url:"item!toolbarEdit.action",
params:{workItemID:a.workItemID},success:function(b){var c=Ext.decode(b.responseText).data,e=a.toolbar.getEl();e.fadeOut({opacity:0.1,easing:"easeOut",duration:150,remove:!1,useDisplay:!1,callback:function(){a.toolbar.removeAll();a.addToolbarButtons.call(a,c);e.fadeIn({opacity:1,easing:"easeOut",duration:300})}});a.actionID=2;a.readOnlyMode=!1},failure:function(){alert("failed!")}})},changeLastModified:function(a){this.lastModified=a},editItemScreen:function(a,b,c){this.projectID=a.projectID;this.issueTypeID=
a.issueTypeID;this.screenID=a.screen.id;this.itemComponent=Ext.create("com.trackplus.item.ItemComponent",{workItemID:a.workItemID,workItemIDDisplay:a.workItemIDDisplay,projectID:a.projectID,projectLabel:a.projectLabel,issueTypeID:a.issueTypeID,issueTypeLabel:a.issueTypeLabel,readOnlyMode:a.readOnlyMode,actionID:a.actionID,issueNoLabel:a.issueNoLabel,statusDisplay:a.statusDisplay,statusID:a.statusID,synopsis:a.synopsis,includeBottomTabs:a.includeBottomTabs,itemDetailData:a.itemDetail,includeItemTitle:!1,
synopsisReadonly:a.synopsisReadonly,inlineEdit:a.inlineEdit,lastModified:this.lastModified,itemLockedMessage:a.itemLockedMessage});this.itemComponent.addListener("editMode",this.changeToEditMode,this);this.itemComponent.addListener("lastModified",this.changeLastModified,this);this.itemComponent.addListener("itemChange",this.itemChangeHandler,this);this.itemComponent.addListener("clickOnChild",this.clickOnChild,this);this.itemComponent.addListener("clickOnLink",this.clickOnLink,this);this.itemComponent.addListener("clickOnParent",
this.clickOnParent,this);this.readOnlyMode=a.readOnlyMode;var e=this.itemComponent.createItemPanel();b.removeAll();b.add(e);c?this.itemComponent.replaceScreenItem(a.screen,a.children,a.readOnlyMode,a.workItemContext):this.itemComponent.refreshItemPanel()},refreshChildren:function(){null!=this.itemComponent&&this.itemComponent.refreshChildren.call(this.itemComponent)},executeToolbarAction:function(a){var b=a.url,b=a.jsonData;switch(a.id){case com.trackplus.item.ToolbarItem.ITEM_ACTION:case com.trackplus.item.ToolbarItem.SIBLING:this.executeItemAction.call(this,
b);break;case com.trackplus.item.ToolbarItem.CHOOSE_PARENT:this.chooseParent();break;case com.trackplus.item.ToolbarItem.PRINT:b="printItem2.action?workItemID\x3d"+this.workItemID;window.open(b,"PrintItem","scrollbars\x3dyes,resizable\x3dyes,menubar\x3dyes,location\x3dyes,status\x3dyes");break;case com.trackplus.item.ToolbarItem.PRINT_WITH_CHILDREN:b="printItemWithChildren.action?workItemID\x3d"+this.workItemID;window.open(b,"PrintItem","scrollbars\x3dyes,resizable\x3dyes,menubar\x3dyes,location\x3dyes,status\x3dyes");
break;case com.trackplus.item.ToolbarItem.ACCESS_LEVEL:this.reverseAccessFlag();break;case com.trackplus.item.ToolbarItem.ARCHIVE:this.reverseArchive();break;case com.trackplus.item.ToolbarItem.DELETE:this.reverseDelete();break;case com.trackplus.item.ToolbarItem.MAIL:this.sendEmail();break;case com.trackplus.item.ToolbarItem.BACK:this.back();break;case com.trackplus.item.ToolbarItem.NAVIGATION_NEXT:this.navigateToItem.call(this,"next");break;case com.trackplus.item.ToolbarItem.NAVIGATION_PREV:this.navigateToItem.call(this,
"prev");break;case com.trackplus.item.ToolbarItem.SAVE:this.save.call(this);break;case com.trackplus.item.ToolbarItem.RESET:this.reset();break;case com.trackplus.item.ToolbarItem.PRINT_ITEM:window.open("printItem.action?workItemID\x3d"+this.workItemID,"printItem"+this.workItemID)}},executeItemAction:function(a){var b=a.actionID;a=a.parentID;null==this.successExtra&&(this.successExtra={});this.successExtra.actionID=this.actionID;this.successExtra.workItemID=this.workItemID;this.actionID=b;this.parentID=
a;this.reExecute();this.fireEvent.call(this,"activate",this)},chooseParent:function(){var a=this.workItemID,b=this.projectID,c=null,e=null,f=null;!0==this.readOnlyMode?(null==this.successExtra&&(this.successExtra={}),this.successExtra.actionID=this.actionID,this.successExtra.workItemID=this.workItemID,c={url:"item!setParent.action",params:{workItemID:a},pickItemName:"parentID",successHandler:this.saveSuccess,successHandlerScope:this}):(e=this.setParent,f=this);Ext.create("com.trackplus.util.IssuePicker",
{workItemID:a,parent:!0,projectID:-1*b,title:getText("common.btn.chooseParent"),ajaxContext:c,handler:e,scope:f}).showDialog()},reverseAccessFlag:function(){this.reverseFlag("item!reverseAccessFlag.action?workItemID\x3d"+this.workItemID)},reverseArchive:function(){this.reverseFlag("item!reverseArchive.action?workItemID\x3d"+this.workItemID)},reverseDelete:function(){this.reverseFlag("item!reverseDelete.action?workItemID\x3d"+this.workItemID)},reverseFlag:function(a){var b=this;Ext.Ajax.request({url:a,
success:function(a){a=Ext.decode(a.responseText);!0==a.success?b.reExecute():null!=a.errorMessage&&Ext.MessageBox.show({title:getText("common.warning"),msg:a.errorMessage,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})},failure:function(){var a=Ext.decode(action.response.responseText);b.handleErrors.call(b,a.data)}})},sendEmail:function(){Ext.create("com.trackplus.item.SendEmail",{workItemID:this.workItemID}).show()},back:function(){},getMyPosition:function(){return null},navigateToItem:function(a){this.fireEvent("navigateToItem",
this,a)},reset:function(){this.itemComponent.itemPanel.getForm().reset()},setLoading:function(a){this.itemComponent.itemPanel.setLoading(a)},save:function(a){var b=this,c=b.itemComponent.txtTitleHeader.getValue(),e=b.itemComponent.itemPanel,f=b.itemComponent.screenFacade.controller.fieldTypeRenderersMap,g=b.itemComponent.screenFacade.controller.dataModel.fieldValues.f16,h=!1,k;for(k in f)"f16"==k&&(h=!0),g=f[k],g.beforeSubmit.call(g);if(!e.getForm().isValid())return CWHF.showMsgError(getText("item.err.invalidForm")),
(e=e.getForm().getFields().findBy(function(a){return!a.validate()}))&&e.focus(),!1;f=b.lastModified;g=b.itemComponent.screenFacade.controller.dataModel.fieldValues.f16;a={confirm:a,workItemID:b.workItemID,projectID:b.projectID,issueTypeID:b.issueTypeID,lastModified:f,"fieldValues.f17":c,actionID:b.actionID};null!=g&&!1==h&&(a["fieldValues.f16"]=g);b.setLoading(!0);e.getForm().submit({url:"itemSave.action",params:a,success:function(a,c){b.setLoading(!1);b.saveSuccess.call(b,a,c)},failure:function(a,
c){b.setLoading(!1);var e=null,f=null,g=null;if(null!=c.response){var h=c.response.responseText;null!=h&&(e=Ext.decode(h),null!=e&&null!=e.data&&(f=e.data.errorCode,g=e.data.errors))}if(3==f&&null!=g){var k="";Ext.Array.forEach(g,function(a){k+=a.label},b);Ext.MessageBox.confirm(getText("common.confirm"),k,function(a){"no"==a?(a=Ext.decode(c.response.responseText),b.handleErrors.call(b,a.data)):b.save.call(b,!0)},this)}else b.handleErrors.call(b,e.data)}})},setParent:function(a){this.itemComponent.setParent.call(this.itemComponent,
a.objectID,a.title,a.id)},reload:function(a){this.itemComponent.refreshItemPanel.call(this.itemComponent);null!=this.successHandler&&this.successHandler.call(null!=this.scope?this.scope:this)},handleErrors:function(a){com.trackplus.item.ItemErrorHandler.handleErrors(this,a)}});
Ext.define("com.trackplus.item.ItemActionDialog",{extend:"com.trackplus.item.ItemAction",config:{title:"...",modal:!0,w:1E3,h:600,createDialogBeforLoaded:!0,animateTarget:null,position:null,addLinkFromContextMenu:null},myPosition:null,centerPanelCls:"itemDialogBody",getMyPosition:function(){return this.myPosition},dialog:null,savedSuccessfully:!1,reExecute:function(){this.execute(!0)},execute:function(a){!0!=a&&this.createDialogBeforLoaded&&this.initDialog();this.callParent()},initDialog:function(){this.initToolbar();
this.createDialog();this.dialog.show(this.animateTarget)},loadSuccess:function(a){this.createDialogBeforLoaded||this.initDialog();this.callParent(arguments)},loadFailure:function(a){if(null!=this.dialog){try{this.dialog.close()}catch(b){}this.dialog=null}this.callParent(arguments)},createDialog:function(){var a=this;a.parentPanel=Ext.create("Ext.container.Container",{margin:"0 0 0 0",padding:" 0 0 0 0",border:!1,cls:"itemDialogBody",layout:"fit",region:"center"});a.toolbar.height=27;var b=borderLayout.ensureSize(a.w,
a.h);a.w=b.width;a.h=b.height;b=Ext.create("Ext.panel.Panel",{border:!1,bodyBorder:!1,margin:"0 0 0 0",region:"north",layout:{type:"hbox",padding:"0",align:"top"},items:[a.toolbar,a.extraToolbar]});a.dialog=Ext.create("Ext.window.Window",{cls:"workItemDialog itemscreen",constrainHeader:!0,maximizable:!0,layout:"border",width:a.w,height:a.h,closeAction:"destroy",stateful:!0,stateId:"winItem",bodyBorder:!1,bodyStyle:{border:"none"},plain:!0,title:a.title,modal:a.modal,items:[b,a.parentPanel],afterSetPosition:a.afterSetPositionItemDialog,
listeners:{staterestore:{fn:function(b,e){borderLayout.ensureDialogSizeFromState(b,e,a.position);a.myPosition=[b.x,b.y]}},activate:{fn:function(){a.fireEvent.call(a,"activate",a)}},deactivate:{fn:function(){a.fireEvent.call(a,"deactivate",a)}},close:{fn:function(){a.fireEvent.call(a,"close",a,{savedSuccessfully:a.savedSuccessfully});a.savedSuccessfully=!1}},maximize:{fn:a.onMaximizeItemDialog,scope:a},beforestatesave:{fn:function(){a.myPosition=a.dialog.getPosition()}}}})},afterSetPositionItemDialog:function(){if(!0==
this.maximized){var a=borderLayout.getHeight(),b=this.getHeight(),c=this.getY(),a=a-95;if(a!=b||67!=c)this.setY(67),this.setHeight(a),this.doLayout()}},onMaximizeItemDialog:function(a,b){this.dialog.getHeight();var c=borderLayout.getHeight();this.dialog.setHeight(c-95);this.dialog.setY(67);this.dialog.doLayout()},updateTitle:function(a){a.useWizard?this.dialog.setTitle(a.title1):this.dialog.setTitle(a.title)},navigate:function(a,b){this.callParent(arguments);null!=this.dialog&&("prev"==a?this.dialog.setTitle(b.title1):
this.dialog.setTitle(b.title))},saveSuccess:function(a,b){var c=null,c=null;null!=b&&(c=b.result.data,c=c.workItemID);if(null!=this.successExtra&&-2==this.successExtra.actionID)this.actionID=-2,null==c&&(c=this.successExtra.workItemID),this.workItemID=c,this.successExtra.actionID=null,this.successExtra.workItemID=null,this.reExecute();else{try{this.savedSuccessfully=!0,this.dialog.close(),this.dialog.destroy()}catch(e){}this.dialog=null}this.callParent(arguments)},saveFailure:function(a,b){if(null!=
this.dialog){try{this.dialog.destroy()}catch(c){}this.dialog=null}this.callParent(arguments)},executeToolbarAction:function(a){switch(a.id){case com.trackplus.item.ToolbarItem.CANCEL:if(null!=this.dialog)if(null!=this.successExtra&&-2==this.successExtra.actionID)this.actionID=-2,this.workItemID=this.successExtra.workItemID,this.successExtra.actionID=null,this.successExtra.workItemID=null,this.reExecute();else{try{this.dialog.close(),this.dialog.destroy()}catch(b){}this.dialog=null}}this.callParent(arguments)},
setLoading:function(a){null!=this.dialog?this.dialog.setLoading(a):borderLayout.setLoading(a)}});Ext.define("com.trackplus.screen.Screen",{extend:"Ext.Base",config:{id:null,label:null,name:null,description:null,personID:null,tabs:[]},type:"Screen",constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)}});
Ext.define("com.trackplus.screen.Tab",{extend:"Ext.Base",config:{id:null,name:null,label:null,description:null,panels:[]},type:"Tab",constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)}});Ext.define("com.trackplus.screen.Panel",{extend:"Ext.Base",config:{id:null,label:null,description:null,colsNo:1,rowsNo:1,fields:[]},type:"Panel",constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)}});
Ext.define("com.trackplus.screen.Field",{extend:"Ext.Base",config:{id:null,title:null,extClassName:null,extReadOnlyClassName:null,label:null,value:null,displayValue:null,name:null,nameMapping:null,jsonData:{},empty:!1,colSpan:0,rowSpan:0,row:0,col:0,labelHAlign:null,labelVAlign:null,valueHAlign:null,valueVAlign:null,hideLabel:!1,iconRendering:null,fieldID:null},type:"Field",constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)}});
com.trackplus.screen.createScreenModel=function(a){var b=Ext.create("com.trackplus.screen.Screen",{id:a.id,name:a.name,label:a.label,description:a.description});a=a.tabs;if(null!=a){for(var c=[],e=0;e<a.length;e++)c.push(com.trackplus.screen.createTabModel(a[e]));b.setTabs(c)}return b};
com.trackplus.screen.createTabModel=function(a){var b=Ext.create("com.trackplus.screen.Tab",{id:a.id,name:a.name,label:a.label,description:a.description});a=a.panels;if(null!=a){for(var c=[],e=0;e<a.length;e++)c.push(com.trackplus.screen.createPanelModel(a[e]));b.setPanels(c)}return b};
com.trackplus.screen.createPanelModel=function(a){var b=Ext.create("com.trackplus.screen.Panel",{id:a.id,name:a.name,label:a.label,description:a.description,colsNo:a.colsNo,rowsNo:a.rowsNo});a=a.fields;if(null!=a){for(var c=[],e=0;e<a.length;e++)c.push(com.trackplus.screen.createFieldModel(a[e]));b.setFields(c)}return b};
com.trackplus.screen.createFieldModel=function(a){return Ext.create("com.trackplus.screen.Field",{id:a.id,name:a.name,nameMapping:a.nameMapping,label:a.label,description:a.description,empty:a.empty,row:a.row,col:a.col,rowSpan:a.rowSpan,colSpan:a.colSpan,jsonData:a.jsonData,extClassName:a.extClassName,extReadOnlyClassName:a.extReadOnlyClassName,value:a.value,displayValue:a.displayValue,labelHAlign:a.labelHAlign,labelVAlign:a.labelVAlign,valueHAlign:a.valueHAlign,valueVAlign:a.valueVAlign,hideLabel:a.hideLabel,
iconRendering:a.iconRendering,fieldID:a.fieldID})};Ext.define("com.trackplus.screen.ScreenView",{extend:"Ext.container.Container",border:!1,margin:"0 0 0 0",frame:!1,collapsible:!1,padding:0,plain:!0,originalTitle:"",layout:"fit",region:"center",config:{model:null,parentView:null,oneTab:!1},initComponent:function(){this.margin="0 0 0 0";Ext.apply(this);this.callParent()},getSelectedTab:function(){return this.oneTab?this.items.get(0):this.items.get(0).getActiveTab()}});
Ext.define("com.trackplus.screen.TabView",{extend:"Ext.container.Container",config:{model:null,parentView:null,oneTab:!1},oneTab:!1,border:!1,style:{overflow:"auto"},initComponent:function(){!0==this.oneTab?(this.margin="0 0 0 0",this.region="center"):(this.margin="0 0 0 0",this.title=this.model.getLabel());this.callParent()},unregister:function(){for(var a=this.items,b,c=0;c<a.getCount();c++)b=a.getAt(c),b.unregister.call(b)}});
Ext.define("com.trackplus.screen.PanelView",{extend:"Ext.container.Container",config:{model:null,parentView:null,myIndex:0,myLength:1},dragDropObjects:[],margin:"0 0 0 0",border:!1,myComponentCls:null,unregister:function(){for(var a=this.dragDropObjects,b=0;b<a.length;b++)a[b].destroy();this.dragDropObjects=[]},getPanelConfig:function(a,b,c){c="screenPanel";var e="0 0 5 0";0==b&&(c="screenPanel-first",e="0 0 5 0");1==b%2&&(c="screenPanel-odd");this.myComponentCls=c;return{cls:c,margin:e,border:!0,
layout:{type:"table",columns:a.colsNo,tableAttrs:{style:{minWidth:"100%"}},trAttrs:{"class":"screenField-tr",style:{"vertical-align":"top"}}},defaults:{frame:!1,border:!1}}}});
Ext.define("com.trackplus.screen.FieldErrorView",{extend:"Ext.panel.Panel",config:{fieldModel:null,parentView:null,error:null},layout:"anchor",border:!0,bodyBorder:!1,bodyCls:"screeFieldError",initComponent:function(){Ext.apply(this);var a=Ext.create("Ext.form.field.Display",{fieldLabel:"Class",anchor:"100%",value:this.fieldModel.extClassName}),b=Ext.create("Ext.form.field.Display",{fieldLabel:"Error",anchor:"100%",value:this.error.message});this.items=[a,b];this.callParent()}});
Ext.define("com.trackplus.screen.BaseScreenController",{extend:"Ext.Base",mixins:{observable:"Ext.util.Observable"},config:{screenModel:null,showOneTab:!1,lastSelectedTab:null,refreshTabUrl:null,storeTabUrl:null,screenViewCls:"com.trackplus.screen.ScreenView",tabViewCls:"com.trackplus.screen.TabView",panelViewCls:"com.trackplus.screen.PanelView",fieldWrapperCls:null,fieldErrorCls:null,dataModel:null},screenViewCls:"com.trackplus.screen.ScreenView",tabViewCls:"com.trackplus.screen.TabView",panelViewCls:"com.trackplus.screen.PanelView",
fieldErrorCls:"com.trackplus.screen.FieldErrorView",screenView:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.mixins.observable.constructor.call(this,a)},createScreenView:function(a){var b=this.screenModel.getTabs();this.screenView=Ext.create(this.screenViewCls,{model:a,oneTab:this.showOneTab&&1==b.length});this.refreshScreenModel(this.screenView,a,this.lastSelectedTab);this.afterScreenCreated.call(this,this.screenView);return this.screenView},afterScreenCreated:function(a){},
refreshScreenModel:function(a,b,c){this.screenModel=b;this.lastSelectedTab=c;a.model=b;a.removeAll(!0);b=this.screenModel.getTabs();!0==this.showOneTab&&1==b.length?(b=this.createTab(a,b[0],!0),b.region="center"):b=this.createTabPanel(a,b);a.add(b);a.doLayout()},createTabPanel:function(a,b){for(var c=[],e=0,f=0;f<b.length;f++)c.push(this.createTab(a,b[f])),null!=this.lastSelectedTab&&b[f].getId()==this.lastSelectedTab&&(e=f);c=Ext.create("Ext.tab.Panel",{plain:!0,border:!1,region:"center",bodyBorder:!1,
defaults:{autoScrollX:!0},items:c,activeTab:e,cls:"screenTabPanel"});this.afterTabPanelCreated.call(this,c);return c},afterTabPanelCreated:function(a){},createTab:function(a,b,c){a=Ext.create(this.tabViewCls,{parentView:a,model:b,refreshTabUrl:this.refreshTabUrl,storeTabUrl:this.storeTabUrl,getPanelConfig:this.getPanelConfig,oneTab:c});this.refreshTabModel.call(this,a,b);a.addListener("activate",this.tabActivate,this);this.afterTabCreated.call(this,a);return a},afterTabCreated:function(a){},tabActivate:function(a){var b=
a.model;null!=this.storeTabUrl&&Ext.Ajax.request({url:this.storeTabUrl,disableCaching:!0,method:"POST",params:{tabID:b.getId()}});null!=this.refreshTabUrl&&this.refreshTab.call(this,a)},refreshTabModel:function(a,b,c){var e=b.panels;a.unregister();a.removeAll(!0);a.tabModel=b;b=[];var f=null;if(null!=e&&0<e.length)for(var g=0;g<e.length;g++){var h=this.createPanel(a,e[g],g,e.length);b.push(h);null!=c&&c==e[g].id&&(f=h)}a.add(b);return f},refreshTab:function(a,b){var c=this,e=a.model,f=c.refreshTabUrl;
null!=b&&0<b.length&&(f=b);if(null==f)return-1;a.setLoading(getText("common.lbl.loading"));Ext.Ajax.request({url:f,disableCaching:!0,encoding:"utf-8",params:{tabID:e.getId(),componentID:e.getId()},success:function(b){b=Ext.decode(b.responseText);b=com.trackplus.screen.createTabModel(b.data);c.refreshTabModel.call(c,a,b);a.setLoading(!1)},failure:function(b){a.setLoading(!1);com.trackplus.util.requestFailureHandler(b)}})},createPanel:function(a,b,c,e){a=Ext.create(this.panelViewCls,{parentView:a,model:b,
myIndex:c,myLength:e});this.refreshPanelModel(a,b);this.afterPanelCreated.call(this,a);return a},afterPanelCreated:function(a){},refreshPanelModel:function(a,b){var c=b.fields,e=[];a.unregister.call(a);a.removeAll.call(a,!0);var f=a.getPanelConfig.call(a,b,a.myIndex,a.myLength);Ext.apply(a,f);if(null!=c)for(f=0;f<c.length;f++)e.push(this.createField(a,c[f]));a.add(e)},createField:function(a,b){var c;if(b.empty)c=Ext.create("Ext.form.Label");else{try{c=Ext.create(b.extClassName,{jsonData:b.jsonData,
parentView:a})}catch(e){c=Ext.create(this.fieldErrorCls,{parentView:a,fieldModel:b,error:e})}c.colspan=b.colSpan;c.rowspan=b.rowSpan}return c}});
Ext.define("com.trackplus.screen.BaseScreenFacade",{extend:"Ext.Base",config:{screenModel:null,readOnlyMode:!1,showOneTab:!1,lastSelectedTab:null,refreshTabUrl:null,storeTabUrl:null,controllerCls:null,screenViewCls:"com.trackplus.screen.ScreenView",tabViewCls:"com.trackplus.screen.TabView",panelViewCls:"com.trackplus.screen.PanelView",fieldWrapperCls:null,fieldErrorCls:"com.trackplus.screen.FieldErrorView",dataModel:null},screenViewCls:"com.trackplus.screen.ScreenView",panelViewCls:"com.trackplus.screen.PanelView",
fieldErrorCls:"com.trackplus.screen.FieldErrorView",controllerCls:"com.trackplus.screen.BaseScreenController",controller:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.controller=Ext.create(this.controllerCls,{screenModel:this.screenModel,readOnlyMode:this.readOnlyMode,showOneTab:this.showOneTab,lastSelectedTab:this.lastSelectedTab,refreshTabUrl:this.refreshTabUrl,storeTabUrl:this.storeTabUrl,tabViewCls:this.tabViewCls,panelViewCls:this.panelViewCls,fieldErrorCls:this.fieldErrorCls,
dataModel:this.dataModel})},screenView:null,createViewComponent:function(){return this.screenView=this.controller.createScreenView.call(this.controller,this.screenModel)}});Ext.define("com.aurel.trackplus.field.FieldConfig",{extend:"Ext.Base",config:{fieldID:null,parameterCode:null,label:null,tooltip:null,required:!1,readonly:!1,invisible:!1,jsonData:{}},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)}});
Ext.define("com.aurel.trackplus.field.TypeRenderer",{extend:"Ext.Base",mixins:{observable:"Ext.util.Observable"},config:{workItemID:null,projectID:null,fieldConfig:null,value:null,displayValue:null,name:null,labelHAlign:null,labelVAlign:null,valueHAlign:null,valueVAlign:null,hideLabel:!1},view:null,tip:null,requiredHtmlTxt:"",requiredMarkup:'\x3cspan class\x3d"required"\x3e\x26nbsp;\x3c/span\x3e',constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.mixins.observable.constructor.call(this,
a);this.addEvents("valueChange");this.addEvents("dblclick");this.addEvents("layoutChange");this.addEvents("afterRender")},getOriginalValue:function(){return this.value},beforeSubmit:function(){},getValue:function(){var a=null;null!=this.view&&null!=this.view.getSubmitValue&&Ext.isFunction(this.view.getSubmitValue)&&(a=this.view.getSubmitValue.call(this.view));return a},getView:function(){var a=this;null==a.view&&(a.view=a.createView(),a.view.addListener("render",function(b){b.getEl().on("dblclick",
function(){a.itemDblClick.call(a,b)})}));return a.view},itemDblClick:function(){this.fireEvent("dblclick",this.fieldID)},createView:function(){return Ext.create("Ext.form.Label",{})},update:function(a){Ext.apply(this,a);this.refreshView()},refreshView:function(){},focus:function(){null!=this.view&&null!=this.view.focus&&Ext.isFunction(this.view.focus)&&this.view.focus.call(this.view)},markInvalid:function(a){null!=this.view&&null!=this.view.markInvalid&&Ext.isFunction(this.view.markInvalid)&&this.view.markInvalid.call(this.view,
a)},markConflict:function(a){null==a&&(a="");a=getText("common.err.concurrentSave.conflict",a);null!=this.view&&(this.view.addCls("fieldConflict"),this.setToolTip(a))},markModifiedByMe:function(){var a=getText("common.err.concurrentSave.modifiedByMe");null!=this.view&&(this.view.addCls("modifiedByMe"),this.setToolTip(a))},markModifiedByOther:function(a){var b=getText("common.err.concurrentSave.modifiedByOther");null!=this.view&&(this.view.addCls("modifiedByOther"),this.view.setValue(a),this.setToolTip(b))},
setToolTip:function(a){if(null==a)null==this.tip&&(this.tip.destroy(),delete this.tip);else if(null!=this.view){var b=this.view.getEl();null!=b&&(null==this.tip?Ext.create("Ext.tip.ToolTip",{target:b,html:a}):this.tip.update(a))}}});
Ext.define("com.aurel.trackplus.field.LabelTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){return Ext.create("Ext.form.field.Display",{fieldLabel:this.fieldConfig.label,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden",width:"300px"},fieldStyle:{height:"auto",margin:"0 0 0 0"},value:this.displayValue,hidden:this.fieldConfig.invisible})},
refreshView:function(){var a=this.fieldConfig.invisible;this.view.setFieldLabel(this.fieldConfig.label);this.view.setValue(this.displayValue);this.view.hidden=a}});
Ext.define("com.aurel.trackplus.field.TextFieldTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.name,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");return Ext.create("Ext.form.field.Text",{fieldLabel:a,afterLabelTextTpl:f,labelStyle:{overflow:"hidden"},labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+
this.valueVAlign+" valueAlign-"+this.valueHAlign,name:c,allowBlank:!e,value:this.value,hidden:b})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;this.view.setValue(this.value);this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.TextAreaTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.name,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");var g="";null!=this.value&&(g=this.value);this.txtArea=Ext.create("Ext.form.field.TextArea",{hideLabel:!0,name:c,allowBlank:!e,value:g,hidden:b,style:{width:"100%"}});return Ext.create("Ext.form.FieldContainer",{combineErrors:!0,
fieldLabel:a,afterLabelTextTpl:f,labelAlign:this.labelHAlign,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},layout:"anchor",defaults:{hideLabel:!0},style:{width:"100%"},items:[this.txtArea],hidden:b})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=
e;a="";null!=this.value&&(a=this.value);this.txtArea.setValue(a);this.txtArea.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.SynopsisTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){return Ext.create("Ext.form.field.Text",{fieldLabel:this.fieldConfig.label,afterLabelTextTpl:this.requiredMarkup,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,name:this.fieldConfig.name,allowBlank:!this.fieldConfig.required,value:this.value,width:500,
hidden:this.fieldConfig.invisible})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.afterLabelTextTpl=e;this.view.setValue(this.value);this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.DateTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.name,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");a=CWHF.createDateField(a,c,{labelIsLocalized:!0,allowBlank:!e,value:this.value,labelAlign:this.labelHAlign,afterLabelTextTpl:f,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+
" valueAlign-"+this.valueHAlign,hidden:b,labelWidth:100,width:210,submitFormat:com.trackplus.TrackplusConfig.DateFormat});a.addListener("change",this.valueChange,this);return a},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabeltextTpl=e;this.view.setValue(this.value);this.view.allowBlank=!c;this.view.hidden=b},valueChange:function(a,b,c){a={};a["f"+this.fieldID]=
b;b={};b["f"+this.fieldID]=c;this.fireEvent("valueChange",this.fieldID,a,b,this)}});
Ext.define("com.aurel.trackplus.field.EndDateRenderer",{extend:"com.aurel.trackplus.field.DateTypeRenderer",config:{durationFieldID:33,startDateFieldID:19},constructor:function(a){this.initConfig(a);this.callParent(arguments)},refreshDependentFields:function(a,b,c,e,f,g){var h=e.durationFieldID;e=e.startDateFieldID;b=b["f"+a];g||(f["f"+a]=Ext.Date.format(b,com.trackplus.TrackplusConfig.DateFormat));var k=null;null!=c&&(k=this.getDateFromModel(c,"f"+a,g));a=this.getDateFromModel(f,"f"+e,g);null==b||
0==b.length||null==a||0==a.length?this.updateField(h,null,"",f):b!==k&&(a=this.getDateFromModel(f,"f"+e,g),g=this.getDurationBetweenDates(a,b),this.updateField(h,g,g,f))}});Ext.define("com.aurel.trackplus.field.EndDateTargetRenderer",{extend:"com.aurel.trackplus.field.EndDateRenderer",config:{durationFieldID:34,startDateFieldID:29},constructor:function(a){this.initConfig(a);this.callParent(arguments)}});
Ext.define("com.aurel.trackplus.field.StartDateRenderer",{extend:"com.aurel.trackplus.field.DateTypeRenderer",config:{durationFieldID:33,endDateFieldID:20},constructor:function(a){this.initConfig(a);this.callParent(arguments)},refreshDependentFields:function(a,b,c,e,f,g){var h=e.durationFieldID;e=e.endDateFieldID;b=b["f"+a];g||(f["f"+a]=Ext.Date.format(b,com.trackplus.TrackplusConfig.DateFormat));var k=null;null!=c&&(k=this.getDateFromModel(c,"f"+a,g));a=f["f"+h];null!=a&&(g=this.getDateFromModel(f,
"f"+e,g),null==b||0==b.length||null==g||0==g.length?this.updateField(h,null,"",f):b!==k&&(g=this.addWeekdays(b,a,!0),this.updateField(e,g,g,f)))}});Ext.define("com.aurel.trackplus.field.StartDateTargetRenderer",{extend:"com.aurel.trackplus.field.StartDateRenderer",config:{durationFieldID:34,endDateFieldID:30},constructor:function(a){this.initConfig(a);this.callParent(arguments)}});
Ext.define("com.aurel.trackplus.field.HtmlReadOnlyTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){return Ext.create("Ext.form.field.Display",{fieldLabel:this.fieldConfig.label,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"olist-ulist htmlReadOnlyField labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},fieldStyle:{height:"auto"},value:this.displayValue,hidden:this.fieldConfig.invisible})},
refreshView:function(){var a=this.fieldConfig.invisible;this.view.setFieldLabel(this.fieldConfig.label);this.view.setValue(this.displayValue);this.view.hidden=a}});
Ext.define("com.aurel.trackplus.field.HtmlTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.requiredMarkup;!1==this.fieldConfig.required&&(c="");var e="";null!=this.value&&(e=this.value);return this.txtArea=CWHF.createRichTextEditorField(b,{fieldLabel:a,afterLabelTextTpl:c,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+
" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},value:e,style:{width:"100%"},inputWidth:"300",height:175},!1,!1,{workItemID:this.workItemID,projectID:this.projectID})},beforeSubmit:function(){CWHF.submitRTEditor(this.view)},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;CWHF.refreshRTEditorValue(this.view,this.value);this.view.allowBlank=
!c;this.view.hidden=b},initEditor:function(a){this.replaceTextArea(this.idDescription+"-inputEl")},replaceTextArea:function(a,b){var c=this;null==b&&(b="en");var e=CKEDITOR.instances[a];e&&CKEDITOR.remove(e);c.ckEditor=CKEDITOR.replace(a,{customConfig:sBasePath+"cktrackplusconfig.js",contentsCss:com.trackplus.TrackplusConfig.htmlEditorCSS,language:b});c.ckEditor.on("blur",function(a){c.ckEditor.updateElement()});c.ckEditor.on("instanceReady",function(a){c.fireEvent("afterRender",c.fieldID)})},getValue:function(){var a=
null;null!=this.ckEditor&&(a=this.ckEditor.getData(),this.ckEditor.updateElement());return a}});
Ext.define("com.aurel.trackplus.field.SelectTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");var f=this.fieldConfig.jsonData.list;!1==c&&null!=f&&0<f.length&&f.unshift({id:null,label:""});var g=!1;null!=this.fieldConfig.jsonData.forceSelection&&(g=this.fieldConfig.jsonData.forceSelection);a={forceSelection:g,fieldLabel:a,afterLabelTextTpl:e,labelAlign:this.labelHAlign,
hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},store:Ext.create("Ext.data.Store",{fields:[{type:"int",name:"id",useNull:!0},{type:"string",name:"label"}],data:f}),valueField:"id",displayField:"label",queryMode:"local",allowBlank:!c,name:b,editable:!0,typeAhead:!0,anyMatch:!0,grow:!0};!1==c&&(a.tpl=new Ext.XTemplate('\x3ctpl for\x3d"."\x3e\x3cli style\x3d"min-height:22px;" class\x3d"x-boundlist-item" role\x3d"option"\x3e{label}\x3c/li\x3e\x3c/tpl\x3e'));
c=Ext.create("Ext.form.ComboBox",a);c.setValue(this.value);c.addListener("change",this.valueChange,this);return c},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");var f=this.fieldConfig.jsonData.list;!1==c&&null!=f&&0<f.length&&f.unshift({id:null,label:""});this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;this.view.store.loadData(f);this.view.setValue(this.value);this.view.allowBlank=!c;this.view.hidden=
b},valueChange:function(a,b){var c={};c["fieldValues.f"+this.fieldID]=b;this.fireEvent("valueChange",this.fieldID,c)}});
Ext.define("com.aurel.trackplus.field.CrmContactRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.fieldID,b=this.fieldConfig.label,c=this.fieldConfig.name,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");a=Ext.create("Ext.form.ComboBox",{fieldLabel:b,afterLabelTextTpl:f,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,
labelStyle:{overflow:"hidden"},valueField:"contactPartnerID",displayField:"displayValue",allowBlank:!e,name:c,forceSelection:!0,width:500,hideTrigger:!0,minChars:2,triggerAction:"query",typeAhead:!0,store:{fields:[{name:"contactPartnerID",mapping:"contactPartnerID"},{name:"customerID",mapping:"customerID"},{name:"displayValue",mapping:"displayValue"},{name:"customerName",mapping:"customerName"},{name:"postalCode",mapping:"postalCode"},{name:"city",mapping:"city"},{name:"street",mapping:"street"},
{name:"country",mapping:"country"},{name:"contactPartnerFirstName",mapping:"contactPartnerFirstName"},{name:"contactPartnerLastName",mapping:"contactPartnerLastName"}],proxy:{type:"ajax",url:"remoteFiltering.action",extraParams:{fieldID:a}},data:this.fieldConfig.jsonData.list},tpl:new Ext.XTemplate('\x3ctpl for\x3d"."\x3e\x3cli style\x3d"min-height:22px;" class\x3d"x-boundlist-item{[xindex % 2 \x3d\x3d\x3d 0 ? "":" x-boundlist-item-odd"]}" role\x3d"option"\x3e{customerID} {country} \x3cbr/\x3e {customerName} \x3cbr/\x3e {postalCode} {city}, {street} \x3cbr/\x3e \x3cb\x3e{contactPartnerFirstName} {contactPartnerLastName}\x3c/b\x3e\x3c/li\x3e\x3c/tpl\x3e')});
a.setValue(this.value);return a},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");var f=this.fieldConfig.jsonData;this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;this.view.store.loadData(f.list);this.view.setValue(this.value);this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.ExtensibleSelectTypeRenderer",{extend:"com.aurel.trackplus.field.SelectTypeRenderer",createView:function(){var a=this.callParent(arguments);a.editable=!0;a.getSubmitValue=function(){var a=this.getValue();return!1==this.findRecordByValue(a)?null==a?"":"'"+a+"'":a};return a}});
Ext.define("com.aurel.trackplus.field.MultipleSelectPickerRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",config:{useIconCls:!1,iconFieldID:null,pikerWidth:300},createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.requiredMarkup;!1==this.fieldConfig.required&&(c="");var e=this.fieldConfig.jsonData.list,f=0;null!=e&&(f=e.length);a=Ext.create("com.trackplus.util.MultipleSelectPicker",{data:e,includeSearch:7<=f,labelStyle:{overflow:"hidden"},labelWidth:100,width:this.pikerWidth,
name:b,value:this.value,fieldLabel:a,labelAlign:this.labelHAlign,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,useNull:!0,afterLabelTextTpl:c,useIconCls:this.useIconCls,iconUrlPrefix:null==this.iconFieldID?null:"optionIconStream.action?fieldID\x3d"+this.iconFieldID+"\x26optionID\x3d"});a.addListener("change",this.valueChange,this);return a},valueChange:function(a,b){var c={};c["fieldValues.f"+this.fieldID]=b;this.fireEvent("valueChange",
this.fieldID,c)},refreshView:function(){var a=this.value,b=this.fieldConfig.label,c=this.fieldConfig.invisible,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");var g=this.fieldConfig.jsonData;this.view.setFieldLabel(b);this.view.afterLabelTextTpl=f;b=g.list;!1==e&&null!=b&&0<b.length&&b.unshift({id:null,label:""});this.view.updateData(b);this.view.setValue(a,!0);this.view.allowBlank=!e;this.view.hidden=c}});
Ext.define("com.aurel.trackplus.field.MultipleSelectTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");a=Ext.create("Ext.ux.form.MultiSelect",{fieldLabel:a,afterLabelTextTpl:e,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},
store:Ext.create("Ext.data.Store",{fields:[{type:"int",name:"id"},{type:"string",name:"label"}],data:this.fieldConfig.jsonData.list}),valueField:"id",displayField:"label",queryMode:"local",allowBlank:!c,name:b,value:this.value,grow:!0,height:125});a.setValue(this.value);return a},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;this.view.setValue(this.value);
this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.ReleasePickerRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");return CWHF.createSingleTreePicker(a,b,this.fieldConfig.jsonData.releaseTree,this.value,{includeClear:!c,labelIsLocalized:!0,afterLabelTextTpl:e,labelAlign:this.labelHAlign,allowBlank:!c,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+
this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},labelWidth:100,width:310})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;a=null;try{a=parseInt(this.value),isNaN(a)&&(a=null)}catch(f){}this.view.setValue(this.fieldConfig.jsonData.releaseLabel);this.view.releaseID=a;this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.ProjectPickerRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");return CWHF.createMultipleTreePicker(a,b,this.fieldConfig.jsonData.projectTree,this.value,{useRemoveBtn:!1,useNull:!0,labelIsLocalized:!0,afterLabelTextTpl:e,labelAlign:this.labelHAlign,allowBlank:!c,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+
this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},labelWidth:100,width:310})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.ItemPickerRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");return CWHF.createMultipleTreePicker(a,b,this.fieldConfig.jsonData.itemTree,this.value,{useRemoveBtn:!1,useNull:!0,labelIsLocalized:!0,afterLabelTextTpl:e,labelAlign:this.labelHAlign,allowBlank:!c,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+
this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},labelWidth:100,width:310})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.ParentTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",config:{readOnly:!1},idField:null,labelField:null,constructor:function(a){this.callParent(arguments);this.addEvents("clickOnParent")},createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.name,e=this.fieldConfig.jsonData,f=this.value;null!=e.projectSpecificID&&""!=e.projectSpecificID&&(f=e.projectSpecificID);var g="";null!=f&&(g=f+": "+e.title);this.idField=
Ext.create("Ext.form.field.Hidden",{name:c,value:this.value,readOnly:!0,margin:"0 0 0 0",cls:"insideFiledCointainer"});this.labelField=Ext.create("Ext.ux.LinkComponent",{handler:this.clickOnParent,scope:this,margin:"4 0 0 0",clsLink:"parentLink",style:{overflow:"hidden"},cls:"insideFiledCointainer",flex:1,label:g});this.btnClear=Ext.create("Ext.button.Button",{margin:"0 5 0 0",iconCls:"delete16",cls:"insideFiledCointainer",handler:this.clearParent,hidden:null==this.value||""==this.value,scope:this});
c=[];!1==this.readOnly&&(c.push(this.idField),c.push(this.btnClear));c.push(this.labelField);return Ext.create("Ext.form.FieldContainer",{combineErrors:!0,fieldLabel:a,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},layout:"hbox",defaults:{hideLabel:!0},width:450,items:c,hidden:b})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,
c=this.fieldConfig.required,e=this.value,f=this.fieldConfig.jsonData,e=this.value;null!=f.projectSpecificID&&""!=f.projectSpecificID&&(e=f.projectSpecificID);var g="";null!=e&&(g=e+": "+f.title);this.idField.setValue(this.value);this.labelField.setLabel(g);this.view.setFieldLabel(a);this.view.afterLabelTextTpl=c;this.btnClear.setVisible(null!=this.value&&""!=this.value);this.view.hidden=b},clearParent:function(){this.value=null;this.idField.setValue(null);this.labelField.setLabel(null);this.btnClear.setVisible(!1);
this.view.doLayout();this.view.ownerCt.doLayout()},clickOnParent:function(){this.fireEvent("clickOnParent",this.value)}});Ext.define("com.aurel.trackplus.field.ParentTypeRendererReadOnly",{extend:"com.aurel.trackplus.field.ParentTypeRenderer",readOnly:!0});
Ext.define("com.aurel.trackplus.field.IntegerTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",config:{allowDecimals:!1,decimalSeparator:"."},createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.name,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");var g=this.fieldConfig.jsonData,a={fieldLabel:a,afterLabelTextTpl:f,allowDecimals:this.allowDecimals,decimalSeparator:this.decimalSeparator,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,
cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},name:c,allowBlank:!e,value:this.value,hidden:b};null!=g&&null!=g.minValue&&(a.minValue=g.minValue);g=Ext.create("Ext.form.field.Number",a);g.addListener("change",this.valueChange,this,this);return g},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);
this.view.afterLabelTextTpl=e;this.view.setValue(this.value);this.view.allowBlank=!c;this.view.hidden=b},valueChange:function(a,b,c){a={};a["f"+this.fieldID]=b;b={};b["f"+this.fieldID]=c;this.fireEvent("valueChange",this.fieldID,a,b,this)}});Ext.define("com.aurel.trackplus.field.DoubleTypeRenderer",{extend:"com.aurel.trackplus.field.IntegerTypeRenderer",allowDecimals:!0,decimalSeparator:com.trackplus.TrackplusConfig.DecimalSeparator});
Ext.define("com.aurel.trackplus.field.DurationRenderer",{extend:"com.aurel.trackplus.field.DoubleTypeRenderer",config:{startDateFieldID:19,endDateFieldID:20},constructor:function(a){this.initConfig(a);this.callParent(arguments)},refreshDependentFields:function(a,b,c,e,f,g){var h=e.startDateFieldID;e=e.endDateFieldID;b=b["f"+a];f["f"+a]=b;b!==c["f"+a]&&(a=f["f"+h],c=f["f"+e],g&&(a=Ext.util.Format.date(a,com.trackplus.TrackplusConfig.DateFormat),c=Ext.util.Format.date(c,com.trackplus.TrackplusConfig.DateFormat)),
null!=b&&(null!=a&&0<a.length?(c=this.addWeekdays(this.parseDate(a,!0),b,!0),this.updateField(e,c,c,f)):null!=c&&0<c.length?(a=this.addWeekdays(this.parseDate(c,!0),b,!1),this.updateField(h,a,a,f)):(a=Ext.Date.format(new Date,com.trackplus.TrackplusConfig.DateFormat),this.updateField(h,a,a,f),c=this.addWeekdays(this.parseDate(c,!0),b,!0),this.updateField(e,c,c,f))))}});
Ext.define("com.aurel.trackplus.field.TargetDurationRenderer",{extend:"com.aurel.trackplus.field.DurationRenderer",config:{startDateFieldID:29,endDateFieldID:30},constructor:function(a){this.initConfig(a);this.callParent(arguments)}});
Ext.define("com.aurel.trackplus.field.CheckBoxTypRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",config:{allowDecimals:!1},createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.name,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");return Ext.create("Ext.form.field.Checkbox",{fieldLabel:a,afterLabelTextTpl:f,allowDecimals:this.allowDecimals,decimalSeparator:this.decimalSeparator,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,
cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},name:c,margin:"3 0 0 0",allowBlank:!e,inputValue:"true",uncheckedValue:"false",value:this.value,checked:!0==this.value,hidden:b})},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;this.view.setValue(this.value);
this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.CompositeTypeRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",parts:null,createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");var f=this.fieldConfig.jsonData,g=[],h=f.cascading;this.parts=[];for(var k=0;k<f.parts.length;k++){var l=h&&k<f.parts.length-1,m=Ext.create(f.parts[k].extClassName,{fieldID:this.fieldID,parameterCode:k+1,fieldConfig:{required:c,hasDependences:l,
name:this.fieldConfig.name+"_"+(k+1),jsonData:f.parts[k].jsonData},value:null==this.value?null:this.value[""+(k+1)]});l&&m.addListener("valueChange",this.partValueChange,this);this.parts.push(m);g.push(m.getView())}return Ext.create("Ext.form.FieldContainer",{combineErrors:!0,fieldLabel:a,afterLabelTextTpl:e,labelAlign:this.labelHAlign,hideLabel:this.hideLabel,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},
layout:{type:"column"},defaults:{hideLabel:!0,margin:"0 0 0 5"},style:{width:"100%"},items:g,hidden:b})},partValueChange:function(a){a={};for(var b=0;b<this.parts.length;b++)a["fieldValues.f"+this.fieldID+"_"+(b+1)]=this.parts[b].getValue();this.fireEvent("valueChange",this.fieldID,a)},refreshView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.invisible,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");this.view.setFieldLabel(a);this.view.afterLabelTextTpl=e;a=this.fieldConfig.jsonData;
for(e=0;e<this.parts.length;e++)this.parts[e].value=null==this.value?null:this.value[""+(e+1)],this.parts[e].fieldConfig.jsonData=a.parts[e].jsonData,this.parts[e].refreshView();this.view.allowBlank=!c;this.view.hidden=b}});
Ext.define("com.aurel.trackplus.field.SingleSelectPickerRenderer",{extend:"com.aurel.trackplus.field.TypeRenderer",config:{useIconCls:!1,iconFieldID:null,pikerWidth:300},createView:function(){var a=this.fieldConfig.label,b=this.fieldConfig.name,c=this.fieldConfig.required,e=this.requiredMarkup;!1==c&&(e="");var f=this.fieldConfig.jsonData.list;!1==c&&null!=f&&0<f.length&&f.unshift({id:null,label:""});c=0;null!=f&&(c=f.length);a=Ext.create("com.trackplus.util.SingleSelectPicker",{data:f,includeSearch:7<=
c,cls:"labelVerticalAlign-"+this.labelVAlign+" valueVerticalAlign-"+this.valueVAlign+" valueAlign-"+this.valueHAlign,labelStyle:{overflow:"hidden"},labelWidth:100,width:this.pikerWidth,name:b,value:this.value,fieldLabel:a,labelAlign:this.labelHAlign,afterLabelTextTpl:e,useIconCls:this.useIconCls,iconUrlPrefix:null==this.iconFieldID?null:"optionIconStream.action?fieldID\x3d"+this.iconFieldID+"\x26optionID\x3d"});a.addListener("change",this.valueChange,this);return a},valueChange:function(a,b){var c=
{};c["fieldValues.f"+this.fieldID]=b;this.fireEvent("valueChange",this.fieldID,c)},refreshView:function(){var a=this.value,b=this.fieldConfig.label,c=this.fieldConfig.invisible,e=this.fieldConfig.required,f=this.requiredMarkup;!1==e&&(f="");var g=this.fieldConfig.jsonData;this.view.setFieldLabel(b);this.view.afterLabelTextTpl=f;b=g.list;!1==e&&null!=b&&0<b.length&&b.unshift({id:null,label:""});this.view.updateData(b);this.view.setValue(a,!0);this.view.allowBlank=!e;this.view.hidden=c}});
Ext.define("com.aurel.trackplus.field.StateRenderer",{extend:"com.aurel.trackplus.field.SingleSelectPickerRenderer",iconFieldID:-4,pikerWidth:265});Ext.define("com.aurel.trackplus.field.PriorityRenderer",{extend:"com.aurel.trackplus.field.SingleSelectPickerRenderer",iconFieldID:-10,pikerWidth:265});Ext.define("com.aurel.trackplus.field.SeverityRenderer",{extend:"com.aurel.trackplus.field.SingleSelectPickerRenderer",iconFieldID:-11,pikerWidth:265});
Ext.define("com.aurel.trackplus.field.PersonPickerRenderer",{extend:"com.aurel.trackplus.field.SingleSelectPickerRenderer",useIconCls:!0,pikerWidth:310});Ext.define("com.trackplus.screen.ItemTabView",{extend:"com.trackplus.screen.TabView",firstTimeOverflow:!0,layout:"auto",border:!1,style:{overflowX:"auto"},initComponent:function(){this.callParent();!0==this.oneTab?(this.margin="0 0 17 0",this.region="center"):(this.margin="5 0 0 0",this.title=this.model.getLabel())}});
Ext.define("com.trackplus.screen.ItemScreenController",{extend:"com.trackplus.screen.BaseScreenController",config:{children:null,readOnlyMode:!1,dataModel:null},tabViewCls:"com.trackplus.screen.ItemTabView",showOneTab:!0,fieldTypeRenderersMap:{},fieldTypeWrappersMap:{},fieldDataMap:{},constructor:function(a){this.callParent(arguments);this.addEvents("editMode","lastModified","clickOnParent")},refreshScreenModel:function(a,b,c){this.fieldTypeRenderersMap={};this.fieldTypeWrappersMap={};this.fieldDataMap=
{};this.callParent(arguments)},createField:function(a,b){var c,e=!1,f;if(b.empty)c=Ext.create("Ext.form.Label",{});else{var g=b.fieldID;this.fieldDataMap["f"+g]=b;f=this.dataModel.fieldConfigs["f"+g];f.name="fieldValues.f"+g;c=b.extClassName;if(this.readOnlyMode||!0==f.readonly)c=b.extReadOnlyClassName,e=this.dataModel.inlineEdit&&!f.readonly;var h=this.dataModel.fieldValues["f"+g],h=Ext.create(c,{workItemID:this.dataModel.workItemID,projectID:this.dataModel.projectID,fieldID:g,fieldConfig:f,value:h,
displayValue:this.dataModel.fieldDisplayValues["f"+g],labelHAlign:b.labelHAlign,labelVAlign:b.labelVAlign,valueHAlign:b.valueHAlign,valueVAlign:b.valueVAlign,hideLabel:b.hideLabel});null!=this.fieldTypeRenderersMap["f"+g]||17==g?c=Ext.create("Ext.form.Label",{text:'Field "'+f.label+'" already on screen!'}):(f.hasDependences&&h.addListener("valueChange",this.fieldValueChange,this),e&&h.addListener("dblclick",this.fieldDblclick,this),h.addListener("afterRender",this.fieldAfterRender,this,{parentView:a}),
c=h.getView.call(h),this.fieldTypeRenderersMap["f"+g]=h);c.colspan=b.colSpan;c.rowspan=b.rowSpan;c.addCls("screenField");16==g&&h.addListener("clickOnParent",this.clickOnParentHandler,this)}if(e&&!b.empty){var g=b.fieldID,e="fieldValues.f"+g,h=this.dataModel.fieldValues["f"+g],k=b.extClassName,l=[];l.push(c);if("com.aurel.trackplus.field.CompositeTypeRenderer"==k){if(null!=h)for(c=0;c<f.jsonData.parts.length;c++)k=CWHF.createHiddenField(e+"_"+(c+1),{value:h[""+(c+1)]}),l.push(k)}else k=CWHF.createHiddenField(e,
{value:h}),l.push(k);h=Ext.create("Ext.container.Container",{border:!1,cls:"editableFieldWrapper",overCls:"editableFieldWrapper-over",bodyBorder:!1,margin:"0 0 0 0",bodyPadding:0,colspan:b.colSpan,rowspan:b.rowSpan,items:l,listeners:{afterrender:{fn:function(a){var b="",b=null!=f.tooltip&&""!=f.tooltip?f.tooltip+"\x3cbr/\x3e"+getText("item.view.dblClickToEditField"):getText("item.view.dblClickToEditField");Ext.create("Ext.tip.ToolTip",{target:a.el,trackMouse:!0,dismissDelay:0,html:b})}}}});return this.fieldTypeWrappersMap["f"+
g]=h}this.dataModel.inlineEdit&&!b.empty&&c.addCls("readOnlyField");null!=f&&null!=f.tooltip&&""!=f.tooltip&&c.addListener("afterrender",function(a){Ext.create("Ext.tip.ToolTip",{target:a.el,trackMouse:!0,dismissDelay:0,html:f.tooltip})});return c},editMode:!1,fieldDblclick:function(a){var b=this,c=b.fieldTypeWrappersMap["f"+a],e=b.fieldDataMap["f"+a],f=e.extClassName,g=b.dataModel.fieldConfigs["f"+a];g.name="fieldValues.f"+a;var h=Ext.create(f,{fieldID:a,fieldConfig:g,value:b.dataModel.fieldValues["f"+
a],displayValue:b.dataModel.fieldDisplayValues["f"+a],labelHAlign:e.labelHAlign,labelVAlign:e.labelVAlign,valueHAlign:e.valueHAlign,valueVAlign:e.valueVAlign,hideLabel:e.hideLabel});g.hasDependences&&h.addListener("valueChange",b.fieldValueChange,b);var k=h.getView.call(h);k.addCls("screenField");b.fieldTypeRenderersMap["f"+a]=h;var l=c.getEl();l.fadeOut({opacity:0.1,easing:"easeOut",duration:150,remove:!1,useDisplay:!1,callback:function(){c.removeAll(!0);c.add(k);c.removeCls("editableFieldWrapper");
c.ownerCt.doLayout();l.fadeIn({opacity:1,easing:"easeOut",duration:500,callback:function(){h.focus()}});!1==b.editMode&&(b.fireEvent("editMode"),b.editMode=!0)}})},fieldAfterRender:function(a,b){b.parentView.ownerCt.doLayout()},clickOnParentHandler:function(a){this.fireEvent("clickOnParent",a)},fieldValueChange:function(a,b,c,e){var f=this,g=f.dataModel.fieldValues,h=f.dataModel.fieldConfigs["f"+a];if(null!=h&&h.clientSideRefresh)null!=e.refreshDependentFields&&e.refreshDependentFields.call(f,a,b,
c,e,g,!1);else{a={workItemID:f.dataModel.workItemID,projectID:f.dataModel.projectID,issueTypeID:f.dataModel.issueTypeID,actionID:f.dataModel.actionID,fieldID:a};for(var k in b)a[k]=b[k];f.screenView.setLoading(!0);Ext.Ajax.request({url:"itemFieldRefresh.action",disableCaching:!0,encoding:"utf-8",sync:!0,success:function(a){a=Ext.decode(a.responseText);!0===a.success&&f.refreshDependentFields.call(f,a.data);f.screenView.setLoading(!1)},failure:function(a,b){f.screenView.setLoading(!1)},params:a,method:"POST"})}},
updateField:function(a,b,c,e){var f={};a="f"+a;var g=this.dataModel.fieldConfigs[a];null!=g&&(f.fieldConfigs={},f.fieldConfigs[a]=g,f.fieldValues={},f.fieldValues[a]=b,e[a]=b,f.fieldDisplayValues={},f.fieldDisplayValues[a]=c,this.refreshDependentFields.call(this,f))},addWeekdays:function(a,b,c){var e=0,f=1;for(c||(f=-1);e<b;)a.setDate(a.getDate()+f),c=a.getDay(),0<c&&6>c&&e++;return Ext.Date.format(a,com.trackplus.TrackplusConfig.DateFormat)},parseDate:function(a,b){return null==a||0==a.length?b?
new Date:null:Ext.Date.parse(a,com.trackplus.TrackplusConfig.DateFormat)},getDurationBetweenDates:function(a,b){var c=this.parseDate(a,!1);if(null==c||null==b)return null;for(var e=0;c<b;){c.setDate(c.getDate()+1);var f=c.getDay();0<f&&6>f?e++:c>=b&&(6==f?e++:e+=2)}return e},getDateFromModel:function(a,b,c){var e=null,e=a[b];c&&(e=Ext.util.Format.date(e,com.trackplus.TrackplusConfig.DateFormat));return e},getPresentFields:function(){var a=[],b;for(b in this.fieldTypeRenderersMap){var c=parseInt(b.substring(1));
a.push(c)}return a},refreshByFields:function(a,b){for(var c=this,e=[],f=c.getPresentFields(),g=0;g<a.length;g++)0<Ext.Array.indexOf(f,a[g])&&e.push(a[g]);null!=b&&c.fireEvent("lastModified",b);if(0==e.length)return!1;c.screenView.setLoading(!0);e={workItemID:c.dataModel.workItemID,projectID:c.dataModel.projectID,issueTypeID:c.dataModel.issueTypeID,actionID:c.dataModel.actionID,fields:e.join(",")};Ext.Ajax.request({url:"itemFieldRefresh!refreshFields.action",disableCaching:!0,encoding:"utf-8",sync:!0,
success:function(a){a=Ext.decode(a.responseText);!0===a.success?(a=a.data,c.refreshDependentFields.call(c,a),c.screenView.setLoading(!1),c.fireEvent("lastModified",a.lastModified)):(c.screenView.setLoading(!1),alert("failure"))},failure:function(a,b){c.screenView.setLoading(!1);alert("failure")},params:e,method:"POST"})},refreshDependentFields:function(a){var b=a.fieldConfigs,c=a.fieldValues;a=a.fieldDisplayValues;for(var e in b){var f=b[e];this.dataModel.fieldValues[e]=c[e];this.dataModel.fieldDisplayValues[e]=
a[e];f.name="fieldValues.f"+b[e].fieldID;var g=this.fieldTypeRenderersMap[e];null!=g&&(g.suspendEvents(!1),g.update.call(g,{fieldConfig:f,value:c[e],displayValue:a[e]}),g.resumeEvents());f=this.fieldTypeWrappersMap[e];null!=f&&(g=null,1<f.items.getCount()&&(g=f.items.getAt(1)),null!=g&&g.setValue(c[e]))}}});
com.trackplus.item.ToolbarItem={SIBLING:1,CHOOSE_PARENT:2,PRINT:3,PRINT_WITH_CHILDREN:4,ACCESS_LEVEL:5,ARCHIVE:6,DELETE:7,MAIL:8,BACK:9,NAVIGATION_NEXT:10,NAVIGATION_PREV:11,ITEM_ACTION:12,SAVE:13,RESET:14,CANCEL:15,PRINT_ITEM:16,EXPORT:17};
Ext.define("com.trackplus.screen.ItemView",{extend:"Ext.container.Container",config:{model:null,itemDetailComponent:null},margin:"0 0 0 0",padding:"0 0 0 0",border:!1,layout:{type:"border"},itemPanel:null,initComponent:function(){this.items=this.createChildren();this.callParent();this.addListener("afterrender",this.setFocusComponent,this)},setFocusComponent:function(){null==this.txtTitleHeader||this.txtTitleHeader.isHidden()||this.txtTitleHeader.focus(!1)},createChildren:function(){var a=[],b={border:!1};
this.model.includeBottomTabs?(b.margin="5 0 5 0",b.anchor="100%",b.layout="fit"):(b.margin="0 0 0 0",b.padding="0 5 5 5",b.region="center",b.autoScroll=!0);this.itemPanel=Ext.create("Ext.form.Panel",b);a.push(this.itemPanel);this.model.includeBottomTabs&&(b=this.itemDetailComponent.createComponent(),a.push(b));var b=this.model.workItemIDDisplay,c=this.model.statusDisplay,e=this.model.itemLockedMessage,f='\x3cimg style\x3d"margin-bottom: -2px;" src\x3d"optionIconStream.action?fieldID\x3d-2\x26optionID\x3d'+
this.model.issueTypeID+'" title\x3d"'+this.model.issueTypeLabel+'"\x3e \x3cstrong\x3e'+this.model.projectLabel+"\x3c/strong\x3e";null!=b&&(f+='\x26nbsp;/\x26nbsp;\x3cspan class\x3d"emphasize"\x3e\x3cstrong\x3e'+b+"\x3c/strong\x3e\x3c/span\x3e");null!=c&&(f+='\x26nbsp;:\x26nbsp;\x3cspan class\x3d"dataEmphasize"\x3e'+c+"\x3c/span\x3e");this.model.readOnlyMode||(f+='\x3cspan class\x3drequiredHint\x3e\x3cspan class\x3d"requiredHintBar"\x3e\x26nbsp;\x3c/span\x3e \x3d '+getText("common.lbl.requiredInfo")+
"\x3c/span\x3e");null!=e&&(f+='\x3cspan class\x3d"itemLock"\x3e'+e+"\x3c/span\x3e");this.projectHeader=Ext.create("Ext.form.Label",{html:f,margin:"0 0 5 0"});this.lblWrapper=null;this.lblTitleHeader=Ext.create("Ext.form.Label",{text:this.model.synopsis,cls:"titleHeader",margin:"0 0 5 0",hidden:!this.model.readOnlyMode});this.lblWrapper=!0==this.model.readOnlyMode&&!0==this.model.inlineEdit&&!1==this.model.synopsisReadonly?Ext.create("Ext.container.Container",{border:!1,cls:"editableFieldWrapper",
overCls:"editableFieldWrapper-over",bodyBorder:!1,margin:"0 0 2px 0",bodyPadding:0,items:[this.lblTitleHeader],listeners:{afterrender:{fn:function(a){Ext.create("Ext.tip.ToolTip",{target:a.el,trackMouse:!0,dismissDelay:0,html:getText("item.view.dblClickToEditField")})}}}}):this.lblTitleHeader;this.txtTitleHeader=Ext.create("com.trackplus.SpellCheckTextField",{beforeSubTpl:'\x3cspan class\x3d"required" style\x3d"height:27px"\x3e\x26nbsp;\x3c/span\x3e',allowBlank:!1,value:this.model.synopsis,cls:"titleHeader",
height:28,enforceMaxLength:!0,maxLength:255,name:"fieldValues.f17",hideLabel:!0,style:{opacity:!0==this.model.readOnlyMode?0:1},hidden:this.model.readOnlyMode});this.headerPanel=Ext.create("Ext.container.Container",{padding:"10 5 0 5",margin:"0 0 0 0",border:!1,cls:"itemHeader",region:"north",layout:{type:"vbox",align:"stretch"},items:[this.projectHeader,this.lblWrapper,this.txtTitleHeader]});this.panelWrapper=null;this.panelWrapper=this.model.includeBottomTabs?Ext.isIE9?Ext.create("Ext.panel.Panel",
{layout:"anchor",defaults:{anchor:"100%"},margin:"0 0 0 0",padding:"0 5 5 5",border:!1,bodyBorder:!1,region:"center",autoScroll:!0,items:a}):Ext.create("Ext.container.Container",{layout:"anchor",defaults:{anchor:"100%"},margin:"0 0 0 0",padding:"0 5 5 5",border:!1,region:"center",autoScroll:!0,items:a}):this.itemPanel;return[this.headerPanel,this.panelWrapper]}});
Ext.define("com.trackplus.item.ItemComponent",{extend:"Ext.Base",mixins:{observable:"Ext.util.Observable"},config:{includeItemTitle:!1,workItemID:null,workItemIDDisplay:null,lastModified:null,projectID:null,projectLabel:null,issueTypeID:null,issueTypeLabel:null,actionID:null,readOnlyMode:!1,includeBottomTabs:!1,itemDetailData:null,issueNoLabel:"IssueNo",statusDisplay:null,statusID:null,synopsis:null,itemLockedMessage:null},itemPanel:null,itemScreenPanel:null,txtTitleHeader:null,itemDetailComponent:null,
constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.mixins.observable.constructor.call(this,a);this.addEvents("editMode","lastModified","itemChange","clickOnParent")},createItemPanel:function(){var a=this;null!=a.itemDetailData&&(a.itemDetailComponent=new com.trackplus.itemDetail.ItemDetailComponent(a.workItemID,a.projectID,a.issueTypeID,a.itemDetailData.tabs,a.itemDetailData.activeTab,a.eventHandlerTabDetail,a,a.lastModified));var b=Ext.create("com.trackplus.screen.ItemView",
{itemDetailComponent:a.itemDetailComponent,model:{workItemID:a.workItemID,projectID:a.projectID,projectLabel:a.projectLabel,issueTypeID:a.issueTypeID,issueTypeLabel:a.issueTypeLabel,issueNoLabel:a.issueNoLabel,workItemIDDisplay:a.workItemIDDisplay,statusDisplay:a.statusDisplay,statusID:a.statusID,synopsis:a.synopsis,includeItemTitle:a.includeItemTitle,includeBottomTabs:a.includeBottomTabs,itemDetailData:a.itemDetailData,readOnlyMode:a.readOnlyMode,synopsisReadonly:a.synopsisReadonly,inlineEdit:a.inlineEdit,
itemLockedMessage:a.itemLockedMessage},region:"center"});a.itemPanel=b.itemPanel;a.txtTitleHeader=b.txtTitleHeader;a.lblWrapper=b.lblWrapper;a.lblTitleHeader=b.lblTitleHeader;!0==a.readOnlyMode&&!0==a.inlineEdit&&!1==a.synopsisReadonly&&a.lblTitleHeader.addListener("afterrender",function(){a.lblTitleHeader.getEl().addListener("dblclick",a.lblTitleHeaderDblClick,a)});return b},eventHandlerTabDetail:function(a,b){"itemChange"==a&&this.screenFacade.controller.refreshByFields.apply(this.screenFacade.controller,
b);this.fireEventArgs(a,b)},lblTitleHeaderDblClick:function(){var a=this;a.lblWrapper.getEl().fadeOut({opacity:0,easing:"easeOut",duration:150,remove:!1,useDisplay:!1,callback:function(){a.lblWrapper.setVisible(!1);a.txtTitleHeader.setVisible(!0);a.txtTitleHeader.getEl().fadeIn({opacity:1,easing:"easeOut",duration:500,callback:function(){a.txtTitleHeader.focus()}})}});a.fireEvent("editMode")},refreshChildren:function(){var a=this;null!=a.gridChildren&&(a.gridChildren.setLoading(!0),Ext.Ajax.request({url:"item!loadChildren.action",
params:{workItemID:a.workItemID},success:function(b){b=Ext.decode(b.responseText).data.children;a.gridChildren.store.loadData(b);a.gridChildren.setLoading(!1)},failure:function(){alert("failed!");a.gridChildren.setLoading(!1)}}))},createChildrenPanel:function(a,b){var c=Ext.create("Ext.panel.Panel",{bodyPadding:0,margin:"5 0 5 0",border:!1,bodyBorder:!1,cls:"screenPanel-odd gridNoBorder",defaults:{frame:!1,border:!1},items:[{xtype:"displayfield",cls:"screenField",style:{marginLeft:"5px"},fieldLabel:getText("item.printItem.lbl.childIssues"),
value:b.length}]}),e=Ext.create("Ext.data.Store",{fields:[{name:"workItemID",type:"int"},{name:"id"},{name:"status"},{name:"originator"},{name:"responsible"},{name:"synopsis"}],data:b});this.gridChildren=Ext.create("Ext.grid.Panel",{store:e,queryMode:"local",border:!1,bodyBorder:!1,columnLines:!1,style:{borderTop:"1px solid #D0D0D0"},stateId:"stateGrid",columns:[{text:getText("field.label12"),width:75,sortable:!0,menuDisabled:!0,dataIndex:"id",xtype:"linkcolumn",handler:this.clickChildItemNumber,
scope:this},{text:getText("field.label4"),width:125,sortable:!0,menuDisabled:!0,dataIndex:"status"},{text:getText("field.label13"),width:150,sortable:!0,menuDisabled:!0,dataIndex:"originator"},{text:getText("field.label6"),width:150,sortable:!0,menuDisabled:!0,dataIndex:"responsible"},{text:getText("field.label17"),flex:1,sortable:!0,menuDisabled:!0,dataIndex:"synopsis"}],viewConfig:{stripeRows:!0}});this.gridChildren.addListener("celldblclick",this.onGridChildrenItemDblClick,this);c.add(this.gridChildren);
return this.childrenPanel=c},clickChildItemNumber:function(a,b){this.fireEvent("clickOnChild",a.data.workItemID)},onGridChildrenItemDblClick:function(a,b,c,e,f,g,h){h.stopEvent();this.fireEvent("clickOnChild",e.data.workItemID);return!1},refreshItemPanel:function(){var a=this;Ext.Ajax.request({url:"item!executeAJAX.action",params:{workItemID:a.workItemID,projectID:a.projectID,issueTypeID:a.issueTypeID,readOnlyMode:a.readOnlyMode,actionID:a.actionID},success:function(b){b=Ext.decode(b.responseText);
a.lastModified=b.data.lastModified;a.replaceScreenItem.call(a,b.data.screen,b.data.children,b.data.readOnlyMode,b.data.workItemContext)},failure:function(){alert("failed!")}})},replaceScreenItem:function(a,b,c,e){var f=this;a=com.trackplus.screen.createScreenModel(a);f.screenFacade=Ext.create("com.trackplus.screen.BaseScreenFacade",{screenModel:a,readOnlyMode:c,showOneTab:!0,tabViewCls:"com.trackplus.screen.ItemTabView",controllerCls:"com.trackplus.screen.ItemScreenController",dataModel:e});c=f.screenFacade.createViewComponent();
f.itemScreenPanel=null==b||0==b.length?c:Ext.create("Ext.container.Container",{layout:"anchor",defaults:{anchor:"100%"},items:[c,f.createChildrenPanel(0,b)]});f.screenFacade.controller.addListener("editMode",function(){f.fireEvent("editMode")});f.screenFacade.controller.addListener("clickOnParent",function(a){f.fireEvent("clickOnParent",a)});f.screenFacade.controller.addListener("lastModified",function(a){null!=f.itemDetailComponent&&(f.itemDetailComponent.lastModified=a);f.lastModified=a;f.fireEvent("lastModified",
a)});f.itemPanel.removeAll(!0);f.itemPanel.add(f.itemScreenPanel)},setParent:function(a,b,c){var e=this.screenFacade.controller.fieldTypeRenderersMap.f16;if(null!=e){var f=e.fieldConfig;f.jsonData={projectSpecificID:c,title:b};e.update.call(e,{value:a,fieldConfig:f})}}});
Ext.define("com.trackplus.item.SendEmail",{extend:"Ext.Base",config:{workItemID:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},view:null,controller:null,show:function(){null==this.controller&&(this.controller=Ext.create("com.trackplus.item.SendEmailController",{workItemID:this.workItemID}));this.controller.show()}});
Ext.define("com.trackplus.item.SendEmailView",{extend:"Ext.form.Panel",config:{model:{},controller:null},layout:"border",border:!1,padding:"0 0 0 0",cmbFromAddress:null,txtTo:null,txtCC:null,txtBCC:null,visibleCC:!1,visibleBCC:!1,visibleAttachments:!1,initComponent:function(){this.items=this.createChildren();this.callParent()},createToolbarBtn:function(a,b,c,e){return Ext.create("Ext.button.Button",{xtype:"button",overflowText:a,tooltip:a,iconCls:c,cls:"toolbarItemAction-noText",text:a,handler:b,
enableToggle:null!=e?!0==e:!1,scope:this})},createChildren:function(){this.btnCC=this.createToolbarBtn(getText("item.action.sendItemEmail.lbl.cc"),this.showHideCC,"user16",!0);this.btnBCC=this.createToolbarBtn(getText("item.action.sendItemEmail.lbl.bcc"),this.showHideBCC,"user16",!0);this.btnAttachemnt=this.createToolbarBtn(getText("item.action.sendItemEmail.lbl.attachments"),this.showHideAtachments,"attachment16",!0);this.btnSend=this.createToolbarBtn(getText("item.action.sendItemEmail.lbl.send"),
this.sendEmail,"buttonEmailSend");this.btnCancel=this.createToolbarBtn(getText("common.btn.cancel"),this.cancelHandler,"itemAction_cancel");var a=[];a.push(this.btnCC);a.push(this.btnBCC);null!=this.model.attachmentsList&&0<this.model.attachmentsList.length&&a.push(this.btnAttachemnt);a.push(this.btnSend);a.push(this.btnCancel);this.toolbar=Ext.create("Ext.toolbar.Toolbar",{layout:{overflowHandler:"Menu"},enableOverflow:!0,anchor:"100%",cls:"toolbarActions",border:"1 0 1 0",defaults:{cls:"toolbarItemAction",
overCls:"toolbarItemAction-over",scale:"small",iconAlign:"left",enableToggle:!1},items:a});var b=this.model.submitterEmail;this.dsFromAddress=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"string"},{name:"label",type:"string"}],data:this.model.fromAddressList});this.cmbFromAddress=Ext.create("Ext.form.ComboBox",{fieldLabel:getText("item.action.sendItemEmail.lbl.from"),labelStyle:"overflow:hidden;",labelAlign:"right",margin:"5 5 5 5",labelWidth:70,store:this.dsFromAddress,displayField:"label",
valueField:"id",typeAhead:!0,queryMode:"local",triggerAction:"all",name:"from",value:this.model.from,width:400});this.linkTo=Ext.create("Ext.ux.LinkComponent",{clsLink:"link_blue",style:{textAlign:"right",paddingTop:"4px"},suffix:":",label:getText("item.action.sendItemEmail.lbl.to"),width:70,handler:this.openLinkTo,scope:this});this.txtTo=Ext.create("Ext.form.field.Text",{name:"toCustom",margin:"0 0 0 5",flex:1});this.btnChooseTo=Ext.create("Ext.button.Button",{tooltip:getText("item.action.sendItemEmail.choosePerson.title",
getText("item.action.sendItemEmail.lbl.to")),iconCls:"addressBook",handler:this.openLinkTo,margin:"0 0 0 5",scope:this});a={xtype:"container",layout:{type:"hbox",pack:"start",align:"stretch"},anchor:"100%",margin:"5 5 5 5",items:[this.linkTo,this.txtTo,this.btnChooseTo]};this.linkCC=Ext.create("Ext.ux.LinkComponent",{clsLink:"link_blue",style:{textAlign:"right",paddingTop:"4px"},suffix:":",label:getText("item.action.sendItemEmail.lbl.cc"),width:70,handler:this.openLinkCC,scope:this});this.txtCC=Ext.create("Ext.form.field.Text",
{name:"ccCustom",margin:"0 0 0 5",flex:1});this.btnChooseCC=Ext.create("Ext.button.Button",{tooltip:getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.cc")),iconCls:"addressBook",handler:this.openLinkCC,margin:"0 0 0 5",scope:this});this.containerCC=Ext.create("Ext.container.Container",{xtype:"container",layout:{type:"hbox",pack:"start",align:"stretch"},anchor:"100%",margin:"5 5 5 5",hidden:!0,items:[this.linkCC,this.txtCC,this.btnChooseCC]});this.linkBCC=
Ext.create("Ext.ux.LinkComponent",{clsLink:"link_blue",style:{textAlign:"right",paddingTop:"4px"},suffix:":",label:getText("item.action.sendItemEmail.lbl.bcc"),width:70,handler:this.openLinkBCC,scope:this});this.txtBCC=Ext.create("Ext.form.field.Text",{margin:"0 0 0 5",flex:1,name:"bccCustom",anchor:"100%"});this.btnChooseBCC=Ext.create("Ext.button.Button",{tooltip:getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.bcc")),iconCls:"addressBook",handler:this.openLinkBCC,
margin:"0 0 0 5",scope:this});this.containerBCC=Ext.create("Ext.container.Container",{layout:{type:"hbox",pack:"start",align:"stretch"},anchor:"100%",margin:"5 5 5 5",hidden:!0,items:[this.linkBCC,this.txtBCC,this.btnChooseBCC]});this.containerAttachments=Ext.create("com.trackplus.util.MultipleSelectPicker",{data:this.model.attachmentsList,hidden:!0,anchor:"100%",margin:"10 5 5 5",name:"selectedAttachments",fieldLabel:getText("item.action.sendItemEmail.lbl.attachments"),labelStyle:"overflow:hidden;",
labelAlign:"right",labelWidth:70,localizedLabel:getText("item.action.sendItemEmail.lbl.attachments"),useNull:!0});this.chkSubmitter=Ext.create("Ext.form.field.Checkbox",{margin:"0 0 0 80",boxLabel:getText("item.action.sendItemEmail.lbl.submitterEmail")+"\x26nbsp;\x26lt;"+b+"\x26gt;",name:"includeSubmitterEmail",hidden:null==b,inputValue:!0});this.txtSubjectPrefix=Ext.create("Ext.form.field.Text",{margin:"0 5 0 0",readOnly:!0,name:"subjectReadonly",value:this.model.subjectReadolnyPart,columnWidth:0.25});
this.txtSubject=Ext.create("Ext.form.field.Text",{name:"subject",value:this.model.subject,columnWidth:0.75});b={xtype:"fieldcontainer",margin:"15 5 5 5",fieldLabel:getText("item.action.sendItemEmail.lbl.subject"),labelStyle:"overflow:hidden;",labelAlign:"right",labelWidth:70,layout:"column",anchor:"100%",defaults:{hideLabel:!0},items:[this.txtSubjectPrefix,this.txtSubject]};a=Ext.create("Ext.panel.Panel",{layout:"anchor",border:!1,bodyBorder:!1,region:"north",padding:"0 0 0 0",items:[this.toolbar,
this.cmbFromAddress,a,this.containerCC,this.containerBCC,this.chkSubmitter,this.containerAttachments,b]});this.txtBody=CWHF.createRichTextEditorField("mailBody",{region:"center",margin:"5 5 5 5",border:!1},!1,!0,{workItemID:this.controller.workItemID});this.chkIncludeItemInformation=Ext.create("Ext.form.field.Checkbox",{boxLabel:getText("item.action.sendItemEmail.lbl.includeItemInformation"),inputValue:!0,name:"includeItemInformation"});this.chkIncludeLink=Ext.create("Ext.form.field.Checkbox",{boxLabel:getText("item.action.sendItemEmail.lbl.includeItemLink"),
inputValue:!0,checked:!0,name:"includeItemLink"});b=Ext.create("Ext.container.Container",{margin:"0 5 5 5",items:[this.chkIncludeItemInformation,this.chkIncludeLink],region:"south"});return[a,this.txtBody,b]},showHideCC:function(){this.visibleCC=!this.visibleCC;this.containerCC.setVisible(this.visibleCC)},showHideBCC:function(){this.visibleBCC=!this.visibleBCC;this.containerBCC.setVisible(this.visibleBCC)},showHideAtachments:function(){this.visibleAttachments=!this.visibleAttachments;this.containerAttachments.setVisible(this.visibleAttachments)},
openLinkTo:function(){var a=getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.to"));this.controller.openPersonDialog.call(this.controller,this.txtTo,a)},openLinkCC:function(){var a=getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.cc"));this.controller.openPersonDialog.call(this.controller,this.txtCC,a)},openLinkBCC:function(){var a=getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.bcc"));
this.controller.openPersonDialog.call(this.controller,this.txtBCC,a)},sendEmail:function(){this.controller.sendEmail.call(this.controller)},cancelHandler:function(){this.controller.cancelHandler.call(this.controller)}});
Ext.define("com.trackplus.item.SendEmailController",{extend:"Ext.Base",config:{workItemID:null},view:null,ERROR_NEED_FROM:1,ERROR_INVALID_EMAIL:2,ERROR_NEED_PERSON:3,ERROR_EMAIL_NOT_SEND:4,ERROR_NEED_MORE_TIME:5,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},createView:function(a){this.view=Ext.create("com.trackplus.item.SendEmailView",{model:a,controller:this});this.addListeners();return this.view},addListeners:function(){},openPersonDialog:function(a,b){this.currentTxtTo=
a;Ext.create("com.trackplus.util.PersonPickerDialog",{title:b,data:null,includeEmail:!0,includeGroups:!0,handler:this.addPersonHandler,scope:this}).showDialog()},addPersonHandler:function(a,b){if(null!=b){var c=this.currentTxtTo.getValue(),e="";null!=c&&""!=c&&(e=c+";");e+=b.join("; ");this.currentTxtTo.setValue(e)}},show:function(){var a=this;borderLayout.setLoading(!0);Ext.Ajax.request({url:"sendItemEmail.action",scope:a,params:{workItemID:a.workItemID},success:function(b){b=Ext.decode(b.responseText);
borderLayout.setLoading(!1);if(!0==b.success)a.successHandler.call(a,b.data);else{var c=b.errorMessage;b.errorCode==a.ERROR_EMAIL_NOT_SEND?CWHF.showMsgError(getText("item.action.sendItemEmail.err.noSMTP")):CWHF.showMsgError(c)}},failure:function(){borderLayout.setLoading(!1);alert("failure")}})},successHandler:function(a){null!=this.view&&this.view.destroy();this.view=this.createView(a);null!=this.win&&(this.win.destroy(),this.win=null);this.win=Ext.create("Ext.window.Window",{layout:"fit",maximizable:!0,
border:!1,bodyBorder:!0,margin:"0 0 0 0",style:{padding:"5px 0px 0px 0px"},bodyStyle:{padding:"0 0 0 0",margin:"0 0 0 0"},iconCls:"buttonEmail16",width:800,height:600,closeAction:"destroy",plain:!0,title:getText("item.action.sendItemEmail.lbl.title"),modal:!0,items:[this.view],autoScroll:!0});var b;b=borderLayout.ensureSize(800,600);a=b.width;b=b.height;this.win.setWidth(a);this.win.setHeight(b);(800>a||600>b)&&this.win.setPosition(10,10);this.win.show()},sendEmail:function(){var a=this;CWHF.submitRTEditor(a.view.txtBody);
var b=a.view;b.setLoading(com.trackplus.TrackplusConfig.getText("common.lbl.loading"));b.getForm().submit({url:"sendItemEmail!sendEmail.action",params:{workItemID:a.workItemID},success:function(c,e){b.setLoading(!1);CWHF.showMsgInfo(getText("item.action.sendItemEmail.lbl.sentSuccessful"));a.win.hide();a.win.destroy()},failure:function(c,e){b.setLoading(!1);var f=e.result.errorCode;CWHF.showMsgError(e.result.errorMessage);switch(f){case a.ERROR_NEED_FROM:a.view.cmbFromAddress.focus();break;case a.ERROR_INVALID_EMAIL:a.view.txtTo.focus();
break;case a.ERROR_NEED_PERSON:a.view.txtTo.focus()}}})},cancelHandler:function(){this.win.hide();this.win.destroy();this.win=null}});
Ext.define("com.trackplus.screen.FieldEditWrapperView",{extend:"Ext.panel.Panel",config:{model:null,parentView:null,emptyText:getText("admin.customize.form.edit.emptyField")},bodyStyle:{overflow:"hidden",background:"transparent"},myComponentCls:null,getFieldCls:function(){return"designField"},initComponent:function(){var a=this,b=a.getFieldWrapperConfig.call(a),c=a.model.iconRendering;2==c&&(this.layout="hbox");Ext.apply(this,b);if(a.model.empty)a.bodyStyle={paddingTop:"3px",paddingBottom:"5px"},
a.html=a.emptyText,a.addCls("emptyField"),a.myComponentCls="emptyField";else{a.myComponentCls=a.getFieldCls();a.addCls(a.myComponentCls);b=null;if(a.model.jsonData.missingPlugin)b="\x3cspan\x3e"+a.model.jsonData.htmlString+"\x3c/span\x3e";else if(c=a.model.jsonData.srcImage,null!=c)c=Ext.create("Ext.Img",{src:"loadImage.action?imageName\x3d"+c,listeners:{render:function(b){b.getEl().on("load",function(){a.ownerCt.ownerCt.doLayout()})}}}),a.items=[c];else switch(c=null!=a.model.iconRendering?a.model.iconRendering:
0,c){case 0:var e=a.model.extClassName;null!=e&&(e=Ext.create(e,{flex:1}).render(a.model),a.items=[e]);break;case 1:c=a.createIconCmp();a.items=[c];break;case 2:c=a.createIconCmp(),e=a.model.extClassName,null!=e?(e=Ext.create(e,{flex:1}).render(a.model),a.items=[c,e]):a.items=[c]}null!=b&&(a.html=b)}a.callParent()},createIconCmp:function(){var a="customFields-ticon";switch(this.model.fieldID){case 2:a="issueType-ticon";break;case 4:a="status-ticon";break;case 10:a="priority-ticon";break;case 11:a=
"severity-ticon"}return Ext.create("Ext.Component",{width:22,html:'\x3cimg class\x3d"'+a+'" src\x3d"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw\x3d\x3d" height\x3d"16"/\x3e'})},getFieldWrapperConfig:function(){var a={margin:"2 2 2 2",border:!1};1==this.model.iconRendering&&(a.width=25);return a}});
Ext.define("com.trackplus.screen.PropertiesPanel",{extend:"Ext.grid.property.Grid",componentModel:null,title:getText("admin.customize.form.edit.lbl.layoutProperties"),border:!1,bodyBorder:!1,height:300,region:"north",ALIGN_TOP:0,ALIGN_BOTTOM:1,ALIGN_MIDDLE:2,ALIGN_LEFT:3,ALIGN_RIGHT:4,ALIGN_CENTER:5,ALIGN_TOP_STR:getText("admin.customize.form.fieldProperties.align.top"),ALIGN_BOTTOM_STR:getText("admin.customize.form.fieldProperties.align.bottom"),ALIGN_MIDDLE_STR:getText("admin.customize.form.fieldProperties.align.middle"),
ALIGN_LEFT_STR:getText("admin.customize.form.fieldProperties.align.left"),ALIGN_RIGHT_STR:getText("admin.customize.form.fieldProperties.align.right"),ALIGN_CENTER_STR:getText("admin.customize.form.fieldProperties.align.center"),ICON_RENDERING_LABEL:0,ICON_RENDERING_ICON:1,ICON_RENDERING_BOTH:2,ICON_RENDERING_LABEL_STR:getText("admin.customize.form.fieldProperties.iconRendering.label"),ICON_RENDERING_ICON_STR:getText("admin.customize.form.fieldProperties.iconRendering.icon"),ICON_RENDERING_BOTH_STR:getText("admin.customize.form.fieldProperties.iconRendering.both"),
propertyNames:{"screen.label":getText("common.lbl.label"),"screen.name":getText("common.lbl.name"),"screen.description":getText("common.lbl.description"),"tab.label":getText("common.lbl.label"),"tab.name":getText("common.lbl.name"),"tab.description":getText("common.lbl.description"),"panel.name":getText("common.lbl.name"),"panel.description":getText("common.lbl.description"),"panel.rowsNo":getText("admin.customize.form.panelProperties.rows"),"panel.colsNo":getText("admin.customize.form.panelProperties.columns"),
fieldType:getText("admin.customize.form.fieldProperties.type"),"field.name":getText("common.lbl.name"),"field.description":getText("common.lbl.description"),"field.rowSpan":getText("admin.customize.form.fieldProperties.rowSpan"),"field.colSpan":getText("admin.customize.form.fieldProperties.colSpan"),"field.iconRendering":getText("admin.customize.form.fieldProperties.iconRendering"),"field.labelHAlign":getText("admin.customize.form.fieldProperties.labelHAlign"),"field.labelVAlign":getText("admin.customize.form.fieldProperties.labelVAlign"),
"field.valueHAlign":getText("admin.customize.form.fieldProperties.valueHAlign"),"field.valueVAlign":getText("admin.customize.form.fieldProperties.valueVAlign"),"field.hideLabelBoolean":getText("admin.customize.form.fieldProperties.hideLabel")},source:{},createCombo:function(a){a=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},{name:"label",type:"string"}],data:a});return Ext.create("Ext.form.ComboBox",{store:a,queryMode:"local",displayField:"label",valueField:"id"})},initComponent:function(){Ext.apply(this);
var a=[{id:this.ALIGN_TOP,label:this.ALIGN_TOP_STR},{id:this.ALIGN_BOTTOM,label:this.ALIGN_BOTTOM_STR},{id:this.ALIGN_MIDDLE,label:this.ALIGN_MIDDLE_STR}],b=[{id:this.ALIGN_LEFT,label:this.ALIGN_LEFT_STR},{id:this.ALIGN_RIGHT,label:this.ALIGN_RIGHT_STR},{id:this.ALIGN_CENTER,label:this.ALIGN_CENTER_STR}],c=this.createCombo([{id:this.ICON_RENDERING_LABEL,label:this.ICON_RENDERING_LABEL_STR},{id:this.ICON_RENDERING_ICON,label:this.ICON_RENDERING_ICON_STR},{id:this.ICON_RENDERING_BOTH,label:this.ICON_RENDERING_BOTH_STR}]),
e=this.createCombo(b),f=this.createCombo(a),g=this.createCombo(b),h=this.createCombo(a);this.customEditors={fieldType:Ext.create("Ext.form.field.Display",{}),"field.rowSpan":Ext.create("Ext.form.field.Number",{minValue:1,maxValue:20,allowBlank:!1}),"field.colSpan":Ext.create("Ext.form.field.Number",{minValue:1,maxValue:10,allowBlank:!1}),"panel.rowsNo":Ext.create("Ext.form.field.Number",{minValue:1,maxValue:20,allowBlank:!1}),"panel.colsNo":Ext.create("Ext.form.field.Number",{minValue:1,maxValue:10,
allowBlank:!1}),"field.iconRendering":c,"field.labelHAlign":e,"field.labelVAlign":f,"field.valueHAlign":g,"field.valueVAlign":h};this.customRenderers={"field.iconRendering":function(a,b,e){return(a=c.findRecord(c.valueField,a))?a.get(c.displayField):c.valueNotFoundText},"field.labelHAlign":function(a,b,c){return(a=e.findRecord(e.valueField,a))?a.get(e.displayField):e.valueNotFoundText},"field.labelVAlign":function(a,b,c){return(a=f.findRecord(f.valueField,a))?a.get(f.displayField):f.valueNotFoundText},
"field.valueHAlign":function(a,b,c){return(a=g.findRecord(g.valueField,a))?a.get(g.displayField):g.valueNotFoundText},"field.valueVAlign":function(a,b,c){return(a=h.findRecord(h.valueField,a))?a.get(h.displayField):h.valueNotFoundText}};this.callParent()}});
Ext.define("com.trackplus.screen.FieldListPanel",{extend:"Ext.grid.GridPanel",config:{url:""},stripeRows:!0,border:!1,bodyBorder:!1,enableColumnHide:!1,enableColumnMove:!1,columnLines:!0,region:"center",collapsible:!1,split:!1,columns:[{header:getText("common.lbl.name"),width:140,dataIndex:"label",id:"label",sortable:!0},{header:getText("common.lbl.description"),flex:1,dataIndex:"description",id:"description",sortable:!1}],viewConfig:{forceFit:!0,plugins:{ddGroup:"fields",ptype:"gridviewdragdrop",
enableDrop:!1,enableDrag:!0}},selModel:Ext.create("Ext.selection.RowModel",{singleSelect:!0}),initComponent:function(){var a=Ext.create("Ext.data.Store",{fields:[{name:"id"},{name:"name"},{name:"label"},{name:"description"}],proxy:{type:"ajax",url:this.url,reader:{type:"json"}},sorters:[{property:"label",direction:"ASC"}]});this.store=a;this.callParent();a.load()}});
Ext.define("com.trackplus.screen.FieldTreePanel",{extend:"Ext.tree.Panel",config:{url:""},useArrows:!1,rootVisible:!1,border:!1,bodyBorder:!1,region:"center",height:300,selModel:Ext.create("Ext.selection.RowModel",{singleSelect:!0}),viewConfig:{forceFit:!0,plugins:{ddGroup:"fields",ptype:"gridviewdragdrop",enableDrop:!1,enableDrag:!0}},columns:[{xtype:"treecolumn",header:getText("common.lbl.name"),width:140,dataIndex:"label",id:"label",sortable:!0},{header:getText("common.lbl.description"),flex:1,
dataIndex:"description",id:"description",sortable:!1}],initComponent:function(){this.store=Ext.create("Ext.data.TreeStore",{fields:[{name:"id"},{name:"name"},{name:"label"},{name:"description"}],proxy:{type:"ajax",url:this.url,reader:{type:"json"}}});this.callParent()}});
Ext.define("com.trackplus.screen.ScreenEditView",{extend:"Ext.panel.Panel",config:{screenView:null,urlFieldList:"",titleFieldList:"Fields",fieldsAsTree:!1},region:"center",fieldsAsTree:!1,margins:"0 0 0 0",border:!1,baseCls:"x-plain",layout:"border",propertiesPanel:null,fieldListPanel:null,cls:"screenEditViewWrapper",initComponent:function(){this.items=[this.screenView,this.createEastPanel()];this.callParent()},createEastPanel:function(){this.propertiesPanel=Ext.create("com.trackplus.screen.PropertiesPanel",
{bodyBorder:!1});this.fieldListPanel=this.fieldsAsTree?Ext.create("com.trackplus.screen.FieldTreePanel",{url:this.urlFieldList,title:this.titleFieldList}):Ext.create("com.trackplus.screen.FieldListPanel",{url:this.urlFieldList,title:this.titleFieldList});return Ext.create("Ext.panel.Panel",{layout:"border",region:"east",border:!1,bodyBorder:!1,bodyPadding:0,width:275,split:!0,style:{borderLeft:"1px solid #D0D0D0"},margin:"0 0 0 -4",items:[this.propertiesPanel,this.fieldListPanel]})},getSelectedTab:function(){return this.screenView.getSelectedTab()}});
Ext.define("com.trackplus.screen.ScreenEditFacade",{extend:"com.trackplus.screen.BaseScreenFacade",config:{urlFieldList:null,fieldsAsTree:!1,useConfig:!1,configURL:null,lastSelectedTab:null,fieldWrapperCls:null,screenAction:null,screenActionParams:null,screenUpdateAction:null,tabAction:null,tabUpdateAction:null,panelAction:null,panelUpdateAction:null,fieldAction:null,fieldUpdateAction:null,messageDeletePanel:null,messageDeleteTab:null,messageDeleteField:null,messageCantDeleteScreen:null,messageCantDeleteLastTab:null,
backAction:null},fieldsAsTree:!1,baseScreenView:null,mainPanel:null,tabsPanel:null,propertiesPan:null,clickOnField:!1,clickOnPanel:!1,clickOnTab:!1,screenEditView:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.controller=Ext.create(this.controllerCls,{screenModel:this.screenModel,showOneTab:this.showOneTab,lastSelectedTab:this.lastSelectedTab,refreshTabUrl:this.refreshTabUrl,storeTabUrl:this.storeTabUrl,panelViewCls:this.panelViewCls,fieldWrapperCls:this.fieldWrapperCls,
screenAction:this.screenAction,screenActionParams:this.screenActionParams,screenUpdateAction:this.screenUpdateAction,tabAction:this.tabAction,tabUpdateAction:this.tabUpdateAction,panelAction:this.panelAction,panelUpdateAction:this.panelUpdateAction,fieldAction:this.fieldAction,fieldUpdateAction:this.fieldUpdateAction,useConfig:this.useConfig,configURL:this.configURL,messageDeletePanel:this.messageDeletePanel,messageDeleteTab:this.messageDeleteTab,messageDeleteField:this.messageDeleteField,messageCantDeleteScreen:this.messageCantDeleteScreen,
messageCantDeleteLastTab:this.messageCantDeleteLastTab,backAction:this.backAction})},createScreenEditViewComponent:function(){this.screenView=this.createViewComponent();this.screenView.addCls("designScreen");this.screenView.myComponentCls="designScreen";this.screenEditView=Ext.create("com.trackplus.screen.ScreenEditView",{screenView:this.screenView,urlFieldList:this.urlFieldList,fieldsAsTree:this.fieldsAsTree,titleFieldList:this.titleFieldList});this.screenEditView.propertiesPanel.addListener("propertychange",
this.controller.changeAttribute,this.controller);return this.controller.screenEditView=this.screenEditView},getToolbar:function(){return this.controller.getToolbar.call(this.controller)}});
Ext.define("com.trackplus.screen.ComponentController",{extend:"Ext.Base",config:{screenEditController:null,action:"",updateAction:""},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},getUpdateLink:function(a){return null==this.updateAction?null:this.updateAction+".action?componentID\x3d"+a+"\x26screenID\x3d"+this.screenEditController.screenModel.id},getPropertyLink:function(a){return null==this.updateAction?null:this.action+"!properties.action?componentID\x3d"+a},reload:function(a,
b,c,e){},click:function(a){}});
Ext.define("com.trackplus.screen.ScreenController",{extend:"com.trackplus.screen.ComponentController",reload:function(a,b,c,e){null==b&&(b="reload");e=a.model.getId();b=this.action+"!"+b+".action?componentID\x3d"+e;null!=this.projectID&&(b=b+"\x26projectID\x3d"+this.projectID+"\x26entityType\x3d"+this.entityType);borderLayout.setLoading(!0);Ext.Ajax.request({url:b,params:c,success:function(a){location.reload(!0)},failure:function(){alert("failed!");a.setLoading(!1)}})},copy:function(a,b,c,e,f){borderLayout.setLoading(!0);
Ext.Ajax.request({url:this.action+"!copy.action?componentID\x3d"+a,params:{sourceType:b,sourceID:c},success:function(a){Ext.decode(a.responseText);borderLayout.setLoading(!1);null!=e&&e.call(f)},failure:function(){alert("failed!");borderLayout.setLoading(!1)}})},paste:function(a,b,c,e,f,g,h,k){var l=this;borderLayout.setLoading(!0);Ext.Ajax.request({url:l.action+"!paste.action?componentID\x3d"+a,params:{sourceType:b,sourceID:c,targetType:e,targetID:f,targetInfo:g},success:function(a){Ext.decode(a.responseText);
borderLayout.setLoading(!1);null!=h&&h.call(null==k?l:k)},failure:function(){alert("failed!");borderLayout.setLoading(!1)}})}});
Ext.define("com.trackplus.screen.TabController",{extend:"com.trackplus.screen.ComponentController",unregister:function(a){a.unregister.call(a)},reload:function(a,b,c,e){var f=this;if(null==f.action)f.screenEditController.reload.call(f.screenEditController);else{var g=a.model.getId();a.setLoading(getText("common.lbl.loading"));f.unregister(a);null==b&&(b="reload");b=f.action+"!"+b+".action?componentID\x3d"+g;b=b+"\x26screenID\x3d"+f.screenEditController.screenModel.id;null!=f.projectID&&(b=b+"\x26projectID\x3d"+
this.projectID+"\x26entityType\x3d"+this.entityType);Ext.Ajax.request({url:b,params:c,success:function(b){b=Ext.decode(b.responseText);b=com.trackplus.screen.createTabModel(b.data);b=f.screenEditController.refreshTabModel(a,b,e);a.setLoading(!1);null!=b&&f.screenEditController.setSelectedComponent(b)},failure:function(){alert("failed!");a.setLoading(!1)}})}}});
Ext.define("com.trackplus.screen.PanelController",{extend:"com.trackplus.screen.ComponentController",unregister:function(a){a.unregister.call(a)},reload:function(a,b,c,e,f){var g=this;g.unregister(a);a.setLoading(getText("common.lbl.loading"));null==b&&(b="reload");e=a.model.getId();b=g.action+"!"+b+".action";b=b+"?componentID\x3d"+e+"\x26screenID\x3d"+g.screenEditController.screenModel.id;null!=g.projectID&&(b=b+"\x26projectID\x3d"+g.projectID+"\x26entityType\x3d"+g.entityType);Ext.Ajax.request({url:b,
disableCaching:!0,success:function(b){b=Ext.decode(b.responseText);b=com.trackplus.screen.createPanelModel(b);g.screenEditController.refreshPanelModel(a,b);null!=f&&f.call();a.setLoading(!1)},failure:function(){alert("failure");a.setLoading(!1)},method:"POST",params:c})},registerDragDrop:function(a){var b=this,c=b.screenEditController,e=new Ext.dd.DragSource(a.getEl(),{dragData:{panel:a},ddGroup:"panels"}),f=new Ext.dd.DropTarget(a.getEl(),{ddGroup:"panels",notifyEnter:function(b,e,f){c.setDragOver(a)},
notifyOut:function(a,b,e){c.clearDragOn()},notifyDrop:function(e,f,k){c.clearDragOn();Ext.defer(b.onDropPanel,100,b,[k.panel,a]);return!0}});a.dragDropObjects.push(e);a.dragDropObjects.push(f)},onDropPanel:function(a,b){var c=a.model.getId(),e=b.model.getId();if(c==e)return!1;this.screenEditController.tabController.reload.call(this.screenEditController.tabController,a.parentView,"moveChild",{panelID:c,newIndex:b.myIndex},c);return!0}});
Ext.define("com.trackplus.screen.FieldController",{extend:"com.trackplus.screen.ComponentController",config:{},registerDrag:function(a){var b=a.parentView,c=a.model.getId();return new Ext.dd.DragSource(a.getEl(),{dragData:{panelCmp:b,cell:a.model.row+";"+a.model.col,fieldID:c},ddGroup:"fields"})},registerDrop:function(a){var b=this,c=b.screenEditController;return new Ext.dd.DropTarget(a.getEl(),{ddGroup:"fields",notifyEnter:function(b,f,g){c.setDragOver(a)},notifyOut:function(a,b,g){c.clearDragOn()},
notifyOver:function(e,f,g){null!=b.lastDropComponent&&b.lastDropComponent.model.getId()==a.id||c.setDragOver(a);return this.dropAllowed},notifyDrop:function(e,f,g){c.clearDragOn();var h=f=e=null,k=null,l=a.model,m=a.parentView,l=l.row+";"+l.col;null!=g.records?f=g.records[0].data.id:(e=g.fieldID,h=g.panelCmp,k=g.cell);if(null==e&&null==f)return!1;Ext.defer(b.onDropField,100,b,[f,e,h,k,m,l]);return!0}})},onDropField:function(a,b,c,e,f,g){var h=null;null!=c&&(h=c.model.getId());var k=f.model.getId(),
l=this.screenEditController;l.clearSelectedComponent();var m;m=null==e?"addField":"moveField";a={fieldID:b,fieldType:a,source:e,sourcePanelID:h,target:g,targetPanelID:k};b=null;null!=h&&h!=k&&(m="moveFieldFromOther",b=function(){l.panelController.reload.call(l.panelController,c,"reload")});if(null==h||h!=k||e!=g)return l.panelController.reload.call(l.panelController,f,m,a,k,b),!0}});
Ext.define("com.trackplus.screen.ScreenEditController",{extend:"com.trackplus.screen.BaseScreenController",config:{fieldWrapperCls:null,screenAction:null,screenActionParams:null,screenUpdateAction:null,tabAction:null,tabUpdateAction:null,panelAction:null,panelUpdateAction:null,fieldAction:null,fieldUpdateAction:null,useConfig:!1,messageDeletePanel:null,messageDeleteTab:null,messageDeleteField:null,messageCantDeleteScreen:null,messageCantDeleteLastTab:null,backAction:"cockpit.action"},showOneTab:!1,
selectedComponent:null,clipboard:null,lastDropComponent:null,clickOnTab:!1,clickOnPanel:!1,clickOnField:!1,screenEditView:null,screenController:null,tabController:null,panelController:null,fieldController:null,actionsController:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.screenController=Ext.create("com.trackplus.screen.ScreenController",{screenEditController:this,action:this.screenAction,updateAction:this.screenUpdateAction});this.tabController=Ext.create("com.trackplus.screen.TabController",
{screenEditController:this,action:this.tabAction,updateAction:this.tabUpdateAction});this.panelController=Ext.create("com.trackplus.screen.PanelController",{screenEditController:this,action:this.panelAction,updateAction:this.panelUpdateAction});this.fieldController=Ext.create("com.trackplus.screen.FieldController",{screenEditController:this,action:this.fieldAction,updateAction:this.fieldUpdateAction});this.actionsController=Ext.create("com.trackplus.screen.ScreenActionsController",{screenEditController:this,
useConfig:this.useConfig});this.callParent()},afterScreenCreated:function(a){var b=this;a.addListener("render",function(a){a.getEl().on("click",function(){b.clickOnScreenHandler.call(b,a)});a.getEl().on("contextmenu",function(e,f){0==b.clickOnScreenHandler.call(b,a)&&b.showPopup.call(b,e)})})},showPopup:function(a,b){this.emptyFieldCmp=b;var c=this.actionsController.createPopup.call(this.actionsController);null!=c&&c.showAt(a.getXY());a.stopEvent()},clickOnScreenHandler:function(a){if(!0==this.clickOnField)return this.clickOnField=
!1,1;if(!0==this.clickOnPanel)return this.clickOnPanel=!1,2;if(!0==this.clickOnTab)return this.clickOnTab=!1,3;this.clickOnScreen=!0;this.clickOnComponent.call(this,a);return 0},clickOnTabHandler:function(a){if(!0==this.clickOnField)return 1;if(!0==this.clickOnPanel)return 2;this.clickOnTab=!0;this.clickOnComponent.call(this,a);return 0},afterTabPanelCreated:function(a){for(var b=this,c=a.tabBar.items,e=0;e<c.getCount();e++)c.getAt(e).addListener("render",function(c){c.getEl().addListener("click",
b.clickOnTabBar,b,a)});c.addListener("add",function(c,e){e.addListener("render",function(c){e.getEl().addListener("click",b.clickOnTabBar,b,a)})})},clickOnTabBar:function(a,b,c){this.clickOnTabHandler.call(this,c.getActiveTab())},afterTabCreated:function(a){var b=this;a.addCls("designTab");a.myComponentCls="designTab";a.addListener("render",function(a){a.getEl().on("click",function(){b.clickOnTabHandler.call(b,a)});a.getEl().on("contextmenu",function(e,f){0==b.clickOnTabHandler.call(b,a)&&b.showPopup.call(b,
e)})});a.addListener("activate",b.clickOnTabHandler,b)},clickOnPanelHandler:function(a){if(!0==this.clickOnField)return 1;this.clickOnPanel=!0;this.clickOnComponent.call(this,a,this);return 0},afterPanelCreated:function(a){var b=this;a.addListener("render",function(a){a.getEl().on("click",function(){b.clickOnPanelHandler.call(b,a)});a.getEl().on("contextmenu",function(e,f){0==b.clickOnPanelHandler.call(b,a)&&b.showPopup.call(b,e)});b.panelController.registerDragDrop.call(b.panelController,a)})},clearDragOn:function(){if(null!=
this.lastDropComponent){var a="dragOver";null!=this.lastDropComponent.myComponentCls&&(a=this.lastDropComponent.myComponentCls+"-dragOver",this.lastDropComponent.addCls(this.lastDropComponent.myComponentCls));this.lastDropComponent.removeCls(a);this.lastDropComponent=null}},setDragOver:function(a){null!=this.lastDropComponent&&this.clearDragOn();var b="dragOver";null!=a.myComponentCls&&(b=a.myComponentCls+"-dragOver",a.removeCls(a.myComponentCls));a.addCls(b);this.lastDropComponent=a},clearSelectedComponent:function(){if(null!=
this.selectedComponent&&null!=this.selectedComponent.getEl()){var a="componentSelected";null!=this.selectedComponent.myComponentCls&&(a=this.selectedComponent.myComponentCls+"-selected",this.selectedComponent.addCls(this.selectedComponent.myComponentCls));this.selectedComponent.removeCls(a);this.selectedComponent=null}},setSelectedComponent:function(a){null!=this.selectedComponent&&this.clearSelectedComponent();var b="componentSelected";null!=a.myComponentCls&&(b=a.myComponentCls+"-selected",a.removeCls(a.myComponentCls));
a.addCls(b);this.selectedComponent=a;this.refreshActions()},refreshActions:function(){var a=this.selectedComponent.model;if(null==a)return null;a=a.type;"Field"==a?this.actionsController.setActionConfigEnabled.call(this.actionsController,!0):this.actionsController.setActionConfigEnabled.call(this.actionsController,!1);if("Screen"==a)this.actionsController.setActionCopyEnabled.call(this.actionsController,!1),this.actionsController.setActionDeleteEnabled.call(this.actionsController,!1);else{var b=!0;
null!=this.tabAction||"Panel"!=a&&"Tab"!=a||(b=!1);this.actionsController.setActionDeleteEnabled.call(this.actionsController,b);this.actionsController.setActionCopyEnabled.call(this.actionsController,b)}actionPasteEnabled=this.allowPaste();this.actionsController.setActionPasteEnabled.call(this.actionsController,actionPasteEnabled)},clickOnComponent:function(a){this.setSelectedComponent(a);var b=this.getComponentController(a);a=a.model.getId();b=b.getPropertyLink(a);if(null==b)return!0;this.refreshOutline.call(this,
b)},refreshOutline:function(a,b,c){var e=this;Ext.Ajax.request({url:a,disableCaching:!0,params:b,success:function(a){a=Ext.decode(a.responseText);e.screenEditView.propertiesPanel.setSource(a);null!=c&&c.call(e)},failure:function(){},method:"POST"})},getComponentController:function(a){a=a.model;if(null==a)return null;a=a.type;return"Tab"==a?this.tabController:"Panel"==a?this.panelController:"Field"==a?this.fieldController:"Screen"==a?this.screenController:null},changeAttribute:function(a,b,c){var e=
this;if(null!=e.selectedComponent){a=e.selectedComponent.model;c=e.getComponentController.call(e,e.selectedComponent);b=a.getId();b=c.getUpdateLink(b);if(null==b)return!0;c={};var f=e.screenEditView.propertiesPanel.getSource(),g;for(g in f)c[g]=f[g];var h=a.type;e.refreshOutline(b,c,function(){if("Field"==h){var a=e.selectedComponent.parentView;e.panelController.reload(a)}else"Panel"==h?(a=e.selectedComponent,e.tabController.reload(a.parentView,null,null,a.model.id)):(a=e.selectedComponent.parentView,
null==a&&(a=e.selectedComponent),e.screenController.reload(a,null,null,e.selectedComponent.model.id))})}},createField:function(a,b){var c=this;null==c.fieldWrapperCls&&(c.fieldWrapperCls="com.trackplus.screen.FieldEditWrapperView");var e=Ext.create(c.fieldWrapperCls,{parentView:a,model:b});e.addListener("render",function(e){if(b.empty)e.getEl().on("contextmenu",function(a,b){c.clickOnPanel=!0;c.clickOnComponent.call(c,e.parentView);c.showPopup.call(c,a,e)});else{e.getEl().on("click",function(a){c.clickOnField=
!0;c.clickOnComponent.call(c,e);a.stopEvent();return!1});e.getEl().on("contextmenu",function(a,b){c.clickOnField=!0;c.clickOnComponent.call(c,e);c.showPopup.call(c,a)});var g=c.fieldController.registerDrag.call(c.fieldController,e);a.dragDropObjects.push(g)}g=c.fieldController.registerDrop.call(c.fieldController,e);a.dragDropObjects.push(g)});e.colspan=b.colSpan;e.rowspan=b.rowSpan;return e},getToolbar:function(){return this.actionsController.getToolbar()},newTab:function(){this.screenController.reload.call(this.screenController,
this.screenView,"addTab",this.screenActionParams)},newPanel:function(){var a=this.screenEditView.getSelectedTab();this.tabController.reload.call(this.tabController,a,"addPanel")},cutItem:function(){var a=this;a.copyItem(function(){a.deleteItem(!0)},a)},copyItem:function(a,b){if(null==this.selectedComponent)return!1;var c=this.selectedComponent.model,e=c.type,c=c.getId();this.clipboard={type:e,id:c};this.screenController.copy.call(this.screenController,this.screenModel.getId(),e,c,a,b)},pasteItem:function(){var a=
this;if(null==a.selectedComponent)return!1;var b=a.selectedComponent.model,c=b.type,b=b.getId(),e=null;if(null!=a.clipboard&&a.allowPaste()){var f=a.clipboard.type,g=a.clipboard.id;null!=a.emptyFieldCmp&&(e=a.emptyFieldCmp.model,e=e.row+";"+e.col);a.screenController.paste.call(a.screenController,a.screenModel.getId(),f,g,c,b,e,function(){var b=a.selectedComponent,e=null;"Screen"==c&&(e=a.screenController);"Tab"==c&&(e=a.tabController);"Panel"==c&&(e=a.panelController,"Panel"==f&&(e=a.tabController,
b=a.selectedComponent.parentView));"Field"==c&&(e=a.panelController,b=a.selectedComponent.parentView);e.reload(b)},a)}},allowPaste:function(){if(null==this.selectedComponent)return!1;var a=this.selectedComponent.model.type;if(null!=this.clipboard){var b=this.clipboard.type;return"Screen"==a&&"Tab"==b||"Tab"==a&&"Tab"==b||"Tab"==a&&"Panel"==b||"Panel"==a&&"Panel"==b||"Panel"==a&&"Field"==b||"Field"==a&&"Field"==b}return!1},deleteItem:function(a){if(null==this.selectedComponent)return!1;var b=this.selectedComponent.model,
c=b.type,e=b.getId(),f="",g,h;if("Screen"==c)return alert(this.messageCantDeleteScreen),-1;var k={};if("Tab"==c&&(f="tab",g=this.messageDeleteTab,h=this.screenController,null!=this.screenActionParams))for(var l in this.screenActionParams)k[l]=this.screenActionParams[l];"Panel"==c&&(f="panel",g=this.messageDeletePanel,h=this.tabController);"Field"==c&&(f="field",g=this.messageDeleteField,h=this.panelController);g=g.replace("{0}",b.name);if((null==a||!1==a)&&!1==confirm(g))return 0;k[f+"ID"]=e;h.reload(this.selectedComponent.parentView,
"deleteChild",k);this.selectedComponent=null},isConfigurableItem:function(){return!1},configItem:function(){},back:function(){window.location.href=this.backAction},reload:function(){borderLayout.setLoading(!0);location.reload()}});
Ext.define("com.trackplus.screen.ScreenActionsController",{extend:"Ext.Base",config:{screenEditController:null,useConfig:!1},actionNewTab:null,actionNewPanel:null,actionDelete:null,actionConfig:null,actionCut:null,actionCopy:null,actionPaste:null,actions:null,actionConfigEnabled:!1,actionDeleteEnabled:!1,actionCopyEnabled:!0,actionPasteEnabled:!1,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},setActionConfigEnabled:function(a){this.actionConfigEnabled=a;null!=this.actionConfig&&
this.actionConfig.setDisabled(!a)},setActionDeleteEnabled:function(a){this.actionDeleteEnabled=a;null!=this.actionDelete&&this.actionDelete.setDisabled(!a)},setActionCopyEnabled:function(a){this.actionCopyEnabled=a;null!=this.actionCut&&this.actionCut.setDisabled(!a);null!=this.actionCopy&&this.actionCopy.setDisabled(!a)},setActionPasteEnabled:function(a){this.actionPasteEnabled=a;null!=this.actionPaste&&this.actionPaste.setDisabled(!a)},initToolbar:function(){var a=this;a.actionNewTab=Ext.create("Ext.Action",
{id:"newTabBtn",itemId:"newTabBtnItemID",overflowText:getText("admin.customize.form.edit.newTab"),tooltip:getText("admin.customize.form.edit.newTab.tooltip"),text:getText("admin.customize.form.edit.newTab"),iconCls:"newTab",disabled:!1,handler:function(){a.screenEditController.newTab.call(a.screenEditController)}});a.actionNewPanel=Ext.create("Ext.Action",{id:"newPanelBtn",itemId:"newPanelBtnItemID",overflowText:getText("admin.customize.form.edit.newPanel"),tooltip:getText("admin.customize.form.edit.newPanel.tooltip"),
text:getText("admin.customize.form.edit.newPanel"),iconCls:"newPanel",disabled:!1,handler:function(){a.screenEditController.newPanel.call(a.screenEditController)}});a.actionCut=Ext.create("Ext.Action",{id:"cutBtn",itemId:"cutBtnItemID",overflowText:getText("common.btn.cut"),tooltip:getText("common.btn.cut"),text:getText("common.btn.cut"),iconCls:"cut",disabled:!a.actionCopyEnabled,handler:function(){a.screenEditController.cutItem.call(a.screenEditController)}});a.actionCopy=Ext.create("Ext.Action",
{id:"copyBtn",itemId:"copyBtnItemID",overflowText:getText("common.btn.copy"),tooltip:getText("common.btn.copy"),text:getText("common.btn.copy"),iconCls:"copy",disabled:!a.actionCopyEnabled,handler:function(){a.screenEditController.copyItem.call(a.screenEditController)}});a.actionPaste=Ext.create("Ext.Action",{id:"pasteBtn",itemId:"pasteBtnItemID",overflowText:getText("common.btn.paste"),tooltip:getText("common.btn.paste"),text:getText("common.btn.paste"),iconCls:"paste",disabled:!a.actionPasteEnabled,
handler:function(){a.screenEditController.pasteItem.call(a.screenEditController)}});a.actionDelete=Ext.create("Ext.Action",{id:"deleteBtn",itemId:"deleteBtnItemID",overflowText:getText("common.btn.delete"),tooltip:getText("common.btn.delete"),text:getText("common.btn.delete"),iconCls:"delete",disabled:!a.actionDeleteEnabled,handler:function(){a.screenEditController.deleteItem.call(a.screenEditController)}});a.actionConfig=Ext.create("Ext.Action",{id:"configureBtn",itemId:"configureBtnItemID",overflowText:getText("common.btn.config"),
tooltip:getText("common.btn.config"),text:getText("common.btn.config"),iconCls:"btnConfig",disabled:!a.actionConfigEnabled,handler:function(){a.screenEditController.configItem.call(a.screenEditController)}});a.btnBack=Ext.create("Ext.Action",{id:"backBtn",itemId:"backBtnItemID",overflowText:getText("common.btn.done"),tooltip:getText("common.btn.done"),text:getText("common.btn.done"),iconCls:"btnBack",disabled:!1,handler:function(){a.screenEditController.back.call(a.screenEditController)}});a.actions=
[];null!=a.screenEditController.tabAction&&a.actions.push(a.actionNewTab);null!=a.screenEditController.tabAction&&a.actions.push(a.actionNewPanel);a.actions.push(a.actionCut);a.actions.push(a.actionCopy);a.actions.push(a.actionPaste);a.actions.push(a.actionDelete);a.useConfig&&a.actions.push(a.actionConfig);a.actions.push(a.btnBack)},getToolbar:function(){null==this.actions&&this.initToolbar();return this.actions},createPopup:function(){var a=new Ext.menu.Menu({items:[]}),b=[];null!=this.screenEditController.tabAction&&
this.actions.push(this.actionNewTab);null!=this.screenEditController.tabAction&&this.actions.push(this.actionNewPanel);!0==this.actionCopyEnabled&&b.push(this.actionCut);!0==this.actionCopyEnabled&&b.push(this.actionCopy);!0==this.actionPasteEnabled&&b.push(this.actionPaste);!0==this.actionDeleteEnabled&&b.push(this.actionDelete);!0==this.useConfig&&!0==this.actionConfigEnabled&&b.push(this.actionConfig);if(0==b.length)return null;for(var c=0;c<b.length;c++){var e=b[c],e={text:e.getText(),iconCls:e.getIconCls()+
"16",scope:e,tooltip:e.tooltip,handler:e.execute,itemId:e.itemId};a.add(e)}return a}});Ext.define("com.trackplus.screen.ItemEditPanelView",{extend:"com.trackplus.screen.PanelView",getPanelConfig:function(a,b,c){this.myComponentCls="screenDesignPanel";return{cls:"screenDesignPanel",margin:"0 0 5 0",border:!0,layout:{type:"table",columns:a.colsNo,tableAttrs:{style:{minWidth:"100%"}},trAttrs:{"class":"screenField-tr",style:{"vertical-align":"top"}}},defaults:{frame:!1,border:!1}}}});
Ext.define("com.trackplus.layout.ItemScreenEditLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,screenModel:null,screenEditFacade:null,constructor:function(a){var b=this;b.callParent(arguments);var c=b.initData,c=null!=c.backAction?c.backAction:"admin.action?selectedNodeID\x3dcustomForms\x26sectionSelected\x3dcustomizationSection";b.screenModel=com.trackplus.screen.createScreenModel(b.initData.screen);b.screenEditFacade=Ext.create("com.trackplus.screen.ScreenEditFacade",{screenModel:b.screenModel,
refreshTabUrl:"tab!reload.action",controllerCls:"com.trackplus.screen.ScreenEditController",urlFieldList:"screenTree!list.action",fieldsAsTree:!0,titleFieldList:getText("admin.customize.form.edit.lbl.fields"),useConfig:!1,panelViewCls:"com.trackplus.screen.ItemEditPanelView",screenAction:"screenEdit",screenUpdateAction:"updateScreenProperty",tabAction:"tab",tabUpdateAction:"updateTabProperty",panelAction:"panel",panelUpdateAction:"updatePanelProperty",fieldAction:"field",fieldUpdateAction:"updateFieldProperty",
messageDeletePanel:getText("admin.customize.form.edit.question.deletePanel"),messageDeleteTab:getText("admin.customize.form.edit.question.deleteTab"),messageDeleteField:getText("admin.customize.form.edit.question.deleteField"),messageCantDeleteScreen:getText("admin.customize.form.edit.message.cantDeleteScreen"),messageCantDeleteLastTab:getText("admin.customize.form.edit.message.cantDeleteLastTab"),backAction:c});b.onReady(function(){var a=b.screenEditFacade.getToolbar.call(b.screenEditFacade);b.borderLayoutController.setActiveToolbarActionList(a)})},
createCenterPanel:function(){return this.screenEditFacade.createScreenEditViewComponent.call(this.screenEditFacade)}});
Ext.define("com.aurel.trackplus.field.design.TypeRenderer",{ALIGN_TOP:0,ALIGN_BOTTOM:1,ALIGN_MIDDLE:2,ALIGN_LEFT:3,ALIGN_RIGHT:4,ALIGN_CENTER:5,ALIGN_TOP_STR:"top",ALIGN_BOTTOM_STR:"bottom",ALIGN_MIDDLE_STR:"middle",ALIGN_LEFT_STR:"left",ALIGN_RIGHT_STR:"right",ALIGN_CENTER_STR:"center",render:function(a){return Ext.create("Ext.form.Label",{})},getAlignStr:function(a){a=null;switch(a){case this.ALIGN_TOP:a=this.ALIGN_TOP_STR;break;case this.ALIGN_BOTTOM:a=this.ALIGN_BOTTOM_STR;break;case this.ALIGN_MIDDLE:a=
this.ALIGN_MIDDLE_STR;break;case this.ALIGN_LEFT:a=this.ALIGN_LEFT_STR;break;case this.ALIGN_RIGHT:a=this.ALIGN_RIGHT_STR;break;case this.ALIGN_CENTER:a=this.ALIGN_CENTER_STR}return a}});
Ext.define("com.aurel.trackplus.field.design.LabelTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){var b=a.label,c="abc";!0==a.hideLabel&&(c="abc("+a.label+")");return Ext.create("Ext.form.field.Display",{fieldLabel:b,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,value:c,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign})}});
Ext.define("com.aurel.trackplus.field.design.TextFieldTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.Text",{fieldLabel:a.label,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,editable:!1})}});
Ext.define("com.aurel.trackplus.field.design.TextAreaTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.Text",{fieldLabel:a.label,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,editable:!1})}});
Ext.define("com.aurel.trackplus.field.design.SynopsisTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.Text",{fieldLabel:a.label,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,editable:!1,width:500})}});
Ext.define("com.aurel.trackplus.field.design.DateTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.Picker",{fieldLabel:a.label,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,triggerCls:Ext.baseCSSPrefix+"form-date-trigger",editable:!1,initTrigger:function(){}})}});
Ext.define("com.aurel.trackplus.field.design.CheckboxTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.Checkbox",{fieldLabel:a.label,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,readOnly:!0})}});
Ext.define("com.aurel.trackplus.field.design.NumberTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.Number",{fieldLabel:a.label,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,editable:!1,initTrigger:function(){}})}});
Ext.define("com.aurel.trackplus.field.design.HtmlTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.HtmlEditor",{fieldLabel:a.label,hideLabel:a.hideLabel,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,editable:!1,readOnly:!0,height:100,style:{width:"100%",marginBottom:"5px"}})}});
Ext.define("com.aurel.trackplus.field.design.SelectTypeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",render:function(a){return Ext.create("Ext.form.field.Picker",{fieldLabel:a.label,hideLabel:a.hideLabel,editable:!1,labelAlign:a.labelHAlign,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+a.valueVAlign+" valueAlign-"+a.valueHAlign,triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",initTrigger:function(){}})}});
Ext.define("com.aurel.trackplus.field.design.CompositeRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",config:{parts:[]},render:function(a){var b=[],c={},e;for(e in a)c[e]=a[e];c.hideLabel=!0;for(e=0;e<this.parts.length;e++){var f=Ext.create(this.parts[e].extClassName,{});b.push(f.render(c))}return Ext.create("Ext.form.FieldContainer",{combineErrors:!0,fieldLabel:a.label,labelAlign:a.labelHAlign,hideLabel:a.hideLabel,cls:"labelVerticalAlign-"+a.labelVAlign+" valueVerticalAlign-"+
a.valueVAlign+" valueAlign-"+a.valueHAlign,labelStyle:{overflow:"hidden"},layout:{type:"column"},defaults:{hideLabel:!0,margin:"0 0 0 5"},style:{width:"100%"},items:b})}});Ext.define("com.aurel.trackplus.field.design.SelectParentChildRenderer",{extend:"com.aurel.trackplus.field.design.CompositeRenderer",parts:[{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"},{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"}]});
Ext.define("com.aurel.trackplus.field.design.SelectParentChildrenRenderer",{extend:"com.aurel.trackplus.field.design.TypeRenderer",parts:[{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"},{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"},{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"}]});
Ext.define("com.aurel.trackplus.field.design.SelectParentChildGrandchildRenderer",{extend:"com.aurel.trackplus.field.design.CompositeRenderer",parts:[{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"},{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"},{extClassName:"com.aurel.trackplus.field.design.SelectTypeRenderer"}]});
Ext.define("com.trackplus.layout.CardScreenEditLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,screenModel:null,screenEditFacade:null,constructor:function(a){var b=this;b.callParent(arguments);var c=b.initData,c=null!=c.backAction?c.backAction:"admin.action?selectedNodeID\x3dcustomForms\x26sectionSelected\x3dcustomizationSection";b.screenModel=com.trackplus.screen.createScreenModel(b.initData.screen);b.screenEditFacade=Ext.create("com.trackplus.screen.ScreenEditFacade",{screenModel:b.screenModel,
showOneTab:!0,refreshTabUrl:"tab!reload.action",controllerCls:"com.trackplus.screen.ScreenEditController",urlFieldList:"screenTree!listExtraFields.action",fieldsAsTree:!0,titleFieldList:getText("admin.customize.form.edit.lbl.fields"),useConfig:!1,panelViewCls:"com.trackplus.screen.ItemEditPanelView",screenAction:null,screenUpdateAction:null,tabAction:null,tabUpdateAction:null,panelAction:"cardPanel",panelUpdateAction:"updateCardPanelProperty",fieldAction:"cardField",fieldUpdateAction:"updateCardFieldProperty",
messageDeletePanel:getText("admin.customize.form.edit.question.deletePanel"),messageDeleteTab:getText("admin.customize.form.edit.question.deleteTab"),messageDeleteField:getText("admin.customize.form.edit.question.deleteField"),messageCantDeleteScreen:getText("admin.customize.form.edit.message.cantDeleteScreen"),messageCantDeleteLastTab:getText("admin.customize.form.edit.message.cantDeleteLastTab"),backAction:c});b.onReady(function(){var a=b.screenEditFacade.getToolbar.call(b.screenEditFacade);b.borderLayoutController.setActiveToolbarActionList(a)})},
createCenterPanel:function(){return this.screenEditFacade.createScreenEditViewComponent.call(this.screenEditFacade)}});
Ext.define("com.trackplus.item.PrintItemAction",{extend:"com.trackplus.item.ItemAction",config:{},initData:null,constructor:function(a){this.callParent(arguments);this.centerPanel=Ext.create("Ext.panel.Panel",{layout:"border",margin:"0 0 0 0",border:!1,bodyBorder:!1,cls:"printItem",items:this.createChildren()})},reExecute:function(){window.location.href="printItem.action?workItemID\x3d"+this.initData.workItemID},execute:function(a){this.initData=a;this.loadSuccess.call(this,a)},reload:function(a){this.reExecute()},
isVisibleAction:function(a){a=a.id;return a==com.trackplus.item.ToolbarItem.NAVIGATION_NEXT||a==com.trackplus.item.ToolbarItem.NAVIGATION_PREV?!1:!0},createToolbarAction:function(a){var b=this;return{overflowText:getText(a.labelKey),tooltip:getText(a.tooltipKey),iconCls:a.cssClass+"20",disabled:!1==a.condition,text:getText(a.labelKey),handler:function(c){b.executeToolbarAction.call(b,a)}}},updateTitle:function(a){},saveSuccess:function(a,b){null!=this.successHandler&&this.successHandler.call(null!=
this.scope?this.scope:this,b.result.data,this.successExtra)},saveFailure:function(a,b){},executeItemAction:function(a){a=Ext.create("com.trackplus.item.ItemActionDialog",{workItemID:this.workItemID,actionID:a.actionID,parentID:a.parentID,successHandler:this.successHandler,scope:this,modal:!0});a.execute.call(a)},clickOnChild:function(a,b){this.clickOnExtraItem(a,b)},clickOnLink:function(a,b){this.clickOnExtraItem(a,b)},clickOnParent:function(a,b){this.clickOnExtraItem(a,b)},clickOnExtraItem:function(a,
b){var c=Ext.create("com.trackplus.item.ItemActionDialog",{workItemID:a,actionID:-2,successHandler:null!=b?b.refreshChildren:this.refreshChildren,scope:null!=b?b:this,modal:!1});c.execute.call(c);c.addListener("clickOnChild",this.clickOnChild,this,c);c.addListener("clickOnLink",this.clickOnLink,this,c);c.addListener("clickOnParent",this.clickOnParent,this,c)}});
Ext.define("com.trackplus.layout.PrintItemLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){var b=this;b.callParent(arguments);var c=b.initData;null!=c.workItemID&&(b.printItemAction=Ext.create("com.trackplus.item.PrintItemAction",{workItemID:c.workItemID,successHandler:b.successHandler,actionID:-2,scope:b}),b.onReady(function(){b.printItemAction.execute.call(b.printItemAction,b.initData)}))},createCenterPanel:function(){return null==this.initData.workItemID?
Ext.create("Ext.Component",{cls:"errorDiv ulist",html:"\x3cul\x3e\x3cli\x3e"+this.initData.error+"\x3c/li\x3e\x3c/ul\x3e"}):this.printItemAction.centerPanel},successHandler:function(a){window.location.href="printItem.action?workItemID\x3d"+this.initData.workItemID},reload:function(){window.location.href="printItem.action?workItemID\x3d"+this.initData.workItemID}});
Ext.define("Ext.ux.form.MultiSelect",{extend:"Ext.form.FieldContainer",mixins:{bindable:"Ext.util.Bindable",field:"Ext.form.field.Field"},alternateClassName:"Ext.ux.Multiselect",alias:["widget.multiselectfield","widget.multiselect"],requires:["Ext.panel.Panel","Ext.view.BoundList","Ext.layout.container.Fit"],uses:["Ext.view.DragZone","Ext.view.DropZone"],layout:"anchor",ddReorder:!1,appendOnly:!1,displayField:"text",allowBlank:!0,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"This field is required",
minSelectionsText:"Minimum {0} item(s) required",maxSelectionsText:"Maximum {0} item(s) required",delimiter:",",dragText:"{0} Item{1}",ignoreSelectChange:0,initComponent:function(){this.bindStore(this.store,!0);this.store.autoCreated&&(this.valueField=this.displayField="field1",this.store.expanded||(this.displayField="field2"));Ext.isDefined(this.valueField)||(this.valueField=this.displayField);this.items=this.setupItems();this.callParent();this.initField();this.addEvents("drop")},setupItems:function(){this.boundList=
Ext.create("Ext.view.BoundList",Ext.apply({anchor:"none 100%",deferInitialRefresh:!1,border:1,multiSelect:!0,store:this.store,displayField:this.displayField,disabled:this.disabled},this.listConfig));this.boundList.getSelectionModel().on("selectionchange",this.onSelectChange,this);if(!this.title)return this.boundList;this.boundList.border=!1;return{border:!0,anchor:"none 100%",layout:"anchor",title:this.title,tbar:this.tbar,items:this.boundList}},onSelectChange:function(a,b){this.ignoreSelectChange||
this.setValue(b)},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},isEqual:function(a,b){var c=Ext.Array.from,e=0;a=c(a);b=c(b);c=a.length;if(c!==b.length)return!1;for(;e<c;e++)if(b[e]!==a[e])return!1;return!0},afterRender:function(){var a=this,b;a.callParent();a.selectOnRender&&(b=a.getRecordsForValue(a.value),b.length&&(++a.ignoreSelectChange,a.boundList.getSelectionModel().select(b),--a.ignoreSelectChange),delete a.toSelect);!a.ddReorder||a.dragGroup||a.dropGroup||
(a.dragGroup=a.dropGroup="MultiselectDD-"+Ext.id());if(a.draggable||a.dragGroup)a.dragZone=Ext.create("Ext.view.DragZone",{view:a.boundList,ddGroup:a.dragGroup,dragText:a.dragText});if(a.droppable||a.dropGroup)a.dropZone=Ext.create("Ext.view.DropZone",{view:a.boundList,ddGroup:a.dropGroup,handleNodeDrop:function(b,e,f){var g=this.view,h=g.getStore(),k=b.records;b.view.store.remove(k);b=h.indexOf(e);"after"===f&&b++;h.insert(b,k);g.getSelectionModel().select(k);a.fireEvent("drop",a,k)}})},isValid:function(){var a=
this.disabled;return this.forceValidation||!a?this.validateValue(this.value):a},validateValue:function(a){a=this.getErrors(a);var b=Ext.isEmpty(a);this.preventMark||(b?this.clearInvalid():this.markInvalid(a));return b},markInvalid:function(a){var b=this.getActiveError();this.setActiveErrors(Ext.Array.from(a));b!==this.getActiveError()&&this.updateLayout()},clearInvalid:function(){var a=this.hasActiveError();this.unsetActiveError();a&&this.updateLayout()},getSubmitData:function(){var a=null,b;this.disabled||
!this.submitValue||this.isFileUpload()||(b=this.getSubmitValue(),null!==b&&(a={},a[this.getName()]=b));return a},getSubmitValue:function(){var a=this.delimiter,b=this.getValue();return Ext.isString(a)?b.join(a):b},getValue:function(){return this.value||[]},getRecordsForValue:function(a){var b=[],c=this.store.getRange(),e=this.valueField,f=0,g=c.length,h,k,l;for(l=a.length;f<l;++f)for(k=0;k<g;++k)h=c[k],h.get(e)==a[f]&&b.push(h);return b},setupValue:function(a){var b=this.delimiter,c=this.valueField,
e=0,f;if(Ext.isDefined(a)){b&&Ext.isString(a)?a=a.split(b):Ext.isArray(a)||(a=[a]);for(b=a.length;e<b;++e)(f=a[e])&&f.isModel&&(a[e]=f.get(c));a=Ext.Array.unique(a)}else a=[];return a},setValue:function(a){var b=this.boundList.getSelectionModel(),c=this.store;if(c.getCount())a=this.setupValue(a),this.mixins.field.setValue.call(this,a),this.rendered?(++this.ignoreSelectChange,b.deselectAll(),a.length&&b.select(this.getRecordsForValue(a)),--this.ignoreSelectChange):this.selectOnRender=!0;else c.on({load:Ext.Function.bind(this.setValue,
this,[a]),single:!0})},clearValue:function(){this.setValue([])},onEnable:function(){var a=this.boundList;this.callParent();a&&a.enable()},onDisable:function(){var a=this.boundList;this.callParent();a&&a.disable()},getErrors:function(a){var b=Ext.String.format,c=[];a=Ext.Array.from(a||this.getValue());a=a.length;!this.allowBlank&&1>a&&c.push(this.blankText);a<this.minSelections&&c.push(b(this.minSelectionsText,this.minSelections));a>this.maxSelections&&c.push(b(this.maxSelectionsText,this.maxSelections));
return c},onDestroy:function(){this.bindStore(null);Ext.destroy(this.dragZone,this.dropZone);this.callParent()},onBindStore:function(a){var b=this.boundList;b&&b.bindStore(a)}});Ext.define("Ext.ux.layout.component.form.MultiSelect",{extend:"Ext.layout.component.field.Field",alias:["layout.multiselectfield"],type:"multiselectfield",defaultHeight:200,sizeBodyContents:function(a,b){Ext.isNumber(b)||(b=this.defaultHeight);this.owner.panel.setSize(a,b)}});Ext.define("Ext.ux.RowExpander",{extend:"Ext.grid.plugin.RowExpander"});
com.trackplus.admin.Filter=function(){};com.trackplus.admin.Filter.tqlFilterWindowWidth=500;com.trackplus.admin.Filter.tqlFilterWindowHeight=400;com.trackplus.admin.Filter.issueFilterWindowWidth=910;com.trackplus.admin.Filter.issueFilterWindowHeight=500;com.trackplus.admin.Filter.notifyFilterWindowWidth=900;com.trackplus.admin.Filter.notifyFilterWindowHeight=500;com.trackplus.admin.Filter.nameWidth=300;com.trackplus.admin.Filter.nameLabelWidth=80;com.trackplus.admin.Filter.menuLabelWidth=100;
com.trackplus.admin.Filter.styleFieldLabelWidth=100;com.trackplus.admin.Filter.styleFieldWidth=200;com.trackplus.admin.Filter.viewLabelWidth=100;com.trackplus.admin.Filter.viewFieldWidth=250;com.trackplus.admin.Filter.upperSelectColumns=4;com.trackplus.admin.Filter.multiSelectWidth=210;com.trackplus.admin.Filter.multipleTreePickerWidth=500;com.trackplus.admin.Filter.moreControlWidth=500;com.trackplus.admin.Filter.moreControlLabelWidth=150;com.trackplus.admin.Filter.matcherComboWidth=150;
com.trackplus.admin.Filter.fieldNameComboWidth=150;com.trackplus.admin.Filter.operationComboWidth=80;com.trackplus.admin.Filter.parenthesisComboWidth=50;com.trackplus.admin.Filter.fieldMomentComboWidth=70;com.trackplus.admin.Filter.executeInstantFilter=function(a,b){window.location.href=com.trackplus.TrackplusConfig.contextPath+"/itemNavigator.action"};
com.trackplus.admin.Filter.getTQLFilterItems=function(a){return[CWHF.createHiddenField("modifiable",{value:a}),CWHF.createTextField("common.lbl.name","label",{disabled:!a,allowBlank:!1,width:com.trackplus.admin.Filter.nameWidth,labelWidth:com.trackplus.admin.Filter.nameLabelWidth,msgTarget:"qtip"}),CWHF.createCombo("admin.customize.queryFilter.lbl.filterType","filterSubType",{disabled:!a,labelWidth:com.trackplus.admin.Filter.styleFieldLabelWidth},null,"filterTypesList"),CWHF.createCheckbox("admin.customize.queryFilter.lbl.menu",
"includeInMenu",{labelWidth:com.trackplus.admin.Filter.menuLabelWidth}),CWHF.createCombo("admin.customize.queryFilter.lbl.styleField","styleField",{labelWidth:com.trackplus.admin.Filter.styleFieldLabelWidth},null,"styleFieldsList"),CWHF.createCombo("admin.customize.queryFilter.lbl.view","viewID",{disabled:!a,labelWidth:com.trackplus.admin.Filter.viewLabelWidth,width:com.trackplus.admin.Filter.viewFieldWidth,data:data.viewList,value:data.viewID}),CWHF.createTextAreaField("admin.customize.queryFilter.lbl.filterExpression",
"tqlExpression",{disabled:!a,allowBlank:!1,labelWidth:com.trackplus.admin.Filter.styleFieldLabelWidth,height:200})]};
com.trackplus.admin.Filter.getTreeFilterItems=function(a,b){var c=[CWHF.createHiddenField("filterSubType",{value:1}),CWHF.createHiddenField("modifiable",{value:a})],e=[];b||(e=[CWHF.createTextField("common.lbl.name","label",{disabled:!a,allowBlank:!1,labelWidth:com.trackplus.admin.Filter.nameLabelWidth,width:com.trackplus.admin.Filter.nameWidth,msgTarget:"qtip"}),CWHF.createCheckbox("admin.customize.queryFilter.lbl.menu","includeInMenu",{labelWidth:com.trackplus.admin.Filter.menuLabelWidth,width:100})],
c.push(Ext.create("Ext.panel.Panel",{itemId:"generalFilterFields",defaults:{labelStyle:"overflow: hidden;",margin:"0 0 5 0"},layout:{type:"table",columns:4},border:!1,items:e})));return c};com.trackplus.admin.Filter.getTreeFilterParameterItems=function(){return[]};
com.trackplus.admin.Filter.getNotifyFilterItems=function(a){return[CWHF.createTextField("common.lbl.name","label",{disabled:!a,allowBlank:!1,labelWidth:com.trackplus.admin.Filter.nameLabelWidth,width:com.trackplus.admin.Filter.nameWidth,msgTarget:"qtip"}),{xtype:"hidden",name:"filterSubType",value:2},Ext.create("Ext.panel.Panel",{itemId:"fieldExpressionsInTree",border:!1})]};
com.trackplus.admin.Filter.preSubmitProcess=function(a,b){null!=b&&1<b.items.getCount()&&(null==a&&(a={}),b.items.each(function(b,e,f){0<e&&(a["fieldExpressionOrderMap["+e+"]"]=b.index)}));return a};com.trackplus.admin.Filter.preSubmitProcessNotifyFilter=function(a,b){var c=b.getComponent("fieldExpressionsInTree");return com.trackplus.admin.Filter.preSubmitProcess(a,c)};
com.trackplus.admin.Filter.preSubmitProcessIssueFilter=function(a,b){var c=b.getComponent("moreFieldSet");return null!=c?(c=c.getComponent("fieldExpressionsInTree"),com.trackplus.admin.Filter.preSubmitProcess(a,c)):a};
com.trackplus.admin.Filter.addFieldExpression=function(a,b,c,e,f){return Ext.create("Ext.Button",{text:getText("common.btn.add"),scope:a,handler:function(g){g.setDisabled(!0);var h={index:a.indexMax++,issueFilter:a.issueFilter,instant:a.instant};if(null!=c){var k=c.getComponent("fieldMap["+c.index+"]");null!=k&&(h.fieldID=k.getValue())}Ext.Ajax.request({url:"fieldExpression!addField.action",params:h,scope:a,disableCaching:!0,success:function(h){var k=1,n=!1,p=null;if(null!=c)for(var q=1;q<b.items.getCount();q++){if(b.items.getAt(q)==
c){var k=q+1,t=c.getComponent("operationMap["+c.index+"]");null!=t&&(p=t.getValue())}}else n=!0,nextExpressionPanel=b.items.getAt(1),null!=nextExpressionPanel&&(t=nextExpressionPanel.getComponent("operationMap["+nextExpressionPanel.index+"]"),null!=t&&(t.setVisible(!0),2<b.items.getCount()&&(nextNextExpressionPanel=b.items.getAt(2),null!=nextNextExpressionPanel&&(q=nextNextExpressionPanel.getComponent("operationMap["+nextNextExpressionPanel.index+"]"),null!=q&&t.setValue(q.getValue())))));h=Ext.decode(h.responseText);
null!=p&&(h.operation=p);n=com.trackplus.admin.Filter.createFieldExpressionInTreePanel(a,b,h,!0,n,e,f);b.insert(k,n);g.setDisabled(!1)},failure:function(b){g.setDisabled(!1);Ext.MessageBox.alert(a.failureTitle,b.responseText)},method:"POST"})}})};
com.trackplus.admin.Filter.deleteFieldExpression=function(a,b,c){return Ext.create("Ext.Button",{text:getText("common.btn.delete"),scope:a,handler:function(a){null!=c&&(c==b.items.getAt(1)&&2<b.items.getCount()&&(nextExpressionPanel=b.items.getAt(2),null!=nextExpressionPanel&&(operationControl=nextExpressionPanel.getComponent("operationMap["+nextExpressionPanel.index+"]"),null!=operationControl&&operationControl.setVisible(!1))),b.remove(c,!0))}})};
com.trackplus.admin.Filter.postLoadProcessTQLFilter=function(a,b){var c=b.getComponent("filterTypesList");c.store.loadData(a.filterTypesList);c.setValue(a.filterSubType);c=b.getComponent("styleFieldsList");c.store.loadData(a.styleFieldsList);c.setValue(a.styleField)};
com.trackplus.admin.Filter.refreshReleaseData=function(a,b,c,e){a=e.projectIDs;e.hiddenShowClosed.setValue(b);var f=e.releaseTree,g=null;null!=f&&(g=f.getValue());Ext.Ajax.request({url:"releasePicker.action",params:{withParameter:!this.instant,projectIDs:a,closedFlag:b,useChecked:!0,projectIsSelectable:!1},scope:this,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);f.updateData(a);f.setValue(g)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})};
com.trackplus.admin.Filter.projectOrItemTypeChange=function(a,b,c,e){var f=e.panel;a=e.withParameter;var g=e.paramSetting,h=e.projectChange;c=e.upperSelectFields.join();var k=null;b=f.getComponent("selectId1");null!=b&&(b=b.getValue(),null!=b&&(k=b));b=null;var l=f.getComponent("selectId2");null!=l&&(l=l.getValue(),null!=l&&(b=l));l=f.getComponent("panel9");f=!1;null!=l&&(l=l.getComponent("showClosedReleases"),null!=l&&(f=l.getValue()));Ext.Ajax.request({url:"filterUpperRefresh.action",params:{upperSelectFields:c,
instant:!a,showClosedReleases:f,projectIDs:k,itemTypeIDs:b,projectChange:h},scope:this,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);com.trackplus.admin.Filter.reloadUpperSelects(e.panel,a,g,!1,h)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})};
com.trackplus.admin.Filter.reloadUpperSelects=function(a,b,c,e,f){null!=b.selectFields&&Ext.Array.forEach(b.selectFields,function(b){var h=null,k=b.fieldID,l=null==f||f||2!=k;if(c||9!=k&&-1001!=k)h=a.getComponent("selectId"+k);else{var m=a.getComponent("panel"+k);null!=m&&(h=m.getComponent("selectId"+k))}null!=h&&(m=h.getValue(),b.isTree?h.updateData(b["dataSource"+k]):l&&h.store.loadData(b["dataSource"+k]),e?h.clearSelection():l&&h.setValue(m))});null!=b.missingSelectFields&&Ext.Array.forEach(b.missingSelectFields,
function(b){var e=null;b=b.id;if(c||9!=b&&-1001!=b)e=a.getComponent("selectId"+b);else{var f=a.getComponent("panel"+b);null!=f&&(e=f.getComponent("selectId"+b))}null!=e&&e.removeHandler()});a.doLayout()};com.trackplus.admin.Filter.clearFilter=function(a,b){var c=a.items[0].up("panel");com.trackplus.admin.Filter.clearTreeFilter(c,b.data)};
com.trackplus.admin.Filter.clearTreeFilter=function(a,b){var c=a.getComponent("upperSelectsFieldSet");com.trackplus.admin.Filter.reloadUpperSelects(c,b,!1,!0);c=a.getComponent("moreFieldSet");if(null!=c){var e=c.getComponent("filterUpperTO.keyword");null!=e&&e.setValue(null);e=c.getComponent("filterUpperTO.linkTypeFilterSuperset");null!=e&&e.setValue(null);e=c.getComponent("filterUpperTO.archived");null!=e&&e.setValue(0);e=c.getComponent("filterUpperTO.deleted");null!=e&&e.setValue(0);e=c.getComponent("fieldExpressionsSimple");
null!=e&&e.items.each(function(a,b,c){b=a.getComponent(0);null!=b&&b.setValue(-1);b=a.getComponent(1);null!=b&&a.remove(b)});var f=c.getComponent("fieldExpressionsInTree");null!=f&&f.items.each(function(a,b,c){0<b&&f.remove(a)})}};
com.trackplus.admin.Filter.addNewSelection=function(a,b){var c=this.upperSelectsPanel,e=this.upperSelectFields,f=this.projectTree,g=this.itemTypeList,h=this.instant,k=this.addSelectionFieldSplitter,l=parseInt(a.id);this.upperSelectFields.push(l);var m=null;null!=f&&(m=f.getValue());var n=null;null!=g&&(n=g.getValue());Ext.Ajax.request({url:"filterUpperRefresh!addSelectionField.action",params:{fieldID:l,projectIDs:m,itemTypeIDs:n,upperSelectFields:this.upperSelectFields.join(),instant:this.instant},
disableCaching:!0,scope:this,success:function(a){a=Ext.decode(a.responseText);var b=a.selectField,n=a.missingSelectFields;1==l?(selectControl=com.trackplus.admin.Filter.createProjectTree(e,c,h,1,b,!0,k),selectControl.addListener("change",com.trackplus.admin.Filter.projectOrItemTypeChange,this,{upperSelectFields:e,panel:c,withParameter:!this.instant,paramSetting:!1,projectChange:!0})):9==l?selectControl=com.trackplus.admin.Filter.createReleaseTree(e,c,f,h,b,9,m,!0,a.showClosedReleasesName,a.showClosedReleases,
a.releaseTypeSelectorIsIncluded,a.releaseTypeSelectorName,a.releaseTypeSelector,a.releaseTypeSelectorList,k):-1001==l?selectControl=com.trackplus.admin.Filter.createWatcherList(e,c,f,h,b,-1001,!0,a.watcherSelectorName,a.watcherSelector,a.watcherSelectorList,k):b.isTree?selectControl=CWHF.createMultipleTreePicker(b["label"+l],b["name"+l],b["dataSource"+l],b["value"+l],{itemId:"selectId"+l,labelIsLocalized:!0,pickerWidth:com.trackplus.admin.Filter.multipleTreePickerWidth,removeHandler:function(){this.setDisabled(!0);
this.ownerCt.remove(this);com.trackplus.admin.Filter.updateAfterRemove(e,c,f,g,h,l,k)}}):(selectControl=CWHF.createMultipleSelectPicker(b["label"+l],b["name"+l],b["dataSource"+l],b["value"+l],{itemId:"selectId"+l,labelIsLocalized:!0,iconUrlPrefix:b.iconUrlPrefix,useIconCls:b.useIconCls,removeHandler:function(){this.setDisabled(!0);this.ownerCt.remove(this);com.trackplus.admin.Filter.updateAfterRemove(e,c,f,g,h,l,k)}}),2==l&&selectControl.addListener("change",com.trackplus.admin.Filter.projectOrItemTypeChange,
this,{upperSelectFields:e,panel:c,withParameter:!this.instant,paramSetting:!1,projectChange:!1}));c.insert(c.items.getCount()-1,selectControl);a=com.trackplus.admin.Filter.getMissingSelectionFieldMenues(k,n,c,e,f,g,h);k.menu.removeAll(!0);null==a||0==a.length?k.setVisible(!1):k.menu.add(a)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}})};
com.trackplus.admin.Filter.updateAfterRemove=function(a,b,c,e,f,g,h){var k=a.indexOf(g);-1!=k&&a.splice(k,1);Ext.Ajax.request({url:"filterUpperRefresh!removeSelectionField.action",params:{upperSelectFields:a},disableCaching:!0,scope:this,success:function(k){k=Ext.decode(k.responseText);h.isVisible()||(h.setVisible(!0),b.doLayout());k=com.trackplus.admin.Filter.getMissingSelectionFieldMenues(h,k.missingSelectFields,b,a,c,e,f);h.menu.removeAll(!0);h.menu.add(k);if(1==g||2==g)k={panel:b,withParameter:!f,
paramSetting:!1,upperSelectFields:a},k.projectChange=1==g,com.trackplus.admin.Filter.projectOrItemTypeChange(null,null,null,k)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}})};
com.trackplus.admin.Filter.createProjectTree=function(a,b,c,e,f,g,h){return CWHF.createMultipleTreePicker(f["label"+e],f["name"+e],f["dataSource"+e],f["value"+e],{itemId:"selectId"+e,labelIsLocalized:!0,disabled:!g,pickerWidth:com.trackplus.admin.Filter.multipleTreePickerWidth,removeHandler:function(){this.setDisabled(!0);this.ownerCt.remove(this);com.trackplus.admin.Filter.updateAfterRemove(a,b,this,null,c,e,h)}})};
com.trackplus.admin.Filter.createReleaseTree=function(a,b,c,e,f,g,h,k,l,m,n,p,q,t,r){var v=CWHF.createHiddenField(l,{value:m});l=CWHF.createCheckbox("admin.customize.queryFilter.lbl.showClosedReleases",l,{itemId:"showClosedReleases",disabled:!k,value:m,labelAlign:"left",labelWidth:com.trackplus.admin.Filter.multiSelectWidth-50,width:com.trackplus.admin.Filter.multiSelectWidth,border:!0,cls:"extensionSelect1"});var u=null;m=null;n?(m=CWHF.createHiddenField(p,{value:q}),n=CWHF.getRadioButtonItems(t,
p,"id","label",q,!k,!0),t=CWHF.getRadioGroup("releaseTypeSelectorList",null,com.trackplus.admin.Filter.multiSelectWidth,n,{disabled:!k,border:!0,cls:"extensionSelect"},{change:{fn:function(a){a=CWHF.getSelectedRadioButtonValue(a);this.setValue(a)},scope:m}}),u=Ext.create("Ext.panel.Panel",{items:[l,t]})):u=l;f=CWHF.createMultipleTreePicker(f["label"+g],f["name"+g],f["dataSource"+g],f["value"+g],{itemId:"selectId"+g,labelIsLocalized:!0,disabled:!k,extraComponent:u,pickerWidth:com.trackplus.admin.Filter.multipleTreePickerWidth,
removeHandler:function(){this.setDisabled(!0);this.ownerCt.ownerCt.remove(this.ownerCt);com.trackplus.admin.Filter.updateAfterRemove(a,b,c,null,e,g,r)}});l.addListener("change",com.trackplus.admin.Filter.refreshReleaseData,this,{projectIDs:h,releaseTree:f,hiddenShowClosed:v});return Ext.create("Ext.panel.Panel",{border:!1,height:22,itemId:"panel"+g,items:[f,v,m]})};
com.trackplus.admin.Filter.createWatcherList=function(a,b,c,e,f,g,h,k,l,m,n){var p=CWHF.createHiddenField(k,{value:l});k=CWHF.getRadioButtonItems(m,k,"id","label",l,!h,!0);m=CWHF.getRadioGroup("watcherSelectorList1",null,com.trackplus.admin.Filter.multiSelectWidth,k,{disabled:!h,border:!0,cls:"extensionSelect"},{change:{fn:function(a){a=CWHF.getSelectedRadioButtonValue(a);this.setValue(a)},scope:p}});f=CWHF.createMultipleSelectPicker(f["label"+g],f["name"+g],f["dataSource"+g],f["value"+g],{itemId:"selectId"+
g,labelIsLocalized:!0,useIconCls:f.useIconCls,disabled:!h,extraComponent:m,removeHandler:function(){this.setDisabled(!0);this.ownerCt.ownerCt.remove(this.ownerCt);com.trackplus.admin.Filter.updateAfterRemove(a,b,c,null,e,g,n)}});return Ext.create("Ext.panel.Panel",{border:!1,height:22,itemId:"panel"+g,items:[f,p]})};
com.trackplus.admin.Filter.getMissingSelectionFieldMenues=function(a,b,c,e,f,g,h){var k=[];if(null!=b)for(var l=0;l<b.length;l++){var m=b[l];k.push({text:m.text,id:m.id.toString(),iconCls:m.iconCls,handler:com.trackplus.admin.Filter.addNewSelection,scope:{addSelectionFieldSplitter:a,upperSelectsPanel:c,upperSelectFields:e,projectTree:f,itemTypeList:g,instant:h}})}return k};
com.trackplus.admin.Filter.postLoadProcessTreeFilter=function(a,b){var c=a.modifiable,e=a.selectColumnCount;null==e&&(e=com.trackplus.admin.Filter.upperSelectColumns);var f=this.instant;null==f&&(f=!1);var g=this.renderPath;null==g&&(g=!1);var h=b.getComponent("generalFilterFields");null!=h&&(h.add(CWHF.createCombo("admin.customize.queryFilter.lbl.styleField","styleField",{labelWidth:com.trackplus.admin.Filter.styleFieldLabelWidth,width:com.trackplus.admin.Filter.styleFieldWidth,data:a.styleFieldsList,
value:a.styleField})),h.add(CWHF.createCombo("admin.customize.queryFilter.lbl.view","viewID",{labelWidth:com.trackplus.admin.Filter.viewLabelWidth,width:com.trackplus.admin.Filter.viewFieldWidth,disabled:!c,idType:"string",data:a.viewList,value:a.viewID})),g&&h.add(CWHF.createSingleTreePicker("common.lbl.path","node",a.pathNodes,null,{labelWidth:com.trackplus.admin.Filter.nameLabelWidth,width:com.trackplus.admin.Filter.nameWidth,allowBlank:!1})));this.upperSelectFields=[];var k=Ext.create("Ext.form.Panel",
{border:!1,itemId:"upperSelectsFieldSet",padding:"5 5 10 10",layout:{type:"table",columns:e,tdAttrs:{style:{"vertical-align":"top",paddingBottom:"5px"}}},items:[]});b.add(k);var e=a.missingSelectFields,l=Ext.create("Ext.button.Split",{text:getText("admin.customize.queryFilter.opt.addSelectField"),overflowText:getText("admin.customize.queryFilter.opt.addSelectField"),tooltip:getText("admin.customize.queryFilter.opt.addSelectField.tt"),iconCls:"addCriteria",menu:{items:[]}}),m=null,n=null;if(null!=
k){var p=[],q=null;Ext.Array.forEach(a.selectFields,function(b,e){var g=b.fieldID,h;this.upperSelectFields.push(g);if(1==g)q=b["value"+g],m=com.trackplus.admin.Filter.createProjectTree(this.upperSelectFields,k,f,g,b,c,l),m.addListener("change",com.trackplus.admin.Filter.projectOrItemTypeChange,this,{upperSelectFields:this.upperSelectFields,panel:k,withParameter:!f,paramSetting:!1,projectChange:!0}),h=m;else if(9==g)h=com.trackplus.admin.Filter.createReleaseTree(this.upperSelectFields,k,m,f,b,g,q,
c,a.showClosedReleasesName,a.showClosedReleases,a.releaseTypeSelectorIsIncluded,a.releaseTypeSelectorName,a.releaseTypeSelector,a.releaseTypeSelectorList,l);else if(-1001==g)h=com.trackplus.admin.Filter.createWatcherList(this.upperSelectFields,k,m,f,b,g,c,a.watcherSelectorName,a.watcherSelector,a.watcherSelectorList,l);else{var s=this.upperSelectFields;b.isTree?h=CWHF.createMultipleTreePicker(b["label"+g],b["name"+g],b["dataSource"+g],b["value"+g],{itemId:"selectId"+g,disabled:!c,labelIsLocalized:!0,
pickerWidth:com.trackplus.admin.Filter.multipleTreePickerWidth,removeHandler:function(){this.setDisabled(!0);this.ownerCt.remove(this);com.trackplus.admin.Filter.updateAfterRemove(s,k,m,n,f,g,l)}}):(h=CWHF.createMultipleSelectPicker(b["label"+g],b["name"+g],b["dataSource"+g],b["value"+g],{itemId:"selectId"+g,disabled:!c,labelIsLocalized:!0,useIconCls:b.useIconCls,iconUrlPrefix:b.iconUrlPrefix,removeHandler:function(){this.setDisabled(!0);this.ownerCt.remove(this);com.trackplus.admin.Filter.updateAfterRemove(s,
k,m,n,f,g,l)}}),2==g&&(n=h,n.addListener("change",com.trackplus.admin.Filter.projectOrItemTypeChange,this,{upperSelectFields:this.upperSelectFields,panel:k,withParameter:!f,paramSetting:!1,projectChange:!1})))}p.push(h)},this);c&&(null==e&&l.setVisible(!1),p.push(l),e=com.trackplus.admin.Filter.getMissingSelectionFieldMenues(l,e,k,this.upperSelectFields,m,n,f),l.menu.add(e));k.add(p);k.doLayout()}e=null!=a.fieldsExpressionsInTree;g=null!=a.keyword&&""!=a.keyword||null!=a.linkTypeFilterSuperset&&""!=
a.linkTypeFilterSuperset||null!=a.archived&&0!=a.archived||null!=a.deleted&&0!=a.deleted||a.hasSimpleFieldExpressions||e;g=Ext.create("Ext.form.FieldSet",{xtype:"fieldset",itemId:"moreFieldSet",border:"1 0 0 0",title:getText("admin.customize.queryFilter.fieldset.moreFields"),collapsible:!0,collapsed:!g,layout:"anchor",items:[]});b.add(g);g.add(Ext.create("Ext.panel.Panel",{itemId:"fieldExpressionsSimple",padding:"0 0 5 0",border:!1}));h=a.fieldsExpressionsSimple;null!=h&&com.trackplus.admin.Filter.populateFieldExpressionsSimplePanel(this,
g.getComponent("fieldExpressionsSimple"),h,c,!0,{projectTree:m,itemTypeList:n});h=[];a.keywordIsIncluded&&h.push(CWHF.createTextField("admin.customize.queryFilter.lbl.keyword",a.keywordName,{disabled:!c,labelWidth:com.trackplus.admin.Filter.moreControlLabelWidth,width:com.trackplus.admin.Filter.moreControlWidth,value:a.keyword}));h.push(CWHF.createCombo("admin.customize.queryFilter.lbl.linkTypeFilterSuperset",a.linkTypeFilterSupersetName,{disabled:!c,labelWidth:com.trackplus.admin.Filter.moreControlLabelWidth,
width:com.trackplus.admin.Filter.moreControlWidth,data:a.linkTypeFilterSupersetList,value:a.linkTypeFilterSuperset,idType:"string"}));a.archivedDeletedIsIncluded&&(h.push(CWHF.createCombo("admin.customize.queryFilter.lbl.archived",a.archivedName,{disabled:!c,labelWidth:com.trackplus.admin.Filter.moreControlLabelWidth,width:com.trackplus.admin.Filter.moreControlWidth,data:a.archivedList,value:a.archived})),h.push(CWHF.createCombo("admin.customize.queryFilter.lbl.deleted",a.deletedName,{disabled:!c,
labelWidth:com.trackplus.admin.Filter.moreControlLabelWidth,width:com.trackplus.admin.Filter.moreControlWidth,data:a.deletedList,value:a.deleted})));g.add(h);if(c||e)e=Ext.create("Ext.panel.Panel",{itemId:"fieldExpressionsInTree",border:!1}),g.add(e),com.trackplus.admin.Filter.populateFieldExpressionsInTreePanel(this,e,a.fieldsExpressionsInTree,c,m,n)};
com.trackplus.admin.Filter.postLoadProcessTreeFilterParameters=function(a,b){this.upperSelectFields=[];var c=null,e=null,f=a.originalProjects,g=a.originalItemTypes;if(null!=a.selectFields){var h=Ext.create("Ext.panel.Panel",{itemId:"upperSelectsPanel",layout:{type:"table",columns:4,tdAttrs:{style:{"vertical-align":"top",paddingBottom:"5px"}}},border:!1,items:[]});b.add(h);var k=[];Ext.Array.forEach(a.selectFields,function(a){var b=a.fieldID,g=a["label"+b];1==b?(c=selectControl=CWHF.createMultipleTreePicker(g,
a["name"+b],a["dataSource"+b],f,{itemId:"selectId"+b,labelIsLocalized:!0,useRemoveBtn:!1}),selectControl.addListener("change",com.trackplus.admin.Filter.projectOrItemTypeChange,this,{upperSelectFields:this.upperSelectFields,panel:h,withParameter:!1,paramSetting:!0,projectChange:!0})):(this.upperSelectFields.push(b),9==b?selectControl=CWHF.createMultipleTreePicker(g,a["name"+b],a["dataSource"+b],a["value"+b],{itemId:"selectId"+b,labelIsLocalized:!0,useRemoveBtn:!1}):a.isTree?selectControl=CWHF.createMultipleTreePicker(g,
a["name"+b],a["dataSource"+b],a["value"+b],{itemId:"selectId"+b,labelIsLocalized:!0,pickerWidth:com.trackplus.admin.Filter.multipleTreePickerWidth,useRemoveBtn:!1}):(selectControl=CWHF.createMultipleSelectPicker(g,a["name"+b],a["dataSource"+b],a["value"+b],{itemId:"selectId"+b,labelIsLocalized:!0,useIconCls:a.useIconCls,iconUrlPrefix:a.iconUrlPrefix,useRemoveBtn:!1}),2==b&&(e=selectControl,selectControl.addListener("change",com.trackplus.admin.Filter.projectOrItemTypeChange,this,{upperSelectFields:this.upperSelectFields,
panel:h,withParameter:!1,paramSetting:!0,projectChange:!1}))));k.push(selectControl)},this);0<k.length&&h.add(k)}var l=null;null==c&&(l=f);var m=null;null==e&&(m=g);g=a.fieldsExpressionsSimple;if(null!=g){var n=Ext.create("Ext.panel.Panel",{itemId:"fieldExpressionsSimple",border:!1,items:[]});b.add(n);com.trackplus.admin.Filter.populateFieldExpressionsSimplePanel(this,n,g,!0,!0,{projectTree:c,itemTypeList:e,selectedProjects:l,selectedItemTypes:m})}g=a.fieldsExpressionsInTree;n=null;null!=g&&(n=Ext.create("Ext.panel.Panel",
{itemId:"fieldExpressionsInTree",border:!1,items:[]}),b.add(n));com.trackplus.admin.Filter.populateFieldExpressionsSimplePanel(this,n,g,!0,!1,{projectTree:c,itemTypeList:e,selectedProjects:l,selectedItemTypes:m})};com.trackplus.admin.Filter.postLoadProcessNotifyFilter=function(a,b){com.trackplus.admin.Filter.populateFieldExpressionsInTreePanel(this,b.getComponent("fieldExpressionsInTree"),a.fieldsExpressionsInTree,a.modifiable)};
com.trackplus.admin.Filter.populateFieldExpressionsSimplePanel=function(a,b,c,e,f,g){if(null!=b&&null!=c){var h=[];Ext.Array.forEach(c,function(b){b=com.trackplus.admin.Filter.createFieldExpressionSimplePanel(a,b,e,f,g);h.push(b)},a);b.add(h)}};
com.trackplus.admin.Filter.createFieldExpressionSimplePanel=function(a,b,c,e,f){var g=Ext.create("Ext.panel.Panel",{border:!1,defaults:{margin:"4 4 0 0"},layout:{type:"hbox"}});c=CWHF.createCombo(b.fieldLabel,b.matcherName,{disabled:!c,width:com.trackplus.admin.Filter.matcherComboWidth+200,labelWidth:com.trackplus.admin.Filter.moreControlLabelWidth,data:b.matcherList,value:b.matcher,labelIsLocalized:!0},{select:{fn:com.trackplus.admin.Filter.selectMatcher,scope:a,panel:g,fieldExpression:b,contextFields:f}});
g.add(c);com.trackplus.admin.Filter.addValuePart(a,b.valueRenderer,b.jsonConfig,b,g,c,null,f);e||g.add(CWHF.createHiddenField("fieldMap["+b.index+"]",{value:b.field}));return g};
com.trackplus.admin.Filter.populateFieldExpressionsInTreePanel=function(a,b,c,e,f,g){if(null!=b&&(e&&b.add(com.trackplus.admin.Filter.addFieldExpression(a,b,null,f,g)),null!=c)){var h=[];a.indexMax=0;Ext.Array.forEach(c,function(c){c=com.trackplus.admin.Filter.createFieldExpressionInTreePanel(a,b,c,e,0==a.indexMax,f,g);h.push(c);a.indexMax++},a);b.add(h)}};
com.trackplus.admin.Filter.createFieldExpressionInTreePanel=function(a,b,c,e,f,g,h){var k=Ext.create("Ext.panel.Panel",{border:!1,itemId:"filterExpressionInTreePanel"+c.index,defaults:{margin:"4 4 0 0"},layout:{type:"hbox"}});k.index=c.index;k.add(CWHF.createCombo(null,c.operationsName,{disabled:!e,width:com.trackplus.admin.Filter.operationComboWidth,data:c.operationsList,value:c.operation,hidden:f},null,c.operationsName));k.add(CWHF.createCombo(null,c.parenthesisOpenName,{disabled:!e,includeEmpty:!0,
width:com.trackplus.admin.Filter.parenthesisComboWidth,data:c.parenthesisOpenList,value:c.parenthesisOpen},null,c.parenthesisOpenName));c.withFieldMoment&&k.add(CWHF.createCombo(null,c.fieldMomentName,{disabled:!e,width:com.trackplus.admin.Filter.fieldMomentComboWidth,data:c.fieldMomentList,value:c.fieldMoment},null,c.fieldMomentName));f={projectTree:g,itemTypeList:h};k.add(CWHF.createCombo(null,c.fieldName,{disabled:!e,width:com.trackplus.admin.Filter.fieldNameComboWidth,data:c.fieldList,value:c.field},
{select:{fn:com.trackplus.admin.Filter.selectField,scope:a,panel:k,fieldExpression:c,contextFields:f}},c.fieldName));var l=CWHF.createCombo(null,c.matcherName,{disabled:!e,width:com.trackplus.admin.Filter.matcherComboWidth,data:c.matcherList,value:c.matcher},{select:{fn:com.trackplus.admin.Filter.selectMatcher,scope:a,panel:k,fieldExpression:c,contextFields:f}},c.matcherName);k.add(l);com.trackplus.admin.Filter.addValuePart(a,c.valueRenderer,c.jsonConfig,c,k,l,null,f);k.add(CWHF.createCombo(null,
c.parenthesisClosedName,{disabled:!e,includeEmpty:!0,width:com.trackplus.admin.Filter.parenthesisComboWidth,data:c.parenthesisClosedList,value:c.parenthesisClosed},null,c.parenthesisClosedName));e&&(k.add(com.trackplus.admin.Filter.addFieldExpression(a,b,k,g,h)),k.add(com.trackplus.admin.Filter.deleteFieldExpression(a,b,k)));return k};
com.trackplus.admin.Filter.selectMatcher=function(a,b,c){b=null;var e=c.fieldExpression.fieldName;null!=e?(e=c.panel.getComponent(e),null!=e&&(b=e.getValue())):b=c.fieldExpression.field;var f=c.panel.getComponent(c.fieldExpression.valueName),e=null;null!=f&&(e=f.getStringValue());var g=c.matcherCombo,h,k;null!=g?(h=g.getValue(),k=g):(h=a.getValue(),k=a);g=c.fieldExpression.index;a={index:g,fieldID:b,matcherID:h,stringValue:e,issueFilter:this.issueFilter,instant:this.instant};null!=g&&(a.inTree=!0);
var l=c.contextFields,g=h=e=b=null;null!=l&&(b=l.projectTree,e=l.selectedProjects,h=l.itemTypeList,g=l.selectedItemTypes);null!=b?a.projectIDs=b.getValue():null!=e&&(a.projectIDs=e);null!=h?a.itemTypeIDs=h.getValue():null!=g&&(a.itemTypeIDs=g);Ext.Ajax.request({url:"fieldExpression!selectMatcher.action",params:a,scope:this,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);null!=f&&c.panel.remove(f);if(a.needMatcherValue&&null!=a.valueRenderer){for(var b=5,e=0;e<c.panel.items.getCount();e++){var g=
c.panel.items.getAt(e);k==g&&(b=e+1)}c.fieldExpression.needMatcherValue=a.needMatcherValue;c.fieldExpression.valueRenderer=a.valueRenderer;com.trackplus.admin.Filter.addValuePart(this,a.valueRenderer,a.jsonConfig,c.fieldExpression,c.panel,k,b,l)}},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})};
com.trackplus.admin.Filter.selectField=function(a,b,c){var e=c.fieldExpression.matcherName,f=b=null;null!=e&&(f=c.panel.getComponent(e),null!=f&&(b=f.getValue()));var e=c.fieldExpression.valueName,g=null;null!=e&&(g=c.panel.getComponent(e));params={index:c.fieldExpression.index,fieldID:a.getValue(),matcherID:b,issueFilter:this.issueFilter,instant:this.instant};var h=c.contextFields;null!=h&&(a=h.projectTree,null!=a&&(params.projectIDs=a.getValue()),a=h.itemTypeList,null!=a&&(params.itemTypeIDs=a.getValue()));
Ext.Ajax.request({url:"fieldExpression!selectField.action",params:params,scope:this,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);null!=f&&(f.store.loadData(a.matcherList),f.setValue(a.matcher));null!=g&&c.panel.remove(g);if(a.needMatcherValue&&null!=a.valueRenderer){for(var b=5,e=0;e<c.panel.items.getCount();e++){var n=c.panel.items.getAt(e);f==n&&(b=e+1)}c.fieldExpression.needMatcherValue=a.needMatcherValue;c.fieldExpression.valueRenderer=a.valueRenderer;com.trackplus.admin.Filter.addValuePart(this,
a.valueRenderer,a.jsonConfig,c.fieldExpression,c.panel,f,b,h)}},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})};
com.trackplus.admin.Filter.addValuePart=function(a,b,c,e,f,g,h,k){e.needMatcherValue&&null!=e.valueRenderer&&""!=e.valueRenderer&&null!=c&&(c.scope=a,c.selectHandler=com.trackplus.admin.Filter.selectMatcher,c.expressionPanel=f,c.fieldExpression=e,c.matcherCombo=g,null!=k&&(c.contextFields=k),null==h?f.add(Ext.create(b,{jsonData:c})):f.insert(h,Ext.create(b,{jsonData:c})))};
com.trackplus.admin.Filter.replacePostDataProcess=function(a,b){b.getComponent("replacementWarning").setText(a.replacementWarning,!1);b.getComponent("replacementID").labelEl.dom.innerHTML=a.replacementListLabel};
com.trackplus.admin.Filter.executeFilter=function(a,b,c){Ext.Ajax.request({url:"filterParameters!containsParameter.action",params:{filterID:b},scope:a,disableCaching:!0,success:function(e){Ext.decode(e.responseText).success?com.trackplus.admin.Filter.renderFilterParameter(a,b,c):com.trackplus.admin.Filter.executeParameterlessFilter(b,c)},failure:function(b){Ext.MessageBox.alert(a.failureTitle,b.responseText)},method:"POST"})};
com.trackplus.admin.Filter.renderFilterParameter=function(a,b,c){var e=getText("admin.customize.queryFilter.lbl.parameters"),f=com.trackplus.admin.Filter.getTreeFilterParameterItems(),g={filterID:b};b={filterID:b,ajax:c};Ext.create("com.trackplus.util.WindowConfig",{postDataProcess:com.trackplus.admin.Filter.postLoadProcessTreeFilterParameters}).showWindow(a,e,1E3,800,{loadUrl:"filterParameters!renderParameters.action",loadUrlParams:g},{submitUrl:"savedFilterExecute!replaceSubmittedParameters.action",
submitUrlParams:b,submitButtonText:getText("common.btn.applyFilter"),standardSubmit:null==c||!1==c},f)};com.trackplus.admin.Filter.executeParameterlessFilter=function(a,b){Ext.create("Ext.form.Panel",{items:[],url:"itemNavigator.action",baseParams:{queryType:1,queryID:a,previousQuery:!1,ajax:b},standardSubmit:null==b||!1==b}).getForm().submit()};
com.trackplus.admin.Filter.generateFilterLink=function(a,b){var c=getText("admin.customize.queryFilter.lbl.filterURL.report.encodedUrl"),e=com.trackplus.admin.Filter.getFilterLinkItems(),f={node:b};Ext.create("com.trackplus.util.WindowConfig",{postDataProcess:com.trackplus.admin.Filter.postLoadProcessFilterLink,cancelButtonText:getText("common.btn.done")}).showWindow(a,c,500,300,{loadUrl:"filterLink.action",loadUrlParams:f},null,e)};
com.trackplus.admin.Filter.getFilterLinkItems=function(){return[CWHF.getRadioGroup("urlTypeRadio",null,400,[{boxLabel:getText("admin.customize.queryFilter.lbl.filterURL.reportOverviewLink"),name:"urlType",inputValue:"1",checked:!0},{boxLabel:getText("admin.customize.queryFilter.lbl.filterURL.changesMavenPluginLink"),name:"urlType",inputValue:"2",checked:!1}]),CWHF.createCheckbox("admin.customize.queryFilter.lbl.filterURL.encodeUserPassword","encodePassword",{itemId:"encodePassword",disabled:!1,checked:!0,
labelWidth:200}),CWHF.createCheckbox("admin.customize.queryFilter.lbl.filterURL.keepMeLogged","keepMeLogged",{itemId:"keepMeLogged",disabled:!1,labelWidth:200}),CWHF.createTextAreaField(null,"filterLinkTextArea",{itemId:"filterLinkTextArea",anchor:"100% -45",listeners:{render:{fn:function(a){a.getEl().on("contextmenu",function(a){a.stopPropagation()},null,{preventDefault:!1})}}}})]};
com.trackplus.admin.Filter.postLoadProcessFilterLink=function(a,b){var c=b.getComponent("filterLinkTextArea");null!=a.filterParams&&(c.anchor="100% -70",b.insert(1,CWHF.createCheckbox("admin.customize.queryFilter.lbl.filterURL.showParameters","showParameters",{itemId:"showParameters",labelWidth:200},{change:{fn:com.trackplus.admin.Filter.changeLinkType,scope:this,panel:b,data:a}})));var e=b.getComponent("urlTypeRadio");if(null!=e)e.on("change",com.trackplus.admin.Filter.changeLinkType,this,{panel:b,
data:a});e=b.getComponent("keepMeLogged");if(null!=e)e.on("change",com.trackplus.admin.Filter.changeLinkType,this,{panel:b,data:a});e=b.getComponent("encodePassword");if(null!=e)e.on("change",com.trackplus.admin.Filter.changeEncodePassword,this,{panel:b,data:a});c.setValue(a.filterUrlIssueNavigator)};
com.trackplus.admin.Filter.changeLinkType=function(a,b,c,e){a=e.panel;c=e.data;if(null!=a){var f=null;e=a.getComponent("keepMeLogged");var g=a.getComponent("encodePassword"),h=a.getComponent("urlTypeRadio").getChecked();b=!1;0<h.length&&(f=h[0],1==f.getSubmitValue()?(b=!0,e.setDisabled(!1),g.setDisabled(!1),f=!1==g.getValue()?c.filterUrlIssueNavigatorNoUser:e.getValue()?c.filterUrlIssueNavigatorKeep:c.filterUrlIssueNavigator):(f=c.filterUrlMavenPlugin,e.setDisabled(!0),g.setDisabled(!0)));g=a.getComponent("showParameters");
null!=g&&g.getValue()&&(f=f+"\x26"+c.filterParams);a=a.getComponent("filterLinkTextArea");null!=a&&a.setValue(f);e.getValue()&&b?a.inputEl.setStyle("color","red"):a.inputEl.setStyle("color","black")}};
com.trackplus.admin.Filter.changeEncodePassword=function(a,b,c,e){a=e.panel;c=e.data;e=null;null!=a&&(b=a.getComponent("keepMeLogged"),a.getComponent("encodePassword").getValue()?(b.setDisabled(!1),e=b.getValue()?c.filterUrlIssueNavigatorKeep:c.filterUrlIssueNavigator):(e=c.filterUrlIssueNavigatorNoUser,b.setValue(!1),b.setDisabled(!0)),a=a.getComponent("filterLinkTextArea"),null!=a&&a.setValue(e),b.getValue()&&filterUrlChecked?a.inputEl.setStyle("color","red"):a.inputEl.setStyle("color","black"))};
Ext.define("com.trackplus.itemNavigator.IssueListViewDescriptor",{extend:"Ext.Base",config:{id:"",enabledColumnChoose:!1,enabledGrouping:!1,useLongFields:!1,name:"",description:"",jsClass:null,iconCls:null,plainData:!1},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)}});
Ext.define("com.trackplus.itemNavigator.IssueListViewPlugin",{extend:"Ext.util.Observable",config:{id:"",descriptor:null,model:null,pluginCls:null,settingsVisible:!1,plainGrid:!1},view:null,refreshData:function(a){},dataChangeSuccess:function(a){},containsFields:function(a){if(null!=a)for(var b=[-1100,-1101,-1300,-1301,-1400,-1401],c=0;c<a.length;c++)if(-1!=Ext.Array.indexOf(b,a[c])||this.containsOneField(a[c]))return!0;return!1},containsOneField:function(a){for(var b=this.model.layout.shortFields,
c=0;c<b.length;c++)if(b[c].reportField==a)return!0;if(this.descriptor.useLongFields)for(b=this.model.layout.longFields,c=0;c<b.length;c++)if(b[c].reportField==a)return!0;return!1},createSettingsPanel:function(a,b,c,e,f){a=this.getSettingsToolbarItems(a,b,c,e,f);return Ext.create("Ext.toolbar.Toolbar",{region:"north",layout:{overflowHandler:"Menu"},enableOverflow:!0,cls:"toolbarActions",border:"0 0 1 0",defaults:{cls:"toolbarItemAction",overCls:"toolbarItemAction-over",scale:"small",iconAlign:"left",
enableToggle:!1},items:a})},getSettingsToolbarItems:function(a,b,c,e,f){var g=[];g.push(a);g.push(b);null!=c&&g.push(c);null!=e&&g.push(e);null!=f&&g.push(f);return g},getSettingsHeight:function(){return 27},createView:function(){return Ext.create("Ext.panel.Panel",{html:"Implement me!"})},destroyView:function(){},getSelectedIssues:function(){return null},selectItemByIndex:function(a){},selectItem:function(a,b){},deselectItem:function(a,b){},constructor:function(a){this.initialConfig=a=a||{};this.events=
[];this.addEvents("itemclick","itemdblclick","itemcontextmenu","selectionchange","bulkselectionchange","datachange","layoutchange","sortchange","totalChange","startDragItems","afterDropItems");this.listeners=a.listeners;com.trackplus.itemNavigator.IssueListViewPlugin.superclass.constructor.call(this,a)},getPopupMenuItems:function(a,b,c,e){return null},destroy:function(){this.pluginCls=this.model=this.descriptor=this.id=null;this.clearListeners();null!=this.view&&(this.view.clearListeners.call(this.view),
this.view.removeAll.call(this.view,!0),this.view.destroy.call(this.view),this.view=null)},createFields:function(){for(var a=[],b=this.model.layout.shortFields,c,e=0;e<b.length;e++)if(c=b[e],a.push({name:"f"+c.reportField,type:c.extJsType,useNull:!0}),!0===c.so){var f="int";null!=c.soType&&(f=c.soType);a.push({name:"f_so"+c.reportField,type:f,useNull:!0})}a.push({name:"group",type:"boolean"});a.push({name:"accessLevelFlag",type:"boolean"});a.push({name:"editable",type:"boolean"});a.push({name:"linkable",
type:"boolean"});a.push({name:"notEditableFields"});a.push({name:"leaf",type:"boolean"});a.push({name:"workItemID",type:"int",useNull:!0});a.push({name:"attachmentIds"});a.push({name:"workItemIndex",type:"int",useNull:!0});a.push({name:"projectID",type:"int"});a.push({name:"issueTypeID",type:"int"});a.push({name:"parentID",type:"int",useNull:!0});a.push({name:"originatorID",type:"int"});a.push({name:"projectName"});a.push({name:"longFields"});a.push({name:"iconCls"});a.push({name:"cssColorClass"});
a.push({name:"cssColorClassGroup"});a.push({name:"queryFieldCSS"});a.push({name:"Name"});return a},createColumn:function(a,b,c,e){var f=this,g="Ext.grid.column.Column",h="ID_"+b.id;0==a&&e&&(g="Ext.tree.Column");var k="\x26nbsp;",l=null,m=!0;0==a&&e?k='\x26nbsp;\x3cspan class\x3d"expandAll" id\x3d"rowExpandAllTrg"\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x3cspan class\x3d"collapseAll" id\x3d"rowCollapseAllTrg"\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/span\x3e\x26nbsp;\x26nbsp;'+b.label:
!0==b.renderContentAsImg||-1001==b.reportField?(l="headerIcon"+b.reportField,-10001!=b.reportField&&(m=!1),b.fieldIsCustomIcon&&(l="headerIcon-customOption",m=!0)):k=b.label;c=Ext.create(g,{header:k,draggable:!0,hideable:0!=a,menuDisabled:!0,width:b.fieldWidth,dataIndex:"f"+b.reportField,fieldID:b.reportField,fieldIsCustomIcon:b.fieldIsCustomIcon,itemId:"R_"+b.id,sortable:c,sortWithSO:!0===b.so,hidden:!1,tdCls:"simpleTreeGridCell",id:h,cls:l,resizable:m});!0===b.so&&(c.getSortParam=function(){return"f_so"+
this.dataIndex.substring(1)});0==a&&!0==f.plainGrid&&(c.renderer=function(a,b,c,e,f,g,h){return'\x3cimg class\x3d"x-tree-icon '+c.data.iconCls+'" role\x3d"presentation" src\x3d"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw\x3d\x3d"\x3e\x3cspan class\x3d"x-tree-node-text"\x3e'+a+"\x3c/span\x3e"});-1001==b.reportField&&(c.renderer=0==a?function(a,b,c,e,f,g,h){return!0==c.data.group?c.data.Name:null==a?"":'\x3ca href\x3d"javaScript:openAttachments('+c.data.workItemID+
",\x26quot;"+c.data.attachmentIds+'\x26quot;)" class\x3d"downloadAttachments"\x3e'+a+"\x3c/a\x3e"}:function(a,b,c,e,f,g,h){return null==a?"":'\x3ca href\x3d"javaScript:openAttachments('+c.data.workItemID+",\x26quot;"+c.data.attachmentIds+'\x26quot;)" class\x3d"downloadAttachments"\x3e'+a+"\x3c/a\x3e"});!0==b.renderContentAsImg&&0!=a&&(a=b.fieldWidth,c.width=null==a?25:a,c.tdCls="iconTreeGridCell",c.renderer=function(a,b,c,e,g,h,k){b=g;f.model.layout.bulkEdit&&(b=g-1);g=this.columns[b].dataIndex.substring(1);
b=this.columns[b].fieldIsCustomIcon;if(-1006==g||-1010==g){if(-1006==g)return null!=a&&""!=a?'\x3cimg src\x3d"'+com.trackplus.TrackplusConfig.icon16Path+a+'" style\x3d"padding-top:2px;"\x3e':"";if(-1010==g){if(null!=a&&0<a.length){a=a.split(",");var l="";Ext.Array.forEach(a,function(a){null!=a&&(l+='\x3cimg src\x3d"'+com.trackplus.TrackplusConfig.icon16Path+a+'" style\x3d"padding-top:2px;"\x3e')},this);return l}return""}}else{if(null!=a&&""!=a){if(b){a=a.split(",");var m="";Ext.Array.forEach(a,function(a){null!=
a&&(m=m+'\x3cimg src\x3d"'+("optionIconStream.action?\x26optionID\x3d"+a)+'" style\x3d"padding-top:2px;"\x3e')},this);return m}return'\x3cimg src\x3d"'+("optionIconStream.action?fieldID\x3d"+g+"\x26optionID\x3d"+a)+'" style\x3d"padding-top:2px;"\x3e'}return""}});return c},createSelModel:function(){this.useSelectionModel=this.model.layout.bulkEdit;var a=null;!0==this.model.layout.bulkEdit&&(a=Ext.create("com.trackplus.itemNavigator.CheckboxModel",{allowDeselect:!0,checkOnly:!1,mode:"MULTI"}));return a},
columnMoveHandler:function(a,b,c,e){var f=this;a=b.itemId.substring(2);Ext.Ajax.request({url:"layoutColumns!moveColumn.action",disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);!1==a.success&&(a=getText(a.errorMessage),CWHF.showMsgError(a));f.fireEvent.call(f,"layoutchange")},failure:function(a){com.trackplus.util.requestFailureHandler(result)},method:"POST",params:{layoutID:a,fromIdx:c,toIdx:e,filterType:f.model.queryContext.queryType,filterID:f.model.queryContext.queryID}})},onGridSelectionChange:function(a,
b){this.fireEvent.call(this,"selectionchange",b);return!1},getRowClass:function(a,b,c,e){b="";!0==a.data.group&&(b+=" reportsTableGrouping",null!=a.data.cssColorClassGroup&&(b+=" "+a.data.cssColorClassGroup));null!=a.data.cssColorClass&&(b+=" "+a.data.cssColorClass);null!=this.queryFieldCSS&&null!=a.data.queryFieldCSS&&(b+=" queryFieldCSS rowCls_"+this.queryFieldCSS+"_"+a.data.queryFieldCSS);return b},updatePossibleFieldOptions:function(a,b){}});
Ext.define("com.trackplus.itemNavigator.IssueListViewFacade",{extend:"Ext.Base",config:{descriptor:null,model:null,itemNavigatorController:null,queryContext:null},listViewPlugin:null,settingsPanel:null,filterPanel:null,settingsHeight:null,view:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},destroy:function(){null!=this.listViewPlugin&&this.listViewPlugin.destroyView.call(this.listViewPlugin);this.model=this.descriptor=this.listViewPlugin=null;delete this.listViewPlugin;
delete this.descriptor;delete this.model},createView:function(a,b){var c=this;c.model=a;var e=c.descriptor.jsClass;null!=c.listViewPlugin&&c.listViewPlugin.destroyView.call(c.listViewPlugin);null==c.listViewPlugin&&(c.listViewPlugin=Ext.create(e,{descriptor:c.descriptor,model:c.model,settingsVisible:b,itemNavigatorController:c.itemNavigatorController}),c.addViewPluginListeners());c.listView=c.listViewPlugin.createView.call(c.listViewPlugin);var e=Ext.create("Ext.button.Button",{id:"btnGroupBy",iconCls:"group",
itemId:"btnGroupByItemID",hidden:!1==c.descriptor.enabledGrouping,text:getText("itemov.lbl.groupBy"),tooltip:getText("itemov.lbl.groupBy"),handler:function(){c.itemNavigatorController.showGroupByPopup.call(c.itemNavigatorController)}}),f=Ext.create("Ext.button.Button",{id:"btnChooseColumns",iconCls:"column",itemId:"btnChooseColumnsItemID",hidden:!1==c.descriptor.enabledColumnChoose,text:getText("itemov.lbl.chooseColumns"),tooltip:getText("itemov.lbl.chooseColumns"),handler:function(){c.itemNavigatorController.showColumnsPopup.call(c.itemNavigatorController)}}),
g=null;if(com.trackplus.TrackplusConfig.user.sys||com.trackplus.TrackplusConfig.user.projectAdmin)g=Ext.create("Ext.button.Button",{text:getText("itemov.btn.saveAsStandardLayout"),overflowText:getText("itemov.btn.saveAsStandardLayout"),tooltip:getText("itemov.btn.saveAsStandardLayout"),iconCls:c.descriptor.iconCls,handler:function(){c.saveAsStandardLayout.call(c)}});var h=Ext.create("Ext.button.Button",{text:getText("itemov.btn.useStandardLayout"),overflowText:getText("itemov.btn.useStandardLayout"),
tooltip:getText("itemov.btn.useStandardLayout"),iconCls:c.descriptor.iconCls,handler:function(){c.useStandardLayout.call(c)}}),k=Ext.create("Ext.button.Button",{text:getText("itemov.btn.saveAsFilterLayout"),overflowText:getText("itemov.btn.saveAsFilterLayout"),tooltip:getText("itemov.btn.saveAsFilterLayout"),iconCls:c.descriptor.iconCls,handler:function(){c.saveAsFilterLayout.call(c)}});!0==c.model.isFilterView?(null!=g&&g.setVisible(!1),h.setVisible(!1),k.setVisible(c.model.maySaveFilterLayout)):
(k.setVisible(!1),null!=g&&g.setVisible(!0),h.setVisible(!0));c.settingsPanel=c.listViewPlugin.createSettingsPanel(e,f,g,h,k);Ext.apply(c.settingsPanel,{region:"north",hidden:!b});c.settingsHeight=c.listViewPlugin.getSettingsHeight();c.view=Ext.create("Ext.panel.Panel",{layout:"border",border:!1,bodyBorder:!1,items:[c.settingsPanel,c.listView]});return c.view},useStandardLayout:function(){this.itemNavigatorController.refresh.call(this.itemNavigatorController,"itemNavigator!useStandardLayout.action",
null,!0)},saveAsStandardLayout:function(){borderLayout.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!saveAsStandardLayout.action",disableCaching:!0,success:function(a){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("itemov.msg.saveAsStandardLayoutSuccess"))},failure:function(){borderLayout.setLoading(!1);CWHF.showMsgError("Failure")},method:"POST"})},saveAsFilterLayout:function(){borderLayout.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!saveAsFilterLayout.action",disableCaching:!0,
success:function(a){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("itemov.msg.saveAsFilterLayoutSuccess"))},failure:function(){borderLayout.setLoading(!1);CWHF.showMsgError("Failure")},method:"POST"})},viewContainsFields:function(a){return null!=this.listViewPlugin?this.listViewPlugin.containsFields(a):!1},getView:function(a){null!=a&&(this.model=a);null==this.view&&this.createView(this.model);return this.view},addViewPluginListeners:function(){this.listViewPlugin.addListener("datachange",
this.onDataChange,this);this.listViewPlugin.addListener("layoutchange",this.onLayoutChange,this);this.listViewPlugin.addListener("sortchange",this.onSortChange,this);this.listViewPlugin.addListener("itemcontextmenu",this.onItemContextMenu,this);this.listViewPlugin.addListener("itemdblclick",this.onItemDblClick,this);this.listViewPlugin.addListener("selectionchange",this.onSelectionChange,this);this.listViewPlugin.addListener("totalChange",this.onTotalChange,this);this.listViewPlugin.addListener("startDragItems",
this.onStartDragItems,this);this.listViewPlugin.addListener("afterDropItems",this.onAfterDropItems,this)},onDataChange:function(a){this.itemNavigatorController.refresh.call(this.itemNavigatorController,null,null,!1,function(){var b=this.issueListFacade.listViewPlugin;b.dataChangeSuccess.call(b,a)})},onLayoutChange:function(){this.itemNavigatorController.changeLayout.call(this.itemNavigatorController)},onSortChange:function(a){this.itemNavigatorController.sortChange.call(this.itemNavigatorController,
a)},onSelectionChange:function(a){this.itemNavigatorController.issueSelectionChange.call(this.itemNavigatorController,a)},onItemContextMenu:function(a,b,c,e,f){var g=a.workItemID;null!=g&&-1!=g&&(a=this.createPopup.call(this,a,c,e,f),null!=a&&(a.showAt(b.getXY()),this.listViewPlugin.selectItem(g)))},onItemDblClick:function(a,b){"com.trackplus.itemNavigator.GanttViewPlugin"!=this.listViewPlugin.$className?this.openEditDlg(a,b):this.listViewPlugin.isNewSelectedTask()||(this.listViewPlugin.isChartContainsUnsavedItems()?
this.listViewPlugin.showSaveDialogWarningIfChartContainsUnsavedItems(this,this.openEditDlg,null,[a,b]):this.openEditDlg(a,b))},openEditDlg:function(a,b){var c=a.workItemID;if(null!=c&&-1!=c){var e=a.workItemIndex;this.listViewPlugin.selectItem(c);this.itemNavigatorController.executeItemAction.call(this.itemNavigatorController,c,-2,null,e)}},onTotalChange:function(a,b){this.itemNavigatorController.model.totalCount=a;this.itemNavigatorController.model.count=b;this.itemNavigatorController.updateTotalCount()},
onStartDragItems:function(a,b,c){var e=this;null==b&&(b=[]);-1==Ext.Array.indexOf(b,4)&&b.push(4);!0===e.itemNavigatorController.filterController.subFilterVisible&&-1==Ext.Array.indexOf(b,10)&&b.push(10);a={selectedItemIDs:a,selectedFieldIDs:b.join(",")};Ext.Ajax.request({disableCaching:!0,url:"possibleFieldOptions.action",params:a,success:function(a){a=Ext.decode(a.responseText);e.listViewPlugin.updatePossibleFieldOptions(a,c);e.itemNavigatorController.filterController.updatePossibleFieldOptions(a)},
failure:function(a,b){}})},onAfterDropItems:function(){this.itemNavigatorController.filterController.onAfterDropItems()},refreshData:function(a){if(null==this.listViewPlugin)return null;this.listViewPlugin.refreshData.call(this.listViewPlugin,a)},setVisibleTools:function(a){var b=this,c=b.settingsPanel;if(null!=c){var e=c.getEl(),f=b.settingsHeight,g=b.listView.getEl();g.getY();var h=g.getHeight();a?g.animate({top:f,height:h-f,duration:300,listeners:{afteranimate:function(){c.setVisible(!0);e.slideIn("t",
{easing:"easeOut",duration:300,listeners:{afteranimate:function(){b.view.ownerCt.doLayout()}}})}}}):e.slideOut("t",{easing:"easeOut",duration:300,listeners:{afteranimate:function(){g.animate({top:0,height:h+f,duration:300,listeners:{afteranimate:function(){c.setVisible(!1);b.view.ownerCt.doLayout()}}})}}})}},addSaveButton:function(a){null!=this.listViewPlugin&&"com.trackplus.itemNavigator.GanttViewPlugin"==this.listViewPlugin.$className&&this.listViewPlugin.addSaveButton(a)},addOrRemoveSaveButton:function(a){if(null!=
this.listViewPlugin)if("com.trackplus.itemNavigator.GanttViewPlugin"==this.listViewPlugin.$className){var b=borderLayout.getActiveToolbarList().items.items,c=borderLayout.getActiveToolbarList(),e;for(e in b)null!=b[e].itemId&&"ganttSaveBtn"==b[e].itemId&&c.remove(b[e]);this.addSaveButton(a)}else for(e in c=borderLayout.getActiveToolbarList(),b=borderLayout.getActiveToolbarList().items.items,b)null!=b[e].itemId&&"ganttSaveBtn"==b[e].itemId&&c.remove(b[e])},getSelectedIssues:function(){return this.listViewPlugin.getSelectedIssues()},
navigate:function(a,b,c){return this.listViewPlugin.navigate.call(this.listViewPlugin,a,b,c)},selectItemByIndex:function(a){return this.listViewPlugin.selectItemByIndex.call(this.listViewPlugin,a)},selectItem:function(a){return null!=this.listViewPlugin?this.listViewPlugin.selectItem.call(this.listViewPlugin,a):null},deselectItem:function(a){return this.listViewPlugin.deselectItem.call(this.listViewPlugin,a)},createPopup:function(a,b,c,e){null!=this.popupMenu&&(this.popupMenu.destroy(),this.popupMenu=
null,delete this.popupMenu);return this.popupMenu=Ext.create("Ext.menu.Menu",{floating:!0,items:this.getPopupMenuItems.call(this,a,b,c,e),closeAction:"destroy"})},getPopupMenuItems:function(a,b,c,e){var f=this,g=a.workItemID,h=a.workItemIndex,k=a.projectID,l=a.issueTypeID,m=a.originatorID,n=a.parentID,p=a.accessLevelFlag,q=[],t=a.editable,r=a.linkable,v=a.notEditableFields,u=a.leaf,s=!0;null!=f.model&&(s=f.model.summaryItemsBehavior);(u=(u||!s)&&t)&&null!=v&&0<v.length&&(u=Ext.Array.indexOf(v,-1200),
v=Ext.Array.indexOf(v,-1201),u=-1==u&&-1==v);t&&q.push({text:getText("common.btn.edit"),iconCls:"itemAction_edit16",handler:function(){f.taskEditHandler(g,h)}});q.push({text:getText("item.action.viewInNewTab"),iconCls:"itemAction_viewAll16",handler:function(){window.open("printItem.action?key\x3d"+g,"printItem"+g)}});q.push({text:getText("common.btn.copy"),iconCls:"itemAction_copy16",handler:function(){f.itemNavigatorController.executeItemAction.call(f.itemNavigatorController,g,-1,null,h)}});t&&(q.push({text:getText("common.btn.move"),
iconCls:"itemAction_move16",handler:function(){f.itemNavigatorController.executeItemAction.call(f.itemNavigatorController,g,3,null,h)}}),q.push({text:getText("common.btn.changeStatus"),iconCls:"itemAction_changeStatus16",handler:function(){f.itemNavigatorController.executeItemAction.call(f.itemNavigatorController,g,5,null,h)}}));q.push({text:getText("common.btn.addChild"),iconCls:"itemAction_addChild16",handler:function(){f.itemNavigatorController.executeItemAction.call(f.itemNavigatorController,
g,4,null,h,null,null,!0)}});t&&(q.push({text:getText("common.btn.chooseParent"),iconCls:"itemAction_parent16",handler:function(){f.itemNavigatorController.chooseParent.call(f.itemNavigatorController,a)}}),null!=n&&q.push({text:getText("common.btn.removeParent"),iconCls:"itemAction_removeParent16",handler:function(){f.itemNavigatorController.executeAJAXItemAction.call(f.itemNavigatorController,"itemNavigator!removeParent.action?workItemID\x3d"+g)}}));t&&r&&q.push({text:getText("common.btn.addLinkedItem"),
iconCls:"links16",handler:function(){addLinkFromContextMenu={};addLinkFromContextMenu.workItemName=a.f17;addLinkFromContextMenu.projectID=a.projectID;addLinkFromContextMenu.issueTypeID=a.issueTypeID;f.itemNavigatorController.executeItemAction.call(f.itemNavigatorController,g,6,null,h,null,null,!0,addLinkFromContextMenu)}});m==com.trackplus.TrackplusConfig.userID&&q.push({text:p?getText("common.btn.unlock"):getText("common.btn.lock"),iconCls:"itemAction_lock16",handler:function(){f.executeAJAX("item!reverseAccessFlag.action?workItemID\x3d"+
g)}});u&&q.push({text:getText("common.btn.addExpense"),iconCls:"cost16",handler:function(){f.addWorklog(g,k,l)}});q.push({text:getText("common.btn.report"),iconCls:"itemAction_report16",handler:function(){com.trackplus.admin.Report.executeReportFromIssueNavigator(g)}});b=f.listViewPlugin.getPopupMenuItems.call(f.listViewPlugin,a,b,c,e);if(null!=b)for(c=0;c<b.length;c++)q.push(b[c]);return q},taskEditHandler:function(a,b){"com.trackplus.itemNavigator.GanttViewPlugin"!=this.listViewPlugin.$className?
this.itemNavigatorController.executeItemAction.call(this.itemNavigatorController,a,2,null,b):this.listViewPlugin.isNewSelectedTask()||(this.listViewPlugin.isChartContainsUnsavedItems()?this.listViewPlugin.showSaveDialogWarningIfChartContainsUnsavedItems(this,this.taskEditHandler,null,[a,b]):this.itemNavigatorController.executeItemAction.call(this.itemNavigatorController,a,2,null,b))},addWorklog:function(a,b,c){b=Ext.create("com.aurel.trackplus.itemDetail.WorklogController",{workItemID:a,projectID:b,
issueTypeID:c,jsonData:{},refresh:this.itemNavigatorController.refresh,refreshScope:this.itemNavigatorController});b.openWorklog.call(b,getText("item.action.edit.title")+"\x26nbsp;"+a+"\x26nbsp;"+getText("item.tabs.expense.editExpense.title.add"),null)},executeAJAX:function(a){var b=this;Ext.Ajax.request({url:a,success:function(a){b.itemNavigatorController.refresh.call(b.itemNavigatorController)},failure:function(){alert("failure")}})},executeURL:function(a){window.location.href=a}});
Ext.define("com.trackplus.util.TreeDropZone",{extend:"Ext.dd.DropZone",config:{view:null,isValidNode:null,isValidNodeScope:null},expandDelay:600,constructor:function(a){Ext.apply(this,a);this.callParent([this.view.el])},getTargetFromEvent:function(a){var b=a.getTarget(this.view.getItemSelector()),c,e,f,g,h;if(!b)for(a=a.getPageY(),f=0,c=this.view.getNodes(),g=c.length;f<g;f++)if(e=c[f],h=Ext.fly(e).getBox(),a<=h.bottom)return e;return b},expandNode:function(a){var b=this.view;a.isLeaf()||a.isExpanded()||
(b.expand(a),this.expandProcId=!1)},queueExpand:function(a){this.expandProcId=Ext.Function.defer(this.expandNode,this.expandDelay,this,[a])},fireViewEvent:function(){var a;this.lock();a=this.view.fireEvent.apply(this.view,arguments);this.unlock();return a},invalidateDrop:function(){this.valid&&(this.valid=!1);null!=this.overRecord&&Ext.fly(this.overRecord).removeCls("my-row-highlight-class")},onNodeEnter:function(a,b,c,e){this.isValidDropPoint(a,b,c,e)&&Ext.fly(a).addCls("my-row-highlight-class")},
onNodeOut:function(a,b,c,e){Ext.fly(a).removeCls("my-row-highlight-class")},onNodeOver:function(a,b,c,e){var f=this.dropNotAllowed,g=this.view.getRecord(a);this.cancelExpand();this.expandProcId||g.isLeaf()||g.isExpanded()||this.queueExpand(g);this.isValidDropPoint(a,b,c,e)?(this.valid=!0,this.overRecord=g,f=Ext.baseCSSPrefix+"dd-drop-ok"):this.valid=!1;return this.currentCls=f},cancelExpand:function(){this.expandProcId&&(clearTimeout(this.expandProcId),this.expandProcId=!1)},isValidDropPoint:function(a,
b,c,e){if(!a||!e.item)return!1;a=this.view.getRecord(a);if(null!=this.isValidNode&&"function"==typeof this.isValidNode)return null==this.isValidNodeScope?this.isValidNode.call(this,a):this.isValidNode.call(this.isValidNodeScope,a);a=a.data.canDrop;return null!=a?!0===a:!0},onNodeDrop:function(a,b,c,e){var f=this,g=!1;b=function(){f.invalidateDrop();g=!0;f.fireViewEvent("drop",a,e,f.overRecord)};c=!1;f.valid&&(c=f.fireViewEvent("beforedrop",a,e,f.overRecord,b),!1!==c&&(g||b()));return c}});
Ext.define("com.trackplus.itemNavigator.NavigableItem",{extend:"Ext.Base",itemDialogManager:null,usePosition:!1,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.itemDialogManager=Ext.create("com.trackplus.itemNavigator.ItemDialogManager",{navigable:this,usePosition:this.usePosition})},navigate:function(a,b,c){},selectItem:function(a){},deselectItem:function(a){},selectItemByIndex:function(a){},deselectItemByIndex:function(a){},itemChangeHandler:function(a){},openItem:function(a,
b,c,e){var f=this.navigate(a,c,"next",!0),g=this.navigate(a,c,"prev",!0);c={workItemID:a,workItemIndex:c,nextItem:f,prevItem:g};a={workItemID:a,actionID:null==b?-2:b,successHandler:this.successHandler,scope:this,modal:!1,disabledNext:null==f,disabledPrev:null==g};if(null!=e)for(var h in e)a[h]=e[h];e=Ext.create("com.trackplus.item.ItemActionDialog",a);this.itemDialogManager.openDialog(e,c)},containsFields:function(a,b){if(null!=b)for(var c=0;c<b.length;c++)if(this.containsOneField(a,b[c]))return!0;
return!1},containsOneField:function(a,b){for(var c=0;c<a.length;c++)if(a[c].reportField==b)return!0;return!1}});
Ext.define("com.trackplus.itemNavigator.GridNavigableItem",{extend:"com.trackplus.itemNavigator.NavigableItem",getGrid:function(){return this.grid},getFieldNameItemID:function(){return"objectID"},navigate:function(a,b,c){var e=this.getGrid(),f=this.getFieldNameItemID();if(null==e)return null;var e=e.getStore(),g=-1;0<=b&&b<e.getCount()&&e.getAt(b).data[f]==a&&(g=b);-1==g&&(g=this.findIndex(f,a));-1==g&&(g=b,"next"==c&&g--);if("next"==c){if(g==e.getCount()-1)return null;g++}else{if(0==g)return null;
g--}return{workItemID:e.getAt(g).data[f],workItemIndex:g}},selectItem:function(a){var b=this.getGrid();return null==b||null==a?null:this.selectItemGrid(b,a)},selectItemGrid:function(a,b){for(var c=a.getStore(),e=Ext.Array.from(b),f=[],g=this.getFieldNameItemID(),h=0;h<e.length;h++){var k=this.findIndex(g,e[h]);null!=k&&(a.getSelectionModel().select(k),f.push(c.getAt(k)))}return f},deselectItem:function(a){var b=this.getGrid();if(null==b||null==a)return null;this.deselectItemGrid(b,a)},deselectItemGrid:function(a,
b){a.getStore();for(var c=Ext.Array.from(b),e=this.getFieldNameItemID(),f=0;f<c.length;f++){var g=this.findIndex(e,c[f]);null!=g&&a.getSelectionModel().deselect(g)}},selectItemByIndex:function(a){var b=this.getGrid();return null==b||null==a?null:this.selectItemGridByIndex(b,a)},selectItemGridByIndex:function(a,b){for(var c=a.getStore(),e=Ext.Array.from(b),f=[],g=0;g<e.length;g++){var h=e[g];0<=h&&h<c.getCount()&&(a.getSelectionModel().select(h),f.push(c.getAt(h)))}return f},findIndex:function(a,b){for(var c=
this.getGrid().getStore(),e,f=0;f<c.getCount();f++)if(e=c.getAt(f),e.data[a]==b)return f;return-1}});
Ext.define("com.trackplus.itemNavigator.TreeNavigableItem",{extend:"com.trackplus.itemNavigator.NavigableItem",getTreeGrid:function(){return null},navigate:function(a,b,c){var e=this.getTreeGrid();if(null!=e)return a=e.getStore().getNodeById(a),e=null,null!=a?e="next"==c?this.findNext(a,!0):this.findPrev(a,!0):(a=this.findNodeByWorkItemIndex(b),null!=a&&(e="next"==c?a:this.findPrev(a,!0))),null!=e?{workItemID:e.data.workItemID,workItemIndex:e.data.workItemIndex}:null},selectItem:function(a){var b=
this.getTreeGrid();return null==b||null==a?null:this.selectItemInTree(b,a)},selectItemInTree:function(a,b){for(var c=Ext.Array.from(b),e=[],f=0;f<c.length;f++){var g=a.getStore().getNodeById(c[f]);null!=g&&(a.selectPath(g.getPath()),e.push(g.data))}return e},deselectItem:function(a){var b=this.getTreeGrid();if(null==b||null==a)return null;this.deselectItemInTree(b,a)},deselectItemInTree:function(a,b){for(var c=Ext.Array.from(b),e=0;e<c.length;e++){var f=a.getStore().getNodeById(c[e]);null!=f&&a.getSelectionModel().deselect(f)}},
selectItemByIndex:function(a){var b=this.getTreeGrid();return null==b||null==a?null:this.selectItemByIndexInTree(b,a)},selectItemByIndexInTree:function(a,b){for(var c=Ext.Array.from(b),e=[],f=0;f<c.length;f++){var g=this.findNodeByWorkItemIndex(c[f]);null!=g&&(a.selectPath(g.getPath()),e.push(g.data))}return e},onStoreRefresh:function(a){a=a.getRootNode();this.updateNodeChildrenIndex(a,0)},updateNodeChildrenIndex:function(a,b){var c=a.childNodes;if(null!=c)for(var e=0;e<c.length;e++){var f=c[e];!0==
!f.data.group&&(f.data.workItemIndex=b++);b=this.updateNodeChildrenIndex(f,b)}return b},findPrev:function(a){var b=null,b=a.parentNode;a.isFirst()?b=b.isRoot()?null:null!=b.data.workItemID?b:this.findPrev(b):(a=b.indexOf(a),a=b.getChildAt(a-1),b=null!=a.data.workItemID?a:this.findPrev(a));return b},findNext:function(a,b){var c=null;if(a.hasChildNodes()&&!0==b)c=a.getChildAt(0);else if(c=a.parentNode,a.isLast())c=c.isRoot()?null:this.findNext(c,!1);else var e=c.indexOf(a),c=c.getChildAt(e+1),c=null!=
c.data.workItemID?c:this.findNext(c,!0);return c},findNodeByWorkItemIndex:function(a){var b=null,c=0,e=0,f=this.getTreeGrid();return null!=f?(f.getStore().getRootNode().cascadeBy(function(f){var h=f.data.workItemIndex;null!=h&&(h>c&&(c=h,e=f),h==a&&(b=f))}),null!=b?b:e):null}});
Ext.define("com.trackplus.itemNavigator.ItemDialogManager",{extend:"Ext.Base",config:{navigable:null,usePosition:!1},allDialogs:[],navigateContexts:[],lastActiveDialog:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},openDialog:function(a,b){if(0<this.allDialogs.length){var c=(null!=this.lastActiveDialog?this.lastActiveDialog:this.allDialogs[this.allDialogs.length-1]).dialog.getPosition();a.position=[c[0]+25,c[1]+25]}a.execute.call(a);a.addListener("activate",this.activateItemDialog,
this);a.addListener("deactivate",this.deactivateItemDialog,this);a.addListener("close",this.closeItemDialog,this);a.addListener("itemChange",this.itemChangeHandler,this);a.addListener("clickOnChild",this.clickOnChildHandler,this);a.addListener("clickOnLink",this.clickOnLinkHandler,this);a.addListener("clickOnParent",this.clickOnParentdHandler,this);a.addListener("navigateToItem",this.navigateToItemHandler,this);this.allDialogs.push(a);this.navigateContexts.push(b);this.lastActiveDialog=a},navigateToItemHandler:function(a,
b){var c=a.workItemID,e=Ext.Array.indexOf(this.allDialogs,a),e=this.navigateContexts[e],f=this.navigable.navigate.call(this.navigable,c,e.workItemIndex,b);if(null!=f){c=f.workItemID;f=f.workItemIndex;this.usePosition?this.navigable.deselectItemByIndex.call(this.navigable,e.workItemIndex):this.navigable.deselectItem.call(this.navigable,a.workItemID);a.workItemID=c;var g=this.navigable.navigate.call(this.navigable,c,f,"next"),h=this.navigable.navigate.call(this.navigable,c,f,"prev");e.workItemID=c;
e.workItemIndex=f;e.nextItem=g;e.prevItem=h;a.disabledNext=null==g;a.disabledPrev=null==h;a.reExecute();this.usePosition?this.navigable.selectItemByIndex.call(this.navigable,f):this.navigable.selectItem.call(this.navigable,a.workItemID)}else e="","next"==b?(e=getText("itemov.err.noNextAvailable"),a.setDisabledNextButton(!0)):(e=getText("itemov.err.noPrevAvailable"),a.setDisabledPrevButton(!0)),CWHF.showMsgError(e)},itemChangeHandler:function(a){null!=this.navigable&&this.navigable.itemChangeHandler.call(this.navigable,
a)},clickOnChildHandler:function(a){null!=this.navigable&&this.navigable.openItem.call(this.navigable,a)},clickOnLinkHandler:function(a){null!=this.navigable&&this.navigable.openItem.call(this.navigable,a)},clickOnParentdHandler:function(a){null!=this.navigable&&this.navigable.openItem.call(this.navigable,a)},activateItemDialog:function(a){this.lastActiveDialog=a;a=a.workItemID;null!=this.navigable&&this.navigable.selectItem.call(this.navigable,a)},deactivateItemDialog:function(a){this.lastActiveDialog=
null},releaseItemLock:function(a){Ext.Ajax.request({url:"releaseItemLock.action",params:{workItemID:a},success:function(a){},failure:function(a){}})},closeItemDialog:function(a,b){var c=a.workItemID,e=a.actionID;if(null!=c&&null!=e){var f=!1;null!=b&&(f=b.savedSuccessfully);!1!=f||2!=e&&3!=e&&5!=e||this.releaseItemLock(c)}this.lastActiveDialog==a&&(this.lastActiveDialog=null);c=Ext.Array.indexOf(this.allDialogs,a);this.navigateContexts=Ext.Array.erase(this.navigateContexts,c,1);this.allDialogs=Ext.Array.remove(this.allDialogs,
a)},findNextItem:function(a,b,c){var e=null;null!=this.navigable&&(e=this.navigable.navigate.call(this.navigable,a,null==b?"next":b,c));return e}});
Ext.define("com.trackplus.itemNavigator.FilterView",{extend:"Ext.tree.Panel",useArrows:!0,autoScroll:!0,rootVisible:!1,border:!1,cls:"westTreeNavigator",bodyBorder:!1,width:200,frame:!1,listeners:{staterestore:{fn:function(a,b){var c=b.width,e=borderLayout.getWidth();c>e+100&&(c=e-100,0>c&&(c=50),a.width=c)}}},config:{model:null,filterController:null,queryContextID:null},initComponent:function(){this.store=Ext.create("Ext.data.TreeStore",{fields:"id text objectID canDrop verifyAllowDropAJAX nodeType useFilter filterViewID maySaveFilterLayout iconCls icon dropHandlerCls cls".split(" "),
root:{expanded:!0,text:"",user:"",status:"",children:this.model.children},proxy:{type:"ajax",url:"itemNavigator!expandNode.action"}});this.callParent();this.initMyListeners()},initMyListeners:function(){this.view.addListener("afterrender",this.onTreeViewAfterRenderer,this);this.view.addListener("itemcontextmenu",this.onTreeNodeCtxMenu,this)},beforeCollapseWestNavigator:function(){this.lastIconCls=this.iconCls;this.setIconCls(null)},beforeExpandWestNavigator:function(){this.setIconCls(this.lastIconCls)},
onTreeViewAfterRenderer:function(){this.store.getRootNode().expandChildren();this.dropZone=Ext.create("com.trackplus.util.TreeDropZone",{view:this.view,ddGroup:"itemToCategory"})},onTreeNodeCtxMenu:function(a,b,c,e,f){f.stopEvent();this.createCtxMenu(a,b,f);return!1},createCtxMenu:function(a,b,c){if(null!=b){var e=b.data.nodeType;if(null!=e)switch(e){case "2_8":this.createProjectReleaseCtxMenu(a,b,c);break;case "2_5":this.createFilterCtxMenu(a,b,c);break;case "2_7":if(6==b.data.objectID){e=[];e.push({text:getText("common.btn.clear"),
iconCls:"clear16",scope:this,handler:function(){this.clearTrashBasket(b,a)}});var f=new Ext.menu.Menu({items:e});f.showAt(c.getXY())}}}return f},clearTrashBasket:function(){var a=this;borderLayout.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!emptyTrashBasket.action",disableCaching:!0,success:function(b){borderLayout.setLoading(!1);a.filterController.itemNavController.refresh.call(a.filterController.itemNavController,null,null,!1)},failure:function(){borderLayout.setLoading(!1)}})},createProjectReleaseCtxMenu:function(a,
b,c){var e=this,f=b.data.objectID;a.setLoading(!0);Ext.Ajax.request({url:"project!getProjectReleaseCtxMenu.action",params:{entityID:f},disableCaching:!0,success:function(g){var h=Ext.decode(g.responseText);g=h.data.issueTypes;var k=h.data.projectID,l=h.data.mightHaveRelease,m=[];if(h.data.isProjectAdmin){if(0>f){var n=getText("common.lbl.add",getText("admin.project.lbl.subproject"));m.push({text:n,iconCls:"projectAdd",scope:this,handler:function(){e.addSubproject(k,n)}});var p=getText("common.lbl.edit",
getText("admin.project.lbl.project"));m.push({text:p,iconCls:"projects-ticon",scope:this,handler:function(){e.editProject(k,p)}});var q=getText("common.lbl.assign",getText("admin.customize.role.lbl.roles"));m.push({text:q,iconCls:"roles-ticon",scope:this,handler:function(){e.assignRoles(k,q)}})}var t=null;if(l){var r=getText("admin.project.release.lbl.main");m.push({text:getText("common.lbl.add",r),iconCls:"releaseAdd",scope:this,handler:function(){e.addRelease(k,t)}})}0<f&&(t=f,m.push({text:getText("common.lbl.add",
getText("admin.project.release.childPhase.general")),iconCls:"releaseAdd",scope:this,handler:function(){e.addChildRelease(k,t)}}),m.push({text:getText("common.lbl.edit",r),iconCls:"releaseEdit",scope:this,handler:function(){e.editRelease(k,t)}}),m.push({text:getText("common.lbl.delete",r),iconCls:"delete",scope:this,handler:function(){e.deleteRelease(k,t)}}));m.push("-")}l&&m.push({text:getText("common.btn.releaseNotes"),iconCls:"releaseNotes16",scope:this,handler:function(){e.releaseNotes(b,a)}});
if(null!=g&&0<g.length)for(m.push("-"),r=0;r<g.length;r++)h=g[r],m.push({text:getText("common.lbl.add",h.label),icon:"optionIconStream.action?fieldID\x3d-2\x26optionID\x3d"+h.id,scope:{issueTypeID:h.id,projectID:k,releaseID:0<f?f:null},handler:function(a){borderLayout.controller.createNewIssue.call(borderLayout.controller,this.issueTypeID,this.projectID,this.releaseID)}});0<m.length&&(new Ext.menu.Menu({items:m})).showAt(c.getXY());a.setLoading(!1)},failure:function(){a.setLoading(!1)}})},addSubproject:function(a,
b){var c={add:!0,addAsSubproject:!0,projectID:a};Ext.create("com.trackplus.admin.project.ProjectConfig",{}).addOrEditProject(c,c,b,this,this.reloadAll)},editProject:function(a,b){var c={add:!1,projectID:a};Ext.create("com.trackplus.admin.project.ProjectConfig",{rootID:a}).addOrEditProject(c,c,b,this,this.reloadAll)},assignRoles:function(a,b){var c=Ext.create("com.trackplus.admin.project.RoleAssignment",{rootID:a,baseAction:"roleAssignments",treeWidth:200}),c={title:b,width:1200,height:800,formPanel:c.createCenterPanel(),
cancelButtonText:getText("common.btn.done")};Ext.create("com.trackplus.util.WindowConfig",c).showWindowByConfig(this)},addRelease:function(a,b){var c=""+a;null!=b&&(c=c+"_"+b);var c={add:!0,addAsChild:!1,node:c},e=getText("admin.project.release.lbl.main");this.addOrEditRelease(c,c,getText("common.lbl.add",e))},addChildRelease:function(a,b){var c=""+a;null!=b&&(c=c+"_"+b);var c={add:!0,addAsChild:!0,node:c},e=getText("admin.project.release.lbl.main");this.addOrEditRelease(c,c,getText("common.lbl.add",
e))},editRelease:function(a,b){var c=""+a;null!=b&&(c=c+"_"+b);var c={add:!1,addAsChild:!1,node:c},e=getText("admin.project.release.lbl.main");this.addOrEditRelease(c,c,getText("common.lbl.edit",e))},addOrEditRelease:function(a,b,c){var e=com.trackplus.admin.project.Release.createEditPanelItems(120);a={loadUrl:"release!edit.action",loadUrlParams:a};b={submitUrl:"release!save.action",submitUrlParams:b,submitButtonText:getText("common.btn.save"),refreshAfterSubmitHandler:this.reloadAll};Ext.create("com.trackplus.util.WindowConfig",
{title:c,width:600,height:400,load:a,submit:b,items:e,postDataProcess:com.trackplus.admin.project.Release.postDataLoadCombo}).showWindowByConfig(this)},deleteRelease:function(a,b){var c=this,e=getText("admin.project.release.lbl.main");Ext.MessageBox.confirm(getText("common.lbl.delete",e),getText("common.lbl.removeWarning",e),function(e){if("no"==e)return!1;c.deleteSelected.call(c,a,b)})},deleteSelected:function(a,b){var c=this,e=a+"_"+b,f=getText("admin.project.release.lbl.main");Ext.Ajax.request({url:"release!delete.action",
params:{node:e},disableCaching:!0,scope:c,success:function(a){a=Ext.decode(a.responseText);if(!0==a.success)c.reloadAll();else{var b=a.errorCode;if(null!=b){if(1==b){a=[{xtype:"label",itemId:"replacementWarning"},CWHF.createSingleTreePicker("Replacement","replacementID",[],null,{allowBlank:!1,blankText:getText("common.err.replacementRequired",f),labelWidth:150,margin:"5 0 0 0"})];var b=getText("common.lbl.delete",f),k={loadUrl:"release!renderReplace.action",loadUrlParams:{node:e}},l={submitUrl:"release!replaceAndDelete.action",
submitUrlParams:{node:e},submitButtonText:getText("common.btn.delete"),timeout:300,refreshAfterSubmitHandler:c.reloadAll};Ext.create("com.trackplus.util.WindowConfig",{postDataProcess:c.replaceOptionPostDataProcess,extraConfig:{}}).showWindow(c,b,500,200,k,l,a)}}else c.errorHandlerDelete(a)}},failure:function(a){com.trackplus.util.requestFailureHandler(a)},method:"POST"})},replaceOptionPostDataProcess:function(a,b,c){var e=b.getComponent("replacementWarning"),f=a.replacementWarning;null==f&&(f=a.label,
f=getText("common.lbl.replacementWarning",this.getEntityLabel(c),f),f+=getText("common.lbl.cancelDeleteAlert"));e.setText(f,!1);b=b.getComponent("replacementID");b.updateData(a.replacementTree);a=a.replacementListLabel;null==a&&(a=this.getTitle("common.lbl.replacement",c));b.labelEl.dom.innerHTML=a},reloadAll:function(){borderLayout.setLoading(!0);window.location.href="itemNavigator.action"},releaseNotes:function(a,b){window.open("releaseNotes.action?project\x3d"+a.data.objectID,"_blank")},createFilterCtxMenu:function(a,
b,c){var e=this,f=b.data.objectID;a.setLoading(!0);Ext.Ajax.request({url:"filterConfig!filterIsModifiable.action",params:{filterID:f},disableCaching:!0,success:function(g){g=Ext.decode(g.responseText).value;var h=[],k=getText("admin.customize.queryFilter.lbl.issueFilter");h.push({text:getText("common.lbl.add",k),iconCls:"filterAdd",scope:this,handler:function(){e.addFilter(f)}});g&&h.push({text:getText("common.lbl.edit",k),iconCls:"filterEdit",scope:this,handler:function(){e.editFilter(f)}});h.push({text:getText("common.lbl.remove",
k),iconCls:"delete",scope:this,handler:function(){e.removeFilter(a,b,f)}});(new Ext.menu.Menu({items:h})).showAt(c.getXY());a.setLoading(!1)},failure:function(){a.setLoading(!1)}})},removeFilter:function(a,b,c){Ext.Ajax.request({url:"filtersInMenu!delete.action",params:{unassign:c},disableCaching:!0,success:function(a){b.remove(!0)}})},addFilter:function(a){a=getText("admin.customize.queryFilter.lbl.issueFilter");this.addOrEditFilter(!0,null,1,getText("common.lbl.add",a))},editFilter:function(a){var b=
getText("admin.customize.queryFilter.lbl.issueFilter");this.addOrEditFilter(!1,a,1,getText("common.lbl.edit",b))},addOrEditFilter:function(a,b,c,e){var f=Ext.create("com.trackplus.admin.customize.category.CategoryConfig",{rootID:"issueFilter"});f.indexMax=0;f.instant=!1;f.renderPath=a;com.trackplus.admin.CategoryConfig.showAddEditFilter(f,this,this.reloadAll,a,b,c,e)}});
Ext.define("com.trackplus.itemNavigator.FilterController",{extend:"Ext.Base",config:{model:null,queryContext:null,skipEmptyNodeType:!1,itemNavController:null,subFilterVisible:!1},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},createView:function(){var a=this;if(null==a.model)return a.view=null;a.filterView=a.createTreeView(a.model.queryView,!0==a.subFilterVisible,a.queryContext.queryType+"_"+a.queryContext.queryID);var b=getText("common.lbl.queries");!0==a.subFilterVisible?
(a.subFilterView=a.createTreeView(a.model.subFilterView),b=b+" \x3e "+getText("common.lbl.subfilter")):a.subFilterView=null;var c=[];c.push(a.filterView);null!=a.subFilterView&&c.push(a.subFilterView);a.toolPlus=Ext.create("Ext.panel.Tool",{type:"plus",hidden:!0==a.subFilterVisible,tooltip:getText("common.lbl.subfilter"),handler:function(){a.toolPlus.setVisible(!1);a.toolMinus.setVisible(!0);a.showHideSubFilter()}});a.toolMinus=Ext.create("Ext.panel.Tool",{type:"minus",tooltip:getText("common.lbl.subfilter.clear"),
hidden:!0!=a.subFilterVisible,handler:function(){a.toolPlus.setVisible(!0);a.toolMinus.setVisible(!1);a.showHideSubFilter()}});var e=225;null!=a.subFilterView&&(e=450);a.view=Ext.create("Ext.panel.Panel",{region:"west",bodyBorder:!1,border:!1,margins:Ext.isIE?"0 -4 0 0":"0 -5 0 0",width:e,minWidth:e,collapsible:!0,title:b,cls:"westTreeNavigator",collapsedCls:"westTreeNavigatorCollapsed",split:!0,tools:[a.toolPlus,a.toolMinus],layout:{type:"hbox",pack:"start",align:"stretch"},defaults:{flex:1},items:c});
return a.view},createTreeView:function(a,b,c){var e=this,f="westTreeNavigator";!0==b&&(f+=" westTreeNavigator-borderRight");var g=Ext.create("com.trackplus.itemNavigator.FilterView",{flex:1,model:a,cls:f,filterController:this});null!=c?g.addListener("afterrender",function(){var a=g.getStore().getNodeById(c);null!=a&&(g.getSelectionModel().select(a),g.expandPath(a.getPath()));g.addListener("select",function(a,b,c,f){e.filterByNode.call(e,a,b,c,f);return!1})}):g.addListener("select",function(a,b,c,
f){e.filterByNode.call(e,a,b,c,f);return!1});g.getView().addListener("beforedrop",function(a,b,c){return c.data.canDrop?!0:!1});g.getView().addListener("drop",function(a,b,c,f,g){e.dropOnNode.call(e,a,b,c,f,g);return!0});g.store.on("beforeload",function(a,b,c){null!=b.node&&(a=e.getTreeExpandExtraParams.call(e,b.node),null!=a&&(g.store.proxy.extraParams=a))});return g},getTreeExpandExtraParams:function(a){return{nodeType:a.data.nodeType,nodeObjectID:a.data.objectID}},showHideSubFilter:function(){var a=
this;a.subFilterVisible=!a.subFilterVisible;var b=getText("common.lbl.queries");if(!0==a.subFilterVisible){var c=Ext.clone(a.model.subFilterView);a.subFilterView=a.createTreeView(c);a.view.getEl().fadeOut({opacity:0.1,easing:"easeOut",duration:250,remove:!1,useDisplay:!1,callback:function(){450>a.view.width&&a.view.setWidth(450);a.filterView.addCls("westTreeNavigator-borderRight");a.view.add(a.subFilterView);b=b+" \x3e "+getText("common.lbl.subfilter");a.view.setTitle(b);a.view.getEl().fadeIn({opacity:1,
easing:"easeOut",duration:500,callback:function(){a.view.doLayout()}})}})}else{var e=a.isNeedToClear();a.view.getEl().fadeOut({opacity:0.1,easing:"easeOut",duration:250,remove:!1,useDisplay:!1,callback:function(){225<a.view.width&&a.view.setWidth(225);a.filterView.removeCls("westTreeNavigator-borderRight");a.view.remove(a.subFilterView,!0);a.subFilterView=null;e&&a.itemNavController.clearSubfilter.call(a.itemNavController);a.view.setTitle(b);a.view.getEl().fadeIn({opacity:1,easing:"easeOut",duration:500,
callback:function(){a.view.doLayout()}})}})}},isNeedToClear:function(){var a=!1,b=this.subFilterView.getSelectionModel().getSelection();null!=b&&0<b.length&&(b=b[0].data.nodeType,null!=b&&""!=b&&(a=!0));return a},clearSubFilter:function(){this.isNeedToClear()&&(this.subFilterView.getSelectionModel().deselectAll(),this.itemNavController.clearSubfilter.call(this.itemNavController))},updatePossibleFieldOptions:function(a){var b=4,c=a["field"+b],e=a["partialField"+b],b=this.filterView.getStore().getNodeById("section_status");
this.markValidDropNodes(b,c,e);if(!0==this.subFilterVisible){var f=[];f.push(4);f.push(10);for(var g=0;g<f.length;g++)b=f[g],c=a["field"+b],e=a["partialField"+b],b=this.subFilterView.getStore().getNodeById("section_operation_ItemOperationSelect_"+b),this.markValidDropNodes(b,c,e)}},markValidDropNodes:function(a,b,c){a=a.childNodes;if(null!=a)for(var e=0;e<a.length;e++){var f=a[e],g=f.data.id,h=parseInt(g.substring(g.lastIndexOf("_")+1)),g=f.get("cls"),k=null==b||-1!=Ext.Array.indexOf(b,h),h=null!=
c&&-1!=Ext.Array.indexOf(c,h);k&&(f.set("cls",g+" treeItem-dropOk"),f.set("canDrop",!0));h&&(f.set("cls",g+" treeItem-dropPartial"),f.set("canDrop",!0));k||h||(f.set("cls",g+" treeItem-dropDisabled"),f.set("canDrop",!1))}},clearMarkedNodes:function(a){a=a.childNodes;if(null!=a)for(var b=0;b<a.length;b++){var c=a[b],e=c.get("cls");null!=e&&(e=e.replace(" treeItem-dropOk",""),e=e.replace(" treeItem-dropPartial",""),e=e.replace(" treeItem-dropDisabled",""),c.set("cls",e))}},onAfterDropItems:function(){var a=
this.filterView.getStore().getNodeById("section_status");this.clearMarkedNodes(a);if(!0==this.subFilterVisible){var b=[];b.push(4);b.push(10);for(var c=0;c<b.length;c++)a=b[c],a=this.subFilterView.getStore().getNodeById("section_operation_ItemOperationSelect_"+a),this.clearMarkedNodes(a)}},filterByNode:function(a,b){var c=b.data.nodeType;if(!0==this.skipEmptyNodeType&&(null==c||""==c))return!1;this.itemNavController.filterByNodeType.call(this.itemNavController,b.data)},getSelectedItemIds:function(a){for(var b=
"",c=-1,e=0;e<a.records.length;e++){var f=a.records[e].data.workItemID;try{c=parseInt(f)}catch(g){c=-1}isNaN(c)||-1==c||(b+=c+",")}return b},dropOnNodeAjaxRequest:function(a,b,c,e,f,g){var h=this,k=h.getSelectedItemIds(b);if(""==k)return!1;var l=c.data.objectID,m=c.data.nodeType;h.view.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!canDropOnNode.action",disableCaching:!0,success:function(k){k=Ext.decode(k.responseText).data.canDrop;h.view.setLoading(!1);k&&h.dropOnNode.call(h,a,b,c,e,f,g)},failure:function(){h.view.setLoading(!1)},
method:"POST",params:{workItems:k,nodeType:m,nodeObjectID:l}})},dropOnNode:function(a,b,c){a=this.getSelectedItemIds(b);if(""==a)return!1;var e=c.data.objectID,f=c.data.nodeType;c=c.data.dropHandlerCls;if(null==c||""==c)c="com.trackplus.itemNavigator.DropHandler";b=Ext.create(c,{workItemID:a[0],workItemIndex:b.records[0].data.workItemIndex,workItems:a,nodeType:f,nodeObjectID:e,itemNavController:this.itemNavController});b.execute.call(b)}});
Ext.define("com.trackplus.itemNavigator.DropHandler",{extend:"Ext.Base",config:{workItemIndex:null,workItemID:null,workItems:null,nodeType:null,nodeObjectID:null,itemNavController:null},TYPE_COMMON:0,TYPE_MASS_OPERATION:1,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},execute:function(){this.ajaxRequest.call(this,{workItems:this.workItems,nodeType:this.nodeType,nodeObjectID:this.nodeObjectID})},ajaxRequest:function(a){var b=this;b.itemNavController.view.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!dropOnNode.action",
disableCaching:!0,success:function(c){c=Ext.decode(c.responseText);b.itemNavController.view.setLoading(!1);!0==c.success?b.itemNavController.refresh.call(b.itemNavController,null,null,!1,function(){null!=b.workItemIndex?b.itemNavController.issueListFacade.selectItemByIndex.call(b.itemNavController.issueListFacade,b.workItemIndex):null!=b.workItemID?b.itemNavController.issueListFacade.selectItem.call(b.itemNavController.issueListFacade,b.workItemID):b.itemNavController.issueListFacade.selectItem.call(b.itemNavController.issueListFacade,
b.workItems.split(","))}):b.handleError.call(b,c,a)},failure:function(){b.itemNavController.view.setLoading(!1)},method:"POST",params:a})},confirmationSubmitHandler:function(a){null==a&&(a={});a["params.confirmSave"]="true";this.ajaxRequest.call(this,a)},handleError:function(a,b){var c=this;switch(a.type){case c.TYPE_COMMON:var e=getText("common.err.failure");null!=a.title&&(e=a.title);Ext.MessageBox.show({title:e,msg:a.errorMessage,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});break;case c.TYPE_MASS_OPERATION:var f=
a.massOperation,e=f.errorCode;null!=e&&4==e?(e="Error",null!=f.title&&(e=f.title),Ext.MessageBox.confirm(e,f.errorMessage,function(a){if("no"==a)return!1;c.confirmationSubmitHandler.call(c,b)})):(e="Error",null!=f.title&&(e=f.title),Ext.MessageBox.show({title:e,msg:f.errorMessage,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING}))}}});
Ext.define("com.trackplus.itemNavigator.PopupDropHandler",{extend:"com.trackplus.itemNavigator.DropHandler",config:{width:600,height:400,title:"",layout:"fit",iconCls:null,autoScroll:!1},execute:function(){this.formPanel=this.createFormPanel();null==this.formPanel?this.ajaxRequest.call(this,{workItems:this.workItems,nodeType:this.nodeType,nodeObjectID:this.nodeObjectID}):this.openDialog()},openDialog:function(){var a=this;null!=a.modalDialog&&a.modalDialog.destroy();null==a.width&&(a.width=600);null==
a.height&&(a.height=400);null==a.autoScroll&&(a.autoScroll=!1);a.modalDialog=new Ext.Window({layout:a.layout,width:a.width,height:a.height,iconCls:a.iconCls,closeAction:"destroy",plain:!0,bodyBorder:!1,bodyStyle:{border:"none"},title:a.title,modal:!0,items:[a.formPanel],autoScroll:a.autoScroll,buttons:[{text:getText("common.btn.ok"),handler:function(){a.okHandler.call(a)}},{text:getText("common.btn.close"),handler:function(){a.modalDialog.destroy()}}]});a.modalDialog.show()},okHandler:function(){var a=
this,b={workItems:a.workItems,nodeType:a.nodeType,nodeObjectID:a.nodeObjectID};a.formPanel.getForm().submit({url:"itemNavigator!dropOnNode.action",params:b,scope:a,success:function(c,e){e.result.success?(a.modalDialog.destroy(),a.itemNavController.refresh.call(a.itemNavController)):a.handleError.call(a,e.result,b)},failure:function(c,e){a.handleError.call(a,e.result,b)}})},createFormPanel:function(){return Ext.create("Ext.form.Panel",{items:this.createFormItems()})},createFormItems:function(){return[]}});
Ext.define("com.trackplus.itemNavigator.BasketDropHandler",{extend:"com.trackplus.itemNavigator.PopupDropHandler",width:450,height:250,layout:"fit",iconCls:null,autoScroll:!1,title:getText("itemov.basketOperation.delegate.title"),createFormPanel:function(){switch(this.nodeObjectID){case 4:return this.width=380,this.height=100,this.title=getText("itemov.basketOperation.calendar.title"),Ext.create("Ext.form.Panel",{layout:{type:"hbox"},bodyStyle:{padding:"5px"},items:this.createFormItemsCalendar()});
case 5:return Ext.create("Ext.form.Panel",{bodyStyle:{padding:"5px"},items:this.createFormItems()})}return null},createFormItemsCalendar:function(){return[CWHF.createDateTimeField("itemov.basketOperation.calendar.date","params.date","params.time",{submitFormat:null,width:100},{width:80,increment:30},{labelWidth:150})]},createFormItems:function(){var a=Ext.create("Ext.data.Store",{fields:["id","label"],proxy:{type:"ajax",url:"itemNavigator!getResponsibles.action?workItems\x3d"+this.workItems,reader:{type:"json"}}}),
a=Ext.create("Ext.form.field.ComboBox",{fieldLabel:getText("admin.customize.automail.trigger.lbl.responsible"),labelAlign:"right",store:a,displayField:"label",valueField:"id",labelWidth:100,width:250,name:"params.responsible"}),b=CWHF.createDateTimeField("itemov.basketOperation.delegate.date","params.date","params.time",{submitFormat:null,width:100},{width:80,increment:30},{labelWidth:100}),c=Ext.create("Ext.form.field.TextArea",{fieldLabel:getText("common.history.lbl.comment"),labelAlign:"right",
name:"params.comment",minWidth:25,labelWidth:100,anchor:"100% -50"});return[a,b,c]}});
Ext.define("com.trackplus.itemNavigator.SimpleTreeGridViewPlugin",{extend:"com.trackplus.itemNavigator.IssueListViewPlugin",mixins:{navigable:"com.trackplus.itemNavigator.TreeNavigableItem"},view:null,includeLongFields:!1,useArrows:!1,lines:!0,disableSort:!1,treeColumnID:null,useSelectionModel:!1,useTree:!0,UNIFORMIZED_FIELD_TYPES:{singleSelect:"SINGLE_SELECT",datePicker:"DATE_PICKER",simpleTextField:"SIMPLE_TEXT_FIELD",checkBox:"CHECK_BOX",numberEditor:"NUMBER_EDITOR"},constructor:function(a){this.callParent(arguments);
this.mixins.navigable.constructor.call(this)},refreshData:function(a){if(null!=this.view){var b=this.view.getStore().getRootNode();b.removeAll(!0);null!=a&&0<a.length&&(b.appendChild(a),this.view.getStore().sort())}},createView:function(){var a=this;a.queryFieldCSS=a.model.queryFieldCSS;a.cellInlineCtr=Ext.create("com.trackplus.itemNavigator.CellInlineEditController",{navigator:a,isPrintItemEditable:a.model.isPrintItemEditable});a.view=Ext.create("Ext.tree.Panel",{margins:"0 0 0 0",region:"center",
border:!1,bodyBorder:!1,columnLines:!0,lines:a.lines,rootVisible:!1,useArrows:a.useArrows,cls:"simpleGridView gridNoBorder",plugins:[{ptype:"cellediting",clicksToEdit:1}],viewConfig:{stripeRows:!0,plugins:a.getTreeViewPlugins(),getRowClass:function(b,c,e,f){return a.getRowClass.call(a,b,c,e,f)}},store:a.createStore(),columns:a.createColumnModel(),selModel:a.createSelModel(),features:a.createFeatures.call(a)});a.initMyListeners();a.cellInlineCtr.grid=a.view;a.cellInlineCtr.initListeners();return a.view},
destroyView:function(){this.view=null;delete this.view},getTreeViewPlugins:function(){return[{ddGroup:"itemToCategory",ptype:"gridviewdragdrop",enableDrop:!1}]},getSelectedIssues:function(){var a=[];if(this.model.layout.bulkEdit){var b=this.view.getSelectionModel().getSelection();if(null!=b&&0<b.length)for(var c=0;c<b.length;c++)a.push(b[c].data.workItemID)}return a},getTreeGrid:function(){return this.view},selectItemByIndex:function(a){return this.selectItemByIndexInTree(this.view,a)},selectItem:function(a){return this.selectItemInTree(this.view,
a)},deselectItem:function(a){return this.deselectItemInTree(this.view,a)},initMyListeners:function(){this.view.on("boxready",function(a){a.view.focus=Ext.emptyFn});this.view.addListener("itemcontextmenu",this.onGridItemContextMenu,this);this.view.addListener("celldblclick",this.onGridItemDblClick,this);this.view.addListener("afterrender",this.onGridAfterRenderer,this);this.view.addListener("columnresize",this.columnResizeHandler,this);this.view.addListener("columnmove",this.columnMoveHandler,this);
this.view.addListener("sortchange",this.sortChangeHandler,this);this.view.addListener("afteritemexpand",this.afterItemExpandHandler,this);this.view.addListener("afteritemcollapse",this.afterItemCollapseHandler,this);this.view.getSelectionModel().addListener("selectionchange",this.onGridSelectionChange,this)},onGridSelectionChange:function(a,b){this.model.layout.bulkEdit&&this.fireEvent.call(this,"selectionchange",b);if(null!=this.cellInlineCtr)this.cellInlineCtr.onGridSelectionChnage(a,b)},onGridAfterRenderer:function(){var a=
this,b=Ext.get("rowExpandAllTrg");null!=b&&b.addListener("click",a.rowExpandAll,a);b=Ext.get("rowCollapseAllTrg");null!=b&&b.addListener("click",a.rowCollapseAll,a);b=this.view.view.plugins[0].dragZone;null!=b&&(b.onStartDrag=function(b,e){var f=a.getSelectedItemIds(this.dragData.records);a.fireEvent("startDragItems",f);return!0},b.afterDragDrop=function(){a.fireEvent("afterDropItems")},b.afterInvalidDrop=function(){a.fireEvent("afterDropItems")})},getSelectedItemIds:function(a){for(var b="",c=-1,
e=0;e<a.length;e++){var f=a[e].data.workItemID;try{c=parseInt(f)}catch(g){c=-1}isNaN(c)||-1==c||(b+=c+",")}return b},onGridItemContextMenu:function(a,b,c,e,f,g){f.stopEvent();this.fireEvent("itemcontextmenu",b.data,f,this.view,e,b);return!1},onGridItemDblClick:function(a,b,c,e,f,g,h){h.stopEvent();if(!0==this.model.layout.bulkEdit&&0==c)return!1;this.fireEvent.call(this,"itemdblclick",e.data,b);return!1},invalidExpandCollapse:!1,expandCollapseItem:function(a,b){var c=a.data.id;-1!=(c+"").indexOf("g")?
this.expandGroup(c.substring(1),b):this.expandItem(c,b)},expandGroup:function(a,b){Ext.Ajax.request({url:"reportExpand!expandGroup.action",params:{expanded:b,groupID:a}})},expandItem:function(a,b){Ext.Ajax.request({url:"reportExpand!expandReportBean.action",params:{expanded:b,workItemID:a}})},afterItemExpandHandler:function(a,b,c){!0!=this.invalidExpandCollapse&&this.expandCollapseItem(a,!0)},afterItemCollapseHandler:function(a,b,c,e){!0!=this.invalidExpandCollapse&&this.expandCollapseItem(a,!1)},
validateExpandCollapse:function(a){var b=this;Ext.Function.defer(function(){b.invalidExpandCollapse=!1},3E3,b)},rowExpandAll:function(a){a.stopEvent();this.invalidExpandCollapse=!0;this.view.expandAll(this.validateExpandCollapse,this);Ext.Ajax.request({url:"reportExpand!expandAll.action"});return!1},rowCollapseAll:function(a){a.stopEvent();this.invalidExpandCollapse=!0;this.view.collapseAll(this.validateExpandCollapse,this);Ext.Ajax.request({url:"reportExpand!collapseAll.action"});return!1},columnResizeHandler:function(a,
b,c){var e=this;a=b.itemId.substring(2);Ext.Ajax.request({url:"layoutColumns!resizeColumn.action",disableCaching:!0,success:function(a){e.fireEvent.call(e,"layoutchange")},failure:function(){},method:"POST",params:{layoutID:a,fieldID:b.fieldID,width:c,filterType:e.model.queryContext.queryType,filterID:e.model.queryContext.queryID}})},sortChangeHandler:function(a,b,c){a=b.dataIndex.substring(1);c="DESC"==c;this.model.layout.sortField=a;this.model.layout.sortOrder=c;this.model.layout.sortWithSO=b.sortWithSO;
null!=this.model.queryContext&&(filterType=this.model.queryContext.queryType,filterID=this.model.queryContext.queryID);this.fireEvent.call(this,"sortchange",{sortField:a,sortOrder:c,sortWithSO:b.sortWithSO});Ext.Ajax.request({url:"layoutSorting.action",disableCaching:!0,params:{sortField:a,sortOrder:c,filterType:filterType,filterID:filterID}})},createFeatures:function(){return[]},getSorters:function(){var a=null;if(null!=this.model.layout.sortField){var b="f"+this.model.layout.sortField,c;c=!0==this.model.layout.sortOrder?
"DESC":"ASC";a=[];!0==this.model.layout.sortWithSO?a.push({property:b,direction:c,sorterFn:function(a,b){this.getRoot(a);this.property.substring(1);this.getRoot(b);this.property.substring(1)}}):a.push({property:b,direction:c})}return a},createStore:function(){var a=this.createFields(),a=Ext.create("Ext.data.TreeStore",{fields:a,autoLoad:!1,sorters:this.getSorters(),root:{expanded:!0,text:"",children:this.model.issues}});a.addListener("refresh",this.onStoreRefresh,this);return a},findNodeByWorkItemIndex:function(a){var b=
null,c=0,e=0;this.view.getStore().getRootNode().cascadeBy(function(f){var g=f.data.workItemIndex;null!=g&&(g>c&&(c=g,e=f),g==a&&(b=f))});return null!=b?b:e},getLayoutData:function(a){},createColumnModel:function(){var a=this.model.layout.shortFields,b=[],c;if(!0==this.model.layout.indexNumber){var e=this.model.totalCount,f=0,f=null==e||0==e?21:5*(e+"").length+17;b.push({draggable:!1,menuDisabled:!0,width:f,dataIndex:"workItemIndex",sortable:!1,align:"right",tdCls:"simpleTreeGridCell",resizable:!1})}for(e=
0;e<a.length;e++)c=a[e],f=this.createColumn(e,c,!this.disableSort,this.useTree),0<e&&(this.cellInlineCtr.setColumnEditor(a[e],f),c=this.getUniformizedFieldType(c.extJsRendererClass),null!=c&&(c=this.getRendererForSpecificColumns(c),null!=c&&(f.renderer=c))),b.push(f);return b},getRendererForSpecificColumns:function(a){var b=null;a==this.UNIFORMIZED_FIELD_TYPES.datePicker&&(b=function(a,b,f,g,h,k,l){if(null!=a&&""!=a){if(a=Ext.Date.parse(a,com.trackplus.TrackplusConfig.DateFormat),b=!1,null!=f.data.isProject&&
(b=f.data.isProject),!b)return Ext.util.Format.date(a,com.trackplus.TrackplusConfig.DateFormat)}else return""});a==this.UNIFORMIZED_FIELD_TYPES.singleSelect&&(b=function(a,b){var f=b.column.getEditor();if(a&&f&&f.store&&f.displayField){var g=parseInt(a),g=f.store.findExact(f.valueField,g);if(0<=g)return f.store.getAt(g).get(f.displayField)}return a});a==this.UNIFORMIZED_FIELD_TYPES.checkBox&&(b=function(a,b){var f=b.column.getEditor();return"true"==a||"false"==a?f.checked?getText("common.boolean.Y"):
getText("common.boolean.N"):a});return b},dataChangeSuccess:function(a){this.cellInlineCtr.dataChangeSuccess()},getUniformizedFieldType:function(a){switch(a){case "com.aurel.trackplus.field.SynopsisTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.simpleTextField;case "com.aurel.trackplus.field.PersonPickerRenderer":case "com.aurel.trackplus.field.StateRenderer":case "com.aurel.trackplus.field.PriorityRenderer":case "com.aurel.trackplus.field.SelectTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.singleSelect;
case "com.aurel.trackplus.field.DateTypeRenderer":case "com.aurel.trackplus.field.StartDateRenderer":case "com.aurel.trackplus.field.EndDateRenderer":case "com.aurel.trackplus.field.StartDateTargetRenderer":case "com.aurel.trackplus.field.EndDateTargetRenderer":return this.UNIFORMIZED_FIELD_TYPES.datePicker;case "com.aurel.trackplus.field.CheckBoxTypRenderer":return this.UNIFORMIZED_FIELD_TYPES.checkBox;case "com.aurel.trackplus.field.DurationRenderer":return this.UNIFORMIZED_FIELD_TYPES.numberEditor;
default:return null}}});
Ext.define("com.trackplus.itemNavigator.CheckboxModel",{extend:"Ext.selection.CheckboxModel",updateHeaderState:function(){var a=this.store,b=a.getCount(),c=this.views,e=!1,f=0,g,h=0,k=this.store.getRange();for(g=0;g<k.length;g++)!0==k[g].get("group")&&h++;if(!a.buffered&&0<b){a=this.selected;g=0;for(e=a.getCount();g<e&&this.storeHasSelected(a.getAt(g));++g)++f;e=b===f+h}c&&c.length&&this.toggleUiHeader(e)},deselectAll:function(){this.callParent(arguments)},listeners:{beforeselect:function(a,b,c){return!0!=
b.get("group")},beforedeselect:function(a,b,c){return!0!=b.get("group")}}});function openAttachments(a,b){for(var c=b.split(";"),e=0;e<c.length;e++){var f="downloadAttachment.action?workItemID\x3d"+a+"\x26attachKey\x3d"+c[e];0==e?window.open(f,"attachmentWindow"):window.open(f)}}
Ext.define("com.trackplus.itemNavigator.FlatGridViewPlugin",{extend:"com.trackplus.itemNavigator.IssueListViewPlugin",mixins:{navigable:"com.trackplus.itemNavigator.GridNavigableItem"},plainGrid:!0,view:null,includeLongFields:!0,disableSort:!1,treeColumnID:null,useSelectionModel:!1,useTree:!0,paginate:!1,pageSize:10,cellInlineCtr:null,UNIFORMIZED_FIELD_TYPES:{singleSelect:"SINGLE_SELECT",datePicker:"DATE_PICKER",simpleTextField:"SIMPLE_TEXT_FIELD",checkBox:"CHECK_BOX",numberEditor:"NUMBER_EDITOR"},
constructor:function(a){this.callParent(arguments);this.mixins.navigable.constructor.call(this);this.paginate=this.model.listViewData.paginate;this.pageSize=this.model.listViewData.pageSize},refreshData:function(a){null!=this.view&&this.view.getStore().loadData(a)},createFields:function(){var a=this.callParent(),b=this.model.layout.longFields;if(null!=b)for(var c=0;c<b.length;c++)a.push({name:"f"+b[c].reportField});a.push({name:"leaf"});return a},getSettingsToolbarItems:function(a,b){var c=this.callParent(arguments),
e=getText("itemov.lbl.paginate");this.checkPaginate=Ext.create("Ext.form.field.Checkbox",{boxLabel:e,overflowText:e,tooltip:getText("itemov.lbl.paginate.tt"),inputValue:!0,checked:this.paginate});this.checkPaginate.addListener("change",this.changePaginate,this);c.push(this.checkPaginate);return c},changePaginate:function(){var a=this;a.view.setLoading(!0);a.paginate=a.checkPaginate.getValue();Ext.Ajax.request({url:"userPreferences.action?property\x3ditemNavigatorPaginate\x26value\x3d"+a.paginate,
disableCaching:!0,success:function(b){a.view.setLoading(!1);a.fireEvent.call(a,"datachange")},failure:function(a,c){}})},changePageSize:function(a,b){if(b.getKey()==b.ENTER){var c=this;c.view.setLoading(!0);c.pageSize=c.txtPageSize.getValue();Ext.Ajax.request({url:"userPreferences.action?property\x3ditemNavigatorPageSize\x26value\x3d"+c.pageSize,disableCaching:!0,success:function(a){c.view.setLoading(!1);c.fireEvent.call(c,"datachange")},failure:function(a,b){}})}},createView:function(){var a=this;
a.cellInlineCtr=Ext.create("com.trackplus.itemNavigator.CellInlineEditController",{navigator:a,isPrintItemEditable:a.model.isPrintItemEditable});a.queryFieldCSS=a.model.queryFieldCSS;var b=a.createStore(),c={margins:"0 0 0 0",region:"center",border:!1,bodyBorder:!1,columnLines:!0,cls:"simpleGridView gridNoBorder",plugins:[{ptype:"cellediting",clicksToEdit:1}],viewConfig:{stripeRows:!0,plugins:a.getTreeViewPlugins(),getRowClass:function(b,c,g,h){return a.getRowClass.call(a,b,c,g,h)}},store:b,columns:a.createColumnModel(),
selModel:a.createSelModel(),features:a.createFeatures.call(a)};!0==a.paginate&&(a.txtPageSize=Ext.create("Ext.form.field.Number",{name:"pageSize",fieldLabel:getText("itemov.lbl.pageSize"),labelAlign:"right",value:a.pageSize,maxValue:1E4,minValue:10,allowDecimals:!1,width:175}),a.txtPageSize.addListener("specialkey",a.changePageSize,a),c.tbar=Ext.create("Ext.PagingToolbar",{itemId:"paginateToolbar",store:b,displayInfo:!0,afterPageText:getText("itemov.lbl.paginate.afterPageText"),beforePageText:getText("itemov.lbl.paginate.beforePageText"),
displayMsg:getText("itemov.lbl.paginate.displayMsg"),emptyMsg:getText("itemov.lbl.paginate.emptyMsg"),items:["-",a.txtPageSize]}));a.view=Ext.create("Ext.grid.Panel",c);a.initMyListeners();a.cellInlineCtr.grid=a.view;a.cellInlineCtr.initListeners();return a.view},destroyView:function(){this.view=null;delete this.view},getTreeViewPlugins:function(){return[{ddGroup:"itemToCategory",ptype:"gridviewdragdrop",enableDrop:!1}]},getSelectedIssues:function(){var a=[];if(this.model.layout.bulkEdit){var b=this.view.getSelectionModel().getSelection();
if(null!=b&&0<b.length)for(var c=0;c<b.length;c++)a.push(b[c].data.workItemID)}return a},getGrid:function(){return this.view},getFieldNameItemID:function(){return"workItemID"},selectItemByIndex:function(a){return this.selectItemGridByIndex(this.view,a)},selectItem:function(a){var b=this.getGrid();return null==b||null==a?null:this.selectItemGrid(b,a)},deselectItem:function(a){var b=this.getGrid();if(null==b||null==a)return null;this.deselectItemGrid(b,a)},initMyListeners:function(){this.view.on("boxready",
function(a){a.view.focus=Ext.emptyFn});this.view.addListener("itemcontextmenu",this.onGridItemContextMenu,this);this.view.addListener("celldblclick",this.onGridItemDblClick,this);this.view.addListener("afterrender",this.onGridAfterRenderer,this);this.view.addListener("columnresize",this.columnResizeHandler,this);this.view.addListener("columnmove",this.columnMoveHandler,this);this.view.addListener("sortchange",this.sortChangeHandler,this);this.view.addListener("afteritemexpand",this.afterItemExpandHandler,
this);this.view.addListener("afteritemcollapse",this.afterItemCollapseHandler,this);this.view.getSelectionModel().addListener("selectionchange",this.onGridSelectionChange,this)},onGridSelectionChange:function(a,b){this.model.layout.bulkEdit&&this.fireEvent.call(this,"selectionchange",b);if(null!=this.cellInlineCtr)this.cellInlineCtr.onGridSelectionChnage(a,b)},onGridAfterRenderer:function(){var a=this,b=Ext.get("rowExpandAllTrg");null!=b&&b.addListener("click",a.rowExpandAll,a);b=Ext.get("rowCollapseAllTrg");
null!=b&&b.addListener("click",a.rowCollapseAll,a);b=this.view.view.plugins[0].dragZone;null!=b&&(b.onStartDrag=function(b,e){var f=a.getSelectedItemIds(this.dragData.records);a.fireEvent("startDragItems",f);return!0},b.afterDragDrop=function(){a.fireEvent("afterDropItems")},b.afterInvalidDrop=function(){a.fireEvent("afterDropItems")})},getSelectedItemIds:function(a){for(var b="",c=-1,e=0;e<a.length;e++){var f=a[e].data.workItemID;try{c=parseInt(f)}catch(g){c=-1}isNaN(c)||-1==c||(b+=c+",")}return b},
onGridItemContextMenu:function(a,b,c,e,f,g){f.stopEvent();this.fireEvent("itemcontextmenu",b.data,f,this.view,e,b);return!1},onGridItemDblClick:function(a,b,c,e,f,g,h){h.stopEvent();if(!0==this.model.layout.bulkEdit&&0==c)return!1;this.fireEvent.call(this,"itemdblclick",e.data,b);return!1},invalidExpandCollapse:!1,columnResizeHandler:function(a,b,c){var e=this;a=b.itemId.substring(2);Ext.Ajax.request({url:"layoutColumns!resizeColumn.action",disableCaching:!0,success:function(a){e.fireEvent.call(e,
"layoutchange")},failure:function(){},method:"POST",params:{layoutID:a,fieldID:b.fieldID,width:c,filterType:e.model.queryContext.queryType,filterID:e.model.queryContext.queryID}})},sortChangeHandler:function(a,b,c){var e=this;a=b.dataIndex.substring(1);c="DESC"==c;e.model.layout.sortField=a;e.model.layout.sortOrder=c;e.model.layout.sortWithSO=b.sortWithSO;var f=null,g=null;null!=e.model.queryContext&&(f=e.model.queryContext.queryType,g=e.model.queryContext.queryID);e.fireEvent.call(e,"sortchange",
{sortField:a,sortOrder:c,sortWithSO:b.sortWithSO});Ext.Ajax.request({url:"layoutSorting.action",disableCaching:!0,params:{sortField:a,sortOrder:c,filterType:f,filterID:g},success:function(){!0==e.paginate&&e.view.getDockedComponent("paginateToolbar").moveFirst()}})},createFeatures:function(){var a=[];null!=this.model.layout.longFields&&0<this.model.layout.longFields.length&&a.push(this.createRowBodyFeature());a.push({ftype:"rowwrap"});return a},createRowBodyFeature:function(){return Ext.create("com.trackplus.itemNavigator.RowBody",
{model:this.model})},getSorters:function(){var a=null;if(null!=this.model.layout.sortField){var b="f"+this.model.layout.sortField,c;c=!0==this.model.layout.sortOrder?"DESC":"ASC";a=[];!0==this.model.layout.sortWithSO?a.push({property:b,direction:c,sorterFn:function(a,b){this.getRoot(a);this.property.substring(1);this.getRoot(b);this.property.substring(1)}}):a.push({property:b,direction:c})}return a},createStore:function(){var a={fields:this.createFields(),pageSize:this.pageSize,autoLoad:!0,sorters:this.getSorters()};
!0==this.paginate?a.proxy={type:"ajax",url:"itemNavigator!navigate.action",reader:Ext.create("com.trackplus.itemNavigator.FlatGridReader",{root:"issues",totalProperty:"totalCount",flatGridViewPlugin:this}),simpleSortMode:!0}:a.data=this.model.issues;a=Ext.create("Ext.data.Store",a);!0==this.paginate&&a.addListener("beforeload",this.beforeLoadPage,this);return a},beforeLoadPage:function(){this.view.store.getProxy().extraParams={queryContextID:this.model.queryContext.id,nodeType:this.model.nodeType,
nodeObjectID:this.model.nodeObjectID}},getLayoutData:function(a){},createColumnModel:function(){var a=this.model.layout.shortFields,b=[],c;if(!0==this.model.layout.indexNumber){var e=this.model.totalCount,f=0,f=null==e||0==e?21:5*(e+"").length+17;b.push({draggable:!1,menuDisabled:!0,width:f,dataIndex:"workItemIndex",sortable:!1,align:"right",tdCls:"simpleTreeGridCell",resizable:!1})}for(e=0;e<a.length;e++)c=a[e],f=this.createColumn(e,c,!this.disableSort,!1),this.cellInlineCtr.setColumnEditor(a[e],
f),c=this.getUniformizedFieldType(c.extJsRendererClass),null!=c&&(c=this.getRendererForSpecificColumns(c),null!=c&&(f.renderer=c)),b.push(f);return b},getRendererForSpecificColumns:function(a){var b=null;a==this.UNIFORMIZED_FIELD_TYPES.datePicker&&(b=function(a,b,f,g,h,k,l){if(null!=a&&""!=a){if(a=Ext.Date.parse(a,com.trackplus.TrackplusConfig.DateFormat),b=!1,null!=f.data.isProject&&(b=f.data.isProject),!b)return Ext.util.Format.date(a,com.trackplus.TrackplusConfig.DateFormat)}else return""});a==
this.UNIFORMIZED_FIELD_TYPES.singleSelect&&(b=function(a,b){var f=b.column.getEditor();if(a&&f&&f.store&&f.displayField){var g=parseInt(a),g=f.store.findExact(f.valueField,g);if(0<=g)return f.store.getAt(g).get(f.displayField)}return a});a==this.UNIFORMIZED_FIELD_TYPES.checkBox&&(b=function(a,b){var f=b.column.getEditor();return"true"==a||"false"==a?f.checked?getText("common.boolean.Y"):getText("common.boolean.N"):a});return b},dataChangeSuccess:function(a){this.cellInlineCtr.dataChangeSuccess()},
getUniformizedFieldType:function(a){switch(a){case "com.aurel.trackplus.field.SynopsisTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.simpleTextField;case "com.aurel.trackplus.field.PersonPickerRenderer":case "com.aurel.trackplus.field.StateRenderer":case "com.aurel.trackplus.field.PriorityRenderer":case "com.aurel.trackplus.field.SelectTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.singleSelect;case "com.aurel.trackplus.field.DateTypeRenderer":case "com.aurel.trackplus.field.StartDateRenderer":case "com.aurel.trackplus.field.EndDateRenderer":case "com.aurel.trackplus.field.StartDateTargetRenderer":case "com.aurel.trackplus.field.EndDateTargetRenderer":return this.UNIFORMIZED_FIELD_TYPES.datePicker;
case "com.aurel.trackplus.field.CheckBoxTypRenderer":return this.UNIFORMIZED_FIELD_TYPES.checkBox;case "com.aurel.trackplus.field.DurationRenderer":return this.UNIFORMIZED_FIELD_TYPES.numberEditor;default:return null}}});Ext.define("com.trackplus.itemNavigator.FlatGridReader",{extend:"Ext.data.reader.Json",config:{flatGridViewPlugin:null},readRecords:function(a){this.flatGridViewPlugin.fireEvent("totalChange",a.totalCount,a.count);return this.callParent(arguments)}});
Ext.define("com.trackplus.itemNavigator.CheckboxModel",{extend:"Ext.selection.CheckboxModel",updateHeaderState:function(){var a=this.store,b=a.getCount(),c=this.views,e=!1,f=0,g,h=0,k=this.store.getRange();for(g=0;g<k.length;g++)!0==k[g].get("group")&&h++;if(!a.buffered&&0<b){a=this.selected;g=0;for(e=a.getCount();g<e&&this.storeHasSelected(a.getAt(g));++g)++f;e=b===f+h}c&&c.length&&this.toggleUiHeader(e)},deselectAll:function(){this.callParent(arguments)},listeners:{beforeselect:function(a,b,c){return!0!=
b.get("group")},beforedeselect:function(a,b,c){return!0!=b.get("group")}}});
Ext.define("com.trackplus.itemNavigator.RowBody",{extend:"Ext.grid.feature.RowBody",config:{model:{}},init:function(a){this.extraRowTpl=["{%","values.view.rowBodyFeature.setupRowData(values.record, values.recordIndex, values);","this.nextTpl.applyOut(values, out, parent);","%}",'\x3ctr class\x3d"'+Ext.baseCSSPrefix+'grid-rowbody-tr {rowBodyCls}"\x3e',this.model.layout.bulkEdit?'\x3ctpl if\x3d"emptyCellClass \x3d\x3d \'\'" \x3e\x3ctd class\x3d"x-grid-cell-special"\x3e\x3c/td\x3e\x3ctpl else\x3e\x3ctd class\x3d"x-grid-cell-special" style\x3d"border-top-width:1px;"\x3e\x3c/td\x3e\x3c/tpl\x3e ':"",
this.model.layout.indexNumber?'\x3ctd class\x3d"simpleTreeGridRowBodyEmptyCell {emptyCellClass}"\x3e\x3c/td\x3e':"",'\x3ctd class\x3d"simpleTreeGridRowBodyEmptyCell {emptyCellClass}"\x3e\x3c/td\x3e','\x3ctd class\x3d"'+Ext.baseCSSPrefix+'grid-cell-rowbody" colspan\x3d"{rowBodyColspan}"\x3e','\x3cdiv class\x3d"ulist '+Ext.baseCSSPrefix+'grid-rowbody {rowBodyDivCls}"\x3e{rowBody}\x3c/div\x3e',"\x3c/td\x3e","\x3c/tr\x3e",{priority:100,syncRowHeights:function(a,c){var e=this.owner,f=Ext.fly(a).down(e.eventSelector,
!0),g,h,k;f&&(g=Ext.fly(c).down(e.eventSelector,!0))&&((h=f.offsetHeight)>(k=g.offsetHeight)?Ext.fly(g).setHeight(h):k>h&&Ext.fly(f).setHeight(k))},syncContent:function(a,c){var e=this.owner,f=Ext.fly(a).down(e.eventSelector,!0),g;f&&(g=Ext.fly(c).down(e.eventSelector,!0))&&Ext.fly(f).syncContent(g)}}];this.callParent(arguments)},getAdditionalData:function(a,b,c,e){var f=this.view.headerCt.getColumnCount()-1;this.model.layout.bulkEdit&&(f-=1);this.model.layout.indexNumber&&(f-=1);if(!0==a.group)return null;
var g="",h="",k="";if(null!=this.model.layout.longFields&&0<this.model.layout.longFields.length){for(var g='\x3cdiv class\x3d"simpleTreeGridRowBody"\x3e',l,m=0;m<this.model.layout.longFields.length;m++){l=this.model.layout.longFields[m];var n=l.reportField;l=l.label;var p=a["f"+n];switch(n){case -1005:n=a["f"+n];null!=n&&0<n.length&&(h+=this.createHistoryTemplate.call(this,a,b,c,e,l,n));break;case 23:n=a["f"+n];null!=n&&0<n.length&&(h+=this.createCommentsTemplate.call(this,a,b,c,e,l,n));break;case -1008:n=
a["f"+n];null!=n&&0<n.length&&(h+=this.createCostsTemplate.call(this,a,b,c,e,l,n));break;case -1007:case -1011:n=a["f"+n];null!=n&&0<n.length&&(h+=this.createBudgetHistoryTemplate.call(this,a,b,c,e,l,n));break;default:null!=p&&""!=p&&(h+=this.createLongFieldTemplate.call(this,a,b,c,e,n,l,p))}}(hasContent=""!=h)&&(k="simpleTreeGridRowBodyEmptyCell-bodyContent");g=g+h+"\x3c/div\x3e"}return{rowBody:g,rowBodyCls:this.rowBodyCls,rowBodyColspan:f,emptyCellClass:k}},createLongFieldTemplate:function(a,b,
c,e,f,g,h){null==this.longFieldTpl&&this.initLongFieldTpl();return this.longFieldTpl.applyTemplate({lonFieldLabel:g,longFieldValue:h})},initLongFieldTpl:function(){var a;a='\x3ctable class\x3d"reportHistory" border\x3d"0" cellPadding\x3d"0" cellSpacing\x3d"0"\x3e\x3ctr class\x3d"reportHistoryRow"\x3e\x3ctd class\x3d"reportHistoryCellLabel"\x3e{lonFieldLabel}\x3c/td\x3e\x3c/tr\x3e\x3ctr class\x3d"reportHistoryRowLast"\x3e\x3ctd class\x3d"reportHistoryCellLongField"\x3e{longFieldValue}\x3c/td\x3e\x3c/tr\x3e';
a+="\x3c/table\x3e";this.longFieldTpl=new Ext.Template(a);this.longFieldTpl.compile()},createCommentsTemplate:function(a,b,c,e,f,g){null==this.commentsTpl&&this.initCommentsTpl();return this.commentsTpl.applyTemplate({longFieldLabel:f,comments:g})},initCommentsTpl:function(){var a=['\x3ctable class\x3d"reportHistory" border\x3d"0" cellPadding\x3d"0" cellSpacing\x3d"0"\x3e','\x3ctr style\x3d"height: 0px"\x3e','\x3cth width\x3d"130px"\x3e\x3c/th\x3e','\x3cth width\x3d"200px"\x3e\x3c/th\x3e','\x3cth width\x3d"100%"\x3e\x3c/th\x3e',
"\x3c/tr\x3e",'\x3ctr class\x3d"reportHistoryRow"\x3e\x3ctd class\x3d"reportHistoryCellLabel" colspan\x3d"3"\x3e{longFieldLabel}\x3c/td\x3e\x3c/tr\x3e','\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCellHeader"\x3e'+getText("common.history.lbl.lastEdit")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader"\x3e'+getText("common.history.lbl.changedBy")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader"\x3e'+getText("common.history.lbl.comment")+"\x3c/td\x3e","\x3c/tr\x3e",
'\x3ctpl for\x3d"comments"\x3e','\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{date}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{author}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCellLast longFieldCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{comment}\x3c/div\x3e\x3c/td\x3e',"\x3c/tr\x3e","\x3c/tpl\x3e","\x3c/table\x3e"];
this.commentsTpl=new Ext.XTemplate(a);this.commentsTpl.compile()},createHistoryTemplate:function(a,b,c,e,f,g){null==this.historyTpl&&this.initHistoryTpl();return this.historyTpl.applyTemplate({longFieldLabel:f,history:g})},initHistoryTpl:function(){var a=['\x3ctable class\x3d"reportHistory" border\x3d"0" cellPadding\x3d"0" cellSpacing\x3d"0"\x3e','\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCellLabel" colspan\x3d"4"\x3e{longFieldLabel}\x3c/td\x3e',"\x3c/tr\x3e",'\x3ctr class\x3d"reportHistoryRow"\x3e',
'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"100px"\x3e'+getText("common.history.lbl.lastEdit")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"20%"\x3e'+getText("common.history.lbl.changedBy")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"40%"\x3e'+getText("common.history.lbl.newValue")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"40%"\x3e'+getText("common.history.lbl.oldValue")+"\x3c/td\x3e","\x3c/tr\x3e",'\x3ctpl for\x3d"history"\x3e',
'\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{date}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{author}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{newValues}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCellLast"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{oldValues}\x3c/div\x3e\x3c/td\x3e',
"\x3c/tr\x3e","\x3c/tpl\x3e","\x3c/table\x3e"];this.historyTpl=new Ext.XTemplate(a);this.historyTpl.compile()},createCostsTemplate:function(a,b,c,e,f,g){null==this.costsTpl&&this.initCostsTpl();return this.costsTpl.applyTemplate({longFieldLabel:f,costs:g})},initCostsTpl:function(){var a=['\x3ctable class\x3d"reportHistory" border\x3d"0" cellPadding\x3d"0" cellSpacing\x3d"0"\x3e','\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCellLabel" colspan\x3d"5"\x3e{longFieldLabel}\x3c/td\x3e',
"\x3c/tr\x3e",'\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"100px"\x3e'+getText("common.history.lbl.lastEdit")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"20%"\x3e'+getText("common.history.lbl.changedBy")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"50%"\x3e'+getText("common.history.lbl.subject")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"10%"\x3e'+getText("item.tabs.expense.editExpense.lbl.effort")+
"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"10%"\x3e'+getText("common.lbl.cost")+"\x3c/td\x3e","\x3c/tr\x3e",'\x3ctpl for\x3d"costs"\x3e','\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{date}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{author}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCellLast"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{subject}\x3c/div\x3e\x3c/td\x3e',
'\x3ctd class\x3d"reportHistoryCellLast"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{work}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCellLast"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{cost}\x3c/div\x3e\x3c/td\x3e',"\x3c/tr\x3e","\x3c/tpl\x3e","\x3c/table\x3e"];this.costsTpl=new Ext.XTemplate(a);this.costsTpl.compile()},createBudgetHistoryTemplate:function(a,b,c,e,f,g){null==this.budgetHistoryTpl&&this.initBudgetHistoryTpl();return this.budgetHistoryTpl.applyTemplate({longFieldLabel:f,
costs:g})},initBudgetHistoryTpl:function(){var a=['\x3ctable class\x3d"reportHistory" border\x3d"0" cellPadding\x3d"0" cellSpacing\x3d"0"\x3e','\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCellLabel" colspan\x3d"4"\x3e{longFieldLabel}\x3c/td\x3e',"\x3c/tr\x3e",'\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"100px"\x3e'+getText("common.history.lbl.lastEdit")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"20%"\x3e'+
getText("common.history.lbl.changedBy")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"40%"\x3e'+getText("item.tabs.expense.editExpense.lbl.effort")+"\x3c/td\x3e",'\x3ctd class\x3d"reportHistoryCellHeader" width\x3d"40%"\x3e'+getText("common.lbl.cost")+"\x3c/td\x3e","\x3c/tr\x3e",'\x3ctpl for\x3d"costs"\x3e','\x3ctr class\x3d"reportHistoryRow"\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{date}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCell"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{author}\x3c/div\x3e\x3c/td\x3e',
'\x3ctd class\x3d"reportHistoryCellLast"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{work}\x3c/div\x3e\x3c/td\x3e','\x3ctd class\x3d"reportHistoryCellLast"\x3e\x3cdiv style\x3d"width:auto;overflow:hidden;"\x3e{cost}\x3c/div\x3e\x3c/td\x3e',"\x3c/tr\x3e","\x3c/tpl\x3e","\x3c/table\x3e"];this.budgetHistoryTpl=new Ext.XTemplate(a);this.budgetHistoryTpl.compile()}});
function openAttachments(a,b){for(var c=b.split(";"),e=0;e<c.length;e++){var f="downloadAttachment.action?workItemID\x3d"+a+"\x26attachKey\x3d"+c[e];0==e?window.open(f,"attachmentWindow"):window.open(f)}}
Ext.define("com.trackplus.itemNavigator.GanttViewPlugin",{extend:"com.trackplus.itemNavigator.IssueListViewPlugin",mixins:{navigable:"com.trackplus.itemNavigator.TreeNavigableItem"},view:null,includeLongFields:!1,useArrows:!1,disableSort:!1,treeColumnID:null,useSelectionModel:!1,useTree:!0,readOnly:!1,dateArrayMinMax:[],eventDrag:!1,workItemDates:[],dependencyStoreData:[],granularity:"",invalidExpandCollapse:!1,presentedProjectIDs:{},dependenciesToRemove:[],SYSTEM_FIELDS:{START_DATE:19,END_DATE:20,
DURATION:33,START_DATE_FIELD:"f19",END_DATE_FIELD:"f20",DURATION_FIELD:"f33",TOP_DOWN_START_DATE:29,TOP_DOWN_END_DATE:30,TOP_DOWN_DURATION:34,TOP_DOWN_START_DATE_FIELD:"f29",TOP_DOWN_END_DATE_FIELD:"f30",TOP_DOWN_DURATION_FIELD:"f34"},UNIFORMIZED_FIELD_TYPES:{singleSelect:"SINGLE_SELECT",datePicker:"DATE_PICKER",simpleTextField:"SIMPLE_TEXT_FIELD",checkBox:"CHECK_BOX",numberEditor:"NUMBER_EDITOR"},constructor:function(a){this.callParent(arguments);this.mixins.navigable.constructor.call(this);Ext.require(["Gnt.plugin.Printable",
"Sch.plugin.TreeCellEditing","Gnt.column.StartDate","Gnt.field.Calendar","Gnt.plugin.Export"]);Ext.define("com.trackplus.ganttView.DependencyStore",{extend:"Gnt.data.DependencyStore",Id:null,projectId:null,issueTypeID:null});Ext.define("com.trackplus.dependency.locale",{override:"Gnt.feature.DependencyDragDrop",fromText:getText("itemov.ganttView.from")+": ",toText:getText("itemov.ganttView.to")+": ",startText:getText("itemov.ganttView.start"),endText:getText("itemov.ganttView.end")});var b=this.SYSTEM_FIELDS.START_DATE_FIELD,
c=this.SYSTEM_FIELDS.END_DATE_FIELD,e=this.SYSTEM_FIELDS.DURATION_FIELD;this.model.showBaseline&&(b=this.SYSTEM_FIELDS.TOP_DOWN_START_DATE_FIELD,c=this.SYSTEM_FIELDS.TOP_DOWN_END_DATE_FIELD,e=this.SYSTEM_FIELDS.TOP_DOWN_DURATION_FIELD);Ext.define("com.trackplus.itemNavigator.GanttChartModel",{extend:"Gnt.model.Task",startDateField:b,endDateField:c,durationField:e,baselineStartDateField:this.SYSTEM_FIELDS.TOP_DOWN_START_DATE_FIELD,baselineEndDateField:this.SYSTEM_FIELDS.TOP_DOWN_END_DATE_FIELD,fields:this.createFields()});
this.localizeExportPDFDialog()},refreshData:function(){},localizeExportPDFDialog:function(){Ext.define("com.trackplus.exportPDFDialog.locale",{override:"Sch.widget.ExportDialog",generalError:getText("itemov.ganttView.exportPDF.generalError"),title:getText("itemov.ganttView.exportPDF.title"),formatFieldLabel:getText("itemov.ganttView.exportPDF.formatFieldLabel"),orientationFieldLabel:getText("itemov.ganttView.exportPDF.orientationFieldLabel"),rangeFieldLabel:getText("itemov.ganttView.exportPDF.rangeFieldLabel"),
showHeaderLabel:getText("itemov.ganttView.exportPDF.showHeaderLabel"),orientationPortraitText:getText("itemov.ganttView.exportPDF.orientationPortraitText"),orientationLandscapeText:getText("itemov.ganttView.exportPDF.orientationLandscapeText"),completeViewText:getText("itemov.ganttView.exportPDF.completeViewText"),currentViewText:getText("itemov.ganttView.exportPDF.currentViewText"),dateRangeText:getText("itemov.ganttView.exportPDF.dateRangeText"),dateRangeFromText:getText("itemov.ganttView.exportPDF.dateRangeFromText"),
pickerText:getText("itemov.ganttView.exportPDF.pickerText"),dateRangeToText:getText("itemov.ganttView.exportPDF.dateRangeToText"),exportButtonText:getText("common.btn.export"),cancelButtonText:getText("common.btn.cancel"),progressBarText:getText("itemov.ganttView.exportPDF.progressBarText"),exportersFieldLabel:getText("itemov.ganttView.exportPDF.exportersFieldLabel"),adjustCols:getText("itemov.ganttView.exportPDF.adjustCols"),adjustColsAndRows:getText("itemov.ganttView.exportPDF.adjustColsAndRows"),
specifyDateRange:getText("itemov.ganttView.exportPDF.specifyDateRange")});Ext.define("com.trackplus.exportPDFDialog.locale.SinglePage",{override:"Sch.plugin.exporter.SinglePage",constructor:function(a){this.callParent(a);this.name=getText("itemov.ganttView.exportPDF.singlePage")}});Ext.define("com.trackplus.exportPDFDialog.locale.MultiPageVertical",{override:"Sch.plugin.exporter.MultiPageVertical",constructor:function(a){this.callParent(a);this.name=getText("itemov.ganttView.exportPDF.multiPageVertical")}});
Ext.define("com.trackplus.exportPDFDialog.locale.MultiPage",{override:"Sch.plugin.exporter.MultiPage",constructor:function(a){this.callParent(a);this.name=getText("itemov.ganttView.exportPDF.multiPage")}})},getTreeGrid:function(){return this.view.getView().lockedGrid},selectItemByIndex:function(a){return this.selectItemByIndexInTree(this.view.getView().lockedGrid,a)},selectItem:function(a){return this.selectItemInTree(this.view.getView().lockedGrid,a)},deselectItem:function(a){return this.deselectItemInTree(this.view.getView().lockedGrid,
a)},createSettingsPanel:function(a,b,c,e,f){b=this.getToolbarLayoutConfigButtons(a,b,c,e,f);c=this.getToolbarViewPresetsButtons();a=this.getToolbarGanttConfigs();b=Ext.create("Ext.container.ButtonGroup",{items:b,frame:!1,border:"0 0 0 0",bodyBorder:!1,shadow:!1,baseCls:"ganttToolbarButtonGroup"});c=Ext.create("Ext.container.ButtonGroup",{items:c,frame:!1,width:245,baseCls:"ganttToolbarButtonGroup",layout:{type:"hbox",pack:"start"}});a=Ext.create("Ext.container.ButtonGroup",{items:a,frame:!1,columns:4,
align:"left",margin:"5 0 0 0",baseCls:"ganttToolbarButtonGroup"});return Ext.create("Ext.toolbar.Toolbar",{region:"north",height:75,layout:{type:"table",columns:2,tableAttrs:{style:{width:"100%"}}},enableOverflow:!0,cls:"toolbarActions",border:"0 0 1 0",defaults:{cls:"toolbarItemAction",overCls:"toolbarItemAction-over",scale:"small",enableToggle:!1},items:[b,c,a]})},getToolbarLayoutConfigButtons:function(a,b,c,e,f){a=[b];null!=c&&a.push(c);null!=e&&a.push(e);null!=f&&a.push(f);return a},getToolbarViewPresetsButtons:function(){var a=
this,b=[],c=Ext.create("Ext.button.Button",{text:getText("itemov.ganttView.granularity.quarterly"),id:"quarterly",enableToggle:!0,toggleGroup:"granularityGroup",pressed:"year"==a.view.viewPreset,margin:"0 2 0 0",handler:function(b){a.granularity="year";a.view.switchViewPreset("year",a.calendarStartDate,a.calendarEndDate);a.storeGranularityAndZoom()}}),e=Ext.create("Ext.button.Button",{text:getText("itemov.ganttView.granularity.monthly"),id:"monthly",enableToggle:!0,toggleGroup:"granularityGroup",
pressed:"monthAndYear"==a.view.viewPreset,margin:"0 2 0 0",handler:function(){a.granularity="monthAndYear";a.view.switchViewPreset("monthAndYear",a.calendarStartDate,a.calendarEndDate);a.storeGranularityAndZoom()}}),f=Ext.create("Ext.button.Button",{text:getText("itemov.ganttView.granularity.weekly"),id:"weekly",enableToggle:!0,toggleGroup:"granularityGroup",pressed:"weekAndMonth"==a.view.viewPreset,margin:"0 2 0 0",handler:function(b){a.granularity="weekAndMonth";a.view.switchViewPreset("weekAndMonth",
a.calendarStartDate,a.calendarEndDate);a.storeGranularityAndZoom()}}),g=Ext.create("Ext.button.Button",{text:getText("itemov.ganttView.granularity.daily"),id:"daily",enableToggle:!0,toggleGroup:"granularityGroup",pressed:"weekAndDayLetter"==a.view.viewPreset,handler:function(){a.granularity="weekAndDayLetter";a.view.switchViewPreset("weekAndDayLetter",a.calendarStartDate,a.calendarEndDate);a.storeGranularityAndZoom()}}),h=Ext.create("Ext.button.Button",{iconCls:"zoomIn",margin:"0 0 0 0",handler:function(){a.view.zoomIn()}}),
k=Ext.create("Ext.button.Button",{iconCls:"zoomOut",margin:"0 0 0 0",handler:function(b){a.view.zoomOut()}});b.push(c);b.push(e);b.push(f);b.push(g);b.push(h);b.push(k);return b},getToolbarGanttConfigs:function(){var a=this,b=[],c=a.model.showBaseline,e=a.model.showBoth,f=!1,g=!1,h=!1,k=!1;a.model.isActiveTopDownDate?(c&&(k=f=!0,h=!1),e&&(h=g=!0,k=!1)):(c&&(f=!0),e&&(g=!0),k=h=!0);e=a.model.validateRelationships;c=a.model.highlightCriticalPath;c=Ext.create("Ext.form.field.Checkbox",{boxLabel:getText("itemov.ganttView.dependency.highlightCp"),
margin:"0 12 0 0",checked:c,handler:function(b){var c=a.view.getSchedulingView();b.checked?c.highlightCriticalPaths(!0):c.unhighlightCriticalPaths(!0);c={};c.ganttConfigValue=b.checked;c.ganttConfigNameToSave="highlightCriticalPath";a.saveGanttSpecifigConfig(c,!1)}});a.showBaseline=Ext.create("Ext.form.field.Checkbox",{boxLabel:getText("itemov.ganttView.showBaseline"),id:"showBaselineCh",itemID:"showBaselineCh",name:"showBaselineCh",margin:"0 12 0 0",checked:f,disabled:h,enabled:!1,handler:function(b){a.isChartContainsUnsavedItems()?
a.showSaveDialogWarningIfChartContainsUnsavedItems(a,a.showBaselineCheckBoxHandler,a.showBaselineCheckBoxHandler,null):a.showBaselineCheckBoxHandler()}});a.showBoth=Ext.create("Ext.form.field.Checkbox",{boxLabel:getText("itemov.ganttView.showBoth"),id:"showBothCh",margin:"0 12 0 0",checked:g,disabled:k,handler:function(b){b.checked?(a.view.el.toggleCls("sch-ganttpanel-showbaseline"),a.showBaseline.setDisabled(!0)):(a.view.el.toggleCls("sch-ganttpanel-showbaseline"),a.showBaseline.setDisabled(!1));
var c={};c.ganttConfigValue=b.checked;c.ganttConfigNameToSave="showBoth";a.saveGanttSpecifigConfig(c,!1)}});f=Ext.create("Ext.form.field.Checkbox",{boxLabel:getText("itemov.ganttView.validate"),margin:"0 12 0 0",checked:e,handler:function(b){b.checked?(a.validateDependencies(),a.model.validateRelationships=!0):(a.removeClsFromValidatedTasks(),a.model.validateRelationships=!1);var c={};c.ganttConfigValue=b.checked;c.ganttConfigNameToSave="validateRelationships";a.saveGanttSpecifigConfig(c,!1)}});g=
Ext.create("Ext.form.field.Text",{emptyText:getText("itemov.ganttView.searchForTask"),width:175,enableKeyEvents:!0,colspan:2,listeners:{keyup:{fn:function(b,c){var e=b.getValue(),f=RegExp(Ext.String.escapeRegex(e),"i");e?a.view.taskStore.filterTreeBy({filter:function(a){return f.test(a.get("f17"))},checkParents:!0}):a.view.taskStore.clearTreeFilter()},buffer:300,scope:this},specialkey:{fn:function(b,c){c.getKey()===c.ESC&&(b.reset(),a.view.taskStore.clearTreeFilter())}}}});a.normalizeTasks=Ext.create("Ext.button.Button",
{margin:"-4 0 0 0",text:getText("itemov.ganttView.normalizeTasks"),iconCls:"normalizeTasks",handler:function(b){a.view.getTaskStore().renormalizeTasks();a.model.validateRelationships&&a.validateDependencies()}});b.push(c);b.push(a.showBaseline);b.push(g);b.push(f);b.push(a.showBoth);b.push(a.normalizeTasks);return b},showBaselineCheckBoxHandler:function(){this.showBaseline?this.showBoth.setDisabled(!0):this.showBoth.setDisabled(!1);var a={};a.ganttConfigValue=this.showBaseline.checked;a.ganttConfigNameToSave=
"showBaseline";this.saveGanttSpecifigConfig(a,!0)},isShowBaseline:function(){return this.model.showBaseline},saveGanttSpecifigConfig:function(a,b){var c=this;Ext.Ajax.request({url:"itemNavigator!saveGanttSpecificConfigs.action",disableCaching:!0,success:function(){c.view.setLoading(!1);b&&c.fireEvent.call(c,"datachange")},failure:function(){c.view.setLoading(!1);alert("failure")},method:"POST",params:a})},getSettingsHeight:function(){return 67},initNorthPanel:function(){var a=[];a.push({xtype:"fieldcontainer",
margin:"5 5 5 5",fieldLabel:getText("itemov.lbl.sortBy"),labelAlign:"right",labelWidth:100,layout:"hbox",items:[this.cmbSortBy,this.radioAsc,this.radioDsc]});this.northPanel=Ext.create("Ext.panel.Panel",{region:"north",layout:{type:"column"},border:!1,bodyBorder:!1,items:a})},getParentFromID:function(a,b){for(aParent in a)if(a[aParent].Id==b)return aParent;return-1},getSelectedIssues:function(){var a=[];if(this.model.layout.bulkEdit){var b=this.view.getSelectionModel().getSelection();if(null!=b&&
0<b.length)for(var c=0;c<b.length;c++)a.push(b[c].data.workItemID)}return a},myComparator:function(a,b){return parseFloat(a.f27)>parseFloat(b.f27)},appendNewDependency:function(a){if(""!=a.linksTo){var b=a.linksTo.split(",");for(index in b){var c=b[index].split("/"),e={};e.From=a.workItemID;null!=c[0]&&(e.To=c[0]);null!=c[1]&&(e.Id=c[1]);null!=c[2]&&(e.Type=c[2]);if(null!=c[3]&&null!=c[4]){var f=this.convertTrackLagUnitToBryntum(parseInt(c[4]));-1!=f&&(e.Lag=c[3],e.LagUnit=f)}e.projectId=a.projectID;
e.issueTypeID=a.issueTypeID;this.dependencyStoreData.push(e)}}},convertTrackLagUnitToBryntum:function(a){switch(a){case 7:case 8:return"d";case 9:case 10:return"w";case 11:case 12:return"mo";default:return-1}},parseJSON:function(a){if(null!=a&&0!=a.length)for(var b=null,c=0;c<a.length;c++)if(b=a[c],!0==b.group)this.parseJSON(b.children);else{if(b.f19){var e=Ext.Date.parse(b.f19,com.trackplus.TrackplusConfig.DateFormat);this.dateArrayMinMax.push(new Date(Ext.util.Format.date(e,"Y-m-d")))}b.f20&&(e=
Ext.Date.parse(b.f20,com.trackplus.TrackplusConfig.DateFormat),this.dateArrayMinMax.push(new Date(Ext.util.Format.date(e,"Y-m-d"))));b.f29&&(e=Ext.Date.parse(b.f29,com.trackplus.TrackplusConfig.DateFormat),this.dateArrayMinMax.push(new Date(Ext.util.Format.date(e,"Y-m-d"))));b.f30&&(e=Ext.Date.parse(b.f30,com.trackplus.TrackplusConfig.DateFormat),this.dateArrayMinMax.push(new Date(Ext.util.Format.date(e,"Y-m-d"))));this.appendNewDependency(b);"true"==b.calendarStartDateMissing&&(b.cls="item-calendarStartDateMissing");
null!=b.children&&this.parseJSON(b.children)}},initMyListeners:function(){this.view.on("boxready",function(a){a.view.focus=Ext.emptyFn});this.view.getView().lockedView.addListener("beforedrop",this.onGridBeforeDrop,this);this.view.addListener("itemcontextmenu",this.onGridItemContextMenu,this);this.view.addListener("celldblclick",this.onGridItemDblClick,this);this.model.layout.bulkEdit&&this.view.getSelectionModel().addListener("selectionchange",this.onGridSelectionChange,this);this.view.getView().lockedGrid.addListener("afterrender",
this.onGridAfterRenderer,this);this.view.getView().lockedGrid.addListener("columnresize",this.columnResizeHandler,this);this.view.getView().lockedGrid.addListener("columnmove",this.columnMoveHandler,this);this.view.getView().lockedGrid.addListener("afteritemexpand",this.afterItemExpandHandler,this);this.view.getView().lockedGrid.addListener("afteritemcollapse",this.afterItemCollapseHandler,this);this.model.layout.bulkEdit&&this.view.getSelectionModel().addListener("selectionchange",this.onGridSelectionChange,
this)},onGridBeforeDrop:function(a,b,c,e){var f=this,g=c.data.projectID;a=[];for(var h=[],k=0;k<b.records.length;k++){var l=b.records[k];!0!=l.data.group&&(l.data.projectID!=g?h.push(l):a.push(l))}if(0==a.length)return c=getText("itemov.wbsView.err.notTheSameProject"),Ext.MessageBox.show({title:"",msg:c,width:200,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR}),!1;for(;0<b.records.length;)b.records.pop();f.view.setLoading(!0);g="";for(k=0;k<a.length;k++)b.records.unshift(a[k]),g+=a[k].data.workItemID,
k<a.length-1&&(g+=",");b="before"==e;f.WBS_SORT_ASCENDING||(b=!b);Ext.Ajax.request({url:"itemNavigator!changeWBS.action",disableCaching:!0,success:function(){f.view.setLoading(!1);f.fireEvent.call(f,"datachange")},failure:function(){f.view.setLoading(!1);alert("failure")},method:"POST",params:{workItems:g,targetWorkItemID:c.data.workItemID,before:b}});return!0},onGridSelectionChange:function(a,b){this.fireEvent.call(this,"selectionchange",b);return!1},onGridAfterRenderer:function(){var a=Ext.get("rowExpandAllTrg");
null!=a&&a.addListener("click",this.rowExpandAll,this);a=Ext.get("rowCollapseAllTrg");null!=a&&a.addListener("click",this.rowCollapseAll,this);this.onReadyHandler()},onReadyHandler:function(){var a=this;borderLayout.onPageMouseDown=function(b){if(a.clickIsOutOfGrid(b)&&a.isChartContainsUnsavedItems())b.stopEvent(),a.showSaveDialogWarningIfChartContainsUnsavedItems(null,null,null,null);else return!0}},showSaveDialogWarningIfChartContainsUnsavedItems:function(a,b,c,e){var f=this;f.isChartContainsUnsavedItems()&&
Ext.MessageBox.show({title:getText("common.warning"),msg:getText("item.action.leavingInlineEdit"),buttons:Ext.MessageBox.YESNO,modal:!0,fn:function(g){"yes"==g&&f.saveChanges2(a,b,e,!1);"no"==g&&(f.fireEvent.call(f,"datachange"),null!=c&&c.call(f))},icon:Ext.MessageBox.QUESTION})},showSaveErrorsConfirmDialog:function(a){var b=this,c=getText("itemov.ganttView.saveTasksErrors"),e=getText("itemov.ganttView.saveTasksErrorsQuestion");a=c+"\x3cbr\x3e"+a+e;Ext.MessageBox.show({title:getText("common.warning"),
msg:a,buttons:Ext.MessageBox.OKCANCEL,modal:!0,fn:function(a){"ok"==a&&b.saveChanges2(null,null,null,!1)},icon:Ext.MessageBox.QUESTION})},isChartContainsUnsavedItems:function(){var a=!1,b=this.view.getDependencyStore().data.items,c;for(c in b){var e=b[c];null!=e&&e.dirty&&(a=!0)}return 0<this.view.getTaskStore().getUpdatedRecords().length||0<this.dependenciesToRemove.length||a?!0:!1},isNewSelectedTask:function(){var a=this.getTreeGrid().getSelectionModel().getSelection();return 0<a.length&&0>a[0].data.Id?
!0:!1},clickIsOutOfGrid:function(a){var b=!0;clickX=a.getX();clickY=a.getY();a=this.view.getX();var c=borderLayout.getActiveToolbarList().getY();clickX>a&&clickY>c&&(b=!1);return b},addSaveButton:function(a){var b=this,c=Ext.create("Ext.button.Button",{itemId:"ganttSaveBtn",id:"ganttSaveBtn",margin:"0 0 0 0",text:getText("common.btn.save"),iconCls:"save",handler:function(a){b.saveChanges2(null,null,null,!0)}});null!=a?a.add(c):borderLayout.getActiveToolbarList().add(c)},onGridItemContextMenu:function(a,
b,c,e,f,g){f.stopEvent();this.fireEvent("itemcontextmenu",b.data,f,this.view,e,b);return!1},getPopupMenuItems:function(a,b,c,e){var f=this,g=[];a.editable&&(g.push({text:getText("common.btn.indent"),iconCls:"itemAction_indent16",handler:function(){f.indent.call(f,a,b,c,e)}}),g.push({text:getText("common.btn.outdent"),iconCls:"itemAction_outdent16",handler:function(){f.outdent.call(f,a,b,c,e)}}));return g},indent:function(a,b,c,e){var f=this,g=e.parentNode;a=g.indexOf(e);if(0===a)return alert(getText("itemov.wbsView.err.noIndentPossible")),
!1;var h=g.getChildAt(a-1);b.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!indent.action",disableCaching:!0,success:function(){g.removeChild(e);h.data.leaf=!1;h.appendChild(e);h.expand();b.setLoading(!1);f.fireEvent.call(f,"datachange");b.setLoading(!1)},failure:function(){b.setLoading(!1);alert("failure")},method:"POST",params:{nodeType:f.itemNavigatorController.nodeType,nodeObjectID:f.itemNavigatorController.nodeObjectID,descriptorID:f.itemNavigatorController.selectedIssueViewDescriptor.id,
queryType:f.itemNavigatorController.model.queryType,queryID:f.itemNavigatorController.model.queryID,workItemID:e.data.workItemID,targetWorkItemID:h.data.workItemID}})},outdent:function(a,b,c,e){var f=this,g=e.parentNode;a=b.store.getRootNode();if(g==a||!0==g.data.group)return CWHF.showMsgError(getText("itemov.wbsView.err.noOutdentPossible")),!1;b.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!outdent.action",disableCaching:!0,success:function(){var a=g.parentNode,c=a.indexOf(g);a.insertChild(c+
1,e);g.hasChildNodes()||(g.data.leaf=!1);b.setLoading(!1);f.fireEvent.call(f,"datachange")},failure:function(){b.setLoading(!1);alert("failure")},method:"POST",params:{nodeType:f.itemNavigatorController.nodeType,nodeObjectID:f.itemNavigatorController.nodeObjectID,descriptorID:f.itemNavigatorController.selectedIssueViewDescriptor.id,queryContextID:f.itemNavigatorController.model.queryContext.id,workItemID:e.data.workItemID}})},onGridItemDblClick:function(a,b,c,e,f,g,h){h.stopEvent();if(!0==this.model.layout.bulkEdit&&
0==c)return!1;this.fireEvent.call(this,"itemdblclick",e.data,b);return!1},expandCollapseItem:function(a,b){var c=a.data.Id;-1!==(c+"").indexOf("g")?this.expandGroup(c.substring(1),b):this.expandItem(c,b)},expandGroup:function(a,b){Ext.Ajax.request({url:"reportExpand!expandGroup.action",params:{expanded:b,groupID:a}})},expandItem:function(a,b){Ext.Ajax.request({url:"reportExpand!expandReportBean.action",params:{expanded:b,workItemID:a}})},afterItemExpandHandler:function(a,b,c){this.invalidExpandCollapse||
this.expandCollapseItem(a,!0)},afterItemCollapseHandler:function(a,b,c){this.invalidExpandCollapse||this.expandCollapseItem(a,!1)},validateExpandCollapse:function(a){var b=this;Ext.Function.defer(function(){b.invalidExpandCollapse=!1},3E3,b)},rowExpandAll:function(a){a.stopEvent();this.invalidExpandCollapse=!0;this.view.expandAll();Ext.Ajax.request({url:"reportExpand!expandAll.action"});return!1},rowCollapseAll:function(a){a.stopEvent();this.invalidExpandCollapse=!0;this.view.collapseAll();Ext.Ajax.request({url:"reportExpand!collapseAll.action"});
return!1},columnResizeHandler:function(a,b,c){var e=this;a=b.getItemId().substring(2);Ext.Ajax.request({url:"layoutColumns!resizeColumn.action",disableCaching:!0,success:function(a){e.fireEvent.call(e,"layoutchange")},failure:function(){},method:"POST",params:{layoutID:a,fieldID:b.fieldID,width:c,filterType:e.model.queryContext.queryType,filterID:e.model.queryContext.queryID}})},createFields:function(){var a=this.callParent();a.push({name:"startDateEditFlag",type:"string"});a.push({name:"endDateEditFlag",
type:"string"});a.push({name:"linkable",type:"boolean"});a.push({name:"status",type:"string"});a.push({name:"wbs",type:"string"});a.push({name:"responsibleValue",type:"string"});a.push({name:"PercentDoneToolTip",type:"string"});a.push({name:"iconCls"});a.push({name:"cssColorClass"});a.push({name:"cssColorClassGroup"});a.push({name:"queryFieldCSS"});a.push({name:"extendedItem"});a.push({name:"workItemIDAbove"});a.push({name:"group",type:"boolean"});var b={},c;for(c in a){if(a[c].name==this.SYSTEM_FIELDS.START_DATE_FIELD||
a[c].name==this.SYSTEM_FIELDS.END_DATE_FIELD||a[c].name==this.SYSTEM_FIELDS.TOP_DOWN_START_DATE_FIELD||a[c].name==this.SYSTEM_FIELDS.TOP_DOWN_END_DATE_FIELD)a[c].type="date",a[c].dateFormat=com.trackplus.TrackplusConfig.DateFormat,b[a[c].name]=!0;if(a[c].name==this.SYSTEM_FIELDS.DURATION_FIELD||a[c].name==this.SYSTEM_FIELDS.TOP_DOWN_DURATION_FIELD)a[c].type="number"}void 0==b[this.SYSTEM_FIELDS.START_DATE_FIELD]&&a.push(this.createNewField(this.SYSTEM_FIELDS.START_DATE_FIELD));void 0==b[this.SYSTEM_FIELDS.END_DATE_FIELD]&&
a.push(this.createNewField(this.SYSTEM_FIELDS.END_DATE_FIELD));void 0==b[this.SYSTEM_FIELDS.TOP_DOWN_START_DATE_FIELD]&&a.push(this.createNewField(this.SYSTEM_FIELDS.TOP_DOWN_START_DATE_FIELD));void 0==b[this.SYSTEM_FIELDS.TOP_DOWN_END_DATE_FIELD]&&a.push(this.createNewField(this.SYSTEM_FIELDS.TOP_DOWN_END_DATE_FIELD));return a},createNewField:function(a){var b={};b.name=a;b.type="date";b.useNull="true";b.dateFormat=com.trackplus.TrackplusConfig.DateFormat;return b},dateSortAsc:function(a,b){return a>
b?1:a<b?-1:0},setCalendarStartEndDate:function(){0==this.dateArrayMinMax.length?(this.calendarStartDate=new Date,this.calendarStartDate.setDate(this.calendarStartDate.getDate()-7),this.calendarEndDate=new Date):1==this.dateArrayMinMax.length?(this.calendarStartDate=this.dateArrayMinMax[0],this.calendarStartDate.setDate(this.calendarStartDate.getDate()-7),this.calendarEndDate=this.dateArrayMinMax[0]):(this.dateArrayMinMax.sort(this.dateSortAsc),this.calendarStartDate=this.dateArrayMinMax[0],this.calendarEndDate=
this.dateArrayMinMax[this.dateArrayMinMax.length-1],this.calendarStartDate.setDate(this.calendarStartDate.getDate()-7));this.calendarEndDate.setDate(this.calendarEndDate.getDate()+14)},createColumns:function(a){a=this.model.layout.shortFields;this.columns=[];var b;if(!0==this.model.layout.indexNumber){var c=this.model.totalCount,e=0,e=null==c||0==c?21:5*(c+"").length+17;this.columns.push({draggable:!1,menuDisabled:!0,width:e,dataIndex:"workItemIndex",sortable:!1,align:"right",tdCls:"simpleTreeGridCell",
resizable:!1})}for(c=0;c<a.length;c++)b=a[c],e=this.createColumn(c,b,!this.disableSort,this.useTree),0<c?(this.cellInlineCtr.setColumnEditor(a[c],e),b=this.getUniformizedFieldType(b.extJsRendererClass),null!=b&&(b=this.getRendererForSpecificColumns(b,c),null!=b&&(e.renderer=b))):(b=this.getUniformizedFieldType(b.extJsRendererClass),null!=b&&b==this.UNIFORMIZED_FIELD_TYPES.datePicker&&(b=this.getRendererForSpecificColumns(b,c),null!=b&&(e.renderer=b))),this.columns.push(e);this.columns=this.columns.reverse()},
getRendererForSpecificColumns:function(a,b){var c=null;a==this.UNIFORMIZED_FIELD_TYPES.datePicker&&(c=function(a,c,g,h,k,l,m){c=!1;null!=g.data.group&&(c=g.data.group);if(c)return 0==b?g.data.Name:"";g=null;g=a instanceof Date?new Date(a.getTime()):Ext.Date.parse(a,com.trackplus.TrackplusConfig.DateFormat);if(null!=g&&!c)return Ext.util.Format.date(g,com.trackplus.TrackplusConfig.DateFormat)});a==this.UNIFORMIZED_FIELD_TYPES.singleSelect&&(c=function(a,b,c,h,k,l,m){b=b.column.getEditor();return a&&
b&&b.store&&b.displayField&&(c=parseInt(a),c=b.store.findExact(b.valueField,c),0<=c)?b.store.getAt(c).get(b.displayField):a});a==this.UNIFORMIZED_FIELD_TYPES.checkBox&&(c=function(a,b){var c=b.column.getEditor();return"true"==a||"false"==a?c.checked?getText("common.boolean.Y"):getText("common.boolean.N"):a});a==this.UNIFORMIZED_FIELD_TYPES.numberEditor&&(c=function(a,b,c,h,k,l,m){b=!1;null!=c.data.group&&(b=c.data.group);return b?"":a});return c},beforeTaskDropEvent:function(a){var b=getText("itemov.ganttView.task.permissionErrorTitle"),
c=getText("itemov.ganttView.task.editPermissionErrorMsg");if(this.eventDrag)return!1;if(a.data.startDateEditFlag&&a.data.endDateEditFlag)return!0;this.showSimpleErrorMessage(c,b);return!1},afterTaskDropEvent:function(a){Ext.defer(this.doInitAfterEverythingLoadedAndRendered,150,this);this.model.validateRelationships&&this.validateDependencies()},showErrorMessage:function(a,b,c,e,f,g,h){},showSimpleErrorMessage:function(a,b){Ext.Msg.show({title:b,msg:a,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})},beforeTaskResize:function(a,
b){return this.eventDrag=!0},afterTaskResize:function(a){Ext.defer(this.doInitAfterEverythingLoadedAndRendered,150,this);this.model.validateRelationships&&this.validateDependencies()},defineStartEndListenerScheduleView:function(){},adjustNewlyCreatedLink:function(a){var b=this.view.getDependencyStore().last(),c=b.getSourceId(),e=b.getTargetId();b.setLag(a.lag);b.setLagUnit(this.convertTrackLagUnitToBryntum(a.lagUnit));b.extraParamsToSubmit=a;b.extraParamsToSubmit.sourceID=c;b.extraParamsToSubmit.targetID=
e;b.data.Id=-1*Math.floor(10*Math.random()+1E3)},removeLastAddedDependency:function(){var a=this.view.getDependencyStore();a.removeAt(a.data.items.length-1)},beforeDependencyDragDrop:function(a,b){},afterDependencyDragDrop:function(a,b){if(a.data.items.length>this.depStoreSize){var c=a.last().data.From,e=a.last().data.To,f=a.last().data.Type,c=this.view.taskStore.getById(c),e=this.view.taskStore.getById(e);if(null!=c&&null!=e){var g=c.data.editable,h=e.data.editable;if(!(null==g||null==h||g&&h))return f=
getText("itemov.ganttView.task.permissionErrorTitle"),c=getText("itemov.ganttView.task.editPermissionErrorMsg"),this.showSimpleErrorMessage(c,f),a.removeAt(a.data.items.length-1),!1;if(c.data.group||e.data.group)return f=getText("itemov.ganttView.task.permissionErrorTitle"),c=getText("itemov.ganttView.dependency.projectCannotBeLinked"),this.showSimpleErrorMessage(c,f),this.removeLastAddedDependency(),!1;if(!c.data.linkable||!e.data.linkable)return f=getText("itemov.ganttView.task.permissionErrorTitle"),
c=getText("itemov.ganttView.dependency.createDependencyPermError"),this.showSimpleErrorMessage(c,f),this.removeLastAddedDependency(),!1}Ext.create("com.trackplus.issue.Link",{fromGantt:!0,gantt:this,dependencyType:f}).addLinkFromIssueNavigator()}},validateNewLinkAndShowErrorMessage:function(a,b,c){return!0},setCreatedLinkID:function(a,b){var c=this.view.getDependencyStore().data.items,c=c[c.length-1];null!=c&&(c.data.Id=a,c.setLag(b))},storeGranularityAndZoom:function(){var a=this;Ext.Ajax.request({url:"itemNavigator!storeGranularityAndZoom.action",
disableCaching:!0,success:function(){},failure:function(){a.view.setLoading(!1);alert("failure")},method:"POST",params:{ganttGranularity:a.granularity}})},createContextMenuForDependency:function(a,b){var c=this,e=[];e.push({text:getText("itemov.ganttView.deleteLink"),iconCls:"dependencyContextDelete",handler:function(){var a=com.trackplus.TrackplusConfig.getText("common.lbl.messageBox.removeSelected.confirm"),e=com.trackplus.TrackplusConfig.getText("common.btn.delete"),h=b.data.Id;Ext.MessageBox.show({title:e,
msg:a,buttons:Ext.MessageBox.YESNO,fn:function(a){if("yes"==a){a=c.view.getDependencyStore().data.items;for(var b in a)a[b].data.Id==h&&c.view.getDependencyStore().remove(a[b]);0<h&&c.dependenciesToRemove.push(h)}},icon:Ext.MessageBox.QUESTION})}});Ext.create("Ext.menu.Menu",{floating:!0,items:e,closeAction:"destroy"}).showAt(a.getXY())},validateDependencies:function(){var a=this.dependencyStore.data.items,b=[];for(index in a){var c=a[index].data.From,e=a[index].data.To,f=a[index].data.Type,g=a[index].data.Lag,
h=a[index].data.Id,k=a[index].data.LagUnit;"mo"==k&&(g*=30);"w"==k&&(g*=7);!1==this.validateOneRelation(c,e,f,g)?(g=this.view.taskStore.getById(c),f=this.view.taskStore.getById(e),void 0==b[parseInt(c)]&&((g=this.view.getSchedulingView().getElementFromEventRecord(g))&&g.frame("#ff0000",1,{duration:1E3}),b[parseInt(c)]=!0),void 0==b[parseInt(e)]&&((c=this.view.getSchedulingView().getElementFromEventRecord(f))&&c.frame("#ff0000",1,{duration:1E3}),b[parseInt(e)]=!0),this.view.getSchedulingView().highlightDependency(a[index])):
this.removeClsFromOneValidatedTask(h)}},removeClsFromValidatedTasks:function(){var a=this.dependencyStore.data.items;for(index in a)this.view.getSchedulingView().unhighlightDependency(a[index])},removeClsFromOneValidatedTask:function(a){var b=this.dependencyStore.data.items;for(index in b)a==b[index].data.Id&&this.view.getSchedulingView().unhighlightDependency(b[index])},validateOneRelation:function(a,b,c,e){var f=this.view.taskStore.getById(a);a=f.data.f19;var f=f.data.f20,g=this.view.taskStore.getById(b);
b=g.data.f19;g=g.data.f20;switch(c){case 0:return this.validateSourceEndRelation(a,b,e);case 1:return this.validateSourceEndRelation(a,g,e);case 2:return this.validateSourceEndRelation(f,b,e);case 3:return this.validateSourceEndRelation(f,g,e);default:return!0}},validateSourceEndRelation:function(a,b,c){var e=!0;if(null!=a&&null!=b){var f=new Date(a.getTime()),g=new Date(b.getTime());a.getTime()==b.getTime()?0<c&&(e=!1):a.getTime()<b.getTime()?(a=this.getWorkingDays(f,g),a-1<c&&(e=!1)):(a=this.getWorkingDays(g,
f),a-=1,-1*a<c&&(e=!1))}return e},getWorkingDays:function(a,b){for(var c=0,e=new Date(a);e<=b;){var f=e.getDay();0!=f&&6!=f&&c++;e.setDate(e.getDate()+1)}return c},configureActualDay:function(a){var b={};b.Date=new Date;b.Cls="gnt-actual-day-highlight";b.Name="Today";b.IsWorkingDay=!1;b.Availability=["00:00-24:00"];a.push(b)},createGanttChart:function(a){var b=this,c=null,e=null;!1==a?(c=b.model.issues,e=b.model.holidays,b.configureActualDay(e),e=void 0==e?e=null:new Gnt.data.Calendar({data:e}),b.parseJSON(c),
b.setCalendarStartEndDate()):(b.calendarStartDate=new Date,b.calendarStartDate.setDate(b.calendarStartDate.getDate()-7),b.calendarEndDate=new Date,b.calendarEndDate.setDate(b.calendarEndDate.getDate()+14));b.exportPlugin=b.createExportPlugin();b.exportPlugin.exportDialogConfig.cls="windowConfig bottomButtonsDialog tpspecial exportGanttPDFDialog";e=Ext.create("Gnt.data.TaskStore",{calendar:e,model:"com.trackplus.itemNavigator.GanttChartModel",sorters:b.getSorters()});a?(e.loadData([{}]),e.remove(),
b.createColumns(!0)):(e.loadData(c),b.dependencyStore=Ext.create("com.trackplus.ganttView.DependencyStore",{data:b.dependencyStoreData,strictDependencyValidation:!1}),b.createColumns(!1));e.sort();b.columns.reverse();a=!1;b.model.isActiveTopDownDate&&(a=b.model.showBoth);return Ext.create("Gnt.panel.Gantt",{region:"center",highlightWeekends:!0,cascadeChanges:!0,border:!1,loadMask:!0,rowHeight:24,enableBaseline:!0,baselineVisible:a,resizeConfig:{showDuration:!1},lockedGridConfig:{stateful:!0,stateId:"itemNavigator_ganttView",
width:"250px",plugins:Ext.create("Sch.plugin.TreeCellEditing",{clicksToEdit:1}),listeners:{beforestaterestore:{fn:function(a,b,c){delete b.columns}},staterestore:{fn:function(a,b,c){b=b.width;c=borderLayout.getWidth();b>c&&(b=c-450,0>b&&(b=50),a.width=b)}}}},lockedViewConfig:{plugins:[{ptype:"gridviewdragdrop",enableDrop:!0,dragText:getText("itemov.wbsView.lbl.dragText"),dragGroup:"itemToCategory",dropGroup:"itemToCategory"}],getRowClass:function(a,c,e,k){c=b.getRowClass.call(b,a,c,e,k);a.data.extendedItem&&
(c+=" ganttExtraRowsWhichAreNotIncludedInFilter");return c}},viewConfig:{focusedItemCls:"row-focused",selectedItemCls:"row-selected",trackOver:!1},enableDependencyDragDrop:!0,enableTaskDragDrop:!0,startDate:b.calendarStartDate,enableProgressBarResize:!1,endDate:b.calendarEndDate,viewPreset:"weekAndDayLetter",tooltipTpl:b.createTaskTooltipTemplate(),columns:b.columns,selModel:b.createSelModel(),taskStore:e,dependencyStore:b.dependencyStore,plugins:[b.exportPlugin],listeners:{beforetaskdrag:function(a,
c,e,k){a=!1;0>c.data.Id&&(a=!0);return a||c.data.editable?!0:(c=getText("itemov.ganttView.task.permissionErrorTitle"),a=getText("itemov.ganttView.task.editPermissionErrorMsg"),b.showSimpleErrorMessage(a,c),!1)},aftertaskdrop:function(a,c,e){b.afterTaskDropEvent(c)},beforetaskresize:function(a,c,e,k){a=!1;0>c.data.Id&&(a=!0);if(a)return!0;if(c.data.leaf&&c.data.editable)return b.beforeTaskResize(c);c.data.leaf&&c.data.editable||(c=getText("itemov.ganttView.task.permissionErrorTitle"),a=getText("itemov.ganttView.task.editPermissionErrorMsg"),
b.showSimpleErrorMessage(a,c));return!1},aftertaskresize:function(a,c,e){b.afterTaskResize(c)},beforedependencydrag:function(a,c,e){b.depStoreSize=b.dependencyStore.data.items.length;b.beforeDependencyDragDrop(b.dependencyStore,c)},afterdependencydragdrop:function(a,c,e){b.afterDependencyDragDrop(b.dependencyStore,c)},dependencycontextmenu:function(a,c,e,k,l){b.createContextMenuForDependency(e,c)}}})},createExportPlugin:function(){var a=this;return new Gnt.plugin.Export({printServer:"itemNavigator!exportGanttChart.action",
defaultConfig:{format:"A3",orientation:"landscape",range:"complete"},fileFormat:"pdf",pageSizes:{Legal:{width:8.5,height:14},Letter:{width:8.5,height:11},A5:{width:5.8,height:8.3},A4:{width:8.3,height:11.7},A3:{width:11.7,height:16.5}},DPI:110,openAfterExport:!1,listeners:{hidedialogwindow:function(b,c){if(b.success){var e=b.url;Ext.Ajax.request({url:"itemNavigator!checkIfExportedGanttPDFExistsBeforeDownload.action",disableCaching:!0,success:function(b){b=Ext.decode(b.responseText);b.success?window.open(e):
a.showSimpleErrorMessage(b.msg,"")},failure:function(){},method:"POST",params:{gntPDFLocation:b.tmpWorkingDirName}})}return!0}}})},createTaskTooltipTemplate:function(){var a=(new Ext.XTemplate('\x3cul class\x3d"taskTip"\x3e',"\x3cli\x3e\x3cstrong\x3e"+this.model.localizedToolTipLabels.name+": \x3c/strong\x3e{Name}\x3c/li\x3e","\x3cli\x3e\x3cstrong\x3e"+this.model.localizedToolTipLabels.issue+": \x3c/strong\x3e{f12}\x3c/li\x3e","\x3cli\x3e\x3cstrong\x3e"+this.model.localizedToolTipLabels.start+": \x3c/strong\x3e{f19:this.formatTplDate}\x3c/li\x3e",
"\x3cli\x3e\x3cstrong\x3e"+this.model.localizedToolTipLabels.end+": \x3c/strong\x3e{f20:this.formatTplDate}\x3c/li\x3e","\x3cli\x3e\x3cstrong\x3e"+this.model.localizedToolTipLabels.state+": \x3c/strong\x3e{status}\x3c/li\x3e","\x3cli\x3e\x3cstrong\x3e"+this.model.localizedToolTipLabels.responsible+": \x3c/strong\x3e{responsibleValue}\x3c/li\x3e","\x3cli\x3e\x3cstrong\x3e"+getText("admin.customize.list.lbl.percentComplete")+": \x3c/strong\x3e{PercentDoneToolTip}%\x3c/li\x3e","\x3c/ul\x3e")).compile();
a.formatTplDate=function(a){return Ext.util.Format.date(a,com.trackplus.TrackplusConfig.DateFormat)};return a},getISOFormattedDate:function(a){var b;b=""+(a.getFullYear()+"-");var c=parseInt(a.getMonth()),e=c+=1;10>c&&(e="0"+c);b+=e+"-";c=a=parseInt(a.getDate());10>a&&(c="0"+a);return b+c},getSorters:function(){this.WBS_SORT_ASCENDING=!0;return[{property:"wbs",direction:!0==this.WBS_SORT_ASCENDING?"ASC":"DESC"}]},dataChangeSuccess:function(a){var b;this.cellInlineCtr.dataChangeSuccess();b=this;null!=
a&&(a=a.position,b.view.getSchedulingView().scrollEventIntoView(a.task,!0),b.view.getSchedulingView().scrollHorizontallyTo(b.view.getSchedulingView().getHorizontalScroll()),b.view.getSchedulingView().scrollVerticallyTo(b.view.getSchedulingView().getVerticalScroll()))},doInitAfterEverythingLoadedAndRendered:function(){this.model.validateRelationships&&this.validateDependencies();this.model.highlightCriticalPath&&this.view.getSchedulingView().highlightCriticalPaths(!0)},normalizeTask:function(a,b,c){c=
this.view.getTaskStore().getById(c);"f19"==a&&c.setStartDate(Ext.Date.parse(b,com.trackplus.TrackplusConfig.DateFormat));"f20"==a&&c.setEndDate(Ext.Date.parse(b,com.trackplus.TrackplusConfig.DateFormat))},getEditedOrNewItemJSON:function(a){var b=a.getChanges(),c=null;if(null!=b){var c={modifiedFields:{}},e;for(e in b)if(e&&"f"==e.charAt(0)){var f=b[e];f instanceof Date&&(f=Ext.util.Format.date(f,com.trackplus.TrackplusConfig.DateFormat));c.modifiedFields[e]=f}b=a.data.Id;e=!1;0>b&&(e=!0);c.workItemID=
b;c.workItemIDAbove=null;e&&(c.workItemIDAbove=a.data.workItemIDAbove);c.projectID=a.data.projectID;c.issueTypeID=a.data.issueTypeID;c.isNew=e;c.rowIndex=a.data.workItemIndex}return c},getdependenciesJSON:function(){var a=[],b=this.view.getDependencyStore().data.items,c;for(c in b){var e=b[c];null!=e&&e.dirty&&null!=e.extraParamsToSubmit&&a.push(e.extraParamsToSubmit)}return a},saveChanges2:function(a,b,c,e){var f=this,g=f.view.getTaskStore(),h=f.view.getTaskStore().getUpdatedRecords();if(f.isChartContainsUnsavedItems()){f.view.setLoading(!0);
f.taskStoreJSONForSave=[];editedOrNewTasksJSON=[];for(var k in h){var l=h[k],m=l.data.group;void 0==m&&(m=!1);m||(l=f.getEditedOrNewItemJSON(l),null!=l&&editedOrNewTasksJSON.push(l))}h=f.getdependenciesJSON();Ext.Ajax.request({url:"itemNavigator!planItem3.action",disableCaching:!0,success:function(e){e=Ext.decode(e.responseText);f.view.setLoading(!1);e.success?(g.sync(),null!=b&&b.apply(a,c),f.fireEvent.call(f,"datachange")):(e=Ext.decode(e.errorMessage),f.showSaveErrorsConfirmDialog(f.getErrorStringAfterValidation(e)))},
failure:function(){f.view.setLoading(!1);alert("failure")},method:"POST",params:{ganttTaskStore:Ext.encode(editedOrNewTasksJSON),validateBeforeSave:e,ganttDependencyStore:Ext.encode(h),ganttDependenciesToRemove:Ext.encode(f.dependenciesToRemove)}})}},getErrorStringAfterValidation:function(a){var b="",c;for(c in a){var e=a[c],f=e.rowIndex,b=b+("\x3cb\x3e"+getText("item.pseudoColumn.indexNumber")+": "+f+"\x3c/b\x3e \x3cbr\x3e"),e=e.errors,g;for(g in e)b+="  "+e[g]+"\x3cbr\x3e"}return b},getUniformizedFieldType:function(a){switch(a){case "com.aurel.trackplus.field.SynopsisTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.simpleTextField;
case "com.aurel.trackplus.field.PersonPickerRenderer":case "com.aurel.trackplus.field.StateRenderer":case "com.aurel.trackplus.field.PriorityRenderer":case "com.aurel.trackplus.field.SelectTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.singleSelect;case "com.aurel.trackplus.field.DateTypeRenderer":case "com.aurel.trackplus.field.StartDateRenderer":case "com.aurel.trackplus.field.EndDateRenderer":case "com.aurel.trackplus.field.StartDateTargetRenderer":case "com.aurel.trackplus.field.EndDateTargetRenderer":return this.UNIFORMIZED_FIELD_TYPES.datePicker;
case "com.aurel.trackplus.field.CheckBoxTypRenderer":return this.UNIFORMIZED_FIELD_TYPES.checkBox;case "com.aurel.trackplus.field.DurationRenderer":case "com.aurel.trackplus.field.TargetDurationRenderer":return this.UNIFORMIZED_FIELD_TYPES.numberEditor;default:return null}},createView:function(a){this.cellInlineCtr=Ext.create("com.trackplus.itemNavigator.CellInlineEditController",{navigator:this,isPrintItemEditable:this.model.isPrintItemEditable});this.dependenciesToRemove=[];this.queryFieldCSS=this.model.queryFieldCSS;
0<this.model.issues.length?(this.dateArrayMinMax=[],this.dependencyStoreData=[],this.view=this.createGanttChart(!1),void 0!=this.model.listViewData&&(actualGranularity=this.model.listViewData.ganttGranularity,this.view.switchViewPreset(actualGranularity,this.calendarStartDate,this.calendarEndDate)),this.initMyListeners(),this.defineStartEndListenerScheduleView(),this.cellInlineCtr.grid=this.getTreeGrid(),this.cellInlineCtr.gantt=this.view,this.cellInlineCtr.initListeners(),this.cellInlineCtr.initGanttSpecificListener()):
this.view=this.createGanttChart(!0);Ext.defer(this.doInitAfterEverythingLoadedAndRendered,150,this);return this.view}});
Ext.define("com.trackplus.itemNavigator.CellInlineEditController",{extend:"Ext.Base",mixins:{field:"Ext.form.field.Field"},config:{navigator:null,grid:null,gantt:null,isPrintItemEditable:null},isNew:!1,editOrCreateInProgress:!1,selectedIdOrValue:null,row:null,actualEditedOrCreatedRow:null,actualEditedOrCreatedRecord:null,warningDisplayed:!1,SYSTEM_FIELDS:{SYNOPSIS:17,RESPONSIBLE:6,STATE_FIELD_ID:4,STARTDATE:19,ENDDATE:20,DURATION:33,TOP_DOWN_STARTDATE:29,TOP_DOWN_ENDDATE:30,TOP_DOWN_DURATION:34},
UNIFORMIZED_FIELD_TYPES:{singleSelect:"SINGLE_SELECT",datePicker:"DATE_PICKER",simpleTextField:"SIMPLE_TEXT_FIELD",checkBox:"CHECK_BOX",numberEditor:"NUMBER_EDITOR"},constructor:function(a){Ext.apply(this,a||{})},initListeners:function(){this.isPrintItemEditable&&(this.grid.addListener("edit",this.onGridEdit,this),this.grid.addListener("beforeedit",this.onGridBeforeEdit,this),this.grid.addListener("render",this.onReadyHandler,this))},initGanttSpecificListener:function(){this.isPrintItemEditable&&
this.gantt.addListener("selectionchange",this.onGridSelectionChnage,this)},onReadyHandler:function(){var a=this;a.isPrintItemEditable&&(Ext.getBody().addKeyMap({eventName:"keydown",binding:[{key:[Ext.EventObject.NUM_PLUS,171,61],ctrl:!0,fn:a.addNewRow,scope:a},{key:[83],ctrl:!0,fn:a.saveShortcutHandler,scope:a},{key:[90],ctrl:!0,fn:a.undoEditOrCreate,scope:a},{key:[Ext.EventObject.NUM_MINUS],ctrl:!0,fn:a.removeRowFromGrid,scope:a}]}),borderLayout.onPageMouseDown=function(b){if(!a.clickIsOutOfGrid(b))return!0;
var c=a.grid.store.getModifiedRecords();if(!a.warningDisplayed&&a.editOrCreateInProgress&&0<c.length)b.stopEvent(),Ext.MessageBox.show({title:getText("common.warning"),msg:getText("item.action.leavingInlineEdit"),buttons:Ext.MessageBox.YESNO,fn:function(b){"yes"==b&&a.prepareDataAdnSave();"no"==b&&(a.navigator.fireEvent.call(a.navigator,"datachange"),a.reInitializeDataAfterEditOrCreate())},icon:Ext.MessageBox.QUESTION}),a.warningDisplayed=!1,a.grid.getSelectionModel().select(a.actualEditedOrCreatedRecord);
else return!0})},clickIsOutOfGrid:function(a){var b=!0;clickX=a.getX();clickY=a.getY();a=this.grid.getX();var c=borderLayout.getActiveToolbarList().getY();clickX>a&&clickY>c&&(b=!1);return b},onGridSelectionChnage:function(a,b,c){this.prepareDataAdnSave()},saveShortcutHandler:function(a,b){b.stopEvent();this.prepareDataAdnSave()},prepareDataAdnSave:function(){if(null==this.gantt){var a={};if(null!=this.row&&this.isRowEditedt()){var b=null;this.isNew&&(b=this.workItemIDAbove);this.saveData(a,b)}}},
onGridEdit:function(a,b,c){null!=this.selectedIdOrValue&&(null==this.row&&(this.row=this.getGridSelectedRow()),null==this.actualEditedOrCreatedRow&&(this.actualEditedOrCreatedRow=this.getGridSelectedRow()))},getGridSelectedRow:function(){return this.grid.getSelectionModel().getSelection()[0].getData()},onGridBeforeEdit:function(a,b,c){if(!this.isEditable(b))return!1;this.selectedIdOrValue=null;this.actualEditedOrCreatedRecord=b.record;this.editOrCreateInProgress=!0;if(!this.isNew&&!b.record.data.editable)return!1;
a=b.column.getEditor();switch(this.getUniformizedFieldType(b.column.extJsRendererClass)){case this.UNIFORMIZED_FIELD_TYPES.singleSelect:this.loadFieldValue(a,b.record.data.workItemID,b.record.data.projectID,b.record.data.issueTypeID,b.column.fieldID,this.UNIFORMIZED_FIELD_TYPES.singleSelect,"itemNavigator!loadComboDataByFieldID.action");break;case this.UNIFORMIZED_FIELD_TYPES.checkBox:this.loadFieldValue(a,b.record.data.workItemID,b.record.data.projectID,b.record.data.issueTypeID,b.column.fieldID,
this.UNIFORMIZED_FIELD_TYPES.checkBox,"itemNavigator!loadFieldValue.action");break;case this.UNIFORMIZED_FIELD_TYPES.simpleTextField:this.isNew&&(a.margin="0 0 0 0")}},isEditable:function(a){Ext.defer(this.doInitAfterEverythingLoadedAndRendered,150,this);return a.record.data.leaf?!0:a.field=="f"+this.SYSTEM_FIELDS.STARTDATE||a.field=="f"+this.SYSTEM_FIELDS.ENDDATE||a.field=="f"+this.SYSTEM_FIELDS.DURATION||a.field=="f"+this.SYSTEM_FIELDS.TOP_DOWN_STARTDATE||a.field=="f"+this.SYSTEM_FIELDS.TOP_DOWN_ENDDATE||
a.field=="f"+this.SYSTEM_FIELDS.TOP_DOWN_DURATION?!1:!0},getShortField:function(a){},setColumnEditor:function(a,b){this.isPrintItemEditable&&(b.extJsRendererClass=a.extJsRendererClass,this.setCellRenderer(a.extJsRendererClass,b,a))},createContext:function(){var a={actionID:1,fromAjax:!0};a["params.projectID"]=this.row.projectID;a["params.issueTypeID"]=this.row.issueTypeID;a.parentID="";a.synopsis="";a.workItemID="";Ext.Ajax.request({url:"item!next.action",disableCaching:!0,success:function(a){},failure:function(){},
method:"POST",params:a})},saveData:function(a,b){var c=this,e=c.grid.store.getModifiedRecords();if(0<e.length){var e=e[0].getChanges(),f;for(f in e){var g=e[f];f&&"f"==f.charAt(0)&&(a["fieldValues."+f]=g)}a.projectID=c.row.projectID;a.issueTypeID=c.row.issueTypeID;null!=b&&(a.workItemIDAbove=b);c.isNew?(a.actionID="1",actionIDValue=1,a.workItemID=""):(a.actionID="2",a.workItemID=c.row.workItemID);a.inlineEditInNavigator=!0;a.fromAjax=!0;Ext.Ajax.request({url:"itemSave.action",disableCaching:!0,success:function(a){a=
Ext.decode(a.responseText);if(a.success)borderLayout.workItemIDToSelectAfterReload=a.data.workItemID,c.reInitializeDataAfterEditOrCreate(),null!=c.gantt?c.grid.store.getById(a.data.workItemID).commit():c.navigator.fireEvent.call(c.navigator,"datachange");else{var b="";Ext.Array.forEach(a.data.errors,function(a){b+=a.label},c);CWHF.showMsgError(b)}},failure:function(){c.reInitializeDataAfterEditOrCreate()},method:"POST",params:a})}},isRowEditedt:function(){return this.editOrCreateInProgress},dateColumnRenderer:function(a){if(0<
a.length){var b=Ext.Date.parse(a,com.trackplus.TrackplusConfig.DateFormat);Ext.isDefined(b)||(b=new Date(a));return Ext.Date.format(b,com.trackplus.TrackplusConfig.DateFormat)}return a},setCellRenderer:function(a,b,c){switch(this.getUniformizedFieldType(a)){case this.UNIFORMIZED_FIELD_TYPES.simpleTextField:this.createTextFieldEditor(b);break;case this.UNIFORMIZED_FIELD_TYPES.singleSelect:this.createComboEditor(b);break;case this.UNIFORMIZED_FIELD_TYPES.datePicker:this.createDateEditor(b,a);break;
case this.UNIFORMIZED_FIELD_TYPES.checkBox:this.createCheckBox(b,c);break;case this.UNIFORMIZED_FIELD_TYPES.numberEditor:this.createNumberEditor(b,c,a);break;default:editor=null}},getUniformizedFieldType:function(a){switch(a){case "com.aurel.trackplus.field.SynopsisTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.simpleTextField;case "com.aurel.trackplus.field.PersonPickerRenderer":case "com.aurel.trackplus.field.StateRenderer":case "com.aurel.trackplus.field.PriorityRenderer":case "com.aurel.trackplus.field.SelectTypeRenderer":return this.UNIFORMIZED_FIELD_TYPES.singleSelect;
case "com.aurel.trackplus.field.DateTypeRenderer":case "com.aurel.trackplus.field.StartDateRenderer":case "com.aurel.trackplus.field.EndDateRenderer":case "com.aurel.trackplus.field.StartDateTargetRenderer":case "com.aurel.trackplus.field.EndDateTargetRenderer":return this.UNIFORMIZED_FIELD_TYPES.datePicker;case "com.aurel.trackplus.field.CheckBoxTypRenderer":return this.UNIFORMIZED_FIELD_TYPES.checkBox;case "com.aurel.trackplus.field.DurationRenderer":case "com.aurel.trackplus.field.TargetDurationRenderer":return this.UNIFORMIZED_FIELD_TYPES.numberEditor;
default:return null}},createTextFieldEditor:function(a){var b=this,c=Ext.create("Ext.form.field.Text",{listeners:{change:function(a,c,g,h){b.selectedIdOrValue=c}}});a.editor=c},createComboEditor:function(a){var b=this,c=[];c.push({name:"label",type:"string"});c.push({name:"id",type:"number"});c=Ext.create("Ext.form.ComboBox",{fields:c,displayField:"label",valueField:"id",listeners:{select:function(a,c){b.selectedIdOrValue=c[0].data.id}}});a.editor=c},createDateEditor:function(a,b){var c=this,e=Ext.create("Ext.form.field.Date",
{format:com.trackplus.TrackplusConfig.DateFormat,listeners:{change:function(a,b,e,k){c.selectedIdOrValue=Ext.Date.format(b,com.trackplus.TrackplusConfig.DateFormat);k=c.grid.getSelectionModel().getSelection()[0];k.set("f"+a.column.fieldID,b);if(null==c.gantt)c.refreshDependentFields(a,k.data,e,b);else{var l=c.grid.store.getById(k.data.Id);c.navigator.isShowBaseline()?("com.aurel.trackplus.field.StartDateTargetRenderer"==this.originalFieldType&&l.setStartDate(b),"com.aurel.trackplus.field.EndDateTargetRenderer"==
this.originalFieldType&&l.setEndDate(b),"com.aurel.trackplus.field.StartDateRenderer"!=this.originalFieldType&&"com.aurel.trackplus.field.EndDateRenderer"!=this.originalFieldType||c.refreshDependentFields(a,k.data,e,b)):("com.aurel.trackplus.field.StartDateRenderer"==this.originalFieldType&&l.setStartDate(b),"com.aurel.trackplus.field.EndDateRenderer"==this.originalFieldType&&l.setEndDate(b),"com.aurel.trackplus.field.StartDateTargetRenderer"!=this.originalFieldType&&"com.aurel.trackplus.field.EndDateTargetRenderer"!=
this.originalFieldType||c.refreshDependentFields(a,k.data,e,b))}}},getValue:function(){if(null!=c.gantt)return c.fieldIsTargetOrNormalStartEnd(this.originalFieldType)?this.value:Ext.util.Format.date(this.value,com.trackplus.TrackplusConfig.DateFormat);var a=this.value;return null!=a&&""!=a?Ext.util.Format.date(a,com.trackplus.TrackplusConfig.DateFormat):this.value}});e.originalFieldType=b;a.format=com.trackplus.TrackplusConfig.DateFormat;a.renderer=c.dateColumnRenderer;a.editor=e},fieldIsTargetOrNormalStartEnd:function(a){return"com.aurel.trackplus.field.StartDateRenderer"==
a||"com.aurel.trackplus.field.EndDateRenderer"==a||"com.aurel.trackplus.field.StartDateTargetRenderer"==a||"com.aurel.trackplus.field.EndDateTargetRenderer"==a?!0:!1},createCheckBox:function(a,b){var c=this,e=Ext.create("Ext.form.field.Checkbox",{boxLabel:b.label,listeners:{change:function(a,b,e,k){null!=a.column&&(c.selectedIdOrValue=Ext.Date.format(b,com.trackplus.TrackplusConfig.DateFormat))}}});a.editor=e},createNumberEditor:function(a,b,c){var e=this;b=Ext.create("Ext.form.field.Number",{boxLabel:b.label,
value:0,listeners:{change:function(a,b,c,k){if(null!=a.column)if(e.selectedIdOrValue=b,k=e.grid.getSelectionModel().getSelection()[0],null!=e.gantt)if(e.navigator.isShowBaseline())"com.aurel.trackplus.field.TargetDurationRenderer"==a.originalFieldType&&(l=e.grid.store.getById(k.data.Id),l.setDuration(b)),"com.aurel.trackplus.field.DurationRenderer"==a.originalFieldType&&e.refreshDependentFields(a,k.data,c,b);else{if("com.aurel.trackplus.field.DurationRenderer"==a.originalFieldType){var l=e.grid.store.getById(k.data.Id);
l.setDuration(b)}"com.aurel.trackplus.field.TargetDurationRenderer"==a.originalFieldType&&e.refreshDependentFields(a,k.data,c,b)}else"com.aurel.trackplus.field.DurationRenderer"!=a.originalFieldType&&"com.aurel.trackplus.field.TargetDurationRenderer"!=a.originalFieldType||e.refreshDependentFields(a,k.data,c,b)}},getValue:function(){return parseInt(this.value)||""}});b.originalFieldType=c;a.editor=b},loadFieldValue:function(a,b,c,e,f,g,h){var k=this;params={};params.workItemID=b;params.fieldID=f;params.projectID=
c;params.issueTypeID=e;Ext.Ajax.request({url:h,disableCaching:!0,success:function(b){responseJSON=Ext.decode(b.responseText);k.UNIFORMIZED_FIELD_TYPES.singleSelect==g&&(b=Ext.create("Ext.data.Store",{fields:["id","label"],data:responseJSON.storeData}),a.bindStore(b));k.UNIFORMIZED_FIELD_TYPES.checkBox==g&&a.setValue(responseJSON.value)},failure:function(){},method:"POST",params:params})},checkUserCreateRight:function(){var a=this,b=a.grid.getSelectionModel().getSelection();if(0<b.length){a.row=b[0].getData();
var b=a.row.issueTypeID,c={};c.projectID=a.row.projectID;c.issueTypeID=b;Ext.Ajax.request({url:"item!checkUserRightForCreatingNewItem.action",disableCaching:!0,success:function(b){Ext.decode(b.responseText).userCanCreateNewItem?a.handleCreatingNewItem():(CWHF.showMsgError(getText("item.err.createNotAllowed")),a.reInitializeDataAfterEditOrCreate())},failure:function(){},method:"POST",params:c})}},reInitializeDataAfterEditOrCreate:function(){this.isNew=!1;this.row=null;this.editOrCreateInProgress=!1},
handleCreatingNewItem:function(){var a=this.grid.getSelectionModel().getSelection();if(0<a.length){a=a[0];this.row=a.getData();this.isNew=!0;var b=this.row.f1,c={leaf:!0,cls:"item-calendarStartDateMissing"};c.f2=this.row.f2;c.f1=b;c.f17="";b=-1*Math.floor(10*Math.random()+1E3);c.Id=b;c.workItemID=null;c.projectID=this.row.projectID;c.issueTypeID=this.row.issueTypeID;c.linkable=this.row.linkable;c.editable=this.row.editable;this.workItemIDAbove=c.workItemIDAbove=this.row.workItemID;switch(this.navigator.$className){case "com.trackplus.itemNavigator.SimpleTreeGridViewPlugin":case "com.trackplus.itemNavigator.WBSViewPlugin":case "com.trackplus.itemNavigator.GanttViewPlugin":this.selectNewlyAddedRowTree(a,
c);break;case "com.trackplus.itemNavigator.FlatGridViewPlugin":this.selectNewlyAddedRowFlat(a,c)}null==this.gantt&&this.createContext();this.editOrCreateInProgress=!0;this.recalculateGridItemIndex();a=this.grid.getSelectionModel().getSelection();0<a.length&&(a=a[0],a.set("f17",getText("itemov.ganttView.newlyCreatedItemDummyTitle")))}},addNewRow:function(a,b){b.stopEvent();this.reInitializeDataAfterEditOrCreate();this.checkUserCreateRight()},selectNewlyAddedRowTree:function(a,b){var c=a.parentNode,
e=c.indexOf(a);e++;this.actualEditedOrCreatedRecord=c.insertChild(e,b);this.grid.getSelectionModel().select(this.actualEditedOrCreatedRecord)},selectNewlyAddedRowFlat:function(a,b){var c=this.grid.store.indexOf(a);c++;this.actualEditedOrCreatedRecord=this.grid.store.insert(c,b);this.grid.getSelectionModel().select(this.actualEditedOrCreatedRecord)},dataChangeSuccess:function(){var a=this.grid.store.getById(borderLayout.workItemIDToSelectAfterReload);this.grid.getSelectionModel().select(a)},undoEditOrCreate:function(){this.navigator.fireEvent.call(this.navigator,
"datachange")},removeRowFromGrid:function(a,b){b.stopEvent();if(null==this.gantt){if(!this.isNew){var c=this.grid.getSelectionModel().getSelection();0<c.length&&(c=c[0],c=c.getData().workItemID,this.closeItemAjax(c))}}else if(c=this.grid.getSelectionModel().getSelection(),0<c.length){var c=c[0],e=!1;0>c.data.Id&&(e=!0);e?(this.gantt.getTaskStore().remove(c),this.recalculateGridItemIndex()):(c=c.getData().workItemID,this.closeItemAjax(c))}},handleRemoveFromGantt:function(){var a=this.grid.getSelectionModel().getSelection();
if(0<a.length){var a=a[0],b=!1;0>a.data.Id&&(b=!0);b?(this.gantt.getTaskStore().remove(a),this.recalculateGridItemIndex()):(a=a.getData().workItemID,this.closeItemAjax(a))}},closeItemAjax:function(a){var b=this,c={};c.workItemID=a;Ext.Ajax.request({url:"itemNavigator!closeWorkItem.action",disableCaching:!0,success:function(c){c=Ext.decode(c.responseText);if(c.success)CWHF.showMsgInfo(getText("item.action.stateChangeToClosed",a)),null==b.gantt?b.navigator.fireEvent.call(b.navigator,"datachange"):(b.grid.store.getById(a).data["f"+
b.SYSTEM_FIELDS.STATE_FIELD_ID]=c.closedStateName,b.grid.getView().refresh());else{var f="";Ext.Array.forEach(c.data.errors,function(a){f+=a.label},b);CWHF.showMsgError(f)}},failure:function(){},method:"POST",params:c})},recalculateGridItemIndex:function(){if(null!=this.gantt){var a=this.gantt.getTaskStore().treeStore.getRootNode();this.workItemIndex=0;this.parseGridItemsAndResetIndex(a);this.grid.getView().refresh()}},parseGridItemsAndResetIndex:function(a){var b=!1;null!=a.data.group&&(b=a.data.group);
b||"root"==a.data.Id||(a.data.workItemIndex=this.workItemIndex,this.workItemIndex++);if(0!=a.childNodes.length)for(var c in a.childNodes)b=a.childNodes[c],0!=b.length&&this.parseGridItemsAndResetIndex(b)},refreshDependentFields:function(a,b,c,e){var f=a.column.fieldID,g="f"+f,h=null,k=c,l=e;switch(a.originalFieldType){case "com.aurel.trackplus.field.StartDateRenderer":h=Ext.create("com.aurel.trackplus.field.StartDateRenderer",{});a.durationFieldID=this.SYSTEM_FIELDS.DURATION;a.startDateFieldID=this.SYSTEM_FIELDS.STARTDATE;
a.endDateFieldID=this.SYSTEM_FIELDS.ENDDATE;null==this.gantt&&(k=Ext.Date.parse(c,com.trackplus.TrackplusConfig.DateFormat),l=Ext.Date.parse(e,com.trackplus.TrackplusConfig.DateFormat));break;case "com.aurel.trackplus.field.EndDateRenderer":h=Ext.create("com.aurel.trackplus.field.EndDateRenderer",{});a.durationFieldID=this.SYSTEM_FIELDS.DURATION;a.startDateFieldID=this.SYSTEM_FIELDS.STARTDATE;a.endDateFieldID=this.SYSTEM_FIELDS.ENDDATE;null==this.gantt&&(k=Ext.Date.parse(c,com.trackplus.TrackplusConfig.DateFormat),
l=Ext.Date.parse(e,com.trackplus.TrackplusConfig.DateFormat));break;case "com.aurel.trackplus.field.StartDateTargetRenderer":h=Ext.create("com.aurel.trackplus.field.StartDateTargetRenderer",{});a.startDateFieldID=this.SYSTEM_FIELDS.TOP_DOWN_STARTDATE;a.endDateFieldID=this.SYSTEM_FIELDS.TOP_DOWN_ENDDATE;a.durationFieldID=this.SYSTEM_FIELDS.TOP_DOWN_DURATION;null==this.gantt&&(k=Ext.Date.parse(c,com.trackplus.TrackplusConfig.DateFormat),l=Ext.Date.parse(e,com.trackplus.TrackplusConfig.DateFormat));
break;case "com.aurel.trackplus.field.EndDateTargetRenderer":h=Ext.create("com.aurel.trackplus.field.EndDateTargetRenderer",{});a.startDateFieldID=this.SYSTEM_FIELDS.TOP_DOWN_STARTDATE;a.endDateFieldID=this.SYSTEM_FIELDS.TOP_DOWN_ENDDATE;a.durationFieldID=this.SYSTEM_FIELDS.TOP_DOWN_DURATION;null==this.gantt&&(k=Ext.Date.parse(c,com.trackplus.TrackplusConfig.DateFormat),l=Ext.Date.parse(e,com.trackplus.TrackplusConfig.DateFormat));break;case "com.aurel.trackplus.field.DurationRenderer":h=Ext.create("com.aurel.trackplus.field.DurationRenderer",
{});a.durationFieldID=this.SYSTEM_FIELDS.DURATION;a.startDateFieldID=this.SYSTEM_FIELDS.STARTDATE;a.endDateFieldID=this.SYSTEM_FIELDS.ENDDATE;break;case "com.aurel.trackplus.field.TargetDurationRenderer":h=Ext.create("com.aurel.trackplus.field.TargetDurationRenderer",{});a.durationFieldID=this.SYSTEM_FIELDS.TOP_DOWN_DURATION;a.startDateFieldID=this.SYSTEM_FIELDS.TOP_DOWN_STARTDATE;a.endDateFieldID=this.SYSTEM_FIELDS.TOP_DOWN_ENDDATE;break;default:return}c={};c[g]=l;l={};l[g]=k;g=!1;null!=this.gantt&&
(g=!0);h.refreshDependentFields.call(this,f,c,l,a,b,g)},updateField:function(a,b,c,e){if(null!=b){c="f"+a;e=this.grid.getSelectionModel().getSelection()[0];var f=b;null==this.gantt||a!=this.SYSTEM_FIELDS.STARTDATE&&a!=this.SYSTEM_FIELDS.ENDDATE&&a!=this.SYSTEM_FIELDS.TOP_DOWN_STARTDATE&&a!=this.SYSTEM_FIELDS.TOP_DOWN_ENDDATE||(f=Ext.Date.parse(b,com.trackplus.TrackplusConfig.DateFormat));e.set(c,f);this.grid.getView().refresh()}},addWeekdays:function(a,b,c){var e=0,f=1;for(c||(f=-1);e<b;)a.setDate(a.getDate()+
f),c=a.getDay(),0<c&&6>c&&e++;return Ext.Date.format(a,com.trackplus.TrackplusConfig.DateFormat)},parseDate:function(a,b){return null==a||0==a.length?b?new Date:null:Ext.Date.parse(a,com.trackplus.TrackplusConfig.DateFormat)},getDurationBetweenDates:function(a,b){var c=this.parseDate(a,!1);if(null==c||null==b)return null;for(var e=0;c<b;){c.setDate(c.getDate()+1);var f=c.getDay();0<f&&6>f?e++:c>=b&&(6==f?e++:e+=2)}return e},getDateFromModel:function(a,b,c){var e=null,e=a[b];c&&(e=Ext.util.Format.date(e,
com.trackplus.TrackplusConfig.DateFormat));return e}});
Ext.define("com.trackplus.itemNavigator.LiteGridViewPlugin",{extend:"com.trackplus.itemNavigator.SimpleTreeGridViewPlugin",initMyListeners:function(){this.view.on("boxready",function(a){a.view.focus=Ext.emptyFn});this.view.addListener("celldblclick",this.onLiteGridItemDblClick,this)},onLiteGridItemDblClick:function(a,b,c,e,f,g,h){h.stopEvent();if(!0==this.model.layout.bulkEdit&&0==c)return!1;this.openItem(e.data.workItemID);return!1},openItem:function(a){a=Ext.create("com.trackplus.item.ItemActionDialog",
{workItemID:a,actionID:-2,parentID:null,successHandler:this.itemActionSuccessHandler,scope:this,modal:!1,navigatorHandler:this.navigatorHandler,navigatorScope:this});a.execute.call(a);a.addListener("navigateToItem",this.navigateToItemHandler,this)},navigateToItemHandler:function(a,b,c){this.openItem(b)},itemActionSuccessHandler:function(){},navigatorHandler:function(a,b,c){return this.navigateToItem(a,b,c)},getTreeViewPlugins:function(){return null}});
Ext.define("com.trackplus.itemNavigator.WBSViewPlugin",{extend:"com.trackplus.itemNavigator.SimpleTreeGridViewPlugin",disableSort:!0,WBS_SORT_ASCENDING:!0,getTreeViewPlugins:function(){return[{ptype:"gridviewdragdrop",dragText:getText("itemov.wbsView.lbl.dragText"),dragGroup:"itemToCategory",dropGroup:"itemToCategory",enableDrop:!0}]},initMyListeners:function(){this.callParent();this.view.getView().addListener("beforedrop",this.onGridBeforeDrop,this)},createFields:function(){var a=this.callParent();
a.push({name:"wbs"});return a},getSorters:function(){return[{property:"wbs",direction:!0==this.WBS_SORT_ASCENDING?"ASC":"DESC"}]},createStore:function(){var a=this.callParent(arguments);a.sort();return a},expandGroup:function(a,b){Ext.Ajax.request({url:"reportExpand!expandGroupWBS.action",params:{expanded:b,groupID:a}})},onGridBeforeDrop:function(a,b,c,e){var f=this,g=c.data.projectID;a=[];for(var h=[],k=0;k<b.records.length;k++){var l=b.records[k];!0!=l.data.group&&(l.data.projectID!=g?h.push(l):
a.push(l))}if(0==a.length)return c=getText("itemov.wbsView.err.notTheSameProject"),Ext.MessageBox.show({title:"",msg:c,width:200,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR}),!1;for(;0<b.records.length;)b.records.pop();f.view.setLoading(!0);g="";for(k=0;k<a.length;k++)b.records.unshift(a[k]),g+=a[k].data.workItemID,k<a.length-1&&(g+=",");b="before"==e;!1==f.WBS_SORT_ASCENDING&&(b=!b);Ext.Ajax.request({url:"itemNavigator!changeWBS.action",disableCaching:!0,success:function(){f.view.setLoading(!1);
f.fireEvent.call(f,"datachange")},failure:function(){f.view.setLoading(!1);alert("failure")},method:"POST",params:{workItems:g,targetWorkItemID:c.data.workItemID,before:b}});return!0},getPopupMenuItems:function(a,b,c,e){var f=this,g=[];a.editable&&(g.push({text:getText("common.btn.indent"),iconCls:"itemAction_indent16",handler:function(){f.indent.call(f,a,b,c,e)}}),g.push({text:getText("common.btn.outdent"),iconCls:"itemAction_outdent16",handler:function(){f.outdent.call(f,a,b,c,e)}}));return g},
indent:function(a,b,c,e){var f=this,g=e.parentNode;a=g.indexOf(e);if(0==a)return alert(getText("itemov.wbsView.err.noIndentPossible")),!1;b.setLoading(!0);var h=g.getChildAt(a-1);Ext.Ajax.request({url:"itemNavigator!indent.action",disableCaching:!0,success:function(){g.removeChild(e);h.data.leaf=!1;h.appendChild(e);h.expand();b.setLoading(!1);f.fireEvent.call(f,"datachange")},failure:function(){b.setLoading(!1);alert("failure")},method:"POST",params:{nodeType:f.itemNavigatorController.nodeType,nodeObjectID:f.itemNavigatorController.nodeObjectID,
descriptorID:f.itemNavigatorController.selectedIssueViewDescriptor.id,queryType:f.itemNavigatorController.model.queryType,queryID:f.itemNavigatorController.model.queryID,workItemID:e.data.workItemID,targetWorkItemID:h.data.workItemID}})},outdent:function(a,b,c,e){var f=this,g=e.parentNode;a=b.store.getRootNode();if(g==a||!0==g.data.group)return CWHF.showMsgError(getText("itemov.wbsView.err.noOutdentPossible")),!1;b.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!outdent.action",disableCaching:!0,
success:function(){var a=g.parentNode,c=a.indexOf(g);a.insertChild(c+1,e);g.hasChildNodes()||(g.data.leaf=!1);b.setLoading(!1);f.fireEvent.call(f,"datachange")},failure:function(){b.setLoading(!1);alert("failure")},method:"POST",params:{nodeType:f.itemNavigatorController.nodeType,nodeObjectID:f.itemNavigatorController.nodeObjectID,descriptorID:f.itemNavigatorController.selectedIssueViewDescriptor.id,queryContextID:f.itemNavigatorController.model.queryContext.id,workItemID:e.data.workItemID}})}});
Ext.define("com.trackplus.itemNavigator.CardViewPlugin",{extend:"com.trackplus.itemNavigator.IssueListViewPlugin",fieldGroup:null,northPanel:null,selectedGroups:null,fieldGroupLabel:null,queryFieldCSS:null,mySelectedIdx:0,selectedCardDataView:null,refreshData:function(a){alert("refresh data")},dataChangeSuccess:function(a){},createSettingsPanel:function(){this.initNorthPanel();this.multipleSelect.setValue(this.selectedGroups);return this.northPanel},getSettingsHeight:function(){return 32},createView:function(){null==
this.view&&(this.view=this.centerPanel=Ext.create("Ext.panel.Panel",{region:"center",layout:{type:"hbox",padding:"2",align:"stretch"},border:!1,defaults:{margins:"0 2 0 0"},bodyBorder:!1,autoScroll:!0}),this.refreshCards());return this.view},initNorthPanel:function(){var a=this,b=[],c=a.model.listViewData.groupBy.options;a.cmbGroupBy=Ext.create("Ext.form.ComboBox",{fieldLabel:getText("itemov.cardView.column"),name:"groupBy",store:Ext.create("Ext.data.Store",{data:null==c?[]:c,fields:[{name:"id",type:"int"},
{name:"label",type:"string"}],autoLoad:!1}),border:!1,bodyBorder:!1,displayField:"label",valueField:"id",queryMode:"local",value:a.model.listViewData.groupBy.id,width:250,labelAlign:"right",margin:"5 5 5 5"});a.cmbGroupBy.addListener("change",a.changeGroupBy,a);b.push(a.cmbGroupBy);b.push(a.createAddGroupPanel());c=a.model.listViewData.sortBy.options;a.cmbSortBy=Ext.create("Ext.form.ComboBox",{name:"sortBy",store:Ext.create("Ext.data.Store",{data:null==c?[]:c,fields:[{name:"id",type:"int"},{name:"label",
type:"string"},{name:"selected",type:"boolean"}],autoLoad:!1}),border:!1,bodyBorder:!1,displayField:"label",valueField:"id",queryMode:"local",value:a.model.listViewData.sortBy.sortField,width:195});a.cmbSortBy.addListener("change",a.changeSortBy,a);c=a.model.listViewData.sortBy.sortOrder;a.radioAsc=Ext.create("Ext.form.field.Radio",{name:"sortOrder",inputValue:!0,boxLabel:getText("itemov.lbl.groupBy.ascending"),checked:!c,margin:"0 0 0 5"});a.radioAsc.addListener("change",a.changeSortBy,a);a.radioDsc=
Ext.create("Ext.form.field.Radio",{name:"sortOrder",inputValue:!0,boxLabel:getText("itemov.lbl.groupBy.descending"),checked:c,margin:"0 0 0 5"});b.push({xtype:"fieldcontainer",margin:"5 5 5 5",fieldLabel:getText("itemov.lbl.sortBy"),labelAlign:"right",labelWidth:100,layout:"hbox",items:[a.cmbSortBy,a.radioAsc,a.radioDsc]});!0==a.model.isFilterView&&a.model.maySaveFilterLayout&&(c=Ext.create("Ext.button.Button",{text:getText("itemov.btn.saveAsFilterLayout"),overflowText:getText("itemov.btn.saveAsFilterLayout"),
tooltip:getText("itemov.btn.saveAsFilterLayout"),iconCls:a.descriptor.iconCls,margin:"5 5 5 10",handler:function(){a.saveAsCardFilterLayout.call(a)}}),b.push(c));a.northPanel=Ext.create("Ext.panel.Panel",{region:"north",layout:{type:"column"},border:!1,bodyBorder:!1,items:b})},saveAsCardFilterLayout:function(){borderLayout.setLoading(!0);Ext.Ajax.request({url:"itemNavigator!saveAsFilterLayout.action",params:{queryType:this.model.queryContext.queryType,queryID:this.model.queryContext.queryID},disableCaching:!0,
success:function(a){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("itemov.msg.saveAsFilterLayoutSuccess"))},failure:function(){borderLayout.setLoading(!1);CWHF.showMsgError("Failure")},method:"POST"})},navigate:function(a,b,c,e){if(null==this.selectedCardDataView)return null;a=this.selectedCardDataView.getStore();if("next"==c){if(this.mySelectedIdx==a.getCount()-1)return null;this.mySelectedIdx++}else{if(0==this.mySelectedIdx)return null;this.mySelectedIdx--}a=a.getAt(this.mySelectedIdx);e?
"next"==c?this.mySelectedIdx--:this.mySelectedIdx++:(c=this.selectedCardDataView.getSelectionModel(),c.deselectAll(),c.select(this.mySelectedIdx));return{workItemID:a.data.workItemID,workItemIndex:this.mySelectedIdx}},changeGroupBy:function(){var a=this,b=a.cmbGroupBy.getValue();a.view.setLoading(!0);Ext.Ajax.request({params:{fieldGroup:b,queryType:a.model.queryContext.queryType,queryID:a.model.queryContext.queryID},url:"cardView!changeGroupBy.action",disableCaching:!0,success:function(b){a.view.setLoading(!1);
a.fireEvent.call(a,"datachange")},failure:function(a,b){}})},changeSortBy:function(){var a=this,b=a.cmbGroupBy.getValue(),c=a.cmbSortBy.getValue(),e=!0!=a.radioAsc.getSubmitValue();a.model.layout.sortField=c;a.model.layout.sortOrder=e;null!=c&&(a.model.layout.sortWithSO=a.cmbSortBy.getStore().findRecord("id",c).data.selected);a.view.setLoading(!0);Ext.Ajax.request({disableCaching:!0,url:"cardView!changeSortBy.action",params:{sortField:c,sortOrder:e,fieldGroup:b,queryType:a.model.queryContext.queryType,
queryID:a.model.queryContext.queryID},success:function(b){a.view.setLoading(!1);a.fireEvent.call(a,"datachange")},failure:function(a,b){}})},findIssuesByGroup:function(a){var b=this.model.issues;if(null!=b&&0<b.length)for(var c=0;c<b.length;c++){var e=b[c],f=e.id.lastIndexOf("_");if(e.id.substring(f+1)==a+"")return this.collectIssues(e.children)}return null},collectIssues:function(a){if(null==a||0==a.length)return null;for(var b=[],c=0;c<a.length;c++){var e=a[c];b.push(e);e=this.collectIssues(e.children);
null!=e&&(b=Ext.Array.merge(b,e))}return b},addAllGroups:function(){var a=this.model.listViewData.groups;this.selectedGroups=[];for(var b=0;b<a.length;b++)this.selectedGroups.push(a[b].id)},refreshCards:function(){this.centerPanel.removeAll(!0);var a=[];this.queryFieldCSS=this.model.queryFieldCSS;var b=this.model.listViewData.groups;this.fieldGroup=this.model.listViewData.groupBy.id;this.selectedGroups=this.model.listViewData.selectedGroups;this.fieldGroupLabel=this.model.listViewData.groupBy.labe;
var c=!1;if(null==this.selectedGroups||0==this.selectedGroups.length)c=!0,this.selectedGroups=[];for(var e=0;e<b.length;e++){var f=b[e],g=0,h=this.findIssuesByGroup(f.id);null!=h&&(g=h.length);a.push({id:f.id,label:f.label,number:g,issues:h,width:f.width});c&&this.selectedGroups.push(f.id)}this.allGroups=a;a=[];if(null!=this.selectedGroups)for(e=0;e<this.selectedGroups.length;e++)f=this.findGroup(this.selectedGroups[e]),null!=f&&a.push(this.createGroupView(f));this.centerPanel.add(a);this.centerPanel.doLayout()},
createSortFunction:function(){if(null!=this.model.layout.sortField){var a,b=1,b=!0==this.model.layout.sortOrder?-1:1;a=!0==this.model.layout.sortWithSO?"f_so"+this.model.layout.sortField:"f"+this.model.layout.sortField;return function(c,e){var f=c[a],g=e[a];return(f>g?1:f<g?-1:0)*b}}return null},findLabelField:function(a){var b=this.model.layout.shortFields;if(null==b)return null;for(var c=0;c<b.length;c++)if(b[c].reportField==a)return b[c].label;return null},renderIconHtml:function(a,b){var c;switch(a){case 5:case 6:case 13:c=
'\x3cimg src\x3d"personAvatar.action?personID\x3d'+b+'" height\x3d"50" width\x3d"50"/\x3e';break;default:c='\x3cimg src\x3d"'+("optionIconStream.action?fieldID\x3d-"+a+"\x26optionID\x3d"+b)+'" height\x3d"16"/\x3e'}return c},createGroupView:function(a){var b=this,c=[],e=a.issues,f=b.createFields(),g=b.createSortFunction();null!=g&&null!=e&&(e=Ext.Array.sort(e,g));e=Ext.create("Ext.data.Store",{fields:f,data:null==e?[]:e});null==b.cardTpl&&b.initCardTpl();var h=Ext.create("Ext.view.View",{store:e,tpl:b.cardTpl,
multiSelect:!0,trackOver:!0,overItemCls:"x-item-over",itemSelector:"div.cardElementBase",emptyText:"nothing to display",prepareData:function(c){var e=c.f12,f=c.workItemID,g=c.f6,h=c.f17,k=c.f21,r=c.editable,v="cardElementBase cardElement",u="cardElementIndicator";null!=b.queryFieldCSS&&null!=c.queryFieldCSS&&(u+=" queryFieldCSS rowCls_"+b.queryFieldCSS+"_"+c.queryFieldCSS);!1==r&&(v="cardElementBase cardElement-readOnly");for(var r=b.model.listViewData.panel.fields,s,B,A=[],z=0;z<r.length;z++){A[z]=
[];for(var w=0;w<r[z].length;w++)if(s=r[z][w],null!=s&&(A[z][w]={},A[z][w].empty=s.empty),null!=s&&!1==s.empty){switch(null!=s.iconRendering?s.iconRendering:0){case 0:B=c["f"+s.fieldID];break;case 1:B=b.renderIconHtml(s.fieldID,c["f-"+s.fieldID]);break;case 2:B=b.renderIconHtml(s.fieldID,c["f-"+s.fieldID])+"\x26nbsp;"+c["f"+s.fieldID]}!1==s.hideLabel&&(B=b.findLabelField(s.fieldID)+": "+B);A[z][w].displayValue=B;A[z][w].rowSpan=s.rowSpan;A[z][w].colSpan=s.colSpan;A[z][w].valueHAlign=s.valueHAlign;
A[z][w].valueVAlign=s.valueVAlign}}Ext.apply(c,{description:k,cardCls:v,clsIndicator:u,fields:A,colsNo:b.model.listViewData.panel.colsNo,rowsNo:b.model.listViewData.panel.rowsNo,parentGroup:a.id,workItemID:f,itemID:e,responsible:g,synopsis:h});return c}});h.addListener("itemcontextmenu",b.onGridItemContextMenu,b);h.addListener("itemdblclick",b.onGridItemDblClick,b);h.addListener("itemclick",b.onItemClick,b);h.getSelectionModel().addListener("selectionchange",b.onGridSelectionChange,b);c.push(h);var k=
Ext.create("com.trackplus.itemNavigator.GroupView",{group:a,width:a.width,items:c});k.addListener("closeGroup",b.removeGroup,b);k.addListener("afterrender",function(c){Ext.create("Ext.resizer.Resizer",{target:k,handles:"e",minWidth:200,maxWidth:800,listeners:{resize:function(c,e,f,g,h){b.groupResizeHandler(k,b.model.listViewData.fieldGroup,a.id,e)}}});new Ext.view.DragZone({view:h,ddGroup:"itemToCategory",dragText:"{0} selected row{1}",onStartDrag:function(c,e){b.validDropTargetIds=null;b.partialDropTargetIds=
null;var f=b.getSelectedItemIds(this.dragData.records),g=b.cmbGroupBy.getValue(),h=[];h.push(g);b.fireEvent("startDragItems",f,h,a);return!0},afterDragDrop:function(){b.removeAllValidMarkers();b.fireEvent("afterDropItems")},afterInvalidDrop:function(){b.removeAllValidMarkers();b.fireEvent("afterDropItems")}});new Ext.dd.DragSource(k.getHeader().getEl(),{dragData:{group:a},ddGroup:"itemToCategory",onStartDrag:function(){var b="\x3cdiv\x3e"+a.label+"\x3c/div\x3e";b.id=Ext.id();this.proxy.update(b);
k.addCls("cardGropDragSource")},afterDragDrop:function(a,b,c){k.removeCls("cardGropDragSource")},afterInvalidDrop:function(){k.removeCls("cardGropDragSource")}});new Ext.dd.DropTarget(c.getEl(),{ddGroup:"itemToCategory",notifyOver:function(c,e,f){return null!=f.group?f.group.id!=a.id?this.dropAllowed:!1:b.checkValidDropTarget(b,f,a)?this.dropAllowed:!1},notifyEnter:function(c,e,f){if(null!=f.group){if(f.group.id==a.id)return!1}else if(!b.checkValidDropTarget(b,f,a))return!1;null!=f.group?(c=b.getGroupViewIndex(f.group),
e=b.getGroupViewIndex(a),c>e?k.addCls("cardGroupPanel-dragOver-left"):k.addCls("cardGroupPanel-dragOver-right")):k.addCls("cardGroupPanel-dragOver");return this.dropAllowed},notifyOut:function(a,b,c){k.removeCls("cardGroupPanel-dragOver");k.removeCls("cardGroupPanel-dragOver-left");k.removeCls("cardGroupPanel-dragOver-right")},notifyDrop:function(c,e,f){k.removeCls("cardGroupPanel-dragOver");k.removeCls("cardGroupPanel-dragOver-left");k.removeCls("cardGroupPanel-dragOver-right");if(null!=f.group){if(a.id==
f.group.id)return!1;b.changeGroupOrder(f.group,a,!1)}else{if(!b.checkValidDropTarget(b,f,a))return!1;Ext.defer(b.changeWorkItems,100,b,[a,f.records])}return!0}})});return k},checkValidDropTarget:function(a,b,c){b=b.records;if(null!=b&&0<b.length){if(b[0].data.parentGroup==c.id)return!1;b=null==a.validDropTargetIds||-1!=Ext.Array.indexOf(a.validDropTargetIds,c.id);a=null!=a.partialDropTargetIds&&-1!=Ext.Array.indexOf(a.partialDropTargetIds,c.id);if(!b&&!a)return!1}return!0},updatePossibleFieldOptions:function(a,
b){var c=this.cmbGroupBy.getValue(),e=a["field"+c],c=a["partialField"+c];this.validDropTargetIds=e;this.partialDropTargetIds=c;for(var f=0;f<this.centerPanel.items.getCount();f++){var g=this.centerPanel.items.getAt(f),h=g.getGroup().id;h!=b.id&&(null!=e&&-1==Ext.Array.indexOf(e,h)||g.addCls("cardGroupPanel-dropTargetOk"),null!=c&&-1!=Ext.Array.indexOf(c,h)&&g.addCls("cardGroupPanel-dropTargetPartial"))}},removeAllValidMarkers:function(){this.partialDropTargetIds=this.validDropTargetIds=null;for(var a=
0;a<this.centerPanel.items.getCount();a++){var b=this.centerPanel.items.getAt(a);b.removeCls("cardGroupPanel-dropTargetOk");b.removeCls("cardGroupPanel-dropTargetPartial")}},myTip:null,isDblClick:!1,onItemClick:function(a,b,c,e,f,g){var h=this;h.isDblClick=!1;null==h.myTip&&(h.myTip=Ext.create("Ext.tip.ToolTip",{autoHide:!0,dismissDelay:0,anchor:"top"}));a=b.data.f21;null!=a&&""!=a&&(h.myTip.update('\x3cdiv class\x3d"ulist"\x3e'+a+"\x3c/div\x3e"),Ext.defer(function(){if(h.isDblClick)return!0;h.myTip.showAt(f.getXY())},
300))},onGridItemContextMenu:function(a,b,c,e,f,g){f.stopEvent();this.fireEvent("itemcontextmenu",b.data,f,this.view,e,b);return!1},onGridItemDblClick:function(a,b,c,e,f,g){this.isDblClick=!0;f.stopEvent();this.mySelectedIdx=e;this.selectedCardDataView=a;this.fireEvent.call(this,"itemdblclick",b.data,c);return!1},onGridSelectionChange:function(a,b){for(var c=[],e=0;e<this.centerPanel.items.getCount();e++){var f=this.centerPanel.items.getAt(e).items.get(0).getSelectionModel().getSelection();null!=
f&&0<f.length&&(c=Ext.Array.merge(c,f))}this.fireEvent.call(this,"selectionchange",c);return!1},createAddGroupPanel:function(){this.fieldGroupLabel=this.model.listViewData.groupBy.label;for(var a=this.model.listViewData.groups,b=[],c=0;c<a.length;c++){var e=a[c];b.push({id:e.id,label:e.label})}a=this.model.listViewData.groupBy.id;this.multipleSelect=Ext.create("com.trackplus.util.MultipleSelectPicker",{data:b,width:300,margin:"5 5 5 5",name:"selectedGroups",localizedLabel:this.fieldGroupLabel,maxSelectionCount:this.model.listViewData.maxSelectionCount,
iconUrlPrefix:5==a||6==a?null:"optionIconStream.action?fieldID\x3d-"+a+"\x26optionID\x3d"});this.multipleSelect.addListener("change",this.multipleSelectChange,this);return this.multipleSelect},multipleSelectChange:function(a,b,c){if(null==b||0==b.length)return this.centerPanel.removeAll(!0),this.selectedGroups=null,!0;this.selectedGroups=[];a=[];var e=[];for(c=0;c<this.centerPanel.items.getCount();c++){var f=this.centerPanel.items.getAt(c),g=f.getGroup().id;-1!=Ext.Array.indexOf(b,g)?(a.push(g),this.selectedGroups.push(g)):
e.push(f)}for(c=0;c<e.length;c++)this.centerPanel.remove(e[c]);e=[];for(c=0;c<b.length;c++)g=b[c],-1==Ext.Array.indexOf(a,g)&&(this.selectedGroups.push(g),e.push(this.findGroup(g)));for(c=0;c<e.length;c++)this.centerPanel.add(this.createGroupView(e[c]));this.centerPanel.doLayout();this.changeSelectedGroups();return!0},changeSelectedGroups:function(){var a="";null!=this.selectedGroups&&(a=this.selectedGroups.join());var b=this.cmbGroupBy.getValue();Ext.Ajax.request({disableCaching:!0,url:"cardView!cardFieldOptionsChange.action",
params:{cardViewGroupFilter:a,fieldGroup:b,queryType:this.model.queryContext.queryType,queryID:this.model.queryContext.queryID},success:function(a){},failure:function(a,b){}})},findGroup:function(a){for(var b=this.allGroups,c=0;c<b.length;c++)if(b[c].id==a)return b[c]},getGroupViewIndex:function(a){for(var b=0;b<this.centerPanel.items.getCount();b++){var c=this.centerPanel.items.getAt(b).getGroup().id;if(a.id==c)return b}return-1},removeGroup:function(a){var b=a.getGroup();this.centerPanel.remove(a,
!0);null==this.selectedGroups&&this.addAllGroups();this.selectedGroups=Ext.Array.remove(this.selectedGroups,b.id);this.multipleSelect.setValue(this.selectedGroups,!0)},getSelectedItemIds:function(a){for(var b="",c=-1,e=0;e<a.length;e++){var f=a[e].data.workItemID;try{c=parseInt(f)}catch(g){c=-1}isNaN(c)||-1==c||(b+=c+",")}return b},changeWorkItems:function(a,b){var c=this.getSelectedItemIds(b);this.view.setLoading(!0);this.ajaxRequest({workItems:c,fieldID:this.fieldGroup,value:a.id})},changeGroupOrder:function(a,
b,c){c=null;for(var e,f,g=0;g<this.centerPanel.items.getCount();g++){var h=this.centerPanel.items.getAt(g),k=h.getGroup().id;k==a.id&&(c=h,e=g);k==b.id&&(f=g)}this.centerPanel.remove(e,!1);this.centerPanel.insert(f,c);this.selectedGroups=[];for(g=0;g<this.centerPanel.items.getCount();g++)h=this.centerPanel.items.getAt(g),k=h.getGroup().id,this.selectedGroups.push(k);this.multipleSelect.setValue(this.selectedGroups,!0);this.changeSelectedGroups()},ajaxRequest:function(a){var b=this;Ext.Ajax.request({url:"itemNavigator!changeOneField.action",
success:function(c){b.view.setLoading(!1);c=Ext.decode(c.responseText);!0==c.success?b.fireEvent.call(b,"datachange"):b.handleError(c,a)},params:a})},onCardItemDblClick:function(a,b,c){this.fireEvent.call(this,"itemdblclick",c.item,b)},onCardItemContextMenu:function(a,b,c){a.stopEvent();this.fireEvent("itemcontextmenu",c.item,a,this.view);return!1},initCardTpl:function(){var a=[];a.push('\x3ctpl for\x3d"."\x3e');a.push('\x3cdiv class\x3d"{cardCls}"\x3e');a.push('\x3ctable style\x3d"width:100%;height:100%" border\x3d"0" cellspacing\x3d"0" cellpadding\x3d"0"\x3e');
a.push('\x3ctr\x3e\x3ctd rowspan\x3d"{rowsNo+1}" width\x3d"7" class\x3d"{clsIndicator}"\x3e\x26nbsp;\x3c/td\x3e\x3ctd colspan\x3d"{colsNo}"\x3e\x3c/td\x3e\x3c/tr\x3e');a.push('\x3ctpl for\x3d"fields"\x3e');a.push("\x3cTR\x3e");a.push('\x3ctpl for\x3d"."\x3e');a.push('\x3ctpl if\x3d"."\x3e');a.push('\x3ctpl if\x3d"!empty"\x3e');a.push('\x3ctd class\x3d"cardField valueVerticalAlign-{valueVAlign} valueAlign-{valueHAlign}" colspan\x3d"{colSpan}" rowspan\x3d"{rowSpan}" \x3e');a.push("{displayValue}");
a.push("\x3c/td\x3e");a.push("\x3c/tpl\x3e");a.push('\x3ctpl if\x3d"empty"\x3e');a.push("\x3ctd\x3e\x26nbsp;\x3c/td\x3e");a.push("\x3c/tpl\x3e");a.push("\x3c/tpl\x3e");a.push("\x3c/tpl\x3e");a.push("\x3c/tr\x3e");a.push("\x3c/tpl\x3e");a.push("\x3c/table\x3e");a.push("\x3c/div\x3e");a.push("\x3c/tpl\x3e");this.cardTpl=new Ext.XTemplate(a);this.cardTpl.compile()},destroyView:function(){},getSelectedIssues:function(){for(var a=[],b=0;b<this.centerPanel.items.getCount();b++){var c=this.centerPanel.items.getAt(b).items.get(0).getSelectionModel().getSelection();
null!=c&&0<c.length&&(a=Ext.Array.merge(a,c))}c=[];for(b=0;b<a.length;b++)c.push(a[b].data.workItemID);return c},selectItemByIndex:function(a){},selectItem:function(a,b){},deselectItem:function(a,b){},TYPE_COMMON:0,TYPE_MASS_OPERATION:1,handleError:function(a,b){var c=this;switch(a.type){case c.TYPE_COMMON:var e=getText("common.err.failure");null!=a.title&&(e=a.title);Ext.MessageBox.show({title:e,msg:a.errorMessage,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});break;case c.TYPE_MASS_OPERATION:var f=
a.massOperation,e=f.errorCode;null!=e&&4==e?(e="Error",null!=f.title&&(e=f.title),Ext.MessageBox.confirm(e,f.errorMessage,function(a){if("no"==a)return!1;c.confirmationSubmitHandler.call(c,b)})):(e="Error",null!=f.title&&(e=f.title),Ext.MessageBox.show({title:e,msg:f.errorMessage,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING}))}},confirmationSubmitHandler:function(a){null==a&&(a={});a["params.confirmSave"]="true";this.ajaxRequest.call(this,a)},groupResizeHandler:function(a,b,c,e){b=this.cmbGroupBy.getValue();
Ext.Ajax.request({disableCaching:!0,url:"cardView!changeOptionWidth.action",params:{optionID:c,width:e,fieldGroup:b,queryType:this.model.queryContext.queryType,queryID:this.model.queryContext.queryID},success:function(a){},failure:function(a,b){}})},getPopupMenuItems:function(a,b,c,e){var f=this;a=[];a.push("-");a.push({text:getText("itemov.cardView.configCardContent"),iconCls:"btnConfig16",handler:function(){f.configCardContent.call(f)}});return a},configCardContent:function(){window.location.href=
"cardScreenEdit.action?backAction\x3ditemNavigator.action"}});
Ext.define("com.trackplus.itemNavigator.GroupView",{extend:"Ext.panel.Panel",config:{group:{}},cls:"cardGroupPanel",frame:!0,autoScroll:!0,width:250,margin:"0 2 0 0",constructor:function(a){this.callParent(arguments);this.addEvents("closeGroup")},initComponent:function(){var a=this;a.title=a.group.label+" ("+a.group.number+")";var b=[];b.push({type:"close",tooltip:"Close",handler:function(b,e,f){a.fireEvent.call(a,"closeGroup",a)}});Ext.apply(this,{tools:b});a.callParent()}});
Ext.define("com.trackplus.itemNavigator.ChooseColumns",{extend:"Ext.Base",config:{itemNavigatorController:null,filterType:null,filterID:null,includeLongFields:!1},controller:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.controller=Ext.create("com.trackplus.itemNavigator.ChooseColumnsController",{itemNavigatorController:this.itemNavigatorController,filterType:this.filterType,filterID:this.filterID,includeLongFields:this.includeLongFields})},setIncludeLongFields:function(a){this.includeLongFields=
a;this.controller.includeLongFields=a},showDialog:function(){this.controller.showDialog.call(this.controller)},destroyMe:function(){null!=this.controller&&(this.controller.destroyMe.call(this.controller),this.controller=null)}});
Ext.define("com.trackplus.itemNavigator.ChooseColumnsController",{extend:"Ext.Base",config:{itemNavigatorController:null,filterType:null,filterID:null,includeLongFields:!1},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},destroyMe:function(){null!=this.win&&this.win.destroy()},showDialog:function(){var a={loadUrl:"layoutColumns.action",loadUrlParams:{filterType:this.filterType,filterID:this.filterID,includeLongFields:this.includeLongFields}},b={submitUrl:"layoutColumns!save.action",
submitUrlParams:{filterType:this.filterType,filterID:this.filterID},refreshAfterSubmitHandler:this.reload,loading:!0},a={title:getText("itemov.lbl.chooseColumns"),width:300,height:400,load:a,submit:b,items:[],postDataProcess:this.createColumnItems,panelConfig:{bodyStyle:{padding:"0 0 0 10"}}};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},reload:function(){this.itemNavigatorController.changeLayout.call(this.itemNavigatorController)},createColumnItems:function(a,b){for(var c=
[],e=0;e<a.length;e++)c.push(this.createColumnItem(a[e]));b.add(c)},createColumnItem:function(a){name=0>a.fieldID?"selectedColumnsMap.f_"+-1*a.fieldID:"selectedColumnsMap.f"+a.fieldID;return CWHF.createCheckbox(null,name,{value:a.used,boxLabel:a.label,margin:5})}});
Ext.define("com.trackplus.itemNavigator.Grouping",{extend:"Ext.Base",config:{filterType:null,filterID:null,itemNavigatorController:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},showDialog:function(){var a={loadUrl:"layoutGrouping.action",loadUrlParams:{filterType:this.filterType,filterID:this.filterID}},b={submitUrl:"layoutGrouping!save.action",submitUrlParams:{filterType:this.filterType,filterID:this.filterID},refreshAfterSubmitHandler:this.reload,loading:!0},a={title:getText("itemov.lbl.groupBy"),
width:350,height:460,load:a,submit:b,items:[],postDataProcess:this.createGroupingItems,panelConfig:{bodyStyle:{padding:"0 0 0 10"}}};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},reload:function(){this.itemNavigatorController.changeLayout.call(this.itemNavigatorController)},createGroupingItems:function(a,b){for(var c=a.selectedGroupFields,e=a.groupFieldList,f=a.ascendingDescendingList,g=a.expandCollapseList,h=c.length,k=[],l=!1,m=!0,n=0;n<c.length;n++)l=null!=c[n].fieldID,
k.push(this.createGroupingItem(n,h,b,c[n],e,f,g,l,m)),m=l;b.add(k)},createGroupingItem:function(a,b,c,e,f,g,h,k,l){var m="groupFields["+a+"].";b=CWHF.createCheckbox(null,"activated"+a,{value:k,disabled:!l,boxLabel:getText("itemov.lbl.groupBy.active")},{change:{fn:this.activate,scope:this,index:a,count:b,mainPanel:c}});f=CWHF.createCombo(null,m+"fieldID",{value:e.fieldID,data:f,disabled:!k,anchor:"100%"});g=CWHF.getRadioButtonItems(g,m+"descending","id","label",e.descending,!1,!0);g=CWHF.getRadioGroup(m+
"descending",null,null,g,{anchor:"100%",disabled:!k});e=CWHF.getRadioButtonItems(h,m+"collapsed","id","label",e.collapsed,!1,!0);k=CWHF.getRadioGroup(m+"collapsed",null,null,e,{anchor:"100%",disabled:!k});return Ext.create("Ext.panel.Panel",{margin:"5 0 5 0",border:!0,itemId:"panel"+a,bodyBorder:!1,bodyStyle:{padding:"5px 5px 2px 10px"},anchor:"100%",layout:"column",items:[{xtype:"fieldcontainer",border:!1,fieldLabel:"\x3cB\x3e"+(a+1)+"\x3c/B\x3e",labelSeparator:".",labelWidth:15,width:90,items:[b]},
{columnWidth:1,border:!1,bodyBorder:!1,layout:"anchor",items:[f,g,k]}]})},activate:function(a,b,c,e){b=e.index;a=e.count;e=e.mainPanel;var f=e.getComponent("panel"+b),g="groupFields["+b+"].",h=f.getComponent(0).getComponent("activated"+b).getRawValue();c=f.getComponent(1).getComponent(g+"fieldID");c.setDisabled(!h);c=f.getComponent(1).getComponent(g+"descending");c.setDisabled(!h);c=f.getComponent(1).getComponent(g+"collapsed");c.setDisabled(!h);if(b<a-1)if(h)a=b+1,b=e.getComponent("panel"+a),b.getComponent(0).getComponent("activated"+
a).setDisabled(!1);else for(h=b+1;h<a;h++)b=e.getComponent("panel"+h),f="groupFields["+h+"].",c=b.getComponent(1).getComponent(f+"fieldID"),c.setDisabled(!0),c=b.getComponent(1).getComponent(f+"descending"),c.setDisabled(!0),c=b.getComponent(1).getComponent(f+"collapsed"),c.setDisabled(!0),b=b.getComponent(0).getComponent("activated"+h),b.setDisabled(!0),b.setRawValue(!1)}});
Ext.define("com.trackplus.itemNavigator.instantFilter",{extend:"Ext.util.Observable",config:{filterName:null,filterType:null,filterID:null,queryContextID:null,viewID:null,fromSession:!1},filterPanel:null,instant:!0,indexMax:0,constructor:function(a){var b=a||{};this.initialConfig=b;this.events=[];this.addEvents("applyFilter");this.addEvents("cleanFilter");this.listeners=b.listeners;this.callParent(arguments)},createPanel:function(){return this.filterPanel=Ext.create("Ext.form.Panel",{border:!1,bodyBorder:!1,
autoScroll:!0,region:"center",dockedItems:this.getFilterToolbar(),style:{borderBottom:"1px solid #d0d0d0"}})},loadFilter:function(){var a=this,b={};null==this.filterID||null==this.filterType?b.add=!0:(b.filterID=this.filterID,b.filterType=this.filterType,b.queryContextID=this.queryContextID);b.fromSession=this.fromSession;a.filterPanel.setLoading(!0);a.filterPanel.getForm().load({url:"filterConfig!edit.action",params:b,scope:a,success:function(b,e){a.filterPanel.setLoading(!1);var f=e.result.data;
f.selectColumnCount=4;var g=f.modifiable;f.modifiable=!0;var h=a.filterPanel.getDockedItems('toolbar[dock\x3d"top"]');null!=h&&h[0].getComponent(2).setDisabled(!g);a.issueFilter=!0;com.trackplus.admin.Filter.postLoadProcessTreeFilter.call(a,f,a.filterPanel)},failure:function(b,e){a.filterPanel.setLoading(!1)}})},getFilterToolbar:function(){return[{xtype:"toolbar",dock:"top",margin:"4 0 0 0",items:[this.getApplyFilterAction(),this.getCleanFilterAction(),this.getSaveFilterAction(),this.getSaveFilterAsAction()]}]},
getApplyFilterAction:function(){var a={text:getText("common.btn.apply"),overflowText:getText("common.btn.applyFilter"),tooltip:getText("itemov.btn.applyFilter.tt"),iconCls:"filterExec",scope:this,handler:this.onApply};return Ext.create("Ext.Action",a)},getCleanFilterAction:function(){var a={text:getText("common.btn.reset"),overflowText:getText("common.btn.reset"),tooltip:getText("itemov.btn.clearFilter.tt"),iconCls:"clear16",scope:this,handler:this.onClean};return Ext.create("Ext.Action",a)},getSaveFilterAction:function(){var a=
{text:getText("common.btn.save"),overflowText:getText("common.btn.save"),tooltip:getText("itemov.btn.saveFilter.tt"),iconCls:"save",disabled:!0,scope:this,handler:this.onSave};return Ext.create("Ext.Action",a)},getSaveFilterAsAction:function(){var a={text:getText("common.btn.saveAs"),overflowText:getText("common.btn.saveAs"),tooltip:getText("itemov.btn.saveAsFilter.tt"),iconCls:"save",scope:this,handler:this.onSaveAs};return Ext.create("Ext.Action",a)},onApply:function(){var a=this;submitUrlParams=
{instant:!0,ajax:!0,filterID:a.filterID,filterType:a.filterType};com.trackplus.admin.Filter.preSubmitProcessIssueFilter(submitUrlParams,a.filterPanel);a.filterPanel.setLoading(!0);a.filterPanel.getForm().submit({url:"savedFilterExecute!applyInstant.action",params:submitUrlParams,method:"POST",scope:a,success:function(b,c){a.filterPanel.setLoading(!1);var e=c.result;null!=e&&(e.success?a.fireEvent.call(a,"applyFilter",{filterType:a.filterType,filterID:a.filterID,queryContextID:a.queryContextID}):com.trackplus.util.showError(e))},
failure:function(b,c){a.filterPanel.setLoading(!1);result=c.result;null!=result&&(null!=result.errorMessage?com.trackplus.util.showError(result):com.trackplus.util.submitFailureHandler(b,c))}})},onClean:function(){var a=this,b={clearFilter:!0};null==this.filterID||null==this.filterType?b.instant=!0:(b.filterID=this.filterID,b.filterType=this.filterType,b.queryContextID=this.queryContextID);a.filterPanel.setLoading(!0);a.filterPanel.getForm().load({url:"filterConfig!edit.action",params:b,scope:a,success:function(b,
e){a.filterPanel.setLoading(!1);var f=e.result.data;f.selectColumnCount=7;f.modifiable=!0;com.trackplus.admin.Filter.clearTreeFilter.call(a,a.filterPanel,f);a.fireEvent.call(a,"clearFilter",{filterType:a.filterType,filterID:a.filterID,queryContextID:a.queryContextID})},failure:function(b,e){a.filterPanel.setLoading(!1)}})},onSave:function(){var a=this,b={};null==this.filterID||null==this.filterType?b.add=!0:(b.filterID=this.filterID,b.filterType=this.filterType,b.queryContextID=this.queryContextID);
com.trackplus.admin.Filter.preSubmitProcessIssueFilter(b,a.filterPanel);a.filterPanel.setLoading(!0);a.filterPanel.getForm().submit({url:"filterConfig!save.action",params:b,method:"POST",scope:a,success:function(b,e){a.filterPanel.setLoading(!1);var f=e.result;null!=f&&(f.success?CWHF.showMsgInfo(getText("admin.customize.queryFilter.successSave")):CWHF.showMsgError(getText("admin.customize.queryFilter.errorSave")))},failure:function(b,e){a.filterPanel.setLoading(!1);result=e.result;null!=result&&
(null!=result.errorMessage?com.trackplus.util.showError(result):com.trackplus.util.submitFailureHandler(b,e))}})},onSaveAs:function(){Ext.create("com.trackplus.util.NameAndPathPicker",{title:getText("common.btn.saveAs"),loadUrl:"categoryPathPicker.action",loadParams:{categoryType:"issueFilter",add:!0},handler:this.saveWithNameAndPath,scope:this}).showDialog()},saveWithNameAndPath:function(a,b,c,e){var f=this;b={node:c,label:b,includeInMenu:e,add:!0,viewID:f.viewID};f.filterPanel.getForm().submit({url:"filterConfig!save.action",
params:b,method:"POST",scope:this,success:function(b,c){f.filterPanel.setLoading(!1);var e=c.result;null!=e&&(e.success?(CWHF.showMsgInfo(getText("admin.customize.queryFilter.successSave")),a.close()):CWHF.showMsgError(getText("admin.customize.queryFilter.errorSave")))},failure:function(a,b){f.filterPanel.setLoading(!1);result=b.result;null!=result&&(null!=result.errorMessage?com.trackplus.util.showError(result):com.trackplus.util.submitFailureHandler(a,b))}})}});
Ext.define("com.trackplus.itemNavigator.MassOperationController",{extend:"Ext.Base",config:{model:null,itemNavigatorController:null},copy:!1,selectedIssueIDs:[],constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.copy=this.model.copy;this.selectedIssueIDs=this.model.selectedIssueIDs},getTitle:function(){return this.copy?getText("common.btn.bulkCopy"):getText("common.btn.bulkEdit")},getSaveLabel:function(){return this.copy?getText("common.btn.copy"):getText("common.btn.save")},
showDialog:function(){var a={loadUrl:"massOperationEdit.action",loadUrlParams:{selectedIssueIDs:this.selectedIssueIDs,bulkCopy:this.copy}},b={submitUrl:"massOperationEdit!save.action",submitUrlParams:{selectedIssueIDs:this.selectedIssueIDs,bulkCopy:this.copy},submitButtonText:this.getSaveLabel(),refreshAfterSubmitHandler:this.reload,loading:!0},c=this.postDataProcess,a={title:this.getTitle(),width:900,height:600,load:a,submit:b,items:[],postDataProcess:c,preSubmitProcess:this.preSubmitProcess,panelConfig:{bodyStyle:{padding:"0 0 0 10"}}};
Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},preSubmitProcess:function(a,b){var c=b.items,e=1;for(this.copy&&(e=2);e<c.getCount();e++){var f=c.getAt(e),g=f.items.getCount(),f=f.items.getAt(g-1);null==f||null==f.beforeSubmit||f.isDisabled()||f.beforeSubmit.call(this)}return a},postDataProcess:function(a,b){this.populateFieldExpressions(this,b,a)},reload:function(){this.itemNavigatorController.refresh.call(this.itemNavigatorController)},populateFieldExpressions:function(a,
b,c){if(null!=b){var e=[{xtype:"component",cls:"infoBox_bottomBorder",border:!0,html:getText("itemov.massOperation.lbl.numberOfSelectedIssues")+"\x26nbsp;"+c.numberOfSelectedIssues}];this.copy&&e.push({xtype:"panel",border:!1,bodyBorde:!1,anchor:"100%",margin:"5 5 5 5",layout:"hbox",items:[CWHF.createCheckbox("itemov.massOperation.lbl.copyHistory","deepCopy",{labelWidth:175,width:200}),CWHF.createCheckbox("itemov.massOperation.lbl.copyAttachments","copyAttachments",{disabled:!1,labelWidth:175,width:200}),
CWHF.createCheckbox("itemov.massOperation.lbl.copyChildren","copyChildren",{disabled:!1,labelWidth:175,width:200}),CWHF.createCheckbox("itemov.massOperation.lbl.copyWatchers","copyWatchers",{labelWidth:175,width:200},{change:{fn:this.changeCopyWatchers,scope:this}})]});c=c.expressions;if(null!=c){for(var f=0;f<c.length;f++){var g=c[f],h="massOperationPanel";1==f%2&&(h="massOperationOddPanel");g=this.createMassOperationExpression(a,g,b,h);e.push(g)}b.add(e)}}},changeCopyWatchers:function(a,b,c,e){a=
this.formEdit.getComponent("expressionPanel-1");null!=a&&(c=a.getComponent("selectedFieldMap.pseudoField1"),null!=c&&(c.setDisabled(b),!0==b?this.changeFieldSelection(c,!1,!0,{panel:a,field:"-1"}):this.changeFieldSelection(c,c.getValue(),!1,{panel:a,field:"-1"})));a=this.formEdit.getComponent("expressionPanel-2");null!=a&&(c=a.getComponent("selectedFieldMap.pseudoField2"),null!=c&&(c.setDisabled(b),!0==b?this.changeFieldSelection(c,!1,!0,{panel:a,field:"-2"}):this.changeFieldSelection(c,c.getValue(),
!1,{panel:a,field:"-2"})))},createMassOperationHeader:function(){return Ext.create("Ext.panel.Panel",{border:!1,defaults:{margin:"4 4 0 0"},layout:{type:"hbox"},items:[{xtype:"label",html:getText("itemov.massOperation.lbl.active"),width:80},{xtype:"displayfield",fieldLabel:getText("itemov.massOperation.lbl.fieldName"),width:300,labelWidth:90,labelAlign:"right",value:getText("itemov.massOperation.lbl.action")},{xtype:"label",html:getText("itemov.massOperation.lbl.fieldValue"),width:200}]})},createMassOperationExpression:function(a,
b,c,e){e=Ext.create("Ext.panel.Panel",{itemId:"expressionPanel"+b.field,border:!1,bodyBorder:!1,cls:e,layout:{type:"hbox",pack:"start",align:"top"}});c=CWHF.createCheckbox(null,b.fieldName,{margin:"0 0 0 5",width:24,border:!0,cls:"massOperationCheck"},{change:{fn:this.changeFieldSelection,scope:this,panel:e,field:b.field,massOperationMainPanel:c}});e.add(c);c=!0;var f=b.jsonConfig;null!=f&&null!=f.disabled&&(c=f.disabled);c=CWHF.createCombo(b.fieldLabel,b.relationName,{disabled:c,width:350,data:b.setterRelations,
value:b.selectedRelation,labelWidth:150,margin:"2 5 2 5",labelIsLocalized:!0},{select:{fn:this.changeSetter,scope:a,panel:e,bulkExpression:b}});e.add(c);this.addValuePart(a,b.valueRenderer,b.jsonConfig,b,e,c);return e},getComponentItemID:function(a,b){return 0<b?a+".field"+b:a+".pseudoField"+Math.abs(b)},changeFieldSelection:function(a,b,c,e){c=e.panel;a=e.field;var f=c.getComponent(this.getComponentItemID("setterRelationMap",a));null!=f&&f.setDisabled(!b);f=c.getComponent(this.getComponentItemID("displayValueMap",
a));null!=f&&f.setDisabled(!b);if(1==a||2==a){var g={};1==a?(g.projectRefresh=!0,b&&(g.projectID=f.getSubmitValue()),this.refreshContext(c,g,a)):2==a&&(g.issueTypeRefresh=!0,b&&(g.issueTypeID=f.getValue()),this.refreshContext(c,g,a))}if(19==a||20==a||29==a||30==a)if(g=e.massOperationMainPanel,null!=g&&(e=!1,null!=g.getComponent("expressionPanel"+a)&&(f=c.getComponent(this.getComponentItemID("displayValueMap",a)),null!=f&&(e=f.getAdjustCheckBoxValue())))){c=null;19==a?c=20:20==a?c=19:29==a?c=30:30==
a&&(c=29);var h=g.getComponent("expressionPanel"+c);null!=h&&(a=h.getComponent(this.getComponentItemID("selectedFieldMap",c)),null!=a&&(g=!1,g=b?e:!1,a.setDisabled(g),f=h.getComponent(this.getComponentItemID("setterRelationMap",c)),null!=f&&f.setDisabled(g||!a.getValue()),f=h.getComponent(this.getComponentItemID("displayValueMap",c)),null!=f&&f.setDisabled(g||!a.getValue())))}},refreshContext:function(a,b,c){var e=a.ownerCt;1==c?b.issueTypeID=this.getContextField(e,2):2==c&&(b.projectID=this.getContextField(e,
1));b.selectedIssueIDs=this.selectedIssueIDs;e.setLoading(!0);Ext.Ajax.request({url:"massOperationEdit.action",params:b,scope:this,disableCaching:!0,success:function(a){massOperationExpressions=Ext.decode(a.responseText).data.expressions;if(null!=e&&null!=massOperationExpressions){a=e.getComponent("expressionPanel1");var b=!1;null!=a&&(a=a.getComponent("selectedFieldMap.field1"),null!=a&&(b=a.getValue()));var c=!1,k=!1;Ext.Array.forEach(massOperationExpressions,function(a){var f=a.field;8==f?c=!0:
9==f&&(k=!0);var n=a.jsonConfig.disabled,p=e.getComponent("expressionPanel"+f);null!=p?(f=a.fieldName,f=p.getComponent(f),f.setDisabled(b),f.setValue(!n),f=p.getComponent(a.relationName),f.setDisabled(n),n=p.getComponent(a.valueName),null!=n&&(n.setDisabled(!0),p.remove(n)),null!=a.valueRenderer&&this.addValuePart(this,a.valueRenderer,a.jsonConfig,a,p,f)):(p=e.getComponent("expressionPanel2"),null!=p?(p=e.items.indexOf(p),null!=p?(8!=f&&9!=f&&(p+=1),e.insert(p,this.createMassOperationExpression(this,
a,e,null))):e.add(this.createMassOperationExpression(this,a,e,null))):e.add(this.createMassOperationExpression(this,a,e,null)),p=e.getComponent("expressionPanel"+f),null!=p&&(f=a.fieldName,f=p.getComponent(f),f.setDisabled(b),f.setValue(!n)))},this);c||(a=e.getComponent("expressionPanel8"),null!=a&&e.remove(a));k||(a=e.getComponent("expressionPanel9"),null!=a&&e.remove(a))}e.setLoading(!1)},failure:function(a){e.setLoading(!1);Ext.MessageBox.show({title:this.failureTitle,msg:a.responseText,buttons:Ext.Msg.OK,
icon:Ext.MessageBox.WARNING})},method:"POST"})},getContextField:function(a,b){var c=this.getFieldComponent(a,b);return null==c||c.isDisabled()?null:c.getValue()},getFieldComponent:function(a,b){var c=a.getComponent("expressionPanel"+b);return null!=c?c.getComponent(this.getComponentItemID("displayValueMap",b)):null},changeSetter:function(a,b,c){b=c.bulkExpression.field;var e=c.panel.getComponent(c.bulkExpression.valueName),f=null;null!=e&&(f=e.getFieldValueJson());var g=a.getValue(),h=f;null==f&&
(h={});h.fieldID=b;h.relationID=g;h.issueTypeID=this.getContextField(a.ownerCt.ownerCt,2);h.projectID=this.getContextField(a.ownerCt.ownerCt,1);h.selectedIssueIDs=this.selectedIssueIDs;Ext.Ajax.request({url:"massOperationFieldSetterAction.action",params:h,scope:this,disableCaching:!0,success:function(b){b=Ext.decode(b.responseText);null!=e&&(e.setDisabled(!0),c.panel.remove(e,!0));null!=b.valueRenderer&&""!=b.valueRenderer&&(c.bulkExpression.valueRenderer=b.valueRenderer,this.addValuePart(this,b.valueRenderer,
b.jsonConfig,c.bulkExpression,c.panel,a))},failure:function(a){Ext.MessageBox.show({title:this.failureTitle,msg:a.responseText,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING})},method:"POST"})},addValuePart:function(a,b,c,e,f,g){if(null!=e.valueRenderer&&""!=e.valueRenderer&&null!=c){c.scope=a;c.selectHandler=this.changeCompositePart;c.expressionPanel=f;c.bulkExpression=e;c.setterRelationCombo=g;c.selectedIssueIDs=this.selectedIssueIDs;var h=Ext.create(b,{jsonData:c,margin:"2 0 2 0"});1==c.fieldID&&
(h.postProcessSelectScope=this,h.postProcessSelect=function(){var a={projectRefresh:!0},b=h.getSubmitValue();a.projectID=b;this.refreshContext(f,a,1)});f.add(h)}}});
Ext.define("com.trackplus.issue.Link",{extend:"Ext.Base",config:{itemNavigatorController:null,workItemIDs:null,fromGantt:!1,gantt:null,dependencyType:null,crossProject:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},addLinkFromIssueNavigator:function(){var a={loadUrl:"itemLink!editItemLink.action",loadUrlParams:{fromGantt:this.fromGantt}},b={workItemIDs:this.workItemIDs,fromGantt:this.fromGantt,crossProject:this.crossProject},c=null,c=null!=this.gantt?{submitHandler:this.ganttSpecialSubmitHandler,
refreshAfterSubmitHandler:this.refreshAfterSubmitOrCancelHandler,submitButtonText:getText("common.btn.save"),submitUrlParams:b}:{specialSubmitFailHandler:this.submitFailHandler,refreshAfterSubmitHandler:this.refresh,submitUrl:"itemLink!saveLinkFromIssueNavigator.action",submitUrlParams:b,submitButtonText:getText("common.btn.save")},a={title:getText("itemov.link.title"),width:600,height:300,load:a,submit:c,items:this.getLinkPanelItems(),isFormPanel:!1,refreshAfterCancel:!0,postDataProcess:this.postDataLoadCombos};
this.windowConfig=a=Ext.create("com.trackplus.util.WindowConfig",a);a.showWindowByConfig(this)},refreshAfterSubmitOrCancelHandler:function(){!0==this.fromGantt&&this.gantt.removeLastAddedDependency()},refresh:function(a,b,c){null!=this.itemNavigatorController&&this.itemNavigatorController.refresh.call(this.itemNavigatorController)},loadFailHandler:function(){!0==this.fromGantt&&this.gantt.removeLastAddedDependency()},ganttSpecialSubmitHandler:function(){var a=this.windowConfig.getFormPanel().getValues(),
b={};b.description=a.description;b.linkTypeWithDirection=a.linkTypeWithDirection;b.linkType=a["parametersMap[0]"];b.lag=a["parametersMap[1]"];b.lagUnit=a["parametersMap[2]"];this.gantt.adjustNewlyCreatedLink(b);this.windowConfig.win.close()},submitFailHandler:function(a){!0==this.fromGantt&&this.gantt.removeLastAddedDependency()},postDataLoadCombos:function(a,b){var c=b.getComponent("linkTypeWithDirection");null!=c&&(c.store.loadData(a.linkTypesList),c.setValue(a.linkTypeWithDirection));this.replaceSpecificPart(b,
a.linkTypeJSClass,a.specificData);null!=this.dependencyType&&(c=b.getComponent("specificPart"),c.items.items[0].setValue(this.getDependencyComboValueFromGanttValue(this.dependencyType)),c.items.items[0].setReadOnly(!0));0==a.linkTypesList.length&&this.loadFailHandler()},getDependencyComboValueFromGanttValue:function(a){switch(a){case 0:return 3;case 1:return 2;case 2:return 1;case 3:return 0;default:return 0}},getLinkPanelItems:function(){var a=CWHF.createCombo("itemov.link.type","linkTypeWithDirection",
{labelWidth:150,anchor:"100%",idType:"string",allowBlank:!1},{select:{fn:this.selectLinkType,scope:this}}),b=CWHF.createTextAreaField("item.tabs.itemLink.lbl.comment","description",{height:125,anchor:"100%",labelWidth:150});return[a,b]},selectLinkType:function(a,b,c){Ext.Ajax.request({url:"itemLink!getSpecificPart.action",params:{linkTypeWithDirection:a.getValue()},disableCaching:!0,scope:this,success:function(b,c){var g=Ext.decode(b.responseText);this.replaceSpecificPart(a.ownerCt,g.linkTypeJSClass,
g.specificData)},failure:function(a,b){},method:"POST"})},replaceSpecificPart:function(a,b,c){var e=a.getComponent("specificPart");null!=e&&(e.setDisabled(!0),a.remove(e,!0));null!=b&&(e=Ext.create(b,{margin:"0 5 5 0"}),null!=e&&(a.insert(1,e),e.onDataReady(c),a.doLayout()))}});
Ext.define("com.trackplus.itemNavigator.ItemNavigatorController",{extend:"Ext.Base",mixins:{navigable:"com.trackplus.itemNavigator.TreeNavigableItem"},config:{model:null,useLastQuery:!0,baseAction:"itemNavigator",skipEmptyNodeType:!1,nodeType:null,nodeObjectID:null,workItemID:null,actionID:null,settingsVisible:!1,filterEditVisible:!1},view:null,filterController:null,selectedIssueViewDescriptor:null,selectedIssueViewDescriptorStandard:null,issueListFacade:null,selectedExtraAction:null,subDialogForExcelWizard:null,
fromSession:!1,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.mixins.navigable.constructor.call(this)},test:function(){alert("HE")},createView:function(){this.selectedIssueViewDescriptor=this.findView(this.model.lastSelectedView);this.selectedIssueViewDescriptorStandard=this.findView(this.model.lastSelectedViewPerson);this.filterEditPanel=Ext.create("Ext.panel.Panel",{region:"north",margins:"0 0 0 0",border:!1,bodyBorder:!1,hidden:!this.filterEditVisible,split:!0,stateful:!0,
stateId:"itemNavigator_filterEdit",height:200,layout:"fit"});this.issueViewPanel=Ext.create("Ext.panel.Panel",{region:"center",margins:"0 0 0 0",border:!1,bodyBorder:!1,layout:"fit"});this.view=Ext.create("Ext.panel.Panel",{region:"center",margins:"0 0 0 0",border:!1,bodyBorder:!1,baseCls:"itemNavigator",layout:"border",style:{borderLeft:"1px solid #D0D0D0"},bodyStyle:{padding:"0px 0px 0px 0px"},items:[this.filterEditPanel,this.issueViewPanel]});this.updateSelectedIssueListView(!0);return this.view},
updateSelectedIssueListView:function(a){var b=this.model.queryContext.id,c=this.model.queryContext.queryType,e=this.model.queryContext.queryID,f=this.model.queryContext.queryName,g=this.selectedIssueViewDescriptor.id;null!=this.fromSession&&!1!=this.fromSession||!this.useLastQuery||(b=Ext.create("com.trackplus.itemNavigator.instantFilter",{filterName:f,filterType:c,filterID:e,queryContextID:b,viewID:g,fromSession:this.fromSession}),this.filterEditPanel.removeAll(!0),this.filterEditPanel.add(b.createPanel()),
b.addListener("applyFilter",this.onApplyFilter,this),b.addListener("clearFilter",this.onClearFilter,this),b.loadFilter.call(b));if(this.model.tooManyItems)return this.issueViewPanel.removeAll(!0),a=Ext.create("Ext.Component",{html:getText("itemov.err.tooManyItems"),border:!1,cls:"infoBox1"}),this.issueViewPanel.add(a),this.view.doLayout(),!0;!0===a||null==this.issueListFacade?this.createIssueListView():this.issueListFacade.refreshData.call(this.issueListFacade,this.model.issues)},createIssueListView:function(){null!=
this.issueListFacade&&(this.issueListFacade.destroy.call(this.issueListFacade),this.issueListFacade=null,delete this.issueListFacade);this.issueListFacade=Ext.create("com.trackplus.itemNavigator.IssueListViewFacade",{descriptor:this.selectedIssueViewDescriptor,model:this.model,queryContext:this.model.queryContext,itemNavigatorController:this});this.issueViewPanel.removeAll(!0);var a=this.issueListFacade.createView.call(this.issueListFacade,this.model,this.settingsVisible);this.issueViewPanel.add(a);
this.view.doLayout();if(null!=a.getEl())this.onReadyHandler();else a.addListener("render",this.onReadyHandler,this)},onApplyFilter:function(a){this.fromSession=!0;this.refresh(null,null,!0,null)},onClearFilter:function(a){this.fromSession=!1},onReadyHandler:function(){var a=this;a.model.showDragDropInfoMsg&&CWHF.showMsgInfo(getText("itemov.lbl.dragDropInfoText"),!1);a.dragCounter=0;var b=a.issueListFacade.view,c=b.getEl().dom;a.highLightPanel=new Ext.Panel({width:500,height:500,bodyCls:"itemNavigatorViewHighlightWhenDrag",
hidden:!0});b.insert(a.highLightPanel);c.addEventListener("dragenter",function(b){b.stopPropagation();b.preventDefault();parseInt(b.clientX);parseInt(b.clientY);a.dragCounter++;a.highLightPanel.isVisible()||(a.highLightPanel.setWidth(a.view.lastBox.width),a.highLightPanel.setHeight(a.view.lastBox.height),a.highLightPanel.setVisible(!0))},!1);c.addEventListener("dragleave",function(b){b.stopPropagation();a.dragCounter--;Ext.isChrome||Ext.isSafari||Ext.isIE?0==a.dragCounter&&a.highLightPanel.setVisible(!1):
a.highLightPanel.setVisible(!1)},!1);c.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault()},!1);c.addEventListener("drop",function(b){b.stopPropagation();b.preventDefault();a.highLightPanel.setVisible(!1);b=b.dataTransfer.files;if(1==b.length){var c=Ext.create("com.trackplus.admin.action.ImportExcel"),g=Ext.create("com.trackplus.admin.action.ImportMsProject",{projectID:null}),h=null;null!=b&&0<b.length&&(h=b[0]);c.validateFileExtension(h.name)&&c.createPopUpDialog(b,a);
g.validateFileExtension(h.name)&&g.createPopUpDialog(b)}},!1)},createNavigator:function(){this.filterController=Ext.create("com.trackplus.itemNavigator.FilterController",{model:this.model.navigator,queryContext:this.model.queryContext,skipEmptyNodeType:this.skipEmptyNodeType,lastSelectedNavigator:this.model.lastSelectedNavigator,itemNavController:this});return this.filterController.createView.call(this.filterController)},issueSelectionChange:function(a){var b=Ext.getCmp("massEdit"),c=Ext.getCmp("massCopy"),
e=Ext.getCmp("addLink");b.setDisabled(null==a||0==a.length);c.setDisabled(null==a||0==a.length);e.setDisabled(null==a||2>a.length)},showGroupByPopup:function(){Ext.create("com.trackplus.itemNavigator.Grouping",{filterType:this.model.queryContext.queryType,filterID:this.model.queryContext.queryID,itemNavigatorController:this}).showDialog()},showColumnsPopup:function(){var a=!1,b=this.selectedIssueViewDescriptor;null!=b&&(a=b.useLongFields);null!=this.chooseColumns&&this.chooseColumns.destroyMe.call(this.chooseColumns);
this.chooseColumns=Ext.create("com.trackplus.itemNavigator.ChooseColumns",{itemNavigatorController:this,filterType:this.model.queryContext.queryType,filterID:this.model.queryContext.queryID,includeLongFields:a});this.chooseColumns.setIncludeLongFields(a);this.chooseColumns.showDialog.call(this.chooseColumns)},changeLayout:function(){var a=this.selectedIssueViewDescriptor;this.selectedIssueViewDescriptor=null;this.changeIssueListViewMode(a,null,!0)},sortChange:function(a){this.model.layout.sortField=
a.sortField;this.model.layout.sortOrder=a.sortOrder;this.model.layout.sortWithSOr=a.sortWithSO},changeIssueListViewMode:function(a,b,c){var e=this;if(null!=e.selectedIssueViewDescriptor&&e.selectedIssueViewDescriptor.id==a.id)return!1;e.selectedIssueViewDescriptor=a;null!=e.btnListView&&(e.btnListView.setText(e.selectedIssueViewDescriptor.name),e.btnListView.setIconCls(e.selectedIssueViewDescriptor.iconCls),e.btnListView.setTooltip(e.selectedIssueViewDescriptor.description));var f=[];"com.trackplus.itemNavigator.GanttViewPlugin"==
a.id?f.push(e.btnPrintGantt):f.push(e.btnExportPDF);f.push(e.btnExportXLS);f.push(e.btnExportCSV);f.push(e.btnExportDOCX);f.push(e.btnExportXML);f.push(e.btnExportTrackplus);e.btnExport.menu.removeAll();e.btnExport.menu.add(f);e.removeOrAddPrintGanttIntoPDFAfterChange(a);c?(e.selectedIssueViewDescriptorStandard=e.selectedIssueViewDescriptor,Ext.Ajax.request({url:"itemNavigator!storeLastSelectedView.action",params:{viewID:e.selectedIssueViewDescriptor.id},success:function(f){e.doChangeIssueListViewMode(a,
b,c)},failure:function(){CWHF.showMsgError("Failure")}})):e.doChangeIssueListViewMode(a,b,c)},removeOrAddPrintGanttIntoPDFAfterChange:function(a){var b=this;if("com.trackplus.itemNavigator.GanttViewPlugin"==a.id){var c=!1;b.btnExtraActions.menu.items.each(function(a){null!=a.itemId&&"exportGanttIntoPDFBtn"==a.itemId&&(c=!0)});c||b.btnExtraActions.menu.add(b.btnExportGanttIntoPDF)}else b.btnExtraActions.menu.items.each(function(a){null!=a.itemId&&"exportGanttIntoPDFBtn"==a.itemId&&b.btnExtraActions.menu.remove(a)})},
doChangeIssueListViewMode:function(a,b,c){null!=b?b.call(this):this.refresh("itemNavigator!reload.action",this.model.queryContext.id,!0)},createLastQueriesMenu:function(a){var b=[];if(null!=a)for(var c=0;c<a.length;c++)b.push(this.createQueryMenu(a[c]));return Ext.create("Ext.menu.Menu",{items:b})},updateModel:function(a){null!=a.layout&&(this.model.layout=a.layout);this.model.issues=a.issues;this.model.isFilterView=a.isFilterView;this.model.maySaveFilterLayout=a.maySaveFilterLayout;this.model.summaryItemsBehavior=
a.summaryItemsBehavior;this.model.tooManyItems=a.tooManyItems;this.model.listViewData=a.listViewData;this.model.milestoneWorkitems=a.milestoneWorkitems;this.model.totalCount=a.totalCount;this.model.forceAllItems=!0==a.forceAllItems;this.model.overflowItems=a.overflowItems;this.model.holidays=a.holidays;this.model.localizedToolTipLabels=a.localizedToolTipLabels;this.model.count=a.count;this.model.lastQueries=a.lastQueries;this.model.queryContext=com.trackplus.itemNavigator.ItemNavigatorFacade.createQueryContext(a.queryContext);
this.model.queryFieldCSS=a.queryFieldCSS;this.model.isActiveTopDownDate=a.isActiveTopDownDate;this.model.showBaseline=a.showBaseline;this.model.validateRelationships=a.validateRelationships;this.model.showDragDropInfoMsg=a.showDragDropInfoMsg;this.model.showBoth=a.showBoth;this.model.highlightCriticalPath=a.highlightCriticalPath;this.model.nodeType=this.nodeType;this.model.nodeObjectID=this.nodeObjectID;this.model.isPrintItemEditable=a.isPrintItemEditable;com.trackplus.itemNavigator.ItemNavigatorFacade.updateCssRules(a.queryFieldCSS,
a.cssRules)},refresh:function(a,b,c,e){c=!0;borderLayout.setLoading(!0);var f=this;null==a&&(a=f.baseAction+"!refresh.action");null==b&&(b=f.model.queryContext.id);Ext.Ajax.request({url:a,disableCaching:!0,success:function(a){borderLayout.setLoading(!1);f.refreshSuccessHandler.call(f,a,c,e)},failure:function(){borderLayout.setLoading(!1);CWHF.showMsgError("Failure")},method:"POST",params:{queryContextID:b,nodeType:f.nodeType,nodeObjectID:f.nodeObjectID,forceAllItems:f.model.forceAllItems,fromSession:this.fromSession}})},
refreshSuccessHandler:function(a,b,c){b=!0;a=Ext.decode(a.responseText);if(!1==a.success)return CWHF.showMsgError(a.errorMessage),!1;this.updateModel(a.data);this.updateTotalCount();this.updateLastExecutedQueries();this.updateSelectedIssueListView(!0===b);borderLayout.setLoading(!1);null!=c&&c.call(this);this.issueListFacade.addOrRemoveSaveButton(null)},filterByNodeType:function(a){var b=this,c=a.objectID,e=a.nodeType,f=a.useFilter;a=a.filterViewID;if(b.nodeType==e&&b.nodeObjectID==c)return!1;null!=
b.btnListView&&b.btnListView.setDisabled(!1);if(null!=a&&""!=a){if(null!=b.btnListView&&b.btnListView.setDisabled(!0),b.selectedIssueViewDescriptor.id!=a)return b.nodeType=e,b.nodeObjectID=c,b.changeIssueListViewMode(b.findView(a),function(){b.doFilterByNode(e,c,f)},!1),!0}else if(null!=b.selectedIssueViewDescriptorStandard&&b.selectedIssueViewDescriptorStandard.id!=b.selectedIssueViewDescriptor.id)return b.nodeType=e,b.nodeObjectID=c,b.changeIssueListViewMode(b.selectedIssueViewDescriptorStandard,
function(){b.doFilterByNode(e,c,f)},!0),!0;b.doFilterByNode(e,c,f)},clearSubfilter:function(){this.doFilterByNode(null,null,null)},doFilterByNode:function(a,b,c){var e=this;e.fromSession=!1;var f=e.baseAction+"!filterByNode.action";e.nodeType=a;e.nodeObjectID=b;a={queryContextID:e.model.queryContext.id,nodeType:e.nodeType,nodeObjectID:e.nodeObjectID};borderLayout.setLoading(!0);Ext.Ajax.request({url:f,disableCaching:!0,success:function(a){borderLayout.setLoading(!1);var f=Ext.decode(a.responseText);
!1==f.success?(a="",a=null!=f.errorMessage?f.errorMessage:"Failure!",CWHF.showMsgError(a)):!0===f.data.includeParameters?com.trackplus.admin.Filter.executeFilter(e,b,!1):(f=null!=f.data.layout,!0==c&&(f=!0),e.refreshSuccessHandler.call(e,a,f))},failure:function(){borderLayout.setLoading(!1)},method:"POST",params:a})},executePreviousQuery:function(a){var b=this;b.fromSession=!1;var c=a.queryContextID;a=a.viewID;null!=b.btnListView&&b.btnListView.setDisabled(!1);if(null!=a&&""!=a){if(null!=b.btnListView&&
b.btnListView.setDisabled(!0),b.selectedIssueViewDescriptor.id!=a)return b.changeIssueListViewMode(b.findView(a),function(){b.refresh("itemNavigator!executePreviousQuery.action",c,!0)},!1),!0}else if(null!=b.selectedIssueViewDescriptorStandard&&b.selectedIssueViewDescriptorStandard.id!=b.selectedIssueViewDescriptor.id)return b.changeIssueListViewMode(b.selectedIssueViewDescriptorStandard,function(){b.refresh("itemNavigator!executePreviousQuery.action",c,!0)},!0),!0;null!=b.btnListView&&b.btnListView.setDisabled(!1);
b.refresh("itemNavigator!executePreviousQuery.action",c,!0)},createQueryMenu:function(a){var b=this;return{text:a.label,tooltip:a.tooltip,icon:a.icon,iconCls:a.iconCls,handler:function(){b.executePreviousQuery.call(b,a)}}},updateLastExecutedQueries:function(){if(this.useLastQuery){var a=Ext.getCmp("reportQueryName");a.setText(this.model.queryContext.queryName);a.menu=this.createLastQueriesMenu(this.model.lastQueries);borderLayout.controller.updateLastExecutedQueries.call(borderLayout.controller,this.model.lastQueries)}},
updateTotalCount:function(){Ext.getCmp("txtReportCount").setText(this.createHtmlTotalNumber());Ext.getCmp("txtReportFilteredCount").setText(this.createHtmlFilteredNumber());var a=this.model.overflowItems;this.viewAllLink.setVisible(null!=a&&0<a)},createHtmlTotalNumber:function(){var a=this.model.totalCount,b=this.model.overflowItems,c="";return-1==a?getText("itemov.lbl.totalNumber")+" ? ":c=null!=b&&0<b?'\x3cspan class\x3d"warning"\x3e!\x3c/span\x3e '+getText("itemov.lbl.totalNumber")+" "+a:getText("itemov.lbl.totalNumber")+
" "+a},createHtmlFilteredNumber:function(){var a=this.model.count,b=this.model.overflowItems,c="";return-1==a?"   "+getText("itemov.lbl.filtered")+": ? ":c=null!=b&&0<b?"   "+getText("itemov.lbl.filtered")+": "+b+" ("+getText("itemov.lbl.filteredLimitedTo")+" "+a+")":"   "+getText("itemov.lbl.filtered")+": "+a},createIssueListViewButton:function(a){var b=this;return{itemId:a.id,iconCls:a.iconCls,overflowText:a.name,text:a.name,tooltip:a.description,handler:function(){b.changeIssueListViewMode(a,null,
!0)}}},storeExtraAction:function(a){if(this.selectedExtraAction==a)return!1;this.selectedExtraAction=a;switch(a){case 1:getText("common.btn.bulkEdit");break;case 2:getText("common.btn.bulkCopy");break;case 3:getText("common.btn.report");break;case 4:getText("common.btn.export");break;case 5:getText("itemov.btn.exportPDF");break;case 6:getText("itemov.btn.exportCSV");break;case 7:getText("itemov.btn.exportXML");break;case 8:getText("itemov.btn.exportExcel");break;case 9:getText("itemov.btn.exportDocx");
break;case 10:getText("common.btn.addLink");break;case 13:getText("itemov.btn.exportMSProject");break;case 14:getText("itemov.btn.importExcel");break;case 15:getText("itemov.btn.importMSProject")}},MASS_EDIT:1,MASS_COPY:2,EXPORT_REPORT:3,EXCHANGE:4,EXPORT_PDF:5,EXPORT_CSV:6,EXPORT_XML:7,EXPORT_XLS:8,EXPORT_DOCX:9,ADD_LINK:10,SAVE_AS_STANDARD_LAYOUT:11,USE_STANDARD_LAYOUT:12,EXPORT_MS_PROJECT:13,IMPORT_EXCEL:14,IMPORT_MS_PROJECT:15,SAVE_AS_FILTER_LAYOUT:16,executeExtraAction:function(){var a=this.selectedExtraAction;
if(null==a)return!1;switch(a){case 1:this.massOperation.call(this,!1);break;case 2:this.massOperation.call(this,!0);break;case 3:this.executeReport.call(this);break;case 4:this.executeUrl("exchangeExport.action");break;case 5:this.executeUrl("reportDatasource.action?exportFormat\x3dpdf");break;case 6:this.executeUrl("reportDatasource.action?exportFormat\x3dcsv");break;case 7:this.executeUrl("reportDatasource!serializeDatasource.action?fromIssueNavigator\x3dtrue");break;case 8:this.executeUrl("reportDatasource.action?exportFormat\x3dxls");
break;case 9:this.exportDocx();break;case 10:this.addLink.call(this)}},initToolbar:function(){var a=this,b=[],c={id:"massEdit",text:getText("common.btn.bulkEdit"),overflowText:getText("common.btn.bulkEdit"),tooltip:getText("common.btn.bulkEdit.tt"),iconCls:"bulkEdit",disabled:!0,handler:function(){a.massOperation.call(a,!1);a.storeExtraAction.call(a,a.MASS_EDIT)}},e={id:"massCopy",text:getText("common.btn.bulkCopy"),overflowText:getText("common.btn.bulkCopy"),tooltip:getText("common.btn.bulkCopy.tt"),
iconCls:"bulkCopy",disabled:!0,handler:function(){a.massOperation.call(a,!0);a.storeExtraAction.call(a,a.MASS_COPY)}},f={id:"addLink",text:getText("common.btn.addLink"),overflowText:getText("common.btn.addLink"),tooltip:getText("common.btn.addLink.tt"),iconCls:"links16",disabled:!0,handler:function(){a.addLink.call(a);a.storeExtraAction.call(a,a.ADD_LINK)}},g={text:getText("common.btn.report"),overflowText:getText("common.btn.report"),tooltip:getText("common.btn.report.tt"),iconCls:"reports20",disabled:!1,
handler:function(){a.executeReport.call(a);a.storeExtraAction.call(a,a.EXPORT_REPORT)}};a.btnExportTrackplus={text:getText("itemov.btn.exportTrackplus"),overflowText:getText("itemov.btn.exportTrackplus"),tooltip:getText("itemov.btn.exportTrackplus.tt"),iconCls:"export",disabled:!1,handler:function(){a.executeUrl("exchangeExport.action");a.storeExtraAction.call(a,a.EXCHANGE)}};a.btnPrintGantt={text:getText("itemov.ganttView.print"),overflowText:getText("itemov.ganttView.print"),tooltip:getText("report.tooltip.printGantt"),
iconCls:"export",disabled:!1,handler:function(){var b=a.issueListFacade.getView();b.items.items[1].zoomToFit();b.items.items[1].print()}};a.btnExportPDF={text:getText("itemov.btn.exportPDF"),overflowText:getText("itemov.btn.exportPDF"),tooltip:getText("report.tooltip.exportPDF"),iconCls:"printIssue",disabled:!1,handler:function(){a.executeUrl("reportDatasource.action?exportFormat\x3dpdf");a.storeExtraAction.call(a,a.EXPORT_PDF)}};a.btnExportCSV={text:getText("itemov.btn.exportCSV"),overflowText:getText("itemov.btn.exportCSV"),
tooltip:getText("report.tooltip.exportCSV"),iconCls:"exportCSV",disabled:!1,handler:function(){a.executeUrl("reportDatasource.action?exportFormat\x3dcsv");a.storeExtraAction.call(a,a.EXPORT_CSV)}};a.btnExportXML={text:getText("itemov.btn.exportXML"),overflowText:getText("itemov.btn.exportXML"),tooltip:getText("itemov.btn.exportXML"),iconCls:"exportXML",disabled:!1,handler:function(){a.executeUrl("reportDatasource!serializeDatasource.action?fromIssueNavigator\x3dtrue\x26exportFormat\x3dxml");a.storeExtraAction.call(a,
a.EXPORT_XML)}};a.btnExportXLS={text:getText("itemov.btn.exportExcel"),overflowText:getText("itemov.btn.exportExcel"),tooltip:getText("report.tooltip.exportExcel"),iconCls:"exportExcel",disabled:!1,handler:function(){a.executeUrl("reportDatasource.action?exportFormat\x3dxls");a.storeExtraAction.call(a,a.EXPORT_XLS)}};a.btnExportMSProject={text:getText("itemov.btn.exportMSProject"),overflowText:getText("itemov.btn.exportMSProject"),tooltip:getText("report.tooltip.exportMSProject"),iconCls:"msProject-ticon",
disabled:!1,handler:function(){Ext.create("com.trackplus.admin.action.ExportMsProject",{projectID:-1}).createPopUpDialog();a.storeExtraAction.call(a,a.EXPORT_MS_PROJECT)}};a.btnExportDOCX={text:getText("itemov.btn.exportDocx"),overflowText:getText("itemov.btn.exportDocx"),tooltip:getText("itemov.btn.exportDocx"),iconCls:"word",disabled:!1,handler:function(){a.exportDocx();a.storeExtraAction.call(a,a.EXPORT_DOCX)}};var h=[];"com.trackplus.itemNavigator.GanttViewPlugin"==a.model.lastSelectedView?h.push(a.btnPrintGantt):
h.push(a.btnExportPDF);h.push(a.btnExportXLS);h.push(a.btnExportMSProject);h.push(a.btnExportCSV);h.push(a.btnExportDOCX);h.push(a.btnExportXML);h.push(a.btnExportTrackplus);a.btnExportGanttIntoPDF={itemId:"exportGanttIntoPDFBtn",text:getText("itemov.btn.exportPDF"),overflowText:getText("itemov.btn.exportPDF"),tooltip:getText("itemov.btn.exportPDF.tt"),iconCls:"exportPDF",disabled:!1,handler:function(){var b=a.issueListFacade.getView().items.items[1],c=null,e;for(e in b.plugins)"Gnt.plugin.Export"==
b.plugins[e].$className&&(c=b.plugins[e]);null!=c&&Ext.Ajax.request({url:"itemNavigator!getGanttExportPDFConfig.action",disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);a.success&&(c.defaultConfig.format=a.format,c.defaultConfig.orientation=a.orientation,c.defaultConfig.range=a.range);b.showExportDialog()},failure:function(){b.showExportDialog()},method:"POST"})}};a.btnExport={text:getText("common.btn.export"),overflowText:getText("common.btn.export"),tooltip:getText("common.btn.export.tt"),
iconCls:"export",disabled:!1,menu:Ext.create("Ext.menu.Menu",{items:h})};a.btnImportXLS={text:getText("itemov.btn.importExcel"),overflowText:getText("itemov.btn.importExcel"),tooltip:getText("report.tooltip.importExcel"),iconCls:"exportExcel",disabled:!1,handler:function(){Ext.create("com.trackplus.admin.action.ImportExcel").createPopUpDialog(null);a.storeExtraAction.call(a,a.IMPORT_EXCEL)}};a.btnImportMSProject={text:getText("itemov.btn.importMSProject"),overflowText:getText("itemov.btn.importMSProject"),
tooltip:getText("report.tooltip.importMSProject"),iconCls:"msProject-ticon",disabled:!1,handler:function(){Ext.create("com.trackplus.admin.action.ImportMsProject",{projectID:null}).createPopUpDialog(null);a.storeExtraAction.call(a,a.IMPORT_MS_PROJECT)}};h=[];h.push(a.btnImportXLS);h.push(a.btnImportMSProject);a.btnImport={text:getText("common.btn.import"),overflowText:getText("common.btn.import"),tooltip:getText("common.btn.import.tt"),iconCls:"import",disabled:!1,menu:Ext.create("Ext.menu.Menu",
{items:h})};b.push(c);b.push(e);b.push(f);com.trackplus.TrackplusConfig.user.reports&&b.push(g);b.push(a.btnImport);b.push(a.btnExport);"com.trackplus.itemNavigator.GanttViewPlugin"==a.model.lastSelectedView&&b.push(a.btnExportGanttIntoPDF);a.btnExtraActions=Ext.create("Ext.button.Split",{id:"extraActions",itemId:"extraActionsItemId",text:getText("itemov.btn.extraActions"),overflowText:getText("itemov.btn.extraActions"),tooltip:getText("itemov.btn.extraActions.tt"),iconCls:"extraActions",disabled:!1,
handler:function(){a.executeExtraAction.call(a)},menu:b})},createToolbar:function(){var a=this;a.initToolbar();var b=[];a.useLastQuery&&(b.push(Ext.create("Ext.button.Split",{iconCls:"queryHistory",text:a.model.queryContext.queryName,id:"reportQueryName",menu:a.createLastQueriesMenu(a.model.lastQueries)})),b.push(borderLayout.createItemToolbarSeparator()));b.push({xtype:"tbtext",disabled:!0,id:"txtReportCount",text:a.createHtmlTotalNumber()});b.push({xtype:"tbtext",disabled:!0,id:"txtReportFilteredCount",
text:a.createHtmlFilteredNumber()});a.viewAllLink=Ext.create("Ext.ux.LinkComponent",{handler:a.forceViewAll,hidden:null==a.model.overflowItems||0==a.model.overflowItems,scope:a,margin:"0 0 0 0",style:{overflow:"hidden"},label:getText("itemov.lbl.forceShowAll")});b.push(a.viewAllLink);b.push("-\x3e");a.btnFilterEdit=Ext.create("Ext.button.Button",{iconCls:"queryView",enableToggle:!0,allowDepress:!0,cls:"toolbarItemAction-noText",text:getText("common.btn.filter"),overflowText:getText("common.btn.filter"),
tooltip:getText("common.btn.filter"),handler:function(){a.showHideFilterEdit()},scope:a});a.useLastQuery&&b.push(a.btnFilterEdit);b.push(a.btnExtraActions);if(1<a.model.issueListViewDescriptors.length){for(var c=[],e=0;e<a.model.issueListViewDescriptors.length;e++)c.push(a.createIssueListViewButton(a.model.issueListViewDescriptors[e]));a.btnListView=Ext.create("Ext.button.Split",{id:"listView",itemId:"elistViewItemId",iconCls:a.selectedIssueViewDescriptor.iconCls,text:a.selectedIssueViewDescriptor.name,
overflowText:a.selectedIssueViewDescriptor.name,tooltip:a.selectedIssueViewDescriptor.description,disabled:a.model.isFilterView,handler:function(){},menu:c});b.push(a.btnListView)}a.btnToolbarSettings=Ext.create("Ext.button.Button",{iconCls:"btnConfig",enableToggle:!0,allowDepress:!0,cls:"toolbarItemAction-noText",text:getText("itemov.lbl.toolbarSettings"),overflowText:getText("itemov.lbl.toolbarSettings"),tooltip:getText("itemov.lbl.toolbarSettings.tt"),handler:function(){a.showHideSettings()},scope:a});
b.push(a.btnToolbarSettings);return b},forceViewAll:function(){this.model.forceAllItems=!0;this.refresh()},showHideFilterEdit:function(){var a=this;a.filterEditVisible=!a.filterEditVisible;Ext.Ajax.request({url:"userPreferences.action?property\x3ditemNavigator_filterEditVisible\x26value\x3d"+a.filterEditVisible,disableCaching:!0,success:function(a){},failure:function(a,b){}});var b=a.filterEditVisible,c=a.filterEditPanel,e=c.getEl(),f=a.issueViewPanel.getEl();f.getY();var g=f.getHeight();b?f.animate({top:100,
height:g-100,duration:300,listeners:{afteranimate:function(){c.setVisible(!0);e.slideIn("t",{easing:"easeOut",duration:300,listeners:{afteranimate:function(){a.view.doLayout()}}})}}}):e.slideOut("t",{easing:"easeOut",duration:300,listeners:{afteranimate:function(){f.animate({top:0,height:g+100,duration:300,listeners:{afteranimate:function(){c.setVisible(!1);a.view.doLayout()}}})}}})},showHideSettings:function(){this.settingsVisible=!this.settingsVisible;this.issueListFacade.setVisibleTools(this.settingsVisible);
Ext.Ajax.request({url:"userPreferences.action?property\x3ditemNavigator_settingsVisible\x26value\x3d"+this.settingsVisible,disableCaching:!0,success:function(a){},failure:function(a,b){}})},getSelectedIssues:function(){return null==this.selectedIssueViewDescriptor||null==this.issueListFacade?null:this.issueListFacade.getSelectedIssues()},formatIntegersAsString:function(a){var b="";if(null!=a&&0<a.length)for(var c=0;c<a.length;c++)b+=a[c],c<a.length-1&&(b+=",");return b},massOperation:function(a){var b=
this.getSelectedIssues(),b=this.formatIntegersAsString(b);Ext.create("com.trackplus.itemNavigator.MassOperationController",{model:{copy:a,selectedIssueIDs:b},itemNavigatorController:this}).showDialog()},addLink:function(){var a=this.getSelectedIssues().join();Ext.create("com.trackplus.issue.Link",{itemNavigatorController:this,workItemIDs:a}).addLinkFromIssueNavigator()},executeReport:function(){var a=this.getSelectedIssues(),b=null;null!=a&&(b=a.join());com.trackplus.admin.Report.executeReportFromIssueNavigator(b)},
exportDocx:function(){var a=this.getSelectedIssues(),b=null;null!=a&&(b=a.join());Ext.create("com.trackplus.admin.action.ExportDocx",{workItemIDs:b}).createExportForm()},executeUrl:function(a){var b=this.getSelectedIssues(),c=null;null!=b&&(c=b.join());null==c?window.open(a):Ext.create("Ext.form.Panel",{items:[],url:a,baseParams:{workItemIDs:c},standardSubmit:!0}).getForm().submit()},findView:function(a){var b=this.model.issueListViewDescriptors[0];if(null!=a)for(var c=0;c<this.model.issueListViewDescriptors.length;c++)if(this.model.issueListViewDescriptors[c].id==
a){b=this.model.issueListViewDescriptors[c];break}return b},successHandler:function(a,b){this.itemActionSuccessHandler(a,b)},executeItemAction:function(a,b,c,e,f,g,h,k){this.openItem(a,b,e,{parentID:c,addLinkFromContextMenu:k,successExtra:{workItemIndex:e,createItem:h},animateTarget:f})},navigate:function(a,b,c){return null!=this.issueListFacade?this.issueListFacade.navigate.call(this.issueListFacade,a,b,c):null},itemChangeHandler:function(a){null!=this.issueListFacade&&this.issueListFacade.viewContainsFields(a)&&
this.refresh()},selectItem:function(a){null!=this.issueListFacade&&this.issueListFacade.selectItem.call(this.issueListFacade,a)},deselectItem:function(a){null!=this.issueListFacade&&this.issueListFacade.deselectItem.call(this.issueListFacade,a)},closeItemDialog:function(a){},chooseParent:function(a){var b=a.workItemID,c={url:"item!setParent.action",params:{workItemID:b},pickItemName:"parentID",successHandler:this.itemActionSuccessHandler,successHandlerScope:this};Ext.create("com.trackplus.util.IssuePicker",
{workItemID:b,parent:!0,projectID:-1*a.projectID,title:getText("common.btn.chooseParent"),ajaxContext:c,width:700,height:500,stateId:"chooseParent"}).showDialog()},itemActionSuccessHandler:function(a,b){var c=this,e=null;null!=a?e=a.workItemID:null!=b&&(e=b.workItemID);null!=b&&!0==b.createItem&&CWHF.showMsgInfo(getText("item.msg.newItemCreated",a.workItemIDDisplay,a.title));c.refresh(null,null,!1,function(){var a=null;null!=b&&(a=b.workItemIndex);var g=null;null!=e&&(g=c.issueListFacade.selectItem.call(c.issueListFacade,
e));null!=g&&0!=g.length||null==a||c.issueListFacade.selectItemByIndex.call(c.issueListFacade,a)})},executeAJAXItemAction:function(a){var b=this;Ext.Ajax.request({url:a,success:function(a){b.itemActionSuccessHandler.call(b)},failure:function(){alert("failure")}})}});Ext.define("com.trackplus.itemNavigator.QueryContext",{extend:"Ext.Base",config:{id:null,queryType:null,queryID:null,queryName:null,dashboardParams:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)}});
Ext.define("com.trackplus.itemNavigator.ItemNavigatorModel",{extend:"Ext.Base",config:{layout:null,issues:null,tooManyItems:!1,listViewData:null,milestoneWorkitems:null,totalCount:0,overflowItems:0,count:0,lastQueries:null,queryContext:null,queryFieldCSS:null,issueListViewDescriptors:null,isFilterView:!1,maySaveFilterLayout:!1,summaryItemsBehavior:!0,lastSelectedViewPerson:null,lastSelectedView:null,lastSelectedNavigator:null,navigator:null,holidays:null,localizedToolTipLabels:null},constructor:function(a){this.initialConfig=
a=a||{};Ext.apply(this,a)}});
com.trackplus.itemNavigator.ItemNavigatorFacade=Ext.define("com.trackplus.itemNavigator.ItemNavigatorFacade",{extend:"Ext.Base",config:{model:null,useLastQuery:!0,baseAction:"itemNavigator",skipEmptyNodeType:!1,workItemID:null,actionID:null},statics:{createInitialModel:function(a){var b=this.createQueryContext(a.queryContext);this.updateCssRules(a.queryFieldCSS,a.cssRules);return Ext.create("com.trackplus.itemNavigator.ItemNavigatorModel",{layout:a.layout,issues:a.issues,tooManyItems:a.tooManyItems,
listViewData:a.listViewData,milestoneWorkitems:a.milestoneWorkitems,totalCount:a.totalCount,count:a.count,overflowItems:a.overflowItems,holidays:a.holidays,localizedToolTipLabels:a.localizedToolTipLabels,includeCharts:a.includeCharts,lastQueries:a.lastQueries,queryContext:b,queryFieldCSS:a.queryFieldCSS,issueListViewDescriptors:this.createIssueListViewDescriptors(a.issueListViews),isFilterView:a.isFilterView,maySaveFilterLayout:a.maySaveFilterLayout,summaryItemsBehavior:a.summaryItemsBehavior,lastSelectedViewPerson:a.lastSelectedViewPerson,
lastSelectedView:a.lastSelectedView,lastSelectedNavigator:a.lastSelectedNavigator,navigator:a.navigator,isActiveTopDownDate:a.isActiveTopDownDate,showBaseline:a.showBaseline,validateRelationships:a.validateRelationships,showDragDropInfoMsg:a.showDragDropInfoMsg,highlightCriticalPath:a.highlightCriticalPath,showBoth:a.showBoth,isPrintItemEditable:a.isPrintItemEditable})},createIssueListViewDescriptors:function(a){var b=[];if(null!=a)for(var c=0;c<a.length;c++)b.push(Ext.create("com.trackplus.itemNavigator.IssueListViewDescriptor",
a[c]));return b},createQueryContext:function(a){null==a&&(a={});return Ext.create("com.trackplus.itemNavigator.QueryContext",a)},updateCssRules:function(a,b){null!=this.oldCss&&(Ext.util.CSS.removeStyleSheet(this.oldCss),this.oldCss=null);if(null!=b){for(var c="",e,f=0;f<b.length;f++){var g=b[f];e="rowCls_"+a+"_"+g.id;e="."+e+",."+e+" .x-grid-td, ."+e+" .simpleTreeGridCell .x-grid-cell-inner{";e+=g.rule;e+="}";c+=e}this.oldCss="cssList_"+a;Ext.util.CSS.createStyleSheet(c,this.oldCss)}}},constructor:function(a){this.initialConfig=
a=a||{};Ext.apply(this,a);this.controller=Ext.create("com.trackplus.itemNavigator.ItemNavigatorController",{model:this.model,useLastQuery:this.useLastQuery,baseAction:this.baseAction,skipEmptyNodeType:this.skipEmptyNodeType,workItemID:this.workItemID,actionID:this.actionID,settingsVisible:this.settingsVisible,filterEditVisible:this.filterEditVisible})},createView:function(a){return this.controller.createView.call(this.controller)},createNavigator:function(){return this.controller.createNavigator.call(this.controller)},
createToolbar:function(){return this.controller.createToolbar.call(this.controller)}});
Ext.define("com.trackplus.layout.ItemNavigatorLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,toolbarCls:"toolbarActions-leftBorder",useSelfToolbarSeparators:!0,itemNavigatorFacade:null,selectedGroup:"itemNavigator",constructor:function(a){var b=this;b.callParent(arguments);var c=com.trackplus.itemNavigator.ItemNavigatorFacade.createInitialModel(b.initData);b.itemNavigatorFacade=Ext.create("com.trackplus.itemNavigator.ItemNavigatorFacade",{model:c,workItemID:b.initData.workItemID,
actionID:b.initData.actionID,settingsVisible:b.initData.settingsVisible,filterEditVisible:b.initData.filterEditVisible});b.borderLayoutController.setHelpContext("itemNavigator");b.onReady(function(){var a=b.itemNavigatorFacade.createToolbar();b.borderLayoutController.setActiveToolbarList(a);b.itemNavigatorFacade.controller.issueListFacade.addOrRemoveSaveButton(b.borderLayoutController.getActiveToolbarList());if(null!=b.initData.actionID){var a=b.itemNavigatorFacade.controller,c=a.issueListFacade.listViewPlugin.selectItem(b.initData.workItemID),
g=null;null!=c&&0<c.length&&(g=c[0].workItemIndex);a.executeItemAction.call(a,b.initData.workItemID,b.initData.actionID,null,a.navigate,a,g)}})},createCenterPanel:function(){return this.itemNavigatorFacade.createView()},createWestPanel:function(){return this.itemNavigatorFacade.createNavigator.call(this.itemNavigatorFacade)},refresh:function(){this.itemNavigatorFacade.controller.refresh()}});
Ext.define("com.trackplus.layout.ItemNavigatorLiteLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,itemNavigatorFacade:null,constructor:function(a){this.callParent(arguments);this.model=com.trackplus.itemNavigator.ItemNavigatorFacade.createInitialModel(this.initData);this.borderLayoutController.setHelpContext("itemNavigator")},createCenterPanel:function(){var a=Ext.create("com.trackplus.itemNavigator.LiteGridViewPlugin",{model:this.model});return a.createView.call(a)}});
Ext.define("com.trackplus.util.WindowConfig",{extend:"Ext.Base",config:{title:"",width:400,height:300,windowConfig:null,panelConfig:null,items:null,formPanel:null,load:null,submit:null,method:"POST",postDataProcess:null,preSubmitProcess:null,cancelButtonText:null,submitButtonText:null,refreshAfterCancel:!1,fileUpload:!1,extraConfig:null,overrideButtons:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},failureTitle:getText("common.err.failure"),win:null,getCancelButtonText:function(){return null!=
this.cancelButtonText?this.cancelButtonText:getText("common.btn.cancel")},getSubmitButtonText:function(a){null!=this.submitButtonText&&(a.submitButtonText=this.submitButtonText);return null!=a.submitButtonText?a.submitButtonText:getText("common.btn.save")},getButtonDisabled:function(a){return null!=a&&null!=a.disabled?a.disabled:!1},cancelHandler:function(a,b){null!=b&&null!=b.specialSubmitFailHandler&&b.specialSubmitFailHandler.call(a);this.refreshAfterCancel&&this.refreshHandler(a,null,b);this.win.close()},
showWindow:function(a,b,c,e,f,g,h){this.title=b;this.width=c;this.height=e;this.ensureSize();this.items=h;this.load=f;this.submit=g;this.showWindowByConfig(a)},setLoading:function(a){null!=this.win&&this.win.setLoading(a)},ensureSize:function(){var a=borderLayout.ensureSize(this.width,this.height);this.width=a.width;this.height=a.height},showWindowByConfig:function(a){var b=this;null!=b.win&&b.win.destroy();b.ensureSize();if(null!=b.items||null!=b.formPanel){if(null!=b.items){var c={fileUpload:b.fileUpload,
border:!1,autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"10px"},defaultType:"textfield",defaults:{labelStyle:"overflow: hidden;",labelWidth:150,msgTarget:"under",anchor:"100%"},method:"POST",items:b.items};if(null!=b.panelConfig)for(propertyName in b.panelConfig)c[propertyName]=b.panelConfig[propertyName];null!=b.submit&&null!=b.submit.timeout&&(c.timeout=b.submit.timeout);b.formPanel=Ext.create("Ext.form.Panel",c)}a.formEdit=b.formPanel;var c=[],e=b.submit;if(null==b.overrideButtons){if(null!=
e){var f=null;e instanceof Array?(null!=e[0]&&(f=e[0],c.push({text:b.getSubmitButtonText(e[0]),disabled:b.getButtonDisabled(e[0]),scope:a,handler:function(){b.submitHandler(e[0],a,0,b.extraConfig)}})),null!=e[1]&&c.push({text:b.getSubmitButtonText(e[1]),disabled:b.getButtonDisabled(e[1]),scope:a,handler:function(){b.submitHandler(e[1],a,1,b.extraConfig)}}),null!=e[2]&&c.push({text:b.getSubmitButtonText(e[2]),disabled:b.getButtonDisabled(e[2]),scope:a,handler:function(){b.submitHandler(e[2],a,2,b.extraConfig)}}),
null!=e[3]&&c.push({text:b.getSubmitButtonText(e[3]),disabled:b.getButtonDisabled(e[3]),scope:a,handler:function(){b.submitHandler(e[3],a,2,b.extraConfig)}})):(f=e,c=[{text:b.getSubmitButtonText(e),disabled:b.getButtonDisabled(e),scope:a,handler:function(){b.submitHandler(e,a,0,b.extraConfig)}}]);null!=b.formPanel&&b.formPanel.addListener("afterRender",function(c,e){this.keyNav=Ext.create("Ext.util.KeyNav",{target:this.el,scope:this,enter:{fn:function(c){if("textarea"==c.getTarget().type)return!0;
b.submitHandler(f,a,0,b.extraConfig)},defaultEventAction:!1}})})}c.push({text:b.getCancelButtonText(),scope:a,handler:function(){b.cancelHandler(a,e)}})}else c=b.overrideButtons;if(null!=b.formPanel){c={title:b.title,width:b.width,height:b.height,layout:"fit",plain:!0,modal:!0,items:b.formPanel,buttons:c};if(null!=b.windowConfig)for(propertyName in b.windowConfig)c[propertyName]=b.windowConfig[propertyName];c.cls="windowConfig bottomButtonsDialog tpspecial";c.bodyBorder=!1;c.margin="0 0 0 0";c.style=
{padding:" 5px 0px 0px 0px"};c.bodyPadding="0px";b.win=Ext.create("Ext.window.Window",c);a.win=b.win;b.win.show()}null!=b.load&&(c=b.load.loadHandler,null==c?(b.formPanel.setLoading(!0),b.formPanel.getForm().load({url:b.load.loadUrl,params:b.load.loadUrlParams,scope:a,success:function(c,e){null!=b.postDataProcess&&b.postDataProcess.call(a,e.result.data,b.formPanel,b.extraConfig);b.formPanel.setLoading(!1)},failure:function(a,c){b.formPanel.setLoading(!1);Ext.MessageBox.show({title:this.failureTitle,
msg:c.response.responseText,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR});b.formPanel.setLoading(!1)}})):c.call(a,b.load.loadUrl,b.load.loadUrlParams))}},submitHandler:function(a,b,c,e){var f=a.submitUrl,g=a.submitUrlParams,h=a.submitHandler,k=this,l=function(e,f){a.loading&&k.formPanel.setLoading(!1);k.disableSubmitButton(b.win,!1,c);var g=f.result;null!=g&&(g.success?(null!=a.refreshAfterSubmit&&!0!=a.refreshAfterSubmit||k.refreshHandler(b,g,a),null!=a.closeAfterSubmit&&!0!=a.closeAfterSubmit||
k.win.close()):com.trackplus.util.showError(g))},m=function(e,f){a.loading&&k.formPanel.setLoading(!1);k.disableSubmitButton(b.win,!1,c);result=f.result;if(null!=result){var h=result.errorCode,l=result.title;null==h||4!=h&&5!=h?(errors=result.errors,null!=errors?e.markInvalid(errors):(h=result.errorMessage,null!=h?com.trackplus.util.showError(result):com.trackplus.util.submitFailureHandler(e,f))):4==h?(h=result.errorMessage,Ext.MessageBox.confirm(l,h,function(e){if("no"==e)return!1;g.confirmSave=
!0;k.submitHandler(a,b,c)},this)):5==h&&b.recommendedReplace.call(b,k,a,result)}null!=a.specialSubmitFailHandler&&a.specialSubmitFailHandler.call(b,result)};if(null!=a.validateHandler){var n=a.validateHandler.call(b,a);if(null!=n&&!n)return}null!=k.preSubmitProcess&&(g=k.preSubmitProcess.call(b,g,k.formPanel,a.submitAction));n=a.standardSubmit;null!=n&&(k.formPanel.getForm().standardSubmit=n);var p=a.timeout;null!=p&&(k.formPanel.getForm().timeOut=p);null==h?(a.loading&&k.formPanel.setLoading(!0),
this.disableSubmitButton(b.win,!0,c),k.formPanel.getForm().submit({url:f,params:g,method:"POST",scope:b,success:l,failure:m})):h.call(b,k.win,f,g,e);n&&k.formPanel.getForm().isValid()&&(null!=a.submitMessage&&CWHF.showMsgInfo(a.submitMessage),Ext.defer(function(){k.disableSubmitButton(b.win,!1,c)},1E3))},disableSubmitButton:function(a,b,c){a=a.getDockedItems('toolbar[dock\x3d"bottom"]');null!=a&&0<a.length&&(null==c&&(c=0),a[0].getComponent(c).setDisabled(b))},refreshHandler:function(a,b,c){if(null!=
c&&null!=c.refreshAfterSubmitHandler){var e=c.refreshParametersBeforeSubmit;null==e&&(e={});null!=c.refreshParametersAfterSubmit&&null!=b&&Ext.each(c.refreshParametersAfterSubmit,function(a){e[a.parameterName]=b[a.fieldNameFromResult]});c.refreshAfterSubmitHandler.call(a,e,b)}}});
com.trackplus.util.requestFailureHandler=function(a,b){getText("common.err.failure");var c="status: "+a.status+" statusText: "+a.statusText+" responseText: "+a.responseText;null!=a.statusText&&""!=a.statusText&&Ext.MessageBox.show({title:getText("common.err.failure"),msg:c,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})};
com.trackplus.util.submitFailureHandler=function(a,b){var c=getText("common.err.failure");switch(b.failureType){case Ext.form.action.Action.CLIENT_INVALID:Ext.Msg.alert(c,getText("common.err.failure.validate"));break;case Ext.form.action.Action.CONNECT_FAILURE:Ext.Msg.alert(c,getText("common.err.failure.ajax"));break;case Ext.form.action.Action.SERVER_INVALID:decodedResult=b.result,null!=decodedResult?com.trackplus.util.showError(decodedResult):com.trackplus.util.requestFailureHandler(b.response)}};
com.trackplus.util.showError=function(a){if(null!=a){var b="",c=a.title,e=a.errorCode,f=!1;null!=e&&(f=!0,b+=getText("common.err.failure.errorCode")+": "+e);var g=a.errorMessage;null!=g&&(f=!0,b+=g);var h=a.message;null!=h&&(f=!0,b+=h);null==c&&(c=null!=g||null!=e?getText("common.err.failure"):getText("common.lbl.message"));if(!f)for(propertyName in a)b+=propertyName+" "+a[propertyName]+" ";Ext.MessageBox.show({title:c,msg:b,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})}};
Ext.define("js.ext.com.track.speedometerPlugin.SpeedometerAxis",{extend:"Ext.chart.axis.Gauge",alias:"axis.kpigauge",position:"left",drawAxis:function(a){var b=this.chart;a=b.surface;var c=b.chartBBox,e=c.x+c.width/2,f=c.y+c.height,g=this.margin||10,c=Math.min(c.width,2*c.height)/2+g,h=[],k=this.steps,l,m=Math.PI,n=Math.cos,p=Math.sin;if(this.sprites&&!b.resizing)this.drawLabel();else{if(0<=this.margin)if(this.sprites)for(h=this.sprites,l=0;l<=k;l++)h[l].setAttributes(Ext.apply({path:["M",e+(c-g)*
n(l/k*m-m),f+(c-g)*p(l/k*m-m),"L",e+c*n(l/k*m-m),f+c*p(l/k*m-m),"Z"]},this.axisStyle),!0);else for(l=0;l<=k;l++)b=a.add(Ext.apply({type:"path",path:["M",e+(c-g)*n(l/k*m-m),f+(c-g)*p(l/k*m-m),"L",e+c*n(l/k*m-m),f+c*p(l/k*m-m),"Z"]},this.axisStyle)),b.setAttributes({hidden:!1},!0),h.push(b);this.sprites=h;this.drawLabel();this.title&&this.drawTitle()}},drawLabel:function(){var a=this.chart,b=a.surface,c=a.chartBBox,a=c.x+c.width/2,e=c.y+c.height,f=this.margin||10,c=Math.min(c.width,2*c.height)/2+2*
f,f=Math.round,g=this.labelGroup,h=this.maximum||0,k=this.minimum||0,l=this.steps,m=0,n=Math.PI,p=Math.cos,q=Math.sin,t,r;this.label.renderer=this.label.renderer||Ext.identityFn;for(m=0;m<=l;m++)t=g.getAt(m),r=0===m||m===l?7:0,x=a+c*p(m/l*n-n),y=e+c*q(m/l*n-n)-r,text=this.label.renderer(f(k+m/l*(h-k))),t?t.setAttributes(Ext.apply({text:text,x:x,y:y},this.label),!0):(t=b.add(Ext.apply({group:g,type:"text",x:x,y:y,text:text,zIndex:10,"text-anchor":"middle"},this.label)),b.renderItem(t));t.setAttributes({hidden:!1},
!0)}});
Ext.define("js.ext.com.track.speedometerPlugin.SpeedometerSeries",{extend:"Ext.chart.series.Gauge",alias:"series.kpigauge",type:"kpigauge",needleValue:0,needleValueFill:"#555555",drawSeries:function(){var a=this.chart,b=a.getChartStore(),c=this.group,e=this.chart.animate,f=this.chart.axes.get(0),g=f&&f.minimum||this.minimum||0,h=f&&f.maximum||this.maximum||0,k=this.ranges,l=this.angleField||this.field||this.xField,m=a.surface,n=a.chartBBox,p=+this.donut,q=[],t=this.seriesStyle,a=Math.cos,f=Math.sin,
r,v,u,s,B,A,z,w;Ext.apply(t,this.style||{});this.setBBox();if(b&&b.getCount()&&!this.seriesIsHidden){r=this.centerX=n.x+n.width/2;v=this.centerY=n.y+n.height;this.radius=Math.min(r-n.x,v-n.y);this.slices=n=[];this.items=q=[];this.value||(z=b.getAt(0),this.value=z.get(l));l=this.value;u=0;for(B=k.length;u<B;u++)splitFromAngle=-180*(1-(k[u].from-g)/(h-g)),splitToAngle=-180*(1-(k[u].to-g)/(h-g)),n.push({startAngle:splitFromAngle,endAngle:splitToAngle,rho:this.radius,color:k[u].color});w=0;for(A=n.length;w<
A;w++)u=n[w],s=c.getAt(w),k=Ext.apply({segment:{startAngle:u.startAngle,endAngle:u.endAngle,margin:0,rho:u.rho,startRho:u.rho*+p/100,endRho:u.rho}},Ext.apply(t,{fill:u.color})),B=Ext.apply({},k.segment,{slice:u,series:this,storeItem:z,index:w}),q[w]=B,s||(s=Ext.apply({type:"path",group:c},Ext.apply(t,{fill:u.color})),s=m.add(Ext.apply(s,k))),u.sprite=u.sprite||[],B.sprite=s,u.sprite.push(s),e?(k=this.renderer(s,z,k,w,b),s._to=k,this.onAnimate(s,{to:k})):(k=this.renderer(s,z,Ext.apply(k,{hidden:!1}),
w,b),s.setAttributes(k,!0));this.needle&&(b=-180*(1-(l-g)/(h-g))*Math.PI/180,c=this.needle.pivotRadius||7,this.needleSprite?(e?(this.onAnimate(this.needlePivotSprite,{to:{x:r,y:v}}),this.onAnimate(this.needleSprite,{to:{path:["M",r+0*this.radius/100*a(b),v+-Math.abs(0*this.radius/100*f(b)),"L",r+this.radius*a(b),v+-Math.abs(this.radius*f(b))]}})):(this.needlePivotSprite.setAttributes({type:"circle",fill:this.needle.pivotFill||"#222",radius:this.needle.pivotRadius||7,x:r,y:v}),this.needleSprite.setAttributes({type:"path",
path:["M",r+0*this.radius/100*a(b),v+-Math.abs(0*this.radius/100*f(b)),"L",r+this.radius*a(b),v+-Math.abs(this.radius*f(b))]})),this.valueSprite.setAttributes({type:"text",text:this.needleValue,fill:this.needleValueFill,x:r-0.045*r-c,y:v-this.radius/2})):(this.needlePivotSprite=this.chart.surface.add({type:"circle",fill:this.needle.pivotFill||"#222",radius:c,x:r,y:v}),this.needleSprite=this.chart.surface.add({type:"path",path:["M",r+0*this.radius/100*a(b),v+-Math.abs(0*this.radius/100*f(b)),"L",r+
this.radius*a(b),v+-Math.abs(this.radius*f(b))],"stroke-width":this.needle.width||2,stroke:this.needle.pivotFill||"#222"}),this.valueSprite=this.chart.surface.add({type:"text",text:this.needleValue,fill:this.needleValueFill,font:"18px Arial",x:r-0.045*r-c,y:v-this.radius/2})),this.needlePivotSprite.setAttributes({hidden:!1},!0),this.needleSprite.setAttributes({hidden:!1},!0),this.valueSprite.setAttributes({hidden:!1},!0));delete this.value}else this.hide(),this.items=[]}});
Ext.define("js.ext.com.track.dashboard.BaseConfig",{extend:"Ext.form.Panel",border:!1,margin:"0 0 0 0",autoScroll:!0,bodyStyle:{padding:"10px"},frame:!1,collapsible:!1,titleCmp:null,layout:"anchor",config:{projectID:null,entityType:null,jsonData:{}},defaults:{labelWidth:150,labelAlign:"right",labelSeparator:":",labelStyle:{overflow:"hidden"}},initComponent:function(){this.items=this.createChildren();for(var a=0;a<this.items.length;a++)Ext.apply(this.items[a],this.defaults);this.callParent()},createChildren:function(){var a=
[];this.titleCmp=Ext.create("Ext.form.field.Text",{fieldLabel:getText("title"),labelAlign:"right",anchor:"100%",name:"params.title",value:this.jsonData.title});a.push(this.titleCmp);return a},isValidParams:function(){return!0}});
Ext.define("js.ext.com.track.dashboard.DashboardRenderer",{extend:"Ext.panel.Panel",border:!1,margin:"0 0 5 5",frame:!0,collapsible:!0,bodyPadding:0,padding:0,originalTitle:"",cls:"dashboardField",config:{projectID:null,useRefresh:!0,refreshTime:0,useConfig:!1,jsonData:{}},initComponent:function(){var a=this;a.useConfig=a.jsonData.useConfig;a.useRefresh=!0;a.refreshTime=a.jsonData.refresh;!1===a.jsonData.useRefresh&&(a.useRefresh=!1);haveLocalization(a.jsonData.title)?a.title=getText(a.jsonData.title):
a.title=a.jsonData.title;a.originalTitle=a.title;var b=[];!0==a.useRefresh&&b.push({type:"refresh",tooltip:getText("common.btn.reload"),handler:function(b,e,f){a.refreshDashboard.call(a)}});!0==a.useConfig&&b.push({type:"gear",tooltip:getText("common.btn.config"),handler:function(){a.configDashboard.call(a)}});Ext.apply(this,{tools:b});a.id="dashboard_"+a.jsonData.dashboardID;a.callParent();0<a.refreshTime&&(a.title=a.originalTitle+" ("+a.refreshTime/1E3+" s)",setTimeout(function(a){a.refreshDashboard()},
a.refreshTime,a))},createErrorCmp:function(a){return Ext.create("Ext.Component",{cls:"infoBox1",html:a})},changeToError:function(a){this.removeAll();this.add(this.createErrorCmp(a))},refreshErrorHandler:function(){this.changeToError(getText("cockpit.err.tooManyItems"))},refreshDashboard:function(a){var b=this,c=com.trackplus.TrackplusConfig.contextPath+"/dashboardAJAX.action?dashboardID\x3d"+b.jsonData.dashboardID+"\x26projectID\x3d"+b.jsonData.projectID+"\x26releaseID\x3d"+b.jsonData.releaseID;b.setLoading(!0);
Ext.Ajax.request({url:c,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);b.setLoading(!1);!0==a.data.tooManyItems?b.refreshErrorHandler():(b.doRefresh.call(b,a.data),b.refreshTime=b.jsonData.refresh,0<b.refreshTime&&setTimeout(function(a){a.refreshDashboard()},b.refreshTime,b),b.setTitle(b.updateTitle.call(b)))},failure:function(a){b.setLoading(!1)},method:"POST",params:a})},updateTitle:function(){var a=this.originalTitle;0<this.refreshTime&&(a=this.originalTitle+" ("+this.refreshTime/
1E3+" s)");return a},createParamsMap:function(){return{}},doRefresh:function(a){},configDashboard:function(){var a=this,b=a.jsonData.projectID,c=a.jsonData.entityType,e=a.jsonData.dashboardID;com.trackplus.dashboard.openConfigDialog(e,null!=b?"dashboardParamsConfig.action?projectID\x3d"+b+"\x26entityType\x3d"+c+"\x26dashboardID\x3d"+e:"dashboardParamsConfig.action?dashboardID\x3d"+e,b,c,function(){a.refreshDashboard.call(a)})},addAll:function(a,b){if(null!=b&&0<b.length)for(var c=0;c<b.length;c++)a.push(b[c]);
return a}});Ext.define("js.ext.com.track.dashboard.Error",{extend:"js.ext.com.track.dashboard.DashboardRenderer",initComponent:function(){this.html=this.createHtmlString();this.callParent()},createHtmlString:function(){var a;return a='\x3cdiv style\x3d"height:100%;width:100%;padding:5px;"\x3e\x3ci\x3eNo js class  found!\x3c/i\x3e\x3c/div\x3e'},doRefresh:function(a){this.jsonData=a;this.update(this.createHtmlString())}});
com.trackplus.dashboard.createPercentGroup=function(a,b,c){null!=a&&b.unshift({label:a,h2:!0,category:!0});a=Ext.create("Ext.data.Store",{fields:[{name:"label"},{name:"number",type:"int"},{name:"width",type:"int"},{name:"percent",type:"int"},{name:"groupByFieldType",type:"int"},{name:"projectID",type:"int",useNull:!0},{name:"releaseID",type:"int",useNull:!0},{name:"openOnly",type:"boolean"},{name:"groupByField",type:"int"},{name:"icon"},{name:"percentLate",type:"int"},{name:"category",type:"boolean"},
{name:"h2",type:"boolean"},{name:"widthLate",type:"int"}],data:b});return Ext.create("Ext.grid.Panel",{store:a,columns:[{xtype:"linkcolumn",text:"label",width:175,sortable:!1,menuDisabled:!0,dataIndex:"label",align:"right",handler:com.trackplus.dashboard.clickOnLabel,scope:c,isLink:com.trackplus.dashboard.isLabelLink,postProcessRenderer:com.trackplus.dashboard.postProcessRendererLabel},{text:"number",width:70,sortable:!1,menuDisabled:!0,renderer:com.trackplus.dashboard.formatNumber,align:"right",
dataIndex:"number"},{text:"",width:75,sortable:!1,menuDisabled:!0,renderer:com.trackplus.dashboard.formatBars,dataIndex:"percent"},{text:"",width:50,sortable:!1,menuDisabled:!0,renderer:com.trackplus.dashboard.formatPercent,dataIndex:"percent"},{text:"",width:10,flex:1,sortable:!1,menuDisabled:!0}],border:!1,bodyBorder:!1,hideHeaders:!0,columnLines:!1,disableSelection:!0,viewConfig:{stripeRows:!0,trackOver:!1,style:{overflow:"hidden"},getRowClass:function(a,b,c,h){b="";!0==a.data.category&&(b+="dashboardCategoryPercent");
return b}},autoHeight:!0})};com.trackplus.dashboard.updateElementWrapperList=function(a,b){if(null!=a)for(var c,e=0;e<a.length;e++)c=a[e],c.groupByFieldType=b.groupByFieldType,c.projectID=b.projectID,c.releaseID=b.releaseID,c.openOnly=b.openOnly;return a};com.trackplus.dashboard.isLabelLink=function(a,b,c,e,f,g,h){return!0!=c.data.category};
com.trackplus.dashboard.postProcessRendererLabel=function(a,b,c,e,f,g,h){b="";!0==c.data.category?(b='\x3cdiv style\x3d"text-align:left;overflow: visible;"\x3e',b=!0==c.data.h2?b+("\x3ch2\x3e"+a+"\x3c/h2\x3e"):b+("\x3cB\x3e"+a+"\x3c/B\x3e"),b+="\x3c/div\x3e"):b=a;return b};
com.trackplus.dashboard.clickOnLabel=function(a,b){var c=a.data.groupByFieldType,e=a.data.projectID,f=a.data.releaseID,g=a.data.openOnly,h=a.data.groupByField,k={queryType:2,queryID:this.jsonData.dashboardID,"dashboardParams.dashboardID":this.jsonData.dashboardID},l=null;null==e&&null==f?(e=this.jsonData.projectID,f=this.jsonData.releaseID,l=this.jsonData.entityType,null!=l&&9==l&&null!=f&&(e=f)):null!=f?(l=9,e=f):l=1;null==g&&(g=!1);k["dashboardParams.groupByFieldType"]=c;k["dashboardParams.groupByField"]=
h;k["dashboardParams.projectID"]=e;k["dashboardParams.entityFlag"]=l;k["dashboardParams.openOnly"]=g;Ext.create("Ext.form.Panel",{items:[],url:"itemNavigator.action",standardSubmit:!0}).getForm().submit({params:k})};com.trackplus.dashboard.formatNumber=function(a,b,c,e,f,g,h){return c.data.category?"":a};
com.trackplus.dashboard.formatBars=function(a,b,c,e,f,g,h){a="";return a=c.data.category?"":'\x3cdiv class\x3d"barWrapper"\x3e \x3cimg src\x3d"'+com.trackplus.TrackplusConfig.iconsPath+'BlueBar.gif" width\x3d"'+c.data.width+'" height\x3d"10" alt\x3d"BlueBar"\x3e\x3cimg src\x3d"'+com.trackplus.TrackplusConfig.iconsPath+'RedBar.gif" width\x3d"'+c.data.widthLate+'" height\x3d"10" alt\x3d"RedBar"\x3e\x3c/div\x3e'};
com.trackplus.dashboard.formatPercent=function(a,b,c,e,f,g,h){b="";return b=c.data.category?"":a+"%"};com.trackplus.dashboard.reload=function(a){var b=Ext.getCmp("dashboard_"+a),c=[];if(1<arguments.length)for(var e=1;e<arguments.length;e++)c.push(arguments[e]);c=b.createParamsMap.apply(b,c);b.refreshDashboard.call(b,c)};
com.trackplus.dashboard.createReportTreeCfg=function(a,b,c,e,f){e={anchor:"100%",margin:"0 0 5 0"};if(null!=f)for(var g in f)"labelAlign"!=g&&"labelWidth"!=g&&(e[g]=f[g]);e.useRemoveBtn=!1;e.useNull=!0;e.useTooltip=!1;var h=CWHF.createMultipleTreePicker(a,b,[],c,e);Ext.Ajax.request({url:"categoryPicker.action",params:{node:"report",useChecked:!0},success:function(a){a=Ext.decode(a.responseText);h.updateData(a);h.setValue(c)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}});return h};
com.trackplus.dashboard.createReleaseTreeCfg=function(a,b,c,e){var f={};if(null!=e)for(var g in e)"labelAlign"!=g&&"labelWidth"!=g&&(f[g]=e[g]);f.useRemoveBtn=!1;f.useNull=!0;f.useTooltip=!1;var h=CWHF.createMultipleTreePicker(a,b,[],c,f);Ext.Ajax.request({url:"releasePicker.action",params:{useChecked:!0},success:function(a){a=Ext.decode(a.responseText);h.updateData(a);h.setValue(c)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}});return h};
com.trackplus.dashboard.wrapLabelAndTree=function(a,b){return Ext.create("Ext.container.Container",{border:!1,layout:{type:"hbox",pack:"start",align:"stretch"},items:[a,b]})};com.trackplus.dashboard.getLabelCmp=function(a,b,c){return Ext.create("Ext.Component",{cls:"right"==b?"x-form-item-label-right x-form-item-label":"x-form-item-label",style:{marginRight:"5px"},html:a+":",width:c})};
com.trackplus.dashboard.createReleasePickerCfg=function(a,b,c,e){var f={labelAlign:"right",labelWidth:100,anchor:"100%",margin:"0 0 5 0"};if(null!=e)for(var g in e)f[g]=e[g];var h=CWHF.createSingleTreePicker(a,b,[],c,f);Ext.Ajax.request({url:"releasePicker.action",success:function(a){a=Ext.decode(a.responseText);h.updateData(a);h.setValue(c)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}});return h};
com.trackplus.dashboard.createMultipleReleasePickerCfg=function(a,b,c,e){var f={labelAlign:"right",labelWidth:100,anchor:"100%",margin:"0 0 5 0"};if(null!=e)for(var g in e)f[g]=e[g];var h=CWHF.createMultipleTreePicker(a,b,[],c,f);Ext.Ajax.request({url:"releasePicker.action",success:function(a){a=Ext.decode(a.responseText);h.updateData(a);h.setValue(c)},failure:function(a){com.trackplus.util.requestFailureHandler(a)},params:{useChecked:!0}});return h};
com.trackplus.dashboard.createFilterPickerCfg=function(a,b,c,e){var f={allowBlank:!1,labelWidth:100,labelAlign:"right",anchor:"100%",margin:"0 0 5 0"};if(null!=e)for(var g in e)f[g]=e[g];var h=CWHF.createSingleTreePicker(a,b,[],c,f);Ext.Ajax.request({url:"categoryPicker.action",params:{node:"issueFilter"},success:function(a){a=Ext.decode(a.responseText);h.updateData(a);h.setValue(c)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}});return h};
com.trackplus.dashboard.createMultiSelectConfig=function(a,b,c,e,f){a={fieldLabel:a,labelAlign:"right",name:b,store:Ext.create("Ext.data.Store",{data:c,fields:[{name:"id",type:"int"},{name:"label",type:"string"}],autoLoad:!1}),border:!0,bodyBorder:!1,displayField:"label",valueField:"id",value:e,width:300,height:125};if(null!=f)for(var g in f)a[g]=f[g];return Ext.create("Ext.ux.form.MultiSelect",a)};
com.trackplus.dashboard.createSelectConfig=function(a,b,c,e,f,g){return Ext.create("Ext.form.ComboBox",{fieldLabel:a,hideLabel:null==a,name:b,store:Ext.create("Ext.data.Store",{data:null==c?[]:c,fields:[{name:"id",type:"int"},{name:"label",type:"string"}],autoLoad:!1}),border:!1,bodyBorder:!1,displayField:"label",valueField:"id",queryMode:"local",value:e,width:null==a?150:300,labelAlign:"right",listeners:{change:function(a,b,c,e){null!=f&&f.call(g,a,b,c,e)}}})};
com.trackplus.dashboard.createMultiSelectComboConfig=function(a,b,c,e,f,g){return Ext.create("Ext.form.ComboBox",{fieldLabel:a,hideLabel:null==a,name:b,store:Ext.create("Ext.data.Store",{data:null==c?[]:c,fields:[{name:"id",type:"int"},{name:"label",type:"string"}],autoLoad:!1}),border:!1,bodyBorder:!1,displayField:"label",valueField:"id",queryMode:"local",value:e,width:null==a?150:300,labelAlign:"right",multiSelect:!0,listeners:{change:function(a,b,c,e){null!=f&&f.call(g,a,b,c,e)}}})};
com.trackplus.dashboard.createRadioGroupConfig=function(a,b,c,e,f,g){var h=[];if(null!=c)for(var k=0;k<c.length;k++)h.push({name:b,inputValue:c[k].id,boxLabel:c[k].label,checked:c[k].id==e});return Ext.create("Ext.form.RadioGroup",{fieldLabel:a,labelStyle:{overflow:"hidden"},labelWidth:100,labelAlign:"right",anchor:"100%",layout:"hbox",defaults:{margin:"0 5 0 0"},listeners:{change:function(a,b,c,e){null!=f&&f.call(g,a,b,c,e)}},items:h})};var dashboardCfgWin;
com.trackplus.dashboard.showConfigDialog=function(a,b,c,e,f,g){var h=600,k=400,l=getText("cockpit.screenEdit.config.title");null!=dashboardCfgWin&&dashboardCfgWin.destroy();var m=b.cfgClass,n=b.jsonData.prefWidth,p=b.jsonData.prefHeight;null!=n&&(h=n);null!=p&&(k=p);var q=Ext.create(m,{projectID:b.projectID,entityType:b.entityType,jsonData:b.jsonData,bodyStyle:{padding:"10px"}});b=borderLayout.ensureSize(h,k);h=b.width;k=b.height;dashboardCfgWin=Ext.create("Ext.window.Window",{layout:"fit",width:h,
height:k,iconCls:"btnConfig16",cls:"bottomButtonsDialog",border:!1,bodyBorder:!0,margin:"0 0 0 0",style:{padding:"5px 0px 0px 0px"},closeAction:"hide",plain:!0,title:l,modal:!0,items:q,autoScroll:!1,buttons:[{text:getText("common.btn.save"),handler:function(){saveDashParams(a,q,c,e,f,g)}},{text:getText("common.btn.close"),handler:function(){dashboardCfgWin.hide()}}]});dashboardCfgWin.show()};
com.trackplus.dashboard.openConfigDialog=function(a,b,c,e,f,g){borderLayout.setLoading(!0);Ext.Ajax.request({url:b,success:function(b){b=Ext.decode(b.responseText);com.trackplus.dashboard.showConfigDialog(a,b.data,c,e,f,g);borderLayout.setLoading(!1)},failure:function(a){alert("failed to open config dashboard");borderLayout.setLoading(!1)}})};
function saveDashParams(a,b,c,e,f,g){var h="",h=null!=c?"dashboardParamsConfig!save.action?projectID\x3d"+c+"\x26entityType\x3d"+e+"\x26dashboardID\x3d"+a:"dashboardParamsConfig!save.action?dashboardID\x3d"+a;if(!b.isValidParams.call(b))return!1;dashboardCfgWin.setLoading(!0);b.getForm().submit({url:h,success:function(a,b){dashboardCfgWin.setLoading(!1);dashboardCfgWin.hide();null!=f&&f.call(g)},failure:function(a,b){dashboardCfgWin.setLoading(!1)}})}
Ext.define("com.trackplus.screen.DashboardFieldErrorView",{extend:"com.trackplus.screen.FieldErrorView",margin:"0 0 5 5",frame:!0,style:{borderColor:"red"},collapsible:!0,padding:0,title:"Dashboard field error"});Ext.define("com.trackplus.screen.DashboardTabView",{extend:"com.trackplus.screen.TabView",layout:{type:"anchor"},defaults:{anchor:"100%"},autoScroll:!0,bodyStyle:{}});
Ext.define("com.trackplus.screen.DashboardPanelView",{extend:"com.trackplus.screen.PanelView",getPanelConfig:function(a,b,c){c="0 5 2 0";0==b&&(c="5 5 2 0");return{style:{overflow:"hidden"},border:!1,margin:c,cls:"dashboardPanel",layout:{type:"table",columns:a.colsNo,tableAttrs:{style:{width:"100%",tableLayout:"fixed"}},tdAttrs:{style:{"vertical-align":"top"}}},defaults:{frame:!1,border:!1}}}});
Ext.define("com.trackplus.layout.HomeLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,screenModel:null,screenFacade:null,selectedGroup:"cockpit",constructor:function(a){var b=this;b.callParent(arguments);b.screenModel=com.trackplus.screen.createScreenModel(b.initData.screen);b.screenFacade=Ext.create("com.trackplus.screen.BaseScreenFacade",{screenModel:b.screenModel,showOneTab:!0,lastSelectedTab:b.initData.lastSelectedTab,refreshTabUrl:"dashboardTabRuntime!execute.action",storeTabUrl:"dashboard!storeLastSelectedTab.action",
tabViewCls:"com.trackplus.screen.DashboardTabView",panelViewCls:"com.trackplus.screen.DashboardPanelView",fieldErrorCls:"com.trackplus.screen.DashboardFieldErrorView"});b.borderLayoutController.setHelpContext("dashboard");b.onReady(function(){if(com.trackplus.TrackplusConfig.user.configureCockpit){var a=[b.createEditDashButton()];com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&(a.push(b.createResetDashButton()),a.push(b.createSaveAsTemplateDashButton()));b.borderLayoutController.setActiveToolbarList.call(b.borderLayoutController,
a)}})},createCenterPanel:function(){return this.screenFacade.createViewComponent.call(this.screenFacade)},createEditDashButton:function(){var a=this;return Ext.create("Ext.button.Button",{xtype:"button",overflowText:getText("cockpit.config"),tooltip:getText("cockpit.config.tt"),text:getText("cockpit.config"),iconCls:"cockpitEdit",disabled:!1,handler:function(){a.editDashboard()}})},createResetDashButton:function(){var a=this;return Ext.create("Ext.button.Button",{xtype:"button",overflowText:getText("cockpit.reset"),
tooltip:getText("cockpit.reset"),text:getText("cockpit.reset"),iconCls:"cockpitReset",disabled:!1,handler:function(){a.resetDashboard()}})},createSaveAsTemplateDashButton:function(){var a=this;return Ext.create("Ext.button.Button",{xtype:"button",overflowText:getText("cockpit.saveAsTemplate"),tooltip:getText("cockpit.saveAsTemplate.tooltip"),text:getText("cockpit.saveAsTemplate"),iconCls:"cockpitSave",disabled:!1,handler:function(){a.saveAsDefault()}})},editDashboard:function(){window.location.href=
"dashboardEdit.action?backAction\x3dcockpit.action"},resetDashboard:function(){com.trackplus.dashboard.resetDashboard("dashboardTemplate!resetDashboard.action",{},this.resetDashboardSuccess,this)},resetDashboardSuccess:function(){window.location.href="cockpit.action"},saveAsDefault:function(){com.trackplus.dashboard.saveAsDefault()}});com.trackplus.dashboard.resetWin=null;
com.trackplus.dashboard.resetDashboard=function(a,b,c,e){borderLayout.setLoading(!0);Ext.Ajax.request({url:"dashboardTemplate!loadNotAssigned.action",disableCaching:!0,success:function(f){f=Ext.decode(f.responseText).data;borderLayout.setLoading(!1);com.trackplus.dashboard.openResetDialog(f,a,b,c,e)},failure:function(){borderLayout.setLoading(!1)}})};
com.trackplus.dashboard.openResetDialog=function(a,b,c,e,f){a=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},{name:"label",type:"string"},{name:"selected",type:"bool"}],data:a});var g=Ext.create("Ext.form.ComboBox",{store:a,queryMode:"local",displayField:"label",valueField:"id",editable:!1,name:"resetID",fieldLabel:getText("cockpit.reset.lbl.defaultCockpit"),labelStyle:{overflow:"hidden"},labelAlign:"right",labelWidth:150,anchor:"100%"}),h=Ext.create("Ext.button.Button",{text:getText("common.btn.delete"),
disabled:!0,handler:function(){borderLayout.setLoading(!0);var a=g.getValue(),b=getText("common.lbl.messageBox.removeSelected.confirm"),c=getText("common.btn.delete");getText("common.btn.ok");Ext.MessageBox.show({title:c,msg:b,buttons:Ext.MessageBox.YESNO,fn:function(b){"yes"==b&&Ext.Ajax.request({url:"dashboardAssign!delete.action",disableCaching:!0,success:function(){Ext.Ajax.request({url:"dashboardTemplate!loadNotAssigned.action",disableCaching:!0,success:function(a){a=Ext.decode(a.responseText).data;
h.setDisabled(!0);g.setValue(null);g.getStore().loadData(a);borderLayout.setLoading(!1)},failure:function(){borderLayout.setLoading(!1)}})},failure:function(){borderLayout.setLoading(!1)},method:"POST",params:{deletedItems:a}})},icon:Ext.MessageBox.QUESTION})}});g.addListener("select",function(a,b,c){null!=b&&0<b.length?h.setDisabled(!b[0].data.selected):h.setDisabled(!0)});var k=Ext.create("Ext.form.Panel",{layout:"anchor",standardSubmit:!1,bodyBorder:!1,border:!1,autoScroll:!1,margin:"0 0 0 0",
bodyStyle:{padding:"10px 10px 5px 10px"},items:[g]});null!=com.trackplus.dashboard.resetWin&&com.trackplus.dashboard.resetWin.destroy();com.trackplus.dashboard.resetWin=Ext.create("Ext.window.Window",{layout:"fit",width:400,height:115,minWidth:360,minHeight:115,closeAction:"destroy",plain:!0,title:getText("cockpit.reset"),modal:!0,cls:"bottomButtonsDialog",border:!1,bodyBorder:!0,margin:"0 0 0 0",style:{padding:"5px 0px 0px 0px"},bodyPadding:"0px",autoScroll:!1,items:[k],buttons:[{text:getText("common.btn.ok"),
handler:function(){k.getForm().submit({url:b,params:c,success:function(a,b){com.trackplus.dashboard.resetWin.destroy();null!=e&&e.call(null==f?this:f)},failure:function(a,b){alert("failure")}})}},h,{text:getText("common.btn.cancel"),handler:function(){com.trackplus.dashboard.resetWin.destroy()}}]});com.trackplus.dashboard.resetWin.show()};
com.trackplus.dashboard.saveAsDefault=function(a,b,c,e){c="dashboardTemplate!copyAsTemplateDashboard.action";null!=a&&(c=c+"?projectID\x3d"+a+"\x26entityType\x3d"+b);borderLayout.setLoading(!0);Ext.Ajax.request({url:c,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);borderLayout.setLoading(!1);com.trackplus.dashboard.openSaveAsDefaultDialog(a.data)},failure:function(){borderLayout.setLoading(!1)}})};
com.trackplus.dashboard.openSaveAsDefaultDialog=function(a,b,c){a=[CWHF.createHiddenField("dashboardID",{labelWidth:150,value:a.id}),CWHF.createTextField("common.lbl.name","name",{labelWidth:150,anchor:"100%",allowBlank:!1,value:a.name}),CWHF.createTextAreaField("common.lbl.description","description",{labelWidth:150,anchor:"100%",value:a.description})];var e=Ext.create("Ext.form.Panel",{layout:"anchor",standardSubmit:!1,bodyBorder:!1,border:!1,autoScroll:!1,margin:"0 0 0 0",bodyStyle:{padding:"10px 10px 5px 10px"},
defaults:{labelStyle:"overflow: hidden;",labelWidth:150,msgTarget:"under",anchor:"100%"},items:a});null!=com.trackplus.dashboard.resetWin&&com.trackplus.dashboard.resetWin.destroy();com.trackplus.dashboard.resetWin=Ext.create("Ext.window.Window",{layout:"fit",width:500,height:300,minWidth:400,minHeight:300,closeAction:"destroy",plain:!0,title:getText("cockpit.saveAsTemplate"),modal:!0,cls:"bottomButtonsDialog",border:!1,bodyBorder:!0,margin:"0 0 0 0",style:{padding:"5px 0px 0px 0px"},bodyPadding:"0px",
autoScroll:!1,items:[e],buttons:[{text:getText("common.btn.ok"),handler:function(){e.getForm().submit({url:"dashboardTemplate!saveAsTemplateDashboard.action",success:function(a,e){com.trackplus.dashboard.resetWin.destroy();null!=b?b.call(null==c?this:c):CWHF.showMsgInfo(getText("cockpit.saveAsTemplate.successMessage"))},failure:function(a,b){alert("failure")}})}},{text:getText("common.btn.cancel"),handler:function(){com.trackplus.dashboard.resetWin.destroy()}}]});com.trackplus.dashboard.resetWin.show()};
Ext.define("js.ext.com.track.dashboard.DashboardFieldEditWrapper",{extend:"com.trackplus.screen.FieldEditWrapperView",emptyText:getText("cockpit.screenEdit.lbl.emptyField"),getFieldCls:function(){return"dashboardDesignField"},getFieldWrapperConfig:function(){return this.model.empty?this.callParent():{border:!0,margin:"0 0 5 5",frame:!0,collapsible:!1,bodyPadding:2,padding:0,title:this.model.name}}});
Ext.define("com.trackplus.screen.DashboardEditPanelView",{extend:"com.trackplus.screen.PanelView",getPanelConfig:function(a,b,c){this.myComponentCls="screenDesignPanel";return{cls:"screenDesignPanel",style:{overflow:"hidden"},border:!0,bodyPadding:2,margin:"0 0 5 0",layout:{type:"table",columns:a.colsNo,tableAttrs:{style:{width:"100%"}},tdAttrs:{width:100/a.colsNo+"%",style:{"vertical-align":"top"}}},defaults:{frame:!1,border:!1}}}});
Ext.define("com.trackplus.screen.DashboardScreenEditController",{extend:"com.trackplus.screen.ScreenEditController",isConfigurableItem:function(){return"Field"==this.selectedComponent.model.type},configItem:function(){var a=this.selectedComponent.model;"Field"==a.type&&(a=a.getId(),com.trackplus.dashboard.openConfigDialog(a,this.configURL+a))}});
Ext.define("com.trackplus.layout.DashboardEditLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,screenEditFacade:null,screenModel:null,constructor:function(a){var b=this;b.callParent(arguments);b.borderLayoutController.setHelpContext("dashboardEdit");b.screenModel=com.trackplus.screen.createScreenModel(b.initData.screen);b.screenEditFacade=Ext.create("com.trackplus.screen.ScreenEditFacade",{screenModel:b.screenModel,refreshTabUrl:"dashboardTab!reload.action",controllerCls:"com.trackplus.screen.DashboardScreenEditController",
fieldWrapperCls:"js.ext.com.track.dashboard.DashboardFieldEditWrapper",panelViewCls:"com.trackplus.screen.DashboardEditPanelView",urlFieldList:"dashboardPluginList!list.action",titleFieldList:getText("cockpit.screenEdit.lbl.views"),useConfig:!0,configURL:b.initData.configURL,screenAction:"dashboardEdit",screenUpdateAction:"updateDashboardScreenProperty",tabAction:"dashboardTab",tabUpdateAction:"updateDashboardTabProperty",panelAction:"dashboardPanel",panelUpdateAction:"updateDashboardPanelProperty",
fieldAction:"dashboardField",fieldUpdateAction:"updateDashboardFieldProperty",messageDeletePanel:getText("cockpit.screenEdit.question.deletePanel"),messageDeleteTab:getText("cockpit.screenEdit.question.deleteTab"),messageDeleteField:getText("cockpit.screenEdit.question.deleteField"),messageCantDeleteScreen:getText("cockpit.screenEdit.message.cantDeleteScreen"),messageCantDeleteLastTab:getText("cockpit.screenEdit.message.cantDeleteLastTab"),backAction:b.initData.backAction});b.onReady(function(){var a=
b.screenEditFacade.getToolbar.call(b.screenEditFacade);b.borderLayoutController.setActiveToolbarActionList(a)})},createCenterPanel:function(){return this.screenEditFacade.createScreenEditViewComponent.call(this.screenEditFacade)}});
Ext.define("Ext.ux.LinkComponent",{extend:"Ext.Component",alias:["widget.linkcomponent"],config:{handler:null,scope:null,clsLink:"synopsis_blue",label:"",prefix:null,suffix:null},initComponent:function(){var a=this;a.initHTML();a.callParent();a.addListener("afterrender",function(b){b.getEl().addListener("click",a.elementClick,a)},a)},initHTML:function(){null!=this.label?(this.html='\x3ca class\x3d"'+this.clsLink+'" href\x3d"javascript:void(0)"\x3e'+this.label+"\x3c/a\x3e",null!=this.prefix&&(this.html=
this.prefix+this.html),null!=this.suffix&&(this.html+=this.suffix)):this.html=""},setLabel:function(a){this.label=a;this.initHTML();this.update(this.html)},setClsLink:function(a){this.clsLink=a;this.initHTML();this.update(this.html)},elementClick:function(a){if(-1!=a.getTarget().className.indexOf(this.clsLink))return null!=this.handler&&this.handler.call(this.scope||this),a.stopEvent(),!1},getMyLabel:function(){return this.label}});
Ext.define("Ext.ux.layout.Center",{extend:"Ext.layout.container.Fit",alias:"layout.ux.center",config:{maxWidth:null},percentRe:/^\d+(?:\.\d+)?\%$/,itemCls:"ux-layout-center-item",initLayout:function(){this.callParent(arguments);this.owner.addCls("ux-layout-center")},getItemSizePolicy:function(a){var b=this.callParent(arguments);"number"==typeof a.width&&(b=this.sizePolicies[b.setsHeight?2:0]);return b},getPos:function(a,b,c){a=Math.round((b.targetSize[c]-(a.props[c]+b.margins[c]))/2);return Math.max(a,
0)},getSize:function(a,b,c){var e=a[c];if("number"==typeof e)return e-b.margins[c];e="string"==typeof e&&this.percentRe.test(e)?parseFloat(e)/100:a[c+"Ratio"];return b.targetSize[c]*(e||1)-b.margins[c]},positionItemX:function(a,b){var c=this.getPos(a,b,"width");a.setProp("x",c)},positionItemY:function(a,b){var c=this.getPos(a,b,"height");a.setProp("y",c)},setItemHeight:function(a,b){var c=this.getSize(a.target,b,"height");a.setHeight(c)},setItemWidth:function(a,b){var c=this.getSize(a.target,b,"width");
null!=this.maxWidth&&c>this.maxWidth&&(c=this.maxWidth);a.setWidth(c)}});Ext.define("com.trackplus.ACField",{extend:"Ext.form.field.Text",initComponent:function(){Ext.each(this.fieldSubTpl,function(a,b,c){Ext.isString(a)&&(c[b]=a.replace('autocomplete\x3d"off"','autocomplete\x3d"on"'))});this.callParent(arguments)}});
Ext.define("com.trackplus.logon.LogonPage",{extend:"Ext.Base",config:{context:1,jsonData:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},view:null,controller:null,createCenterPanel:function(){this.controller=Ext.create("com.trackplus.logon.LogonPageController",{model:this.jsonData});this.view=this.controller.createView.call(this.controller);if(isDemo){this.infoMessage=Ext.create("Ext.Component",{html:initData.teaserText,border:!0,cls:"infoBoxDemoSite",region:"north"});
var a=Ext.create("Ext.panel.Panel",{region:"center",cls:"logonPageWrapper",border:!1,baseCls:"x-plain",unstyled:!0,layout:{type:"ux.center",maxWidth:this.controller.WIDTH_COLLAPSED},items:[this.view]});return Ext.create("Ext.panel.Panel",{region:"center",border:!1,baseCls:"x-plain",unstyled:!0,layout:{type:"border",maxWidth:this.controller.WIDTH_COLLAPSED},items:[this.infoMessage,a]})}return Ext.create("Ext.panel.Panel",{region:"center",cls:"logonPageWrapper",border:!1,baseCls:"x-plain",unstyled:!0,
layout:{type:"ux.center",maxWidth:this.controller.WIDTH_COLLAPSED},items:[this.view]})},setFocus:function(){this.controller.setFocus.call(this.controller)}});
Ext.define("com.trackplus.logon.LogonPageView",{extend:"Ext.form.Panel",config:{model:{},controller:null},id:"logonpageview",url:"logon!login.action",standardSubmit:!1,title:getText("common.btn.login"),layout:"border",txtHiddenPassword:null,txtUsername:null,txtPassword:null,linkForgotPassword:null,linkSelfRegistration:null,panelMotd:null,linkExpandMOTD:null,panelMessage:null,toolExpanCollapse:null,initComponent:function(){this.items=this.createChildren();this.height=this.controller.HEIGHT_COLLAPSED;
this.width="100%";this.callParent();this.addListener("afterrender",function(a){})},createChildren:function(){this.txtHiddenPassword=Ext.create("com.trackplus.ACField",{hidden:!0,name:"j_password",inputId:"password"});this.txtUsername=Ext.create("com.trackplus.ACField",{cls:"loginInputField",fieldLabel:getText("logon.lbl.username"),labelAlign:"right",itemId:"j_username",name:"j_username",inputId:"username",allowBlank:!1,validateOnBlur:!1,validateOnChange:!0,tabIndex:1,value:Ext.util.Cookies.get("username"),
blankText:getText("logon.err.username.required")});this.txtPassword=Ext.create("Ext.form.field.Text",{cls:"loginInputField",fieldLabel:getText("logon.lbl.password"),labelAlign:"right",inputType:"password",name:"k_password",itemId:"k_password",allowBlank:!1,validateOnBlur:!1,validateOnChange:!0,submitValue:!1,tabIndex:2,value:Ext.util.Cookies.get("passwd"),blankText:com.trackplus.TrackplusConfig.getText("logon.err.password.required")});this.btnLogin=Ext.create("Ext.button.Button",{text:getText("common.btn.login"),
tabIndex:3,formBind:!0,handler:this.controller.login,scope:this.controller,minWidth:75});com.trackplus.TrackplusConfig.isSelfRegAllowed&&(this.linkSelfRegistration=Ext.create("Ext.ux.LinkComponent",{handler:this.controller.selfRegistration,scope:this.controller,id:"registerLink",clsLink:"registerLink",tabIndex:10,hideMode:"offsets",style:{opacity:0},width:310,label:getText("logon.lbl.register")}));this.linkForgotPassword=Ext.create("Ext.ux.LinkComponent",{handler:this.controller.forgetPassword,scope:this.controller,
id:"pw_forgot",clsLink:"forgotPwd",tabIndex:4,style:{opacity:0},hideMode:"offsets",width:310,label:getText("logon.lbl.passwordForgotten")});this.checkRemeberMe=Ext.create("Ext.form.field.Checkbox",{boxLabel:getText("logon.lbl.remember"),fieldLabel:"\x26nbsp;",labelSeparator:"",labelAlign:"right",cls:"rememberMe",name:"rememberME",style:{opacity:0},hideMode:"offsets",width:310,tabIndex:5,inputValue:!0,checked:"true"==Ext.util.Cookies.get("rememberMe")});this.lbl=Ext.create("Ext.form.Label",{text:"My Awesome Field"});
this.linkExpandMOTD=Ext.create("Ext.ux.LinkComponent",{handler:this.controller.expandMOTD,scope:this.controller,label:getText("logon.lbl.expandMOTD"),clsLink:"expandMOTD",tabIndex:6,style:{textAlign:"left",whiteSpace:"nowrap",padding:"0px 5px 0px 10px",margin:"2px 0 2px 0"}});var a=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",padding:"0",align:"left"},id:"usernamePanel",height:42,width:310,border:!1,bodyBorder:!1,items:[this.txtUsername,this.checkRemeberMe]}),b=[];b.push(this.txtPassword);b.push(this.linkForgotPassword);
null!=this.linkSelfRegistration&&b.push(this.linkSelfRegistration);var b=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",padding:"0",align:"left"},id:"passwordPanel",height:58,width:310,border:!1,bodyBorder:!1,items:b}),c=[];c.push(this.txtHiddenPassword);c.push(a);c.push(b);a={xtype:"panel",region:"center",layout:"hbox",border:!1,bodyBorder:!1,bodyPadding:"5 0 5 5",margin:"15 0 0 0",cls:"loginPanel",items:c};this.linkArea=Ext.create("Ext.panel.Panel",{border:!1,bodyBorder:!1,id:"linkArea",autoScroll:!1,
region:"center",layout:"hbox",bodyPadding:5,items:[]});this.panelMessage=Ext.create("Ext.panel.Panel",{border:!1,bodyBorder:!1,id:"panelMessage",html:this.model.teaserText,autoScroll:!1,region:"center",flex:1});this.panelMotd=Ext.create("Ext.panel.Panel",{region:"center",cls:"motd",border:!1,bodyBorder:!1,autoScroll:!0,html:""});b=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"left",padding:"19 5 5 0"},minWidth:100,border:!1,bodyBorder:!1,region:"east",cls:"tpspecial",items:[this.btnLogin]});
c=[];this.teaserText=Ext.create("Ext.Component",{html:this.model.teaserText,cls:"versionInfoLabel",margin:"0 25 0 0",style:{overflow:"hidden",whiteSpace:"nowrap"},flex:1});c.push(this.teaserText);c.push(this.linkExpandMOTD);c=Ext.create("Ext.panel.Panel",{layout:"hbox",border:!1,bodyBorder:!1,region:"south",cls:"panelTeaser",height:42,bodyPadding:"10 0 0 20",items:c});return[Ext.create("Ext.panel.Panel",{layout:"border",border:!1,bodyBorder:!1,region:"north",cls:"loginNorthPanel",padding:"15 0 0 0",
items:[a,b,c],height:this.controller.HEIGHT_COLLAPSED-35}),this.panelMotd]}});
Ext.define("com.trackplus.logon.LogonPageController",{extend:"Ext.Base",config:{context:1,model:{}},view:null,expandedMOTD:!1,HEIGHT_EXPANDED:600,HEIGHT_COLLAPSED:175,WIDTH_COLLAPSED:750,profile:null,windowConfigProfile:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},createView:function(){this.view=Ext.create("com.trackplus.logon.LogonPageView",{model:this.model,controller:this});this.addListeners();return this.view},addListeners:function(){this.view.txtUsername.addListener("specialkey",
this.onInputKeyPressed,this);this.view.txtPassword.addListener("specialkey",this.onInputKeyPressed,this)},setFocus:function(){this.view.txtUsername.focus(!0)},expandMOTD:function(){var a=this;a.expandedMOTD=!a.expandedMOTD;var b=a.view.ownerCt.getEl().getY(),c=a.view.ownerCt.body.getSize().height;a.expandedMOTD?(null!=a.view.linkSelfRegistration&&a.view.linkSelfRegistration.getEl().fadeIn({opacity:1,easing:"easeOut",duration:600}),a.view.linkForgotPassword.getEl().fadeIn({opacity:1,easing:"easeOut",
duration:600}),a.view.checkRemeberMe.getEl().fadeIn({opacity:1,easing:"easeOut",duration:600}),a.view.getEl().animate({y:b+20,duration:600}),a.view.body.animate({height:c-40,duration:600,listeners:{afteranimate:{fn:function(){a.view.height="100%";a.view.width="100%";a.view.panelMotd.getEl().fadeOut({opacity:0.1,easing:"easeOut",duration:15,remove:!1,useDisplay:!1,callback:function(){a.view.panelMotd.update(a.model.motd);a.view.panelMotd.getEl().fadeIn({opacity:1,easing:"easeOut",duration:300})}});
a.view.linkExpandMOTD.setClsLink("collapseMOTD");a.view.linkExpandMOTD.setLabel(getText("logon.lbl.collapseMOTD"));a.view.ownerCt.doLayout();a.view.doLayout()}}}})):(null!=a.view.linkSelfRegistration&&a.view.linkSelfRegistration.getEl().fadeOut({opacity:0,easing:"easeOut",duration:600,remove:!1,useDisplay:!1}),a.view.linkForgotPassword.getEl().fadeOut({opacity:0,easing:"easeOut",duration:600,remove:!1,useDisplay:!1}),a.view.checkRemeberMe.getEl().fadeOut({opacity:0,easing:"easeOut",duration:600,remove:!1,
useDisplay:!1}),c=a.view.ownerCt.body.getSize().height,b=a.view.ownerCt.getEl().getY(),c=Math.round(c/2)-Math.round(a.HEIGHT_COLLAPSED/2),a.view.getEl().animate({y:b+20+c,duration:600}),a.view.body.animate({height:a.HEIGHT_COLLAPSED-40,duration:625,listeners:{afteranimate:{fn:function(){a.view.height=a.HEIGHT_COLLAPSED;a.view.width="100%";a.view.panelMotd.update("");a.view.linkExpandMOTD.setClsLink("expandMOTD");a.view.linkExpandMOTD.setLabel(getText("logon.lbl.expandMOTD"));a.view.ownerCt.doLayout();
a.view.doLayout()}}}}))},onTxtEmailTestInputKeyPressed:function(a,b){b.getKey()==b.ENTER&&this.txtEmail.isValid()&&this.doForgetPassword()},doForgetPassword:function(){var a=this;a.forgotForm.getForm().isValid()&&(a.logon_forgotWin.setLoading(!0),a.forgotForm.getForm().submit({success:function(b,c){a.logon_forgotWin.setLoading(!1);a.logon_forgotWin.hide();CWHF.showMsgInfo(getText("logon.newpassword.welcome"));a.setFocus()},failure:function(b,c){a.logon_forgotWin.setLoading(!1);var e="";if(null!=c.result.errors&&
0<c.result.errors.length)for(var f=c.result.errors,g=0;g<f.length;g++)e+=f[g].message;CWHF.showMsgError(e)}}))},selfRegistration:function(){var a=com.trackplus.admin.user.createSelfRegistrationDialog();this.profile=a.profile;this.windowConfigProfile=a.windowConfig},forgetPassword:function(){var a=this;null!=a.logon_forgotWin&&a.logon_forgotWin.destroy();a.txtEmail=Ext.create("Ext.form.field.Text",{anchor:"100%",vtype:"email",name:"email",allowBlank:!1});a.txtEmail.addListener("specialkey",a.onTxtEmailTestInputKeyPressed,
a);a.forgotForm=Ext.create("Ext.form.Panel",{border:!1,autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"10px"},layout:"anchor",url:"resetPassword.action",items:[{xtype:"displayfield",value:getText("logon.newpassword.prompt.text"),itemId:"forgotLabel",height:"32px"},a.txtEmail]});a.logon_forgotWin=Ext.create("Ext.window.Window",{layout:"fit",width:400,height:155,closeAction:"hide",plain:!0,title:com.trackplus.TrackplusConfig.getText("logon.newpassword.title"),modal:!0,items:[a.forgotForm],autoScroll:!0,
margin:"0 0 0 0",style:{padding:" 5px 0px 0px 0px"},bodyPadding:"0px",cls:"forgotPassword bottomButtonsDialog tpspecial",buttons:[{text:com.trackplus.TrackplusConfig.getText("common.btn.ok"),itemID:"btnOkForgetPassword",handler:a.doForgetPassword,scope:a},{text:getText("common.btn.cancel"),itemID:"btnCancelForgetPassword",handler:function(){a.logon_forgotWin.hide();a.setFocus()}}],defaultFocus:a.txtEmail});a.logon_forgotWin.show(a.linkForgotPassword)},onInputKeyPressed:function(a,b){b.getKey()==b.ENTER&&
this.login.call(this)},login:function(){var a=this,b=a.view.getForm();if(!b.isValid())return!0;var c=a.view.txtHiddenPassword,e=a.view.txtPassword.getValue(),f=a.view.txtUsername.getValue(),g=new Date((new Date).getTime()+2592E6);!0==a.view.checkRemeberMe.getValue()?(Ext.util.Cookies.set("username",f,g),Ext.util.Cookies.set("passwd",e,g),Ext.util.Cookies.set("rememberMe","true",g)):(Ext.util.Cookies.clear("username"),Ext.util.Cookies.clear("passwd"),Ext.util.Cookies.clear("rememberMe"));for(var f=
"",g=a.model.nonce.charCodeAt(0),h=0;h<e.length;++h)var k=e.charCodeAt(h),k=g^k,f=f+a.decimalToHex(k,4);c.setValue(f);borderLayout.setLoading(!0);b.submit({url:"logon!login.action",success:function(a,b){document.location=b.result.data.jsonURL},failure:function(b,c){if(a.model.nonce!=c.result.data.nonce)return null==c.result.data.nonce?location.reload(!0):(a.model.nonce=c.result.data.nonce,a.login.call(a)),!0;borderLayout.setLoading(!1);"client"!=c.failureType&&a.handleErrors(c.result.data)}})},decimalToHex:function(a,
b){var c=Number(a).toString(16);for(b="undefined"===typeof b||null===b?b=2:b;c.length<b;)c="0"+c;return c},handleErrors:function(a){var b=a.errors,c="";a.banned&&(document.location=a.jsonURL);if(null!=b&&0<b.length){for(var e=0;e<b.length;e++){if("errCredentials"==b[e].label){var f=this.view.txtPassword;this.view.txtUsername.markInvalid(b[e].id);f.markInvalid(b[e].id);a.continyou=!1}"errGeneralError"==b[e].label&&(c+=b[e].id+"\n",a.continyou=!1);"errLicenseError"==b[e].label&&(c+=b[e].id+"\n")}null!=
c&&0<c.length?Ext.MessageBox.show({title:"",msg:c,modal:!0,fn:function(b){!0==a.continyou&&(document.location=a.jsonURL)},buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR}):this.shakeWin()}},shakeWin:function(){var a=this.view.getEl().getX();this.view.getEl().animate({keyframes:{"0%":{x:a-15},"25%":{x:a+15},"50%":{x:a-15},"75%":{x:a+15},"100%":{x:a}},duration:250})}});
Ext.define("com.trackplus.layout.LogonLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,logonPage:null,constructor:function(a){var b=this;b.callParent(arguments);b.logonPage=Ext.create("com.trackplus.logon.LogonPage",{jsonData:b.initData});b.borderLayoutController.setHelpContext("logon");b.onReady(function(){b.logonPage.setFocus.call(b.logonPage);Ext.DomHelper.append("logonpageview",{tag:"div",cls:"",id:"logonBoxShadow",html:"\x26nbsp;"})})},createCenterPanel:function(){return this.logonPage.createCenterPanel.call(this.logonPage)}});
Ext.define("com.trackplus.layout.BannedLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.borderLayoutController.setHelpContext("logon")},createCenterPanel:function(){return Ext.create("Ext.panel.Panel",{region:"center",cls:"messagePageWrapper",border:!1,baseCls:"x-plain",unstyled:!0,html:'\x3cdiv class\x3d"boxMessage boxMessage-error"\x3e\x3cdiv class\x3d"messageIcon"\x3e\x3cimg src\x3d"design/silver/32x32/cancel.png"/\x3e\x3c/div\x3e\x3cdiv class\x3d"messageBody"\x3e'+
getText("logon.banned.body")+"\x3c/div\x3e\x3c/div\x3e"})}});
Ext.define("com.trackplus.layout.ConfirmedUserLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.borderLayoutController.setHelpContext("logon")},createCenterPanel:function(){return Ext.create("Ext.panel.Panel",{region:"center",cls:"messagePageWrapper",border:!1,baseCls:"x-plain",unstyled:!0,html:'\x3cdiv class\x3d"boxMessage boxMessage-ok"\x3e\x3cdiv class\x3d"messageIcon"\x3e\x3cimg src\x3d"design/silver/32x32/check.png"/\x3e\x3c/div\x3e\x3cdiv class\x3d"messageBody"\x3e'+getText("logon.register.msg.confirmationSuccess")+
'\x3c/div\x3e\x3cdiv class\x3d"redirectToLoginDiv"\x3e \x3ca class\x3d"redirectToLogin" href\x3d"logoff.action"\x3e'+getText("common.btn.login")+"...\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e"})}});
Ext.define("com.trackplus.layout.ExpiredUserLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.borderLayoutController.setHelpContext("logon")},createCenterPanel:function(){return Ext.create("Ext.panel.Panel",{region:"center",cls:"messagePageWrapper",border:!1,baseCls:"x-plain",unstyled:!0,html:'\x3cdiv class\x3d"boxMessage boxMessage-error"\x3e\x3cdiv class\x3d"messageIcon"\x3e\x3cimg src\x3d"design/silver/32x32/cancel.png"/\x3e\x3c/div\x3e\x3cdiv class\x3d"messageBody"\x3e'+
getText("logon.register.msg.tokenExpired")+'\x3c/div\x3e\x3cdiv class\x3d"redirectToLoginDiv"\x3e \x3ca class\x3d"redirectToLogin" href\x3d"logoff.action"\x3e'+getText("common.btn.login")+"...\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e"})}});
Ext.define("com.trackplus.layout.ResetPasswordLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.borderLayoutController.setHelpContext("logon")},applyPasswordVType:function(){Ext.apply(Ext.form.field.VTypes,{password:function(a,b){if(b.initialPassField){var c=Ext.getCmp(b.initialPassField);return a==c.getValue()}return!0},passwordText:getText("admin.user.profile.err.password.match")})},resetPassword:function(){var a=this;a.form.getForm().submit({url:"resetPassword!reset.action",
params:{ctk:a.initData.token},success:function(b,c){a.saveSuccess.call(a,b,c)},scope:a,failure:a.saveFailure})},saveSuccess:function(a,b){var c=getText("logon.resetPassword.title"),e=getText("logon.resetPassword.msg.resetSuccessfully");Ext.MessageBox.show({title:c,msg:e,width:400,buttons:Ext.Msg.OK,fn:function(){var a=Ext.JSON.decode(b.response.responseText),c=a.data.jsonURL,e=a.data.ftever,k=a.data.licURL,e=b.result.data.ftever,k=b.result.data.licURL;null!=c&&""!=c?(e&&Ext.MessageBox.show({msg:getText("logon.getLicense"),
width:450,height:300,cls:"licenseRequest",closable:!1,buttonText:{ok:getText("logon.register")},buttons:Ext.Msg.OK,fn:function(a){window.open(k,"_blank");document.location=jsonURL},icon:Ext.window.MessageBox.INFO}),document.location=c):window.location.href="logoff.action"},icon:Ext.MessageBox.INFO})},saveFailure:function(a,b){var c=getText("logon.resetPassword.title"),e=getText("logon.resetPassword.error.cantResetPassword");Ext.MessageBox.show({title:c,msg:e,width:400,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})},
createCenterPanel:function(){this.applyPasswordVType();var a=Ext.create("Ext.Button",{text:getText("common.btn.reset"),margin:"10 0 0 255",formBind:!0,handler:this.resetPassword,scope:this});this.form=Ext.create("Ext.form.Panel",{layout:"anchor",border:!1,margin:"0 0 0 0",baseCls:"x-plain",unstyled:!0,bodyStyle:{padding:"10px"},items:[CWHF.createTextField("admin.user.profile.lbl.passwd","passwd",{inputType:"password",minLength:5,id:"passwd",allowBlank:!1}),CWHF.createTextField("admin.user.profile.lbl.passwd2",
"passwd2",{inputType:"password",vtype:"password",initialPassField:"passwd",allowBlank:!1}),a]});a=Ext.create("Ext.panel.Panel",{cls:"boxMessage boxMessage-ok",baseCls:"x-plain",unstyled:!0,items:[{xtype:"component",html:getText("logon.resetPassword.msg",this.initData.loginName)},this.form]});return Ext.create("Ext.panel.Panel",{region:"center",cls:"messagePageWrapper",border:!1,baseCls:"x-plain",unstyled:!0,items:[a]})}});
Ext.define("com.trackplus.layout.ResetPasswordExpiredLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.borderLayoutController.setHelpContext("logon")},createCenterPanel:function(){return Ext.create("Ext.panel.Panel",{region:"center",cls:"messagePageWrapper",border:!1,baseCls:"x-plain",unstyled:!0,html:'\x3cdiv class\x3d"boxMessage boxMessage-error"\x3e\x3cdiv class\x3d"messageIcon"\x3e\x3cimg src\x3d"design/silver/32x32/cancel.png"/\x3e\x3c/div\x3e\x3cdiv class\x3d"messageBody"\x3e'+
getText("logon.register.msg.tokenResetPasswordExpired")+'\x3c/div\x3e\x3cdiv class\x3d"redirectToLoginDiv"\x3e \x3ca class\x3d"redirectToLogin" href\x3d"logoff.action"\x3e'+getText("common.btn.login")+"...\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e"})}});com.trackplus.browseProjects.urlEditScreen="dashboardEdit.action";com.trackplus.browseProjects.urlResetScreen="browseProjects!resetDashboard.action";
com.trackplus.browseProjects.btnProjectDashEdit=new Ext.Button({id:"projectDashEditButton",itemId:"projectDashEditButtonItemID",overflowText:getText("cockpit.config"),tooltip:getText("cockpit.config.tt"),text:getText("cockpit.config"),iconCls:"cockpitEdit",disabled:!0,handler:function(){window.location.href=com.trackplus.browseProjects.urlEditScreen}});
com.trackplus.browseProjects.btnProjectDashReset=new Ext.Button({xtype:"button",id:"projectDashResetButton",overflowText:getText("cockpit.reset"),tooltip:getText("cockpit.reset"),text:getText("cockpit.reset"),iconCls:"cockpitReset",disabled:!0,handler:function(){com.trackplus.browseProjects.resetDashboard()}});
com.trackplus.browseProjects.btnSaveAsTemplatetDash=new Ext.Button({xtype:"button",id:"projectDashSaveAsTemplatetButton",overflowText:getText("cockpit.saveAsTemplate"),tooltip:getText("cockpit.saveAsTemplate"),text:getText("cockpit.saveAsTemplate.tooltip"),iconCls:"cockpitSave",disabled:!0,handler:function(){com.trackplus.browseProjects.saveAsDefault()}});com.trackplus.browseProjects.westPanel=null;com.trackplus.browseProjects.browseProjectCenterPanel=null;
com.trackplus.browseProjects.treeProjects=null;com.trackplus.browseProjects.resetDashboard=function(){com.trackplus.dashboard.resetDashboard(com.trackplus.dashboard.urlResetScreen,{},this.resetDashboardSuccess,this)};com.trackplus.browseProjects.resetDashboardSuccess=function(){com.trackplus.browseProjects.showProject(com.trackplus.browseProjects.projectID,com.trackplus.browseProjects.entityType,com.trackplus.browseProjects.releaseID)};
com.trackplus.browseProjects.saveAsDefault=function(){com.trackplus.dashboard.saveAsDefault(com.trackplus.browseProjects.projectID,com.trackplus.browseProjects.entityType)};
com.trackplus.browseProjects.createWestPanel=function(){var a=Ext.create("Ext.data.Store",{fields:[{name:"label"},{name:"value"},{name:"cssClass"},{name:"img"},{name:"entityID"},{name:"optionID"}],data:[]}),a=Ext.create("Ext.grid.Panel",{id:"gridDetail",store:a,border:!1,disableSelection:!0,columns:[{dataIndex:"label",flex:0.5},{dataIndex:"value",flex:0.5,renderer:com.trackplus.browseProjects.gridDetailRenderer}],hideHeaders:!0,columnLines:!1,viewConfig:{stripeRows:!0,trackOver:!1},autoHeight:!0});
Ext.create("Ext.panel.Panel",{border:!0,autoScroll:!1,header:!1,items:[{xtype:"image",id:"imageDetail",src:com.trackplus.TrackplusConfig.iconsPath+"project.png",tdAttrs:{width:30}},{xtype:"displayfield",id:"titleDetail",value:"\x3cb\x3e...\x3c/b\x3e"},{xtype:"displayfield",id:"descriptionDetail",value:"..."}]});return Ext.create("Ext.panel.Panel",{layout:"border",id:"layout-browser",region:"west",border:!1,split:!0,margins:"0 -5 0 0",width:275,minSize:100,maxSize:500,listeners:{collapse:function(a){com.trackplus.browseProjects.storeSplitCollapsed()},
expand:function(a){com.trackplus.browseProjects.storeSplitCollapsed()}},items:[com.trackplus.browseProjects.treeProjects,Ext.create("Ext.panel.Panel",{id:"projectDetailPanel",region:"south",border:!1,bodyBorder:!1,height:325,split:!0,margins:"0 0 0 0",collapsible:!0,autoScroll:!0,collapseMode:"mini",title:"Detail",items:[{border:!1,bodyBorder:!1,margin:"0 0 0 0",layout:{type:"hbox"},items:[{xtype:"image",id:"imageDetail",src:com.trackplus.TrackplusConfig.iconsPath+"project.png",width:20,margin:"5 5 0 5"},
{xtype:"displayfield",id:"titleDetail",value:"\x3cb\x3e...\x3c/b\x3e",flex:1,margin:"5 5 0 0"}]},{xtype:"displayfield",id:"descriptionDetail",value:"..."},a]})]})};com.trackplus.browseProjects.replaceDetail=function(a){var b=Ext.getCmp("imageDetail"),c=Ext.getCmp("titleDetail"),e=Ext.getCmp("descriptionDetail"),f=Ext.getCmp("gridDetail");b.setSrc(com.trackplus.TrackplusConfig.iconsPath+a.image);c.setValue(a.title);e.setValue(a.description);f.store.loadData(a.gridData)};
com.trackplus.browseProjects.gridDetailRenderer=function(a,b,c,e,f,g){b="";null!=c.data.img&&""!=c.data.img&&(b+='\x3cimg src\x3d"'+com.trackplus.TrackplusConfig.iconsPath+c.data.img+'"\x3e');null!=c.data.optionID&&""!=c.data.optionID&&(b+='\x3cimg src\x3d"'+("optionIconStream.action?fieldID\x3d"+c.data.entityID+"\x26optionID\x3d"+c.data.optionID)+'" style\x3d"margin-right:3px"\x3e');return b=null!=c.data.cssClass?b+('\x3cspan class\x3d"'+c.data.cssClass+'"\x3e'+a+"\x3c/span\x3e"):b+a};
com.trackplus.browseProjects.showProject=function(a,b,c){Ext.Ajax.request({url:"dashboard.action",disableCaching:!0,method:"POST",params:{projectID:a,entityType:b,releaseID:c},success:function(e){e=Ext.decode(e.responseText).data;var f=com.trackplus.screen.createScreenModel(e.screen),g="dashboardTabRuntime!execute.action?projectID\x3d"+a,h="dashboard!storeLastSelectedTab.action?projectID\x3d"+a+"\x26entityType\x3d"+b;null!=c&&(g+="\x26releaseID\x3d"+c);e=Ext.create("com.trackplus.screen.BaseScreenFacade",
{screenModel:f,lastSelectedTab:e.lastSelectedTab,projectID:e.projectID,releaseID:e.releaseID,refreshTabUrl:g,storeTabUrl:h,tabViewCls:"com.trackplus.screen.DashboardTabView",panelViewCls:"com.trackplus.screen.DashboardPanelView",fieldErrorCls:"com.trackplus.screen.DashboardFieldErrorView"}).createViewComponent();com.trackplus.browseProjects.browseProjectCenterPanel.removeAll(!0);com.trackplus.browseProjects.browseProjectCenterPanel.add(e);com.trackplus.browseProjects.browseProjectCenterPanel.doLayout()}})};
com.trackplus.browseProjects.findParentProject=function(a){var b=a.parentNode;return 0>b.data.id?-1*a.parentNode.data.id:com.trackplus.browseProjects.findParentProject(b)};
com.trackplus.browseProjects.treeNodeClick=function(a,b){var c=1,e,f=null,g=parseInt(b.data.id);Ext.get("projectDetailPanel");0>g?(c=1,e=-1*g,com.trackplus.browseProjects.urlEditScreen="dashboardEdit.action?backAction\x3dbrowseProjects.action\x26projectID\x3d"+e+"\x26entityType\x3d1",com.trackplus.dashboard.urlResetScreen="project!cokpitAssignment.action?projectID\x3d"+e+"\x26entityType\x3d1"):(f=g,c=9,e=com.trackplus.browseProjects.findParentProject(b),com.trackplus.browseProjects.urlEditScreen=
"dashboardEdit.action?backAction\x3dbrowseProjects.action\x26projectID\x3d"+e+"\x26entityType\x3d9",com.trackplus.dashboard.urlResetScreen="project!cokpitAssignment.action?projectID\x3d"+e+"\x26entityType\x3d9");var h=Ext.getCmp("projectDetailPanel");h.setLoading(com.trackplus.TrackplusConfig.getText("common.lbl.loading"));Ext.Ajax.request({url:"browseProjects!entityDetail.action",params:{entityID:g,entityType:c},success:function(a){a=Ext.decode(a.responseText);var b={};!0==a.data.canEdit?(com.trackplus.browseProjects.btnProjectDashEdit.setDisabled(!1),
com.trackplus.browseProjects.btnProjectDashReset.setDisabled(!1),com.trackplus.browseProjects.btnSaveAsTemplatetDash.setDisabled(!1)):(com.trackplus.browseProjects.btnProjectDashEdit.setDisabled(!0),com.trackplus.browseProjects.btnProjectDashReset.setDisabled(!0),com.trackplus.browseProjects.btnSaveAsTemplatetDash.setDisabled(!0));if(1==c){b.title=a.data.projectLabel;b.description=a.data.projectDescription;b.image="project.png";var e="bulkCheck.gif";a.data.projectLinking&&(e="bulkCheck-select.gif");
var f="bulkCheck.gif";a.data.projectWorkCost&&(f="bulkCheck-select.gif");b.gridData=[{label:getText("common.lbl.projectType"),value:a.data.projectType},{label:getText("admin.customize.localeEditor.type.projectStatus"),value:a.data.projectState},{label:getText("admin.project.lbl.defaultManager"),value:a.data.defaultManager},{label:getText("admin.project.lbl.defaultResponsible"),value:a.data.defaultResponsible},{label:getText("admin.project.lbl.defaultInitialState"),value:a.data.defaultItemState,cssClass:"dataEmphasize",
optionID:a.data.defaultItemStateID,entityID:-4},{label:getText("admin.project.lbl.defaultIssueType"),value:a.data.defaultIssueType,optionID:a.data.defaultIssueTypeID,entityID:-2},{label:getText("admin.project.lbl.defaultPriority"),value:a.data.defaultPriority,optionID:a.data.defaultPriorityID,entityID:-10},{label:getText("admin.project.lbl.defaultSeverity"),value:a.data.defaultSeverity,optionID:a.data.defaultSeverityID,entityID:-11},{label:getText("admin.project.lbl.linking"),value:"",img:e},{label:getText("admin.project.lbl.accounting"),
value:"",img:f}]}else b.title=a.data.label,b.description=a.data.description,b.image="releaseActive.png",e="bulkCheck.gif",a.data.noticedDefault&&(e="bulkCheck-select.gif"),f="bulkCheck.gif",a.data.scheduleDefault&&(f="bulkCheck-select.gif"),b.gridData=[{label:getText("admin.customize.localeEditor.type.releaseStatus"),value:a.data.state},{label:getText("admin.project.release.lbl.dueDate"),value:a.data.dueDate},{label:getText("admin.project.release.lbl.defaultReleaseNoticed"),value:"",img:e},{label:getText("admin.project.release.lbl.defaultReleaseScheduled"),
value:"",img:f}];com.trackplus.browseProjects.replaceDetail(b);h.doLayout();h.setLoading(!1)},failure:function(a){h.setLoading(!1)},method:"POST"});com.trackplus.browseProjects.projectID=e;com.trackplus.browseProjects.entityType=c;com.trackplus.browseProjects.releaseID=f;com.trackplus.browseProjects.showProject(e,c,f)};
com.trackplus.browseProjects.storeSplitCollapsed=function(){Ext.Ajax.request({url:"browseProjects!storeSpliterCollapsed.action",disableCaching:!0,success:function(){},failure:function(){},method:"POST",params:{editSpliterCollapses:com.trackplus.browseProjects.westPanel.collapsed}})};
com.trackplus.browseProjects.createCustomCenterPanel=function(a){a=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:"browseProjects!expandNode.action"},fields:"id text type canEdit icon leaf".split(" "),root:{expanded:!0,text:"",user:"",status:"",children:null==a.treeDataProjects?[]:a.treeDataProjects}});com.trackplus.browseProjects.treeProjects=Ext.create("Ext.tree.Panel",{region:"center",useArrows:!0,autoScroll:!0,store:a,rootVisible:!1,border:!1,margins:"0 0 0 0",baseCls:"x-plain",bodyStyle:{border:"none"},
cls:"westTreeNavigator"});com.trackplus.browseProjects.treeProjects.store.on("beforeload",function(a,c){var e=c.node;if(null!=e){var f=e.data.id,f=f.substring(1,f.length),f=parseInt(f);com.trackplus.browseProjects.treeProjects.store.proxy.extraParams={entityID:f,entityType:e.data.type}}});com.trackplus.browseProjects.treeProjects.on("itemclick",com.trackplus.browseProjects.treeNodeClick);com.trackplus.browseProjects.browseProjectCenterPanel=new Ext.Panel({region:"center",border:!1,autoScroll:!0,header:!1,
style:{},bodyStyle:{padding:"2px 0px 0px 0px"},layout:"fit"});return com.trackplus.browseProjects.browseProjectCenterPanel};
Ext.define("com.trackplus.layout.BrowseProjectsLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,selectedGroup:"browseProjects",constructor:function(a){var b=this;b.callParent(arguments);b.borderLayoutController.setHelpContext("browseProject");b.onReady(function(){var a=b.initData,e=[com.trackplus.browseProjects.btnProjectDashEdit];com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&(e.push(com.trackplus.browseProjects.btnProjectDashReset),e.push(com.trackplus.browseProjects.btnSaveAsTemplatetDash));
b.borderLayoutController.setActiveToolbarList(e);null==a.treeDataProjects?CWHF.showMsgError(getText("browseProject.err.noProjectToBrowse")):(a=com.trackplus.browseProjects.treeProjects.getStore().getNodeById(a.selectedNode),null!=a&&(com.trackplus.browseProjects.treeProjects.getSelectionModel().select(a),com.trackplus.browseProjects.treeProjects.expandPath(a.getPath()),com.trackplus.browseProjects.treeNodeClick(null,a)))})},createCenterPanel:function(){return com.trackplus.browseProjects.createCustomCenterPanel(this.initData)},
createWestPanel:function(){com.trackplus.browseProjects.westPanel=com.trackplus.browseProjects.createWestPanel();return com.trackplus.browseProjects.westPanel}});com.trackplus.util.RefreshAfterSubmit=function(){};
com.trackplus.util.RefreshAfterSubmit.refreshSimpleTree=function(a){var b=a.node;if(a.reloadTree){a=this.tree.getStore();var c={};if(null==b&&a.getRootNode().hasChildNodes()){var e=a.getRootNode().childNodes;if(null!=e&&(e=e.length,0<e)){var f=a.getRootNode().getChildAt(0);if(null!=f){var g=null;null!=this.selectNode&&(g=this.selectedNode.get("id"));b=f.get("id");b==g&&(b=null,1<e&&(e=a.getRootNode().getChildAt(1),null!=e&&(b=e.get("id"))))}}}null!=b?(c.callback=this.selectNode,c.scope={tree:this.tree,
nodeIdToSelect:b}):(c.callback=this.resetDetailPanel,c.scope=this);a.load(c)}else a=this.tree.getSelectionModel(),null!=b&&(b=this.tree.getStore().getNodeById(b),null!=b&&a.select(b))};
com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit=function(a){var b=a.nodeIDToSelect,c=a.nodeIDToReload,e=a.resetDetail;if(a.reloadTree){a=this.tree.getStore();var f={};null!=c&&(f.node=this.tree.getStore().getNodeById(c));null!=b?(f.callback=com.trackplus.util.RefreshAfterSubmit.selectTreeNodeAfterReload,f.scope={treePanel:this.tree,nodeIDToSelect:b}):e&&(f.callback=this.resetDetailPanel,f.scope=this);a.load(f)}else com.trackplus.util.RefreshAfterSubmit.selectTreeNodeAfterReload.call({treePanel:this.tree,
nodeIDToSelect:b})};
com.trackplus.util.RefreshAfterSubmit.refreshGridAndTreeAfterSubmit=function(a){var b=null,c=null,e=null;null!=a&&(b=a.nodeIDToReload,c=a.nodeIDToSelect,e=a.rowToSelect);null!=b?a=this.tree.getStore().getNodeById(b):null!=this.selectedNode?(a=this.selectedNode,b=this.selectedNodeID):(a=this.tree.getRootNode(),b=this.rootID);null!=a&&(a.isLoaded()?(this.rowIdToSelect=e,null==c&&(c=b),this.tree.store.load({node:a,callback:com.trackplus.util.RefreshAfterSubmit.selectTreeNodeAfterReload,synchronous:!1,
scope:{treePanel:this.tree,grid:this.grid,nodeIDToSelect:c,rowToSelect:e,scope:this}})):null!=this.grid&&com.trackplus.util.RefreshAfterSubmit.refreshGridAfterSubmit.call(this,{rowToSelect:e}))};com.trackplus.util.RefreshAfterSubmit.selectTreeNodeAfterReload=function(){var a=this.treePanel.getSelectionModel();if(null!=this.nodeIDToSelect){var b=this.treePanel.getStore().getNodeById(this.nodeIDToSelect);null!=b&&(a.isSelected(b)&&a.deselect(b),a.select(b),b.isVisible()||this.treePanel.expandPath(b.getPath()))}};
com.trackplus.util.RefreshAfterSubmit.refreshGridAfterSubmit=function(a){this.grid.getStore().load({scope:this,callback:function(){if(null!=a){var b=a.rowToSelect;null!=b&&(b=this.grid.getStore().getById(b),null!=b&&this.grid.getSelectionModel().select(b))}}})};
Ext.define("com.trackplus.admin.CrudBase",{extend:"Ext.Base",config:{confirmDeleteEntity:!0,allowMultipleSelections:!1,allowDeselect:!1,editWidth:600,editHeight:400,replacementWidth:500,replacementHeight:200,baseAction:"",gridSelectionModel:null},baseAction:"",allowMultipleSelections:!1,allowDeselect:!1,editWidth:600,editHeight:400,confirmDeleteEntity:!0,confirmDeleteNotEmpty:!1,deleteConfirmed:!1,replacementWidth:500,replacementHeight:200,grid:null,actions:null,win:null,formEdit:null,ERROR_CODE_NEED_REPLACE:1,
NOT_EMPTY_WARNING:3,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},failureTitle:getText("common.err.failure"),getEntityLabel:function(a){return""},getAddIconCls:function(){return"add"},getAddButtonKey:function(){return"common.btn.add"},getAddTitleKey:function(){return"common.lbl.add"},getEditIconCls:function(){return"edit"},getEditButtonKey:function(){return"common.btn.edit"},getEditTitleKey:function(){return"common.lbl.edit"},getCopyIconCls:function(){return"copy"},getCopyButtonKey:function(){return"common.btn.copy"},
getCopyTitleKey:function(){return"common.lbl.copy"},getDeleteIconCls:function(){return"delete"},getDeleteButtonKey:function(){return"common.btn.delete"},getDeleteTitleKey:function(){return"common.lbl.delete"},getRemoveWarningKey:function(){return"common.lbl.removeWarning"},getTitle:function(a,b){null!=a&&(null==b&&(b={}),b.tooltipKey=a);return getText(a,this.getEntityLabel(b))},initActions:function(){this.actions=[]},getToolbarActions:function(){return this.actions},getGridContextMenuActions:function(a){return this.actions},
createAction:function(a,b,c,e,f,g,h){a={text:getText(a),overflowText:getText(a),iconCls:b,scope:this,handler:c};null!=e&&(a.disabled=e);null!=f&&(a.tooltipKey=f,a.tooltip=this.getTitle(f));null!=g&&(a.itemId=g);if(null!=h)for(propertyName in h)a[propertyName]=h[propertyName];return Ext.create("Ext.Action",a)},createLocalizedAction:function(a,b,c,e,f){a={text:a,overflowText:a,iconCls:b,scope:this,handler:c};null!=f&&(a.disabled=f);null!=e&&(a.tooltip=e);return Ext.create("Ext.Action",a)},createContextMenu:function(a,
b){var c=new Ext.menu.Menu({items:[]});if(null!=b)for(var e=0;e<b.length;e++){var f=b[e],g={text:f.getText(),iconCls:f.getIconCls()+"16",scope:f,tooltip:f.initialConfig.tooltip,handler:f.execute,itemId:f.itemId};c.add(g);null!=f.itemId&&(c.getComponent(f.itemId).tooltipKey=f.initialConfig.tooltipKey)}return c},reload:null,getReloadParamsAfterDelete:function(a,b,c){return c},createEditForm:function(a,b){return null},getEditPanelItems:function(a,b){return null},loadHandler:null,submitHandler:null,getStrutsBaseAction:function(a){return null},
getAdditionalActions:function(a,b,c){return null},getRecordID:function(a,b){return null},canCreateEntity:function(){return!0},getDeleteUrlBase:function(a){return this.getStrutsBaseAction(a)},getDeleteUrl:function(a){return this.getDeleteUrlBase(a)+"!delete.action"},getDeleteParamName:function(a){return null},getDeleteParams:function(a,b){var c={},e=this.getSelectionParam(a,b);c[this.getDeleteParamName(b)]=e;this.confirmDeleteNotEmpty&&(c.deleteConfirmed=this.deleteConfirmed);return c},getRenderReplaceUrl:function(a){return this.getDeleteUrlBase(a)+
"!renderReplace.action"},getRenderReplaceParams:function(a,b){return this.getDeleteParams(a,b)},getReplaceAndDeleteUrl:function(a){return this.getDeleteUrlBase(a)+"!replaceAndDelete.action"},getReplaceAndDeleteParams:function(a,b){return this.getDeleteParams(a,b)},preSubmitProcess:null,getSaveLabel:function(a){return getText("common.btn.save")},getDeleteLabel:function(){return getText("common.btn.delete")},getCancelLabel:function(){return getText("common.btn.cancel")},getDeleteEntityLabel:function(a){return this.getEntityLabel(a)},
getDeleteEntityMessage:function(a,b){return getText(a,this.getDeleteEntityLabel(b))},deleteHandler:function(a,b){var c=this;if(null==a)return!0;this.deleteConfirmed=!1;c.confirmDeleteEntity?Ext.MessageBox.confirm(c.getDeleteEntityMessage(c.getDeleteTitleKey(),b),c.getDeleteEntityMessage(c.getRemoveWarningKey(),b),function(e){if("no"==e)return!1;c.deleteSelected.call(c,a,b)}):c.deleteSelected(a,b)},deleteSelected:function(a,b){var c=this,e=c.getDeleteParams(a,b);Ext.Ajax.request({url:c.getDeleteUrl(b),
params:e,disableCaching:!0,scope:c,success:function(e){e=Ext.decode(e.responseText);if(!0==e.success)c.reload.call(c,c.getReloadParamsAfterDelete(a,b,e));else{var g=e.errorCode;if(null!=g)if(g==c.ERROR_CODE_NEED_REPLACE){var g=c.getReplacementItems(e,a,b),h=c.getTitle(c.getDeleteTitleKey(),b),k={loadUrl:c.getRenderReplaceUrl(b),loadUrlParams:c.getRenderReplaceParams(a,b)};e={submitUrl:c.getReplaceAndDeleteUrl(b),submitUrlParams:c.getReplaceAndDeleteParams(a,b),submitButtonText:c.getDeleteLabel(),
timeout:300,refreshAfterSubmitHandler:c.reload,refreshParametersBeforeSubmit:c.getReloadParamsAfterDelete(a,b,e)};Ext.create("com.trackplus.util.WindowConfig",{postDataProcess:c.replaceOptionPostDataProcess,extraConfig:b}).showWindow(c,h,c.replacementWidth,c.replacementHeight,k,e,g)}else g==c.NOT_EMPTY_WARNING?(e=e.errorMessage,Ext.MessageBox.confirm(c.getDeleteEntityMessage(c.getDeleteTitleKey(),b),e,function(e){if("no"==e)return!1;this.deleteConfirmed=!0;c.deleteSelected.call(c,a,b)},this)):Ext.MessageBox.alert(this.failureTitle,
e.errorMessage);else c.errorHandlerDelete(e,a)}},failure:function(a){com.trackplus.util.requestFailureHandler(a)},method:"POST"})},getSelectionParam:function(a,b){if(this.allowMultipleSelections){var c=[];Ext.Array.forEach(a,function(a){c.push(this.getRecordID(a.data,b))},this);return c.join()}return this.getRecordID(a.data,b)},errorHandlerDelete:function(a,b){com.trackplus.util.showError(a)},getReplacementItems:function(a,b,c){return[{xtype:"label",itemId:"replacementWarning"},CWHF.createCombo("Replacement",
"replacementID",{labelWidth:200,allowBlank:!1,blankText:getText("common.err.replacementRequired",this.getEntityLabel(c))})]},replaceOptionPostDataProcess:function(a,b,c){var e=b.getComponent("replacementWarning"),f=a.replacementWarning;null==f&&(f=a.label,f=getText("common.lbl.replacementWarning",this.getEntityLabel(c),f),f+=getText("common.lbl.cancelDeleteAlert"));e.setText(f,!1);b=b.getComponent("replacementID");this.loadReplacementOptionData(b,a);a=a.replacementListLabel;null==a&&(a=this.getTitle("common.lbl.replacement",
c));b.labelEl.dom.innerHTML=a},loadReplacementOptionData:function(a,b){a.store.loadData(b.replacementList);a.setValue(null)},getGridSelectionModel:function(){var a={};this.allowMultipleSelections?a.mode="MULTI":(a.mode="SINGLE",this.allowDeselect&&(a.allowDeselect=this.allowDeselect));return null==this.gridSelectionModel?Ext.create("Ext.selection.RowModel",a):this.gridSelectionModel},getLastSelectedGridRow:function(){return null!=this.grid?this.grid.getSelectionModel().getLastSelected():null},getGridSelection:function(){return null!=
this.grid?this.grid.getSelectionModel().getSelection():null},selectGridRow:function(a){null!=this.grid&&this.grid.getSelectionModel().select(a,!1);return a},getLastSelected:function(){return this.getLastSelectedGridRow()},getSelection:function(){return this.getGridSelection()},getSelectedRecords:function(){return this.allowMultipleSelections?this.getSelection():this.getLastSelected()},selectionIsSimple:function(){if(this.allowMultipleSelections){var a=this.getSelection();return null!=a&&1==a.length}return null!=
this.getLastSelected()},getSingleSelectedRecordData:function(a){a=this.getSingleSelectedRecord(a);return null!=a?a.data:null},getSingleSelectedRecord:function(a){a=this.getSelectedRecords(a);return null!=a?this.allowMultipleSelections?null!=a&&1==a.length?a[0]:null:a:null},selectRecord:function(a){return this.selectGridRow(a)}});
Ext.define("com.trackplus.admin.TreeBase",{extend:"com.trackplus.admin.CrudBase",config:{rootID:"",allowMultipleNodeSelections:!1,folderAction:"",folderDetailUrl:null,leafDetailUrl:null,treeWidth:200,replaceCenterPanel:null},treeWidth:200,rootID:"",showGridForFolder:!1,folderDetailByFormLoad:!1,leafDetailByFormLoad:!1,replaceToolbarOnTreeNodeSelect:!1,useCopyPaste:!1,dragAndDropOnTree:!1,treeHasItemcontextmenu:!0,treeHasItemdblclick:!0,tree:null,selectedNode:null,selectedNodeID:null,cutCopyNode:null,
copy:!1,mainPanel:null,centerPanel:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},init:function(){this.initActions()},getStrutsBaseAction:function(a){if(null==this.folderAction||""==this.folderAction)return this.baseAction;var b=!0;null!=a&&(b=a.isLeaf);return b?this.baseAction:this.folderAction},getAddFolderIconCls:function(){return"add"},getCutIconCls:function(){return"cut"},getCutButtonKey:function(){return"common.btn.cut"},getCutTitleKey:function(){return"common.lbl.cut"},
getPasteIconCls:function(){return"paste"},getPasteButtonKey:function(){return"common.btn.paste"},getPasteTitleKey:function(){return"common.lbl.paste"},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"}]},getTreeExpandExtraParams:function(a){return null},getActionItemIdsWithContextDependentLabel:function(){return[]},getTreeContextMenuActions:function(a,
b){return[]},getContextMenuActions:function(a,b,c){return this.getTreeContextMenuActions(a,b)},onTreeNodeCtxMenu:function(a,b,c,e,f){this.onCtxMenu(!0,b,f);return!1},onCtxMenu:function(a,b,c){c.stopEvent();this.selectRecord(b,a);var e=this.getSelectedRecords(a),f=this.selectionIsSimple(a),f=this.getContextMenuActions(e,f,a);null!=f&&0<f.length&&(b=this.createContextMenu(b,f),this.adjustContextMenuText(b,e,a),b.showAt(c.getXY()));return!1},adjustContextMenuText:function(a,b,c){actionIds=this.getActionItemIdsWithContextDependentLabel();
for(var e=0;e<actionIds.length;e++){var f=a.getComponent(actionIds[e]);if(null!=f){var g=this.selectedIsLeaf(c);f.text=this.getTitle(f.tooltipKey,{isLeaf:g,fromTree:c,selectedRecord:b});f.setTooltip(this.getTitle(f.tooltipKey,{isLeaf:g,fromTree:c,selectedRecord:b}))}}},adjustToolbarButtonsTooltip:function(a,b){actionIds=this.getActionItemIdsWithContextDependentLabel();for(var c=borderLayout.getActiveToolbarList(),e=0;e<actionIds.length;e++){var f=c.getComponent(actionIds[e]);if(null!=f){var g=this.selectedIsLeaf(b);
f.setTooltip(this.getTitle(f.tooltipKey,{isLeaf:g,fromTree:b,selectedRecord:a}))}}},hasDragAndDropOnTree:function(a){return this.dragAndDropOnTree},getDragAndDropOnTreeConfig:function(){return{ptype:"treeviewdragdrop",dragGroup:this.baseAction+"DDGroup",dropGroup:this.baseAction+"DDGroup",appendOnly:!0,enableDrag:!0,enableDrop:!0}},initTree:function(){var a=this.baseAction+"TreeModel";Ext.define(a,{extend:"Ext.data.Model",proxy:{fromCenterPanel:!0,type:"ajax",url:this.getStrutsBaseAction({isLeaf:!1})+
"!expand.action",extraParams:this.getTreeExpandExtraParams(),listeners:{exception:function(a,b,c,h){a=Ext.decode(b.responseText);com.trackplus.util.showError(a)}}},fields:this.getTreeFields()});var b=Ext.create("Ext.data.TreeStore",{model:a,root:{expanded:!0,id:this.rootID}}),a={xtype:"treepanel",store:b,selModel:this.getTreeSelectionModel(),region:"west",autoScroll:!0,width:this.treeWidth,margin:"0 -5 0 0",split:!0,header:!1,border:!1,bodyBorder:!1,style:{borderRight:"1px solid #D0D0D0"},animate:!1,
useArrows:!0,containerScroll:!0,rootVisible:!1,cls:"simpleTree"},c={};this.allowMultipleNodeSelections?c.selectionchange={fn:this.treeNodeSelectionchange,scope:this}:c.select={fn:this.treeNodeSelect,scope:this};this.treeHasItemcontextmenu&&(c.itemcontextmenu={fn:this.onTreeNodeCtxMenu,scope:this});this.treeHasItemdblclick&&(c.itemdblclick={fn:this.onTreeNodeDblClick,scope:this});a.listeners=c;this.hasDragAndDropOnTree()&&(a.viewConfig={plugins:this.getDragAndDropOnTreeConfig(),listeners:{beforedrop:{scope:this,
fn:function(a,b,c,h){a=b.records[0];b=b.copy;null==b&&(b=!1);return this.canDragDropNode(a,b,c)}},drop:{scope:this,fn:function(a,b,c,h){a=b.copy;null==a&&(a=!1);this.onDropTreeNode(b.records[0],c,a)}}}});this.tree=Ext.create("Ext.tree.Panel",a);b.on("beforeload",function(a,c){if(null!=c.node){var g=this.getTreeExpandExtraParams(c.node);null!=g&&(b.proxy.extraParams=g)}},this);b.on("load",function(a,b){this.onTreeNodeLoad(a,b)},this)},getTreeSelectionModel:function(){var a={};this.allowMultipleNodeSelections?
a.mode="MULTI":(a.mode="SINGLE",this.allowDeselect&&(a.allowDeselect=this.allowDeselect));return null==this.treeSelectionModel?Ext.create("Ext.selection.TreeModel",a):this.treeSelectionModel},onTreeNodeLoad:function(a,b){},canDragDropNode:function(a,b,c){return!1},getDragDropBaseAction:function(a){return this.getStrutsBaseAction({isLeaf:a})},onDropTreeNode:function(a,b,c){b.isLeaf()&&(b=b.parentNode);var e=this.selectedIsLeaf(a),e=this.getDragDropBaseAction(e);Ext.Ajax.request({fromCenterPanel:!0,
url:e+"!copy.action",params:{nodeFrom:a.data.id,nodeTo:b.data.id,copy:c},scope:this,disableCaching:!0,success:function(e){e=Ext.decode(e.responseText);!0==e.success?(c||a.remove(!0),com.trackplus.util.RefreshAfterSubmit.refreshGridAndTreeAfterSubmit.call(this,{nodeIDToReload:b.data.id,nodeIDToSelect:e.node})):null!=e.errorMessage&&Ext.MessageBox.alert(this.failureTitle,e.errorMessage)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})},onTreeNodeDblClick:function(a,
b){},getRootMessage:function(){return""},initCenterPanel:function(){this.initTree()},createCenterPanel:function(){var a=[],b=this.getRootMessage();if(null!=b||""!=b)a=this.getInfoBoxItems(b);this.centerPanel=Ext.create("Ext.form.Panel",{region:"center",border:!1,autoScroll:!0,header:!1,items:a});this.initCenterPanel();this.mainPanel=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:!1,items:[this.tree,this.centerPanel]});this.postInitCenterPanel(this.tree.getRootNode());return this.mainPanel},
postInitCenterPanel:function(a){},getInfoBoxItems:function(a){return null!=a&&""!=a?[{xtype:"component",cls:"infoBox_bottomBorder",border:!0,html:a}]:[]},treeNodeSelect:function(a,b,c,e){a=!1;null!=b?(a=b.data.leaf,this.selectedNodeID=b.data.id,this.selectedNode=b):b=this.selectedNode;this.loadDetailPanel(b,a,e);this.actualizeToolbarOnTreeSelect(b)},treeNodeSelectionchange:function(a,b,c){a=null;this.selectionIsSimple(!0)&&(a=b[0]);null!=a?(this.selectedNodeID=a.data.id,this.selectedNode=a):a=this.selectedNode;
null!=a?this.loadDetailPanel(a,!1):this.resetDetailPanel();this.getToolbarActionChangesForTreeNodeSelectionChange(b)},actualizeToolbarOnTreeSelect:function(a){this.replaceToolbarOnTreeNodeSelect?borderLayout.setActiveToolbarActionList(this.getToolbarActionsForTreeNodeSelect(a)):this.getToolbarActionChangesForTreeNodeSelect(a);this.adjustToolbarButtonsTooltip(a,!0)},loadDetailPanel:function(a,b,c){return null},getToolbarActionsForTreeNodeSelect:function(a){return this.getToolbarActions()},getToolbarActionChangesForTreeNodeSelect:function(a){},
getToolbarActionChangesForTreeNodeSelectionChange:function(a){},getDetailUrl:function(a,b){return null!=a&&a.isLeaf()||b?this.getLeafDetailUrl(a,b):this.getFolderDetailUrl(a,b)},getFolderDetailUrl:function(a,b){return null==this.folderDetailUrl?this.folderAction+"!load.action":folderDetailUrl},getLeafDetailUrl:function(a,b){return null==this.leafDetailUrl?this.baseAction+"!load.action":leafDetailUrl},getDetailParams:function(a,b,c){return b?null!=a&&a.isLeaf()?this.getAddLeafParams(c):this.getAddFolderParams(c):
this.getEditParams(!0,c)},getDetailItems:function(a,b,c){return null!=a&&a.isLeaf()||b?this.getLeafDetailItems(a,b,c):this.getFolderDetailItems(a,b,c)},getFolderDetailItems:function(a,b,c){return[]},getLeafDetailItems:function(a,b,c){return[]},getDetailPanelConfigOptions:function(){return null},loadDetailPanelWithFormLoad:function(a,b,c){null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);var e={region:"center",border:!1,autoScroll:!0,header:!1,items:this.getDetailItems(a,b)},f=this.getDetailPanelConfigOptions();
if(null!=f)for(propertyName in f)e[propertyName]=f[propertyName];this.centerPanel=Ext.create("Ext.form.Panel",e);null!=this.replaceCenterPanel?this.replaceCenterPanel.call(this,this.centerPanel):this.mainPanel.add(this.centerPanel);this.centerPanel.getForm().load({fromCenterPanel:!0,url:this.getDetailUrl(a,b),scope:this,params:this.getDetailParams(a,b,c),success:function(c,e){var f=b;null!=a&&(f=a.isLeaf());f=this.getEditPostDataProcess(a,f,b);if(null!=f)try{f.call(this,e.result.data,this.centerPanel)}catch(l){}},
failure:function(a,b){Ext.MessageBox.alert(this.failureTitle,b.response.responseText)}})},loadSimpleDetailPanel:function(a,b,c){Ext.Ajax.request({fromCenterPanel:!0,url:this.getDetailUrl(a,b),params:this.getDetailParams(a,b,c),scope:this,disableCaching:!0,success:function(c){c=Ext.decode(c.responseText);null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);this.centerPanel=Ext.create("Ext.panel.Panel",{region:"center",border:!1,autoScroll:!0,header:!1,items:this.getDetailItems(a,b,c)});
null!=this.replaceCenterPanel?this.replaceCenterPanel.call(this,this.centerPanel):this.mainPanel.add(this.centerPanel)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})},resetDetailPanel:function(){var a=this.getRootMessage();if(null!=a||""!=a)items=this.getInfoBoxItems(a);null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);this.centerPanel=Ext.create("Ext.form.Panel",{region:"center",border:!1,autoScroll:!0,header:!1,items:items});null!=this.replaceCenterPanel?
this.replaceCenterPanel.call(this,this.centerPanel):this.mainPanel.add(this.centerPanel);this.actualizeToolbarOnTreeSelect()},getAddFolderParams:function(a){return this.getAddParams(!1,a)},getAddLeafParams:function(a){return this.getAddParams(!0,a)},getAddParams:function(a,b){var c=null,c=null!=b?b:{};c.add=!0;c.leaf=a;var e=null;null!=this.selectedNode?(e=a&&this.selectedNode.isLeaf()?this.selectedNode.parentNode:this.selectedNode,null!=e&&(c.node=e.data.id)):c.node=this.rootID;return c},getEditParams:function(a,
b){var c=null,c=null!=b?b:{},e=this.getSingleSelectedRecordData(a);if(null!=e){var f=null,f=a?e.id:e.node;null!=f&&(c.node=f)}return c},getEditPostDataProcess:function(a,b,c){var e=null;null!=a&&(e=a.data);if(b){if(null!=this.getEditLeafPostDataProcess)return this.getEditLeafPostDataProcess(e,c)}else if(null!=this.getEditFolderPostDataProcess)return this.getEditFolderPostDataProcess(e,c);return null},getEditFolderPostDataProcess:null,getEditLeafPostDataProcess:null,getDeleteParamName:function(a){return"node"},
getRecordID:function(a,b){var c=null;null!=b&&(c=b.fromTree);return c?a.id:a.node},selectNode:function(){var a=this.tree.getSelectionModel();if(null!=this.nodeIdToSelect){var b=this.tree.getStore().getNodeById(this.nodeIdToSelect);null!=b&&a.select(b)}},getLastSelectedTreeNode:function(){return null!=this.tree?this.tree.getSelectionModel().getLastSelected():null},getTreeSelection:function(){return null!=this.tree?this.tree.getSelectionModel().getSelection():null},selectTreeNode:function(a){null!=
this.tree&&this.tree.getSelectionModel().select(a,!0);return a},getLastSelected:function(a){return a?this.getLastSelectedTreeNode():this.getLastSelectedGridRow()},getSelection:function(a){return a?this.getTreeSelection():this.getGridSelection()},getSelectedRecords:function(a){var b=!1;return(b=a?this.allowMultipleNodeSelections:this.allowMultipleSelections)?this.getSelection(a):this.getLastSelected(a)},getSingleSelectedRecord:function(a){var b=this.getSelectedRecords(a);if(null!=b){var c=!1;return(c=
a?this.allowMultipleNodeSelections:this.allowMultipleSelections)?null!=b&&1==b.length?b[0]:null:b}return null},selectedIsLeaf:function(a){var b=this.getLastSelected(a);return null!=b?a?b.isLeaf():b.data.leaf:!0},selectionIsSimple:function(a){var b=!1;return(b=a?this.allowMultipleNodeSelections:this.allowMultipleSelections)?(a=this.getSelection(a),null!=a&&1==a.length):null!=this.getLastSelected(a)},selectRecord:function(a,b){return b?this.selectTreeNode(a):this.selectGridRow(a)},getSelectionParam:function(a,
b){var c=null;null!=b&&(c=b.fromTree);if(allowMultiple=c?this.allowMultipleNodeSelections:this.allowMultipleSelections){var e=[];Ext.Array.forEach(a,function(a){e.push(this.getRecordID(a.data,b))},this);return e.join()}return this.getRecordID(a.data,b)},changeAndRefreshNode:function(a,b,c,e){var f=a.getStore();b=f.getNodeById(b);if(null!=b){if(null!=c)for(propertyName in c)b.data[propertyName]=c[propertyName];b.commit();a=a.getView();c=a.indexOf(b);a.refreshNode(c);b.isLoaded()&&e&&f.load({node:b})}}});
Ext.define("com.trackplus.admin.TreeDetail",{extend:"com.trackplus.admin.TreeBase",config:{},showGridForFolder:!1,folderDetailByFormLoad:!1,leafDetailByFormLoad:!0,treeHasItemdblclick:!1,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},loadDetailPanel:function(a,b,c){b?this.leafDetailByFormLoad?this.loadDetailPanelWithFormLoad(a,!1):this.loadSimpleDetailPanel(a,!1):this.folderDetailByFormLoad?this.loadDetailPanelWithFormLoad(a,!1):this.loadSimpleDetailPanel(a,!1)}});
Ext.define("com.trackplus.admin.TreeWithGrid",{extend:"com.trackplus.admin.TreeBase",config:{},showGridForFolder:!0,folderDetailByFormLoad:!1,showGridForLeaf:!0,gridHasItemcontextmenu:!0,gridHasItemdblclick:!0,leafDetailByFormLoad:!1,folderEditWidth:600,folderEditHeight:400,dragAndDropOnGrid:!1,actionAddFolder:null,actionAddLeaf:null,actionEditGridRow:null,actionEditTreeNode:null,actionCutTreeNode:null,actionCopyTreeNode:null,actionPasteTreeNode:null,actionDeleteGridRow:null,actionDeleteTreeNode:null,
rowIdToSelect:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},getShowGridForLeaf:function(){return this.showGridForLeaf},getGridFields:function(a){return[]},getGridColumns:function(a){return[]},initActions:function(){this.actionAddFolder=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),{isLeaf:!1}),this.getAddFolderIconCls(),this.onAddFolder,this.getTitle(this.getAddTitleKey(),{isLeaf:!1}));this.actionAddLeaf=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),
{isLeaf:!0}),this.getAddIconCls(),this.onAddLeaf,this.getTitle(this.getAddTitleKey(),{isLeaf:!0}),!0);this.actionEditGridRow=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEditGridRow,!0,this.getEditTitleKey(),"editGridRow");this.actionEditTreeNode=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEditTreeNode,!1,this.getEditTitleKey(),"editTreeNode");this.actionDeleteGridRow=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromGrid,
!0,this.getDeleteTitleKey(),"deleteGridRow");this.actionDeleteTreeNode=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromTree,!1,this.getDeleteTitleKey(),"deleteTreeNode");this.useCopyPaste?(this.actionCutTreeNode=this.createAction(this.getCutButtonKey(),this.getCutIconCls(),this.onCutTreeNode,!1,this.getCutTitleKey()),this.actionCopyTreeNode=this.createAction(this.getCopyButtonKey(),this.getCopyIconCls(),this.onCopyTreeNode,!1,this.getCopyTitleKey()),this.actionPasteTreeNode=
this.createAction(this.getPasteButtonKey(),this.getPasteIconCls(),this.onPasteTreeNode,!1,this.getPasteTitleKey()),this.actions=[this.actionAddFolder,this.actionAddLeaf,this.actionEditGridRow,this.actionCutTreeNode,this.actionCopyTreeNode,this.actionPasteTreeNode,this.actionDeleteGridRow]):this.actions=[this.actionAddFolder,this.actionAddLeaf,this.actionEditGridRow,this.actionDeleteGridRow]},getToolbarActions:function(){return[this.actionAddFolder,this.actionAddLeaf,this.actionEditGridRow,this.actionDeleteGridRow]},
getActionItemIdsWithContextDependentLabel:function(){return["editGridRow","editTreeNode","deleteGridRow","deleteTreeNode"]},getGridContextMenuActions:function(a,b){return b?[this.actionEditGridRow,this.actionDeleteGridRow]:[this.actionDeleteGridRow]},getTreeContextMenuActions:function(a,b){var c=null;b?(c=a.isLeaf()?[]:[this.actionAddFolder],c.push(this.actionAddLeaf),c.push(this.actionEditTreeNode)):c=[];this.useCopyPaste&&(c.push(this.actionCutTreeNode),c.push(this.actionCopyTreeNode),c.push(this.actionPasteTreeNode));
c.push(this.actionDeleteTreeNode);return c},getContextMenuActions:function(a,b,c){return c?this.getTreeContextMenuActions(a,b):this.getGridContextMenuActions(a,b)},onGridRowCtxMenu:function(a,b,c,e,f){this.onCtxMenu(!1,b,f);return!1},loadDetailPanel:function(a,b,c){b?this.getShowGridForLeaf()?this.getGridPanel(a,c):this.leafDetailByFormLoad?this.loadDetailPanelWithFormLoad(a,!1):this.loadSimpleDetailPanel(a,!1):this.showGridForFolder?this.getGridPanel(a,c):this.folderDetailByFormLoad?this.loadDetailPanelWithFormLoad(a,
!1):this.loadSimpleDetailPanel(a,!1)},getToolbarActionChangesForTreeNodeSelect:function(a){this.actionAddFolder.setDisabled(!1);this.actionAddLeaf.setDisabled(!1);this.actionEditGridRow.setDisabled(!0);this.actionDeleteGridRow.setDisabled(!0)},onTreeNodeDblClick:function(a,b){this.onEditTreeNode()},hasDragAndDropOnGrid:function(a){return this.dragAndDropOnGrid},onGridDrop:function(a,b,c,e){a=!1;"before"==e&&(a=!0);b={node:b.records[0].get("node"),droppedToNode:c.get("node"),before:a};this.onOrderChange(this.baseAction+
"!droppedNear.action",b)},onMoveUpGridRow:function(){var a=this.getLastSelectedGridRow();null!=a&&(nodeID=a.data.node,this.onOrderChange(this.baseAction+"!moveUp.action",{node:nodeID}))},onMoveDownGridRow:function(){var a=this.getLastSelectedGridRow();null!=a&&(nodeID=a.data.node,this.onOrderChange(this.baseAction+"!moveDown.action",{node:nodeID}))},onOrderChange:function(a,b){Ext.Ajax.request({url:a,disableCaching:!0,scope:this,success:function(a){a=Ext.decode(a.responseText);!0!==a.success&&Ext.MessageBox.alert(this.failureTitle,
a.errorMessage);this.reload.call(this,{rowToSelect:a.node})},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},isUpload:!1,method:"POST",params:b})},getGridExtraParams:function(a,b){return{node:this.selectedNodeID}},getGridPanel:function(a,b){var c=this.getGridFields(a),e=this.getGridColumns(a),f=this.baseAction+"GridModel";Ext.define(f,{extend:"Ext.data.Model",fields:c,idProperty:"node"});c={xtype:"grid",region:"center",store:Ext.create("Ext.data.Store",{proxy:{type:"ajax",
url:this.getStrutsBaseAction({isLeaf:!1})+"!loadList.action",extraParams:this.getGridExtraParams(a,b),reader:{type:"json"}},model:f,autoLoad:!0,listeners:{load:{fn:this.onGridStoreLoad,scope:this}}}),columns:e,selModel:this.getGridSelectionModel(a),autoWidth:!0,border:!1,bodyBorder:!1,cls:"gridNoBorder",stripeRows:!0};c.viewConfig=this.getGridViewConfig(a);e={selectionchange:{fn:this.onGridSelectionChange,scope:this}};this.gridHasItemcontextmenu&&(e.itemcontextmenu={fn:this.onGridRowCtxMenu,scope:this});
this.gridHasItemdblclick&&(e.itemdblclick={fn:this.onGridRowDblClick,scope:this});c.listeners=e;this.grid=Ext.create("Ext.grid.Panel",c);null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);this.centerPanel=this.grid;null!=this.replaceCenterPanel?this.replaceCenterPanel.call(this,this.centerPanel):this.mainPanel.add(this.centerPanel);this.postGridPanel(this.grid);return this.grid},getGridViewConfig:function(a){return this.hasDragAndDropOnGrid(a)?{plugins:{ptype:"gridviewdragdrop",dragGroup:this.baseAction+
"gridDDGroup",dropGroup:this.baseAction+"gridDDGroup",enableDrag:!0,enableDrop:!0},listeners:{drop:{scope:this,fn:function(a,c,e,f){this.onGridDrop(a,c,e,f)}}}}:null},postGridPanel:function(a){},onGridStoreLoad:function(a){if(null!=this.rowIdToSelect){if(a=a.getById(this.rowIdToSelect),null!=a){var b=this.grid.getSelectionModel();b.select(a)}}else 1==a.getTotalCount()&&(b=this.grid.getSelectionModel(),b.select(0))},onGridSelectionChange:function(a,b){this.enableDisableToolbarButtons(a,b);var c=null;
null!=b&&0<b.length&&(c=b[0]);this.adjustToolbarButtonsTooltip(c,!1)},onGridRowDblClick:function(a,b){this.onEditGridRow()},enableDisableToolbarButtons:function(a,b){null==b||0==b.length?(null!=this.actionDeleteGridRow&&this.actionDeleteGridRow.setDisabled(!0),null!=this.actionEditGridRow&&this.actionEditGridRow.setDisabled(!0)):(null!=this.actionDeleteGridRow&&this.actionDeleteGridRow.setDisabled(!1),null!=this.actionEditGridRow&&(1==b.length?this.actionEditGridRow.setDisabled(!1):this.actionEditGridRow.setDisabled(!0)))},
getEditUrl:function(a){return this.getStrutsBaseAction({isLeaf:a})+"!edit.action"},getSaveUrl:function(a){return this.getStrutsBaseAction({isLeaf:a})+"!save.action"},reload:com.trackplus.util.RefreshAfterSubmit.refreshGridAndTreeAfterSubmit,getAddReloadParamsAfterSave:function(a){if(null!=this.selectedNode)if(this.selectedNode.data.leaf){var b=this.selectedNode.parentNode;if(null!=b){if(a)return{nodeIDToReload:b.data.id};b=b.parentNode;if(null!=b)return{nodeIDToReload:b.data.id}}}else return{nodeIDToReload:this.selectedNode.data.id};
return null},getEditReloadParamsAfterSave:function(a){if(null!=this.selectedNode)if(a){if(a=this.selectedNode.parentNode,null!=a)return{nodeIDToReload:a.data.id}}else if(this.getShowGridForLeaf()&&this.selectedNode.isLeaf()){if(a=this.selectedNode.parentNode,null!=a)return{nodeIDToReload:a.data.id}}else return{nodeIDToReload:this.selectedNode.data.id};return null},getAddSelectionAfterSaveFromResult:function(){return[{parameterName:"nodeIDToSelect",fieldNameFromResult:"node"},{parameterName:"rowToSelect",
fieldNameFromResult:"node"}]},getEditReloadParamsAfterSaveFromResult:function(a){return a?[{parameterName:"nodeIDToSelect",fieldNameFromResult:"node"},{parameterName:"rowToSelect",fieldNameFromResult:"node"}]:this.getShowGridForLeaf()&&this.selectedNode.isLeaf()?[{parameterName:"nodeIDToSelect",fieldNameFromResult:"node"},{parameterName:"rowToSelect",fieldNameFromResult:"node"}]:{parameterName:"rowToSelect",fieldNameFromResult:"node"}},onAddFolder:function(){var a=this.getTitle(this.getAddTitleKey(),
{isLeaf:!1,selectedRecord:this.getLastSelected(!0)}),b=this.getAddFolderParams(),c=this.getAddFolderParams(),e=this.getAddReloadParamsAfterSave(!1),f=this.getAddSelectionAfterSaveFromResult(),g=this.getSingleSelectedRecord(!0);null==g&&(g=this.tree.getRootNode());return this.onAddEdit(a,g,"addFolder",!1,!0,!0,b,c,e,f)},onAddLeaf:function(){var a=this.getTitle(this.getAddTitleKey(),{isLeaf:!0,selectedRecord:this.getLastSelected(!0)}),b=this.getAddLeafParams(),c=this.getAddLeafParams(),e=this.getAddReloadParamsAfterSave(!0),
f=this.getAddSelectionAfterSaveFromResult(),g=this.getSingleSelectedRecord(!0);null==g&&(g=this.tree.getRootNode());return this.onAddEdit(a,g,"addLeaf",!0,!0,!0,b,c,e,f)},onEditGridRow:function(){return this.onEdit(!1)},onEditTreeNode:function(){return this.onEdit(!0)},onEdit:function(a){var b=this.selectedIsLeaf(a),c=this.getTitle(this.getEditTitleKey(),{isLeaf:b,fromTree:a,selectedRecord:this.getLastSelected(a)}),e=this.getEditParams(a),f=this.getEditParams(a),g=this.getEditReloadParamsAfterSave(a),
h=this.getEditReloadParamsAfterSaveFromResult(a),k=this.getSingleSelectedRecord(a);return this.onAddEdit(c,k,"edit",b,!1,a,e,f,g,h)},onAddEdit:function(a,b,c,e,f,g,h,k,l,m){var n=null;null!=b&&(n=b.data);var p=this.getEditWidth(n,e,f,g,c),q=this.getEditHeight(n,e,f,g,c);h={loadUrl:this.getEditUrl(e),loadUrlParams:h};l={submitUrl:this.getSaveUrl(e),submitUrlParams:k,submitButtonText:this.getSaveLabel(c),submitHandler:this.submitHandler,submitAction:c,refreshAfterSubmitHandler:this.reload,refreshParametersBeforeSubmit:l,
refreshParametersAfterSubmit:m};b=this.getEditPostDataProcess(b,e,f,g,c);m=this.getEditPreSubmitProcess(n,e,f);e=this.getPanelItems(n,e,f,g,c);k=this.getAdditionalActions(n,k,c,e);null!=k&&(k.push(l),l=k);a={title:a,width:p,height:q,load:h,submit:l,items:e,postDataProcess:b,preSubmitProcess:m};c=this.getExtraWindowParameters(n,c);if(null!=c)for(propertyName in c)a[propertyName]=c[propertyName];Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},getEditWidth:function(a,b,c,e,
f){return b?this.editWidth:this.folderEditWidth},getEditHeight:function(a,b,c,e,f){return b?this.editHeight:this.folderEditHeight},getPanelItems:function(a,b,c,e,f){return b?this.getEditLeafPanelItems(a,c,e,f):this.getEditFolderPanelItems(a,c,e,f)},getEditFolderPanelItems:function(a,b,c){return[]},getEditLeafPanelItems:function(a,b,c){return[]},getExtraWindowParameters:function(a,b){},getEditPreSubmitProcess:function(a,b,c){if(b){if(null!=this.getEditLeafPreSubmitProcess)return this.getEditLeafPreSubmitProcess(a,
c)}else if(null!=this.getEditFolderPreSubmitProcess)return this.getEditFolderPreSubmitProcess(a,c);return null},getEditFolderPreSubmitProcess:null,getEditLeafPreSubmitProcess:null,onCutTreeNode:function(){this.cutCopyNode=this.selectedNode;this.copy=!1},onCopyTreeNode:function(){this.cutCopyNode=this.selectedNode;this.copy=!0},onPasteTreeNode:function(){this.onDropTreeNode(this.cutCopyNode,this.selectedNode,this.copy);this.cutCopyNode=null},onDeleteFromGrid:function(){this.onDelete(!1)},onDeleteFromTree:function(){this.onDelete(!0)},
onDelete:function(a){var b=this.getSelectedRecords(a);if(null!=b){var c=this.selectedIsLeaf(a);this.deleteHandler(b,{fromTree:a,isLeaf:c})}},getReloadParamsAfterDelete:function(a,b,c){if(null!=a&&null!=a&&(c=c=null,null!=b))if(fromTree=b.fromTree){if(c=a.parentNode,null!=c)return c=c.data.id,{nodeIDToReload:c,nodeIDToSelect:c}}else if(this.getShowGridForLeaf()&&this.selectedNode.isLeaf()){if(c=this.selectedNode.parentNode,null!=c)return{nodeIDToReload:c.data.id}}else return{nodeIDToReload:this.selectedNode.data.id};
return null}});
com.trackplus.admin.CategoryConfig=Ext.define("com.trackplus.admin.customize.category.CategoryConfig",{extend:"com.trackplus.admin.TreeWithGrid",config:{rootID:"",projectID:null,excludePrivate:!1},issueFilter:!1,confirmDeleteEntity:!0,confirmDeleteNotEmpty:!0,folderAction:"categoryConfig",leafDetailUrl:null,entityID:"node",folderEditWidth:400,folderEditHeight:115,reportEditWidth:500,reportEditHeight:150,useCopyPaste:!0,dragAndDropOnTree:!0,labelWidth:170,instant:!1,upperSelectFields:null,indexMax:null,
actionInstantFilter:null,actionExecuteGridRow:null,actionExecuteTreeNode:null,actionLinkGridRow:null,actionLinkTreeNode:null,actionDownloadGridRow:null,actionDownloadTreeNode:null,btnExecute:null,statics:{showInstant:function(a,b){var c=getText("menu.findItems.instantFilter"),e=com.trackplus.admin.Filter.issueFilterWindowWidth,f=com.trackplus.admin.Filter.issueFilterWindowHeight,g=com.trackplus.admin.Filter.getTreeFilterItems(!0,!0),h={loadUrl:b,loadUrlParams:{instant:!0,add:!0,leaf:!0}},k={submitUrl:"savedFilterExecute!executeUnwrapped.action",
submitUrlParams:{instant:!0,add:!0,leaf:!0,ajax:!0},submitButtonText:getText("common.btn.applyFilter"),refreshAfterSubmitHandler:com.trackplus.admin.Filter.executeInstantFilter},l={submitUrl:"filterConfig!edit.action",submitUrlParams:{clearFilter:!0,instant:!0},submitButtonText:getText("common.btn.reset"),closeAfterSubmit:!1,refreshParametersBeforeSubmit:{items:g},refreshAfterSubmitHandler:com.trackplus.admin.Filter.clearFilter},k=[k,l];Ext.create("com.trackplus.util.WindowConfig",{postDataProcess:com.trackplus.admin.Filter.postLoadProcessTreeFilter,
preSubmitProcess:com.trackplus.admin.Filter.preSubmitProcessIssueFilter}).showWindow(a,c,e,f,h,k,g)},showAddEditFilter:function(a,b,c,e,f,g,h){var k=com.trackplus.admin.Filter.issueFilterWindowWidth,l=com.trackplus.admin.Filter.issueFilterWindowHeight,m=com.trackplus.admin.Filter.getTreeFilterItems(!0,!1);f={add:e,filterID:f,filterType:g,fromNavigatorContextMenu:!0};e={loadUrl:"filterConfig!edit.action",loadUrlParams:f};f={submitUrl:"filterConfig!save.action",submitUrlParams:f,submitButtonText:getText("common.btn.save"),
refreshParametersBeforeSubmit:{refreshScope:b,refreshMethod:c},refreshAfterSubmitHandler:function(a,e){c.call(b)}};g={submitUrl:"filterConfig!edit.action",submitUrlParams:{clearFilter:!0,instant:!0},submitButtonText:getText("common.btn.reset"),closeAfterSubmit:!1,refreshParametersBeforeSubmit:{items:m},refreshAfterSubmitHandler:com.trackplus.admin.Filter.clearFilter};f=[f,g];Ext.create("com.trackplus.util.WindowConfig",{postDataProcess:com.trackplus.admin.Filter.postLoadProcessTreeFilter,preSubmitProcess:com.trackplus.admin.Filter.preSubmitProcessIssueFilter}).showWindow(a,
h,k,l,e,f,m)}},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.baseAction=this.initBaseAction();this.isIssueFilter()?this.btnExecute="common.btn.applyFilter":this.isReport()&&(this.btnExecute="common.btn.executeReport");this.init()},isIssueFilter:function(){return 0==this.rootID.indexOf("issueFilter")},isNotifyFilter:function(){return 0==this.rootID.indexOf("notifyFilter")},isReport:function(){return 0==this.rootID.indexOf("report")},getShowGridForLeaf:function(){return this.isReport()},
initBaseAction:function(){if(this.isIssueFilter()||this.isNotifyFilter())return this.isIssueFilter()&&(this.issueFilter=!0),"filterConfig";if(this.isReport())return"reportConfig"},getEditWidth:function(a,b,c,e,f){return b?this.isIssueFilter()?com.trackplus.admin.Filter.issueFilterWindowWidth:this.isNotifyFilter()?com.trackplus.admin.Filter.notifyFilterWindowWidth:this.reportEditWidth:this.folderEditWidth},getEditHeight:function(a,b,c,e,f){return b?this.isIssueFilter()?com.trackplus.admin.Filter.issueFilterWindowHeight:
this.isNotifyFilter()?com.trackplus.admin.Filter.notifyFilterWindowHeight:this.reportEditHeight:this.folderEditHeight},getRootMessage:function(a){return this.isIssueFilter()?getText("admin.customize.queryFilter.lbl.description"):this.isNotifyFilter()?getText("admin.customize.automail.filter.lbl.description"):getText("admin.customize.reportTemplate.lbl.description")},getEntityLabel:function(a){var b=!0;null!=a&&(b=a.isLeaf);return b?this.isIssueFilter()?getText("admin.customize.queryFilter.lbl.issueFilter"):
this.isNotifyFilter()?getText("admin.customize.automail.filter.lblOperation"):getText("admin.customize.reportTemplate.lbl"):getText("admin.customize.queryFilter.lbl.category")},getSaveLabel:function(a){return"instant"==a?getText(this.btnExecute):getText("common.btn.save")},getLeafDetailUrl:function(){return this.folderAction+"!leafDetail.action"},initActions:function(){var a=null,b=null,c=null;this.isNotifyFilter()?(a=this.getAddFolderNotifyFilterIconCls(),b=this.getAddNotifyFilterIconCls(),c=this.getEditNotifyFilterIconCls()):
this.isIssueFilter()?(a=this.getAddFolderIssueFilterIconCls(),b=this.getAddIssueFilterIconCls(),c=this.getEditIssueFilterIconCls()):this.isReport()&&(a=this.getAddFolderReportIconCls(),b=this.getAddReportIconCls(),c=this.getEditReportIconCls());this.actionAddFolder=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),{isLeaf:!1}),a,this.onAddFolder,this.getTitle(this.getAddTitleKey(),{isLeaf:!1}),!0);this.actionAddLeaf=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),{isLeaf:!0}),
b,this.onAddLeaf,this.getTitle(this.getAddTitleKey(),{isLeaf:!0}),!0);this.actionEditGridRow=this.createAction(this.getEditButtonKey(),c,this.onEditGridRow,!0,this.getEditTitleKey(),"editGridRow");this.actionEditTreeNode=this.createAction(this.getEditButtonKey(),c,this.onEditTreeNode,!1,this.getEditTitleKey(),"editTreeNode");this.isIssueFilter()?(this.actionExecuteGridRow=this.createAction(this.btnExecute,"filterExec",this.onExecuteGridRow,!0,this.btnExecute),this.actionExecuteTreeNode=this.createAction(this.btnExecute,
"filterExec",this.onExecuteTreeNode,!0,this.btnExecute),this.actionInstantFilter=this.createAction("menu.findItems.instantFilter","filterInst",this.onInstantFilter,!1,"menu.findItems.newInstantFilter.tt"),this.actionLinkGridRow=this.createLocalizedAction(getText("common.btn.link"),"filterLink",this.onLinkGridRow,getText("admin.customize.queryFilter.lbl.filterURL.report.encodedUrl"),!0),this.actionLinkTreeNode=this.createLocalizedAction(getText("common.btn.permURL"),"filterLink",this.onLinkTreeNode,
getText("admin.customize.queryFilter.lbl.filterURL.report.encodedUrl"),!0)):this.isReport()&&(this.actionExecuteGridRow=this.createAction(this.btnExecute,"rtemplateExec",this.onExecuteGridRow,!0,this.btnExecute),this.actionExecuteTreeNode=this.createAction(this.btnExecute,"rtemplateExec",this.onExecuteTreeNode,!0,this.btnExecute),this.actionDownloadGridRow=this.createAction("common.btn.download","download",this.onDownloadGridRow,!0,"common.lbl.download","downloadGridRow"),this.actionDownloadTreeNode=
this.createAction("common.btn.download","download",this.onDownloadTreeNode,!0,"common.lbl.download","downloadTreeNode"));this.actionDeleteGridRow=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromGrid,!0,this.getDeleteTitleKey(),"deleteGridRow");this.actionDeleteTreeNode=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromTree,!1,this.getDeleteTitleKey(),"deleteTreeNode");this.useCopyPaste&&(this.actionCutTreeNode=this.createAction(this.getCutButtonKey(),
this.getCutIconCls(),this.onCutTreeNode,!1,this.getCutTitleKey(),"cut"),this.actionCopyTreeNode=this.createAction(this.getCopyButtonKey(),this.getCopyIconCls(),this.onCopyTreeNode,!1,this.getCopyTitleKey(),"copy"),this.actionPasteTreeNode=this.createAction(this.getPasteButtonKey(),this.getPasteIconCls(),this.onPasteTreeNode,!1,this.getPasteButtonKey()))},getActionItemIdsWithContextDependentLabel:function(){return"editGridRow editTreeNode deleteGridRow deleteTreeNode downloadGridRow downloadTreeNode cut copy".split(" ")},
getTreeExpandExtraParams:function(a){a={excludePrivate:this.excludePrivate};null!=this.projectID&&(a.projectID=this.projectID);return a},getGridExtraParams:function(a,b){null==a&&(a=this.selectedNode);var c={node:a.data.id,excludePrivate:this.excludePrivate};null!=this.projectID&&(c.projectID=this.projectID);return c},canDragDropNode:function(a,b,c){if(a.data.readOnly||!a.data.modifiable&&!b)return!1;a=c;a.isLeaf()&&(a=a.parentNode);return a.data.canAddChild?!0:!1},getDragDropBaseAction:function(a){return this.folderAction},
getToolbarActionChangesForTreeNodeSelect:function(a){var b=!1;if(null!=a)if(null!=this.projectID&&a.isRoot()){if(this.isIssueFilter()||this.isReport())b=!0}else b=a.data.canAddChild;this.actionAddFolder.setDisabled(!b);this.actionAddLeaf.setDisabled(!b);this.actionEditGridRow.setDisabled(!0);this.actionDeleteGridRow.setDisabled(!0);if(this.isIssueFilter()||this.isReport())this.actionExecuteGridRow.setDisabled(!0),this.isIssueFilter()?this.actionLinkGridRow.setDisabled(!0):this.actionDownloadGridRow.setDisabled(!0)},
onTreeNodeLoad:function(a,b){b.isRoot()&&null==this.projectID&&a.load({node:b.firstChild,callback:function(){b.firstChild.expand()}})},onTreeNodeDblClick:function(a,b){var c=b.data.readOnly;if(null==c||!1==c)this.onEditTreeNode()},onGridRowDblClick:function(a,b){var c=b.data.readOnly;if(null==c||!1==c)this.onEditGridRow()},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"readOnly",mapping:"readOnly",type:"boolean"},{name:"modifiable",
mapping:"modifiable",type:"boolean"},{name:"deletable",mapping:"deletable",type:"boolean"},{name:"canCopy",mapping:"canCopy",type:"boolean"},{name:"categoryType",mapping:"categoryType",type:"string"},{name:"treeFilter",mapping:"treeFilter",type:"boolean"},{name:"reportConfigNeeded",mapping:"reportConfigNeeded",type:"boolean"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"},{name:"canAddChild",mapping:"canAddChild",type:"boolean"}]},getLeafDetailItems:function(a,
b,c){return!0==c.success?[Ext.create("Ext.Component",{html:c.errorMessage,cls:"categoryConfigLeafDetail",border:!0})]:[]},getGridViewConfig:function(){return{forceFit:!0,markDirty:!1}},getGridFields:function(a){return this.isIssueFilter()&&"issueFilter_3"!=a.data.id?[{name:"node",type:"string"},{name:"categoryType",type:"string"},{name:"text",type:"string"},{name:"typeLabel",type:"string"},{name:"styleFieldLabel",type:"string"},{name:"viewName",type:"string"},{name:"includeInMenu",type:"boolean"},
{name:"treeFilter",type:"boolean"},{name:"modifiable",type:"boolean"},{name:"deletable",type:"boolean"},{name:"leaf",type:"boolean"}]:[{name:"node",type:"string"},{name:"categoryType",type:"string"},{name:"text",type:"string"},{name:"typeLabel",type:"string"},{name:"modifiable",type:"boolean"},{name:"deletable",type:"boolean"},{name:"readOnly",mapping:"readOnly",type:"boolean"},{name:"reportConfigNeeded",mapping:"reportConfigNeeded",type:"boolean"},{name:"icon",mapping:"icon",type:"string"},{name:"leaf",
type:"boolean"}]},getGridColumns:function(a){var b=[{header:getText("common.lbl.name"),flex:1,dataIndex:"text",sortable:!1,hidden:!1},{header:getText("common.lbl.type"),flex:1,dataIndex:"typeLabel",sortable:!1,hidden:!1}];this.isIssueFilter()&&"issueFilter_3"!=a.data.id?(b.push({header:getText("admin.customize.queryFilter.lbl.styleField"),flex:1,dataIndex:"styleFieldLabel",sortable:!1,hidden:!1}),b.push({xtype:"checkcolumn",header:getText("admin.customize.queryFilter.lbl.menu"),flex:1,dataIndex:"includeInMenu",
sortable:!1,hidden:!1,listeners:{checkchange:{fn:this.changeSubscribe,scope:this}}}),b.push({header:getText("admin.customize.queryFilter.lbl.view"),flex:1,dataIndex:"viewName",sortable:!1,hidden:!1})):this.isReport();return b},changeSubscribe:function(a,b,c,e){a=this.grid.getStore().getAt(b);null!=a&&Ext.Ajax.request({url:this.baseAction+"!changeSubscribe.action",params:{node:a.data.node,includeInMenu:c},scope:this,success:function(a){},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},
postGridPanel:function(a){if(this.isReport()){var b=a.getView();Ext.create("Ext.tip.ToolTip",{target:b.el,delegate:b.itemSelector,trackMouse:!0,id:"templatePreview",renderTo:Ext.getBody(),dismissDelay:0,listeners:{beforeshow:function(a){var e=borderLayout.getWidth();a.maxWidth=900;850>e&&(a.maxWidth=e-150);b.getRecord(a.triggerElement).get("leaf")?(e=b.getRecord(a.triggerElement).get("node"),e=e.substring(e.lastIndexOf("_")+1),a.removeAll(),e=Ext.create("Ext.Img",{src:"reportDatasource!showPreviewImage.action?templateID\x3d"+
e,alt:getText("admin.customize.reportTemplate.err.noPreviewAvailable"),listeners:{render:function(b){b.getEl().on("load",function(){a.doLayout()})}}}),a.add(e)):(a.removeAll(),e=b.getRecord(a.triggerElement).get("text"),a.add(Ext.create("Ext.Component",{html:e})))}}})}},getGridSelectionModel:function(a){return this.isReport()?Ext.create("Ext.selection.CheckboxModel",{mode:"MULTI"}):Ext.create("Ext.selection.RowModel",{mode:"SINGLE"})},getSelectedReportIDs:function(){var a=[],b=this.getSelection();
null!=b&&Ext.Array.forEach(b,function(b,e,f){b=b.data.node;e=b.lastIndexOf("_");a.push(b.substring(e+1))},this);return a.join(",")},enableDisableToolbarButtons:function(a,b){if(null==b||0==b.length){if(this.actionDeleteGridRow.setDisabled(!0),this.actionEditGridRow.setDisabled(!0),this.isIssueFilter()||this.isReport())this.actionExecuteGridRow.setDisabled(!0),this.isIssueFilter()?this.actionLinkGridRow.setDisabled(!0):this.actionDownloadGridRow.setDisabled(!0)}else{if(1==b.length){var c=b[0],e=c.data.leaf,
c=c.data.modifiable;this.isIssueFilter()&&e?this.actionEditGridRow.setDisabled(!1):this.actionEditGridRow.setDisabled(!c);if(this.isIssueFilter()||this.isReport())this.actionExecuteGridRow.setDisabled(!e),this.isIssueFilter()?this.actionLinkGridRow.setDisabled(!e):this.actionDownloadGridRow.setDisabled(!e)}else if(this.actionEditGridRow.setDisabled(!0),this.isIssueFilter()||this.isReport())this.actionExecuteGridRow.setDisabled(!0),this.isIssueFilter()?this.actionLinkGridRow.setDisabled(!0):this.actionDownloadGridRow.setDisabled(!0);
for(var e=!0,f=0;f<b.length;f++)c=b[f],c.data.deletable||(e=!1);this.actionDeleteGridRow.setDisabled(!e)}},getEditFolderPanelItems:function(a,b,c,e){c=!1;c=b?!0:a.modifiable;return[CWHF.createTextField("common.lbl.name","label",{disabled:!c,allowBlank:!1,labelWidth:this.labelWidth})]},getEditLeafPanelItems:function(a,b,c,e){c=!1;c=b?!0:null==a||a.modifiable;return this.isIssueFilter()?b||null==a||null==a.treeFilter||a.treeFilter?com.trackplus.admin.Filter.getTreeFilterItems(c,!1):com.trackplus.admin.Filter.getTQLFilterItems(c):
this.isNotifyFilter()?com.trackplus.admin.Filter.getNotifyFilterItems(c):this.getReportItems(c,b)},getReportItems:function(a,b){var c=[CWHF.createTextField("common.lbl.name","label",{disabled:!a,allowBlank:!1,labelWidth:this.labelWidth})];b&&c.push(CWHF.createFileField("admin.customize.reportTemplate.lbl.reportFile","reportFile",{disabled:!a,allowBlank:!1,labelWidth:this.labelWidth}));return c},getEditLeafPostDataProcess:function(a,b){if(this.isIssueFilter())return null==a||b||a.treeFilter?com.trackplus.admin.Filter.postLoadProcessTreeFilter:
com.trackplus.admin.Filter.postLoadProcessTQLFilter;if(this.isNotifyFilter())return com.trackplus.admin.Filter.postLoadProcessNotifyFilter},getEditLeafPreSubmitProcess:function(a,b){return this.isIssueFilter()&&(null==a||a.treeFilter||b)?com.trackplus.admin.Filter.preSubmitProcessIssueFilter:this.isNotifyFilter()?com.trackplus.admin.Filter.preSubmitProcessNotifyFilter:null},getExtraWindowParameters:function(a,b){return this.isReport()&&"addLeaf"==b?{fileUpload:!0,windowConfig:{minWidth:450,minHeight:150},
panelConfig:{autoScroll:!1}}:null},onInstantFilter:function(){this.instant=!0;this.indexMax=0;com.trackplus.admin.CategoryConfig.showInstant(this,this.baseAction+"!edit.action")},onExecuteTreeNode:function(){this.onExecute(!0)},onExecuteGridRow:function(){this.onExecute(!1)},onExecute:function(a){var b=this.getSingleSelectedRecordData(a);if(null!=b){var c=this.selectedIsLeaf(a);a=this.getRecordID(b,{fromTree:a});c&&(c=a.lastIndexOf("_"),c=a.substring(c+1),this.isIssueFilter()?com.trackplus.admin.Filter.executeFilter(this,
c):com.trackplus.admin.Report.executeReport(this,c,b.reportConfigNeeded,!1))}},onLinkTreeNode:function(){this.onLink(!0)},onLinkGridRow:function(){this.onLink(!1)},onLink:function(a){var b=this.getSingleSelectedRecordData(a);null!=b&&this.selectedIsLeaf(a)&&this.isIssueFilter()&&(a=this.getRecordID(b,{fromTree:a}),com.trackplus.admin.Filter.generateFilterLink(this,a))},onDownloadTreeNode:function(){this.downloadReport(!0)},onDownloadGridRow:function(){this.downloadReport(!1)},downloadReport:function(a){var b=
this.getSingleSelectedRecordData(a);null!=b&&this.selectedIsLeaf(a)&&this.isReport()&&(a=this.getRecordID(b,{fromTree:a}),attachmentURI=this.baseAction+"!download.action?node\x3d"+a,window.open(attachmentURI))},onAddLeaf:function(){if(this.isIssueFilter()||this.isNotifyFilter())this.indexMax=0,this.isIssueFilter()&&(this.instant=!1);this.callParent(arguments)},getAdditionalActions:function(a,b,c,e){if(this.isIssueFilter()&&null!=a&&a.leaf){var f=[];"edit"==c&&f.push({submitUrl:"savedFilterExecute!unwrappedContainsParameter.action",
submitUrlParams:b,submitButtonText:getText(this.btnExecute),refreshAfterSubmitHandler:this.executeUnwrappedFilter});a.modifiable&&(null==b&&(b={}),b.clearFilter=!0,f.push({submitUrl:"filterConfig!edit.action",submitUrlParams:b,submitButtonText:getText("common.btn.reset"),closeAfterSubmit:!1,refreshParametersBeforeSubmit:{items:e},refreshAfterSubmitHandler:com.trackplus.admin.Filter.clearFilter}));return f}return null},executeUnwrappedFilter:function(a,b){(containsParameter=b.value)?this.renderFilterParameter():
window.location.href=com.trackplus.TrackplusConfig.contextPath+"/itemNavigator.action"},renderFilterParameter:function(){var a=getText("admin.customize.queryFilter.lbl.parameters"),b=com.trackplus.admin.Filter.getTreeFilterParameterItems();Ext.create("com.trackplus.util.WindowConfig",{postDataProcess:com.trackplus.admin.Filter.postLoadProcessTreeFilterParameters}).showWindow(this,a,1E3,800,{loadUrl:"filterParameters!renderParameters.action"},{submitUrl:"savedFilterExecute!replaceSubmittedParameters.action",
submitButtonText:getText(this.btnExecute),standardSubmit:!0},b)},onEditGridRow:function(){if(this.isIssueFilter()||this.isNotifyFilter())this.indexMax=0,this.isIssueFilter()&&(this.instant=!1);this.callParent(arguments)},onEditTreeNode:function(){if(this.isIssueFilter()||this.isNotifyFilter())this.indexMax=0,this.isIssueFilter()&&(this.instant=!1);this.callParent(arguments)},getDeleteUrlBase:function(a){return this.folderAction},getReplacementItems:function(a,b,c){return[{xtype:"label",itemId:"replacementWarning"},
CWHF.createSingleTreePicker("Replacement","replacementID",[],null,{allowBlank:!1,blankText:getText("common.err.replacementRequired",this.getEntityLabel(c)),labelWidth:200,margin:"5 0 0 0"})]},loadReplacementOptionData:function(a,b){a.setData(b.replacementTree)},getImportPanel:function(){return this.formPanel=new Ext.form.FormPanel({border:!1,bodyStyle:"padding:5px",defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"side",anchor:"-20"},method:"POST",fileUpload:!0,items:[CWHF.createCheckbox("common.lbl.overwriteExisting",
"overwriteExisting",{labelWidth:200}),CWHF.createFileField("admin.customize.reportTemplate.lbl.reportFile","uploadFile",{allowBlank:!1,labelWidth:200})]})},getTreeContextMenuActions:function(a,b){var c=a.data.modifiable,e=a.data.deletable,f=a.data.canAddChild,g=a.data.canCopy,h=a.data.leaf,k=[];b?(f&&(h||k.push(this.actionAddFolder),k.push(this.actionAddLeaf)),(c||h&&this.isIssueFilter())&&k.push(this.actionEditTreeNode),h&&(this.isIssueFilter()||this.isReport())&&(k.push(this.actionExecuteTreeNode),
this.isReport()?k.push(this.actionDownloadTreeNode):this.isIssueFilter()&&k.push(this.actionLinkTreeNode))):k=[];this.useCopyPaste&&(g&&(c&&k.push(this.actionCutTreeNode),k.push(this.actionCopyTreeNode)),f&&null!=this.cutCopyNode&&k.push(this.actionPasteTreeNode));e&&k.push(this.actionDeleteTreeNode);return k},getGridContextMenuActions:function(a,b){var c=a.data.modifiable,e=[];if(a.data.leaf){if((c||this.isIssueFilter())&&e.push(this.actionEditGridRow),this.isIssueFilter()||this.isReport())e.push(this.actionExecuteGridRow),
this.isReport()?e.push(this.actionDownloadGridRow):this.isIssueFilter()&&(e.push(this.actionEditGridRow),e.push(this.actionLinkGridRow))}else c&&e.push(this.actionEditGridRow);return e},getToolbarActions:function(){if(this.isIssueFilter())return this.getIssueFilterToolbarItems();if(this.isNotifyFilter())return this.getNotifyFilterToolbarItems();if(this.isReport())return this.getReportToolbarItems()},getIssueFilterToolbarItems:function(){return null==this.projectID?[this.actionInstantFilter,this.actionAddFolder,
this.actionAddLeaf,this.actionEditGridRow,this.actionExecuteGridRow,this.actionLinkGridRow,this.actionDeleteGridRow]:[this.actionAddFolder,this.actionAddLeaf,this.actionEditGridRow,this.actionExecuteGridRow,this.actionLinkGridRow,this.actionDeleteGridRow]},getNotifyFilterToolbarItems:function(){return[this.actionAddFolder,this.actionAddLeaf,this.actionEditGridRow,this.actionDeleteGridRow]},getReportToolbarItems:function(){return[this.actionAddFolder,this.actionAddLeaf,this.actionEditGridRow,this.actionExecuteGridRow,
this.actionDownloadGridRow,this.actionDeleteGridRow]},getAddFolderIssueFilterIconCls:function(){return"categoryFilterAdd"},getAddIssueFilterIconCls:function(){return"filterAdd"},getEditIssueFilterIconCls:function(){return"filterEdit"},getAddFolderNotifyFilterIconCls:function(){return"categoryFilterAdd"},getAddNotifyFilterIconCls:function(){return"filterAdd"},getEditNotifyFilterIconCls:function(){return"filterEdit"},getPasteIconCls:function(){return"filterPaste"},getAddFolderReportIconCls:function(){return"categoryReportAdd"},
getAddReportIconCls:function(){return"rtemplateAdd"},getEditReportIconCls:function(){return"rtemplateEdit"},getAddIconCls:function(){return"rtemplateAdd"}});
Ext.define("com.trackplus.admin.customize.ReportConfig",{extend:"com.trackplus.admin.TreeDetail",config:{},baseAction:"reportConfig",folderAction:"categoryConfig",btnExecute:null,confirmDeleteEntity:!0,confirmDeleteNotEmpty:!0,leafDetailUrl:null,entityID:"node",folderEditWidth:400,folderEditHeight:115,reportEditWidth:500,reportEditHeight:150,useCopyPaste:!0,dragAndDropOnTree:!0,labelWidth:170,treeHasItemdblclick:!0,allowMultipleSelections:!0,actionAddFolder:null,actionAddLeaf:null,actionEditGridRow:null,
actionEditTreeNode:null,actionCutTreeNode:null,actionCopyTreeNode:null,actionPasteTreeNode:null,actionDeleteGridRow:null,actionDeleteTreeNode:null,localizedLabels:null,instant:!1,selectedRecords:{},statics:{},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.btnExecute="common.btn.executeReport";this.init()},initActions:function(){var a,b,c;a=this.getAddFolderReportIconCls();b=this.getAddReportIconCls();c=this.getEditReportIconCls();this.actionAddFolder=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),
{isLeaf:!1}),a,this.onAddFolder,this.getTitle(this.getAddTitleKey(),{isLeaf:!1}),!0);this.actionAddLeaf=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),{isLeaf:!0}),b,this.onAddLeaf,this.getTitle(this.getAddTitleKey(),{isLeaf:!0}),!0);this.actionEditGridRow=this.createAction(this.getEditButtonKey(),c,this.onEditGridRow,!0,this.getEditTitleKey(),"editGridRow");this.actionEditTreeNode=this.createAction(this.getEditButtonKey(),c,this.onEditTreeNode,!1,this.getEditTitleKey(),"editTreeNode");
this.actionExecuteGridRow=this.createAction(this.btnExecute,"rtemplateExec",this.onExecuteGridRow,!0,this.btnExecute);this.actionExecuteTreeNode=this.createAction(this.btnExecute,"rtemplateExec",this.onExecuteTreeNode,!0,this.btnExecute);this.actionDownloadGridRow=this.createAction("common.btn.download","download",this.onDownloadGridRow,!0,"common.lbl.download","downloadGridRow");this.actionDownloadTreeNode=this.createAction("common.btn.download","download",this.onDownloadTreeNode,!0,"common.lbl.download",
"downloadTreeNode");this.actionDeleteGridRow=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromGrid,!0,this.getDeleteTitleKey(),"deleteGridRow");this.actionDeleteTreeNode=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromTree,!1,this.getDeleteTitleKey(),"deleteTreeNode");this.useCopyPaste&&(this.actionCutTreeNode=this.createAction(this.getCutButtonKey(),this.getCutIconCls(),this.onCutTreeNode,!1,this.getCutTitleKey(),"cut"),this.actionCopyTreeNode=
this.createAction(this.getCopyButtonKey(),this.getCopyIconCls(),this.onCopyTreeNode,!1,this.getCopyTitleKey(),"copy"),this.actionPasteTreeNode=this.createAction(this.getPasteButtonKey(),this.getPasteIconCls(),this.onPasteTreeNode,!1,this.getPasteButtonKey()))},loadDetailPanel:function(a,b,c){this.getGridPanel(a,c)},getGridPanel:function(a,b){this.params={};this.params=this.getGridExtraParams(a,b);this.getDataViewPanelData()},getDataViewPanelData:function(a){var b=this;Ext.Ajax.request({url:this.getStrutsBaseAction({isLeaf:!1})+
"!loadList.action",params:this.params,success:function(a){a=Ext.decode(a.responseText);b.centerDataViewDataArrived(a)},failure:function(){},method:"GET"})},centerDataViewDataArrived:function(a){var b=this,c=[],e;for(e in a){var f={};f.text=a[e].text;f.typeLabel=a[e].typeLabel;f.icon=a[e].icon;var g=a[e].node;f.node=a[e].node;f.templateIDLong=g;f.modifiable=a[e].modifiable;f.leaf=a[e].leaf;f.templateID=g.substring(g.lastIndexOf("_")+1);f.reportConfigNeeded=a[e].reportConfigNeeded;f.categoryType=a[e].categoryType;
f.deletable=a[e].deletable;f.iconCls=a[e].iconCls;c.push(f)}a=Ext.create("Ext.data.Store",{id:"imagesStore",fields:[{name:"text",type:"string"},{name:"typeLabel",type:"string"},{name:"templateID",type:"string"},{name:"node",type:"string"},{name:"templateIDLong",type:"string"},{name:"modifiable",type:"boolean"},{name:"reportConfigNeeded",type:"boolean"},{name:"deletable",type:"boolean"},{name:"categoryType",type:"string"},{name:"iconCls",type:"string"},{name:"leaf",type:"boolean"}],data:c});c=new Ext.XTemplate('\x3ctpl for\x3d"."\x3e',
'\x3cdiv class\x3d"mosaicDiv"\x3e','\x3ctpl if\x3d"leaf\x3d\x3dtrue"\x3e','\x3ca class\x3d"example-image-link" href\x3d"reportDatasource!showPreviewImage.action?templateID\x3d{templateID}\x26leaf\x3d{leaf}\x26iconCls\x3d{iconCls}" data-lightbox\x3d"example-set"\x3e','\x3cimg class \x3d "mosaicImageReport" src\x3d"reportDatasource!showPreviewImage.action?templateID\x3d{templateID}\x26leaf\x3d{leaf}" /\x3e','\x3cp class \x3d "titeLabel" \x3e{text}/{typeLabel}\x3c/p\x3e',"\x3c/a\x3e","\x3c/tpl\x3e",
'\x3ctpl if\x3d"leaf\x3d\x3dfalse"\x3e',"\x3ctpl if\x3d\"iconCls\x3d\x3d'projects-ticon'\"\x3e",'\x3cimg class \x3d "mosaicImageFolder" src\x3d"reportDatasource!showPreviewImage.action?templateID\x3d{templateID}\x26leaf\x3d{leaf}\x26iconCls\x3d{iconCls}" /\x3e','\x3cp class \x3d "titeLabel"\x3e{text}\x3c/p\x3e',"\x3c/tpl\x3e","\x3ctpl if\x3d\"iconCls\x3d\x3d'folder'\"\x3e",'\x3cimg class \x3d "mosaicImageFolder" src\x3d"reportDatasource!showPreviewImage.action?templateID\x3d{templateID}\x26leaf\x3d{leaf}\x26iconCls\x3d{iconCls}" /\x3e',
'\x3cp class \x3d "titeLabel"\x3e{text}\x3c/p\x3e',"\x3c/tpl\x3e","\x3c/tpl\x3e","\x3c/div\x3e","\x3c/tpl\x3e",'\x3cdiv class\x3d"x-clear"\x3e\x3c/div\x3e');this.dataView=Ext.create("Ext.view.View",{store:a,tpl:c,cls:"reportsCenterContent",itemSelector:"div.mosaicDiv",overItemCls:"x-item-over",simpleSelect:!1,darggable:!0,listeners:{selectionchange:function(a,c){b.onDataViewChange(a,c)},itemcontextmenu:function(a,c,e,f,g){b.onGridRowCtxMenu(a,c,e,f,g)},itemdblclick:function(a,c,e,f,g){b.itemdblclick(a,
c,e,f,g)}},multiSelect:!0,trackOver:!0});b.initDraDrop();this.centerPanel=this.dataView;null!=this.replaceCenterPanel?this.replaceCenterPanel.call(this,this.centerPanel):this.mainPanel.add(this.centerPanel)},initDraDrop:function(){var a=this;this.dataView.on("render",function(b){a.dataView=new Ext.dd.DragZone(a.dataView.getEl(),{getDragData:function(a){if(a=a.getTarget("div.mosaicDiv",10))return d=a.cloneNode(!0),d.id=Ext.id(),a.cls="",{ddel:d,sourceEl:a,repairXY:Ext.fly(a).getXY(),sourceStore:b.store,
item:b.getRecord(a)}},getRepairXY:function(){return this.dragData.repairXY}});a.dataView.dropZone=Ext.create("Ext.dd.DropZone",a.dataView.getEl(),{getTargetFromEvent:function(a){if(a=a.getTarget("div.mosaicDiv",10))return{item:b.getRecord(a)}},onNodeDrop:function(b,e,f,g){b=b.item;b.data.id=b.data.node;g=g.item;g.data.id=g.data.node;if(a.dataViewDropIsAllowed(g.data,b.data))a.onDropDataViewNode(g,b,!1)},onNodeOver:function(b,e,f,g){return a.dataViewDropIsAllowed(g.item.data,b.item.data)?Ext.dd.DropZone.prototype.dropAllowed:
Ext.dd.DropZone.prototype.dropNotAllowed}});a.tree.dropZone=Ext.create("Ext.dd.DropZone",a.tree.getEl(),{getTargetFromEvent:function(b){if(b=b.getTarget(".x-grid-row",10))return{item:a.tree.getView().getRecord(b)}},onNodeDrop:function(b,e,f,g){b=b.item;b.data.id=b.raw.id;g=g.item;g.data.id=g.data.node;if(a.dataViewDropIsAllowed(g.data,b.data))a.onDropDataViewNode(g,b,!1)},onNodeOver:function(b,e,f,g){return a.dataViewDropIsAllowed(g.item.data,b.item.data)?Ext.dd.DropZone.prototype.dropAllowed:Ext.dd.DropZone.prototype.dropNotAllowed}})})},
dataViewDropIsAllowed:function(a,b){return b.leaf||b.node==a.node?!1:!0},onDataViewChange:function(a,b){this.enableDisableToolbarButtons(a,b);var c=null;null!=b&&0<b.length&&(c=b[0],this.selectedRecord=b[0],this.selectedRecords=b);this.adjustToolbarButtonsTooltip(c,!1)},onTreeNodeLoad:function(a,b){if(b.isRoot()&&null==this.projectID)for(var c in b.childNodes)"report_2"==b.childNodes[c].data.id&&(a.load({node:b.childNodes[c],callback:function(){b.childNodes[c].expand()}}),this.params={},this.params.node=
b.childNodes[c].data.id,this.nodeIDToSelect=b.childNodes[c].data.id,this.getDataViewPanelData())},enableDisableToolbarButtons:function(a,b){if(null==b||0==b.length)this.actionDeleteGridRow.setDisabled(!0),this.actionEditGridRow.setDisabled(!0),this.actionExecuteGridRow.setDisabled(!0),this.actionDownloadGridRow.setDisabled(!0);else{if(1==b.length){var c=b[0],e=c.data.leaf;this.actionEditGridRow.setDisabled(!c.data.modifiable);this.actionExecuteGridRow.setDisabled(!e);this.actionDownloadGridRow.setDisabled(!e)}else this.actionEditGridRow.setDisabled(!0),
this.actionExecuteGridRow.setDisabled(!0),this.actionDownloadGridRow.setDisabled(!0);for(var e=!0,f=0;f<b.length;f++)c=b[f],c.data.deletable||(e=!1);this.actionDeleteGridRow.setDisabled(!e)}},onEdit:function(a){var b=this.selectedIsLeaf(a),c=this.getTitle(this.getEditTitleKey(),{isLeaf:b,fromTree:a,selectedRecord:this.getLastSelected(a)}),e={},f={},g={},h={},k={};a?(e=this.getEditParams(a),f=this.getEditParams(a),g=this.getEditReloadParamsAfterSave(a),h=this.getEditReloadParamsAfterSaveFromResult(a),
k=this.getSingleSelectedRecord(a)):(k=this.selectedRecord,e.node=this.selectedRecord.data.templateIDLong,f.node=this.selectedRecord.data.templateIDLong);return this.onAddEdit(c,k,"edit",b,!1,a,e,f,g,h)},onEditTreeNode:function(){this.onEdit(!0)},getEditReloadParamsAfterSaveFromResult:function(a){if(a)return[{parameterName:"nodeIDToSelect",fieldNameFromResult:"node"},{parameterName:"rowToSelect",fieldNameFromResult:"node"}]},onTreeNodeDblClick:function(a,b){var c=b.data.readOnly;if(null==c||!1==c)this.onEditTreeNode()},
onAddEdit:function(a,b,c,e,f,g,h,k,l,m){var n=null;null!=b&&(n=b.data);var p=this.getEditWidth(n,e,f,g,c),q=this.getEditHeight(n,e,f,g,c);h={loadUrl:this.getEditUrl(e),loadUrlParams:h};l={submitUrl:this.getSaveUrl(e),submitUrlParams:k,submitButtonText:this.getSaveLabel(c),submitHandler:this.submitHandler,submitAction:c,refreshAfterSubmitHandler:this.reload,refreshParametersBeforeSubmit:l,refreshParametersAfterSubmit:m};b=this.getEditPostDataProcess(b,e,f,g,c);m=this.getEditPreSubmitProcess(n,e,f);
e=this.getPanelItems(n,e,f,g,c);k=this.getAdditionalActions(n,k,c,e);null!=k&&(k.push(l),l=k);a={title:a,width:p,height:q,load:h,submit:l,items:e,postDataProcess:b,preSubmitProcess:m};c=this.getExtraWindowParameters(n,c);if(null!=c)for(propertyName in c)a[propertyName]=c[propertyName];Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},reload:function(a){a.reloadTree=!0;com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit.call(this,a);this.getDataViewPanelData()},onAddFolder:function(){var a=
this.getTitle(this.getAddTitleKey(),{isLeaf:!1,selectedRecord:this.getLastSelected(!0)}),b=this.getAddFolderParams(),c=this.getAddFolderParams(),e=this.getAddReloadParamsAfterSave(!1),f=this.getAddSelectionAfterSaveFromResult(),g=this.getSingleSelectedRecord(!0);null==g&&(g=this.tree.getRootNode());return this.onAddEdit(a,g,"addFolder",!1,!0,!0,b,c,e,f)},onAddLeaf:function(){var a=this.getTitle(this.getAddTitleKey(),{isLeaf:!0,selectedRecord:this.getLastSelected(!0)}),b=this.getAddLeafParams(),c=
this.getAddLeafParams(),e=this.getAddReloadParamsAfterSave(!0),f=this.getAddSelectionAfterSaveFromResult(),g=this.getSingleSelectedRecord(!0);null==g&&(g=this.tree.getRootNode());return this.onAddEdit(a,g,"addLeaf",!0,!0,!0,b,c,e,f)},onDownloadTreeNode:function(){this.downloadReport(!0)},downloadReport:function(a){if(a){var b=this.getSingleSelectedRecordData(a);null!=b&&(this.selectedIsLeaf(a),a=this.getRecordID(b,{fromTree:a}),attachmentURI=this.baseAction+"!download.action?node\x3d"+a,window.open(attachmentURI))}else a=
this.selectedRecord.data.templateIDLong,attachmentURI=this.baseAction+"!download.action?node\x3d"+a,window.open(attachmentURI)},getDeleteUrlBase:function(a){return"categoryConfig"},onDeleteFromTree:function(){this.onDelete(!0)},onDeleteFromGrid:function(){this.onDelete(!1)},onDelete:function(a){var b=[],b=a?this.getSelectedRecords(a):this.selectedRecords;if(null!=b){var c=this.selectedIsLeaf(a);this.deleteHandler(b,{fromTree:a,isLeaf:c})}},onCutTreeNode:function(){this.cutCopyNode=this.selectedNode;
this.copy=!1},onCopyTreeNode:function(){this.cutCopyNode=this.selectedNode;this.copy=!0},onPasteTreeNode:function(){this.onDropTreeNode(this.cutCopyNode,this.selectedNode,this.copy);this.cutCopyNode=null},onGridRowCtxMenu:function(a,b,c,e,f){f.stopEvent();this.selectedRecord=b;a=this.selectionIsSimple(!1);a=this.getContextMenuActions(b,a,!1);null!=a&&0<a.length&&(a=this.createContextMenu(b,a),this.adjustContextMenuText(a,b,!1),a.showAt(f.getXY()));return!1},itemdblclick:function(a,b,c,e,f){this.params=
{};this.nodeIDToSelect=this.params.node=b.data.node;this.treePanel=this.tree;this.getDataViewPanelData()},onDownloadGridRow:function(){this.downloadReport(!1)},onEditGridRow:function(){this.onEdit(!1)},onExecuteTreeNode:function(){this.onExecute(!0)},onExecuteGridRow:function(){this.onExecute(!1)},onExecute:function(a){if(a){var b=this.getSingleSelectedRecordData(a);if(null!=b){var c=this.selectedIsLeaf(a);a=this.getRecordID(b,{fromTree:a});c&&(c=a.lastIndexOf("_"),c=a.substring(c+1),com.trackplus.admin.Report.executeReport(this,
c,b.reportConfigNeeded,!1))}}else c=this.selectedRecord.data.leaf,a=this.selectedRecord.data.node,c&&(c=a.lastIndexOf("_"),c=a.substring(c+1),com.trackplus.admin.Report.executeReport(this,c,!0,!1))},getEntityLabel:function(a){var b=!0;null!=a&&(b=a.isLeaf);return b?getText("admin.customize.reportTemplate.lbl"):getText("admin.customize.queryFilter.lbl.category")},getSaveLabel:function(a){return"instant"==a?getText(this.btnExecute):getText("common.btn.save")},getLeafDetailUrl:function(){return this.folderAction+
"!leafDetail.action"},getRootMessage:function(a){return getText("admin.customize.reportTemplate.lbl.description")},getActionItemIdsWithContextDependentLabel:function(){return"editGridRow editTreeNode deleteGridRow deleteTreeNode downloadGridRow downloadTreeNode cut copy".split(" ")},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"readOnly",mapping:"readOnly",type:"boolean"},{name:"modifiable",mapping:"modifiable",type:"boolean"},
{name:"deletable",mapping:"deletable",type:"boolean"},{name:"canCopy",mapping:"canCopy",type:"boolean"},{name:"categoryType",mapping:"categoryType",type:"string"},{name:"treeFilter",mapping:"treeFilter",type:"boolean"},{name:"reportConfigNeeded",mapping:"reportConfigNeeded",type:"boolean"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"},{name:"canAddChild",mapping:"canAddChild",type:"boolean"}]},getGridExtraParams:function(a,b){return{node:this.selectedNodeID}},
getTreeExpandExtraParams:function(a){a={excludePrivate:this.excludePrivate};null!=this.projectID&&(a.projectID=this.projectID);return a},getAddFolderReportIconCls:function(){return"categoryReportAdd"},getAddReportIconCls:function(){return"rtemplateAdd"},getEditReportIconCls:function(){return"rtemplateEdit"},getToolbarActions:function(){return this.getReportToolbarItems()},getReportToolbarItems:function(){return[this.actionAddFolder,this.actionAddLeaf,this.actionEditGridRow,this.actionExecuteGridRow,
this.actionDownloadGridRow,this.actionDeleteGridRow]},getToolbarActionChangesForTreeNodeSelect:function(a){var b=!1;null!=a&&(b=null!=this.projectID&&a.isRoot()?!0:a.data.canAddChild);this.actionAddFolder.setDisabled(!b);this.actionAddLeaf.setDisabled(!b);this.actionEditGridRow.setDisabled(!0);this.actionDeleteGridRow.setDisabled(!0);this.actionExecuteGridRow.setDisabled(!0);this.actionDownloadGridRow.setDisabled(!0)},getLastSelected:function(a){return a?this.getLastSelectedTreeNode():this.selectedRecord.data},
getSelection:function(a){return a?this.getTreeSelection():this.selectedRecords},getShowGridForLeaf:function(){return!0},selectedIsLeaf:function(a){var b=this.getLastSelected(a);return null!=b?a?b.isLeaf():b.leaf:!0},getReloadParamsAfterDelete:function(a,b,c){if(null!=a&&null!=a&&(c=c=null,null!=b))if(fromTree=b.fromTree){if(c=a.parentNode,null!=c)return c=c.data.id,{nodeIDToReload:c,nodeIDToSelect:c}}else if(this.getShowGridForLeaf()&&this.selectedNode.isLeaf()){if(c=this.selectedNode.parentNode,
null!=c)return{nodeIDToReload:c.data.id}}else return{nodeIDToReload:this.selectedNode.data.id};return null},getAddReloadParamsAfterSave:function(a){if(null!=this.selectedNode)if(this.selectedNode.data.leaf){var b=this.selectedNode.parentNode;if(null!=b){if(a)return{nodeIDToReload:b.data.id};b=b.parentNode;if(null!=b)return{nodeIDToReload:b.data.id}}}else return{nodeIDToReload:this.selectedNode.data.id};return null},getAddSelectionAfterSaveFromResult:function(){return[{parameterName:"nodeIDToSelect",
fieldNameFromResult:"node"},{parameterName:"rowToSelect",fieldNameFromResult:"node"}]},getEditUrl:function(a){return this.getStrutsBaseAction({isLeaf:a})+"!edit.action"},getSaveUrl:function(a){return this.getStrutsBaseAction({isLeaf:a})+"!save.action"},getEditPreSubmitProcess:function(a,b,c){if(b){if(null!=this.getEditLeafPreSubmitProcess)return this.getEditLeafPreSubmitProcess(a,c)}else if(null!=this.getEditFolderPreSubmitProcess)return this.getEditFolderPreSubmitProcess(a,c);return null},getPanelItems:function(a,
b,c,e,f){return b?this.getEditLeafPanelItems(a,c,e,f):this.getEditFolderPanelItems(a,c,e,f)},getExtraWindowParameters:function(a,b){return"addLeaf"==b?{fileUpload:!0,windowConfig:{minWidth:450,minHeight:150},panelConfig:{autoScroll:!1}}:null},getEditFolderPanelItems:function(a,b,c,e){c=!1;c=b?!0:a.modifiable;return[CWHF.createTextField("common.lbl.name","label",{disabled:!c,allowBlank:!1,labelWidth:this.labelWidth})]},getEditLeafPanelItems:function(a,b,c,e){c=!1;c=b?!0:a.modifiable;return this.getReportItems(c,
b)},getReportItems:function(a,b){var c=[CWHF.createTextField("common.lbl.name","label",{disabled:!a,allowBlank:!1,labelWidth:this.labelWidth})];b&&c.push(CWHF.createFileField("admin.customize.reportTemplate.lbl.reportFile","reportFile",{disabled:!a,allowBlank:!1,labelWidth:this.labelWidth}));return c},getEditWidth:function(a,b,c,e,f){return b?this.reportEditWidth:this.folderEditWidth},getEditHeight:function(a,b,c,e,f){return b?this.reportEditHeight:this.folderEditHeight},getEditReloadParamsAfterSave:function(a){if(null!=
this.selectedNode)if(a){if(a=this.selectedNode.parentNode,null!=a)return{nodeIDToReload:a.data.id}}else if(this.getShowGridForLeaf()&&this.selectedNode.isLeaf()){if(a=this.selectedNode.parentNode,null!=a)return{nodeIDToReload:a.data.id}}else return{nodeIDToReload:this.selectedNode.node};return null},getGridContextMenuActions:function(a,b){var c=a.data.modifiable,e=[];a.data.leaf?(c&&e.push(this.actionEditGridRow),e.push(this.actionExecuteGridRow),e.push(this.actionDownloadGridRow)):c&&e.push(this.actionEditGridRow);
return e},getTreeContextMenuActions:function(a,b){var c=a.data.modifiable,e=a.data.deletable,f=a.data.canAddChild,g=a.data.canCopy,h=a.data.leaf,k=[];b?(f&&(h||k.push(this.actionAddFolder),k.push(this.actionAddLeaf)),c&&k.push(this.actionEditTreeNode),h&&(k.push(this.actionExecuteTreeNode),k.push(this.actionDownloadTreeNode))):k=[];this.useCopyPaste&&(g&&(c&&k.push(this.actionCutTreeNode),k.push(this.actionCopyTreeNode)),f&&null!=this.cutCopyNode&&k.push(this.actionPasteTreeNode));e&&k.push(this.actionDeleteTreeNode);
return k},getContextMenuActions:function(a,b,c){return c?this.getTreeContextMenuActions(a,b):this.getGridContextMenuActions(a,b)},getRecordID:function(a,b){var c=null;null!=b&&(c=b.fromTree);return c?a.id:a.node},canDragDropNode:function(a,b,c){if(a.data.readOnly||!a.data.modifiable&&!b)return!1;a=c;a.isLeaf()&&(a=a.parentNode);return a.data.canAddChild?!0:!1},getDragDropBaseAction:function(a){return this.folderAction},onDropDataViewNode:function(a,b,c){var e=this,f=this.getDragDropBaseAction(a.data.leaf);
Ext.Ajax.request({fromCenterPanel:!0,url:f+"!copy.action",params:{nodeFrom:a.data.id,nodeTo:b.data.id,copy:c},scope:this,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);!0==a.success?e.reload({nodeIDToReload:b.data.id,nodeIDToSelect:b.data.id}):null!=a.errorMessage&&Ext.MessageBox.alert(this.failureTitle,a.errorMessage)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})}});com.trackplus.admin.Report=function(){};
com.trackplus.admin.Report.executeReport=function(a,b,c,e,f,g,h){c?(params={templateID:b},null!=e&&(params.fromIssueNavigator=e),null!=f&&(params.workItemIDs=f),null!=g&&(params.projectID=g),null!=h&&(params.dashboardID=h),Ext.Ajax.request({url:"reportDatasource!configPage.action",params:params,scope:a,disableCaching:!0,success:function(c){var f=Ext.decode(c.responseText);c=!e&&f.implementSerialization;f=Ext.create(f.configClass,f.configData);com.trackplus.admin.Report.showConfigPage(a,b,f,c)},failure:function(b){Ext.MessageBox.alert(a.failureTitle,
b.responseText)},method:"POST"})):(c="reportDatasource.action?templateID\x3d"+b,null!=e&&(c=c+"\x26fromIssueNavigator\x3d"+e),null!=f&&(c=c+"\x26workItemIDs\x3d"+f),null!=g&&(c=c+"\x26projectID\x3d"+g),null!=h&&(c=c+"\x26dashboardID\x3d"+h),window.open(c))};
com.trackplus.admin.Report.showConfigPage=function(a,b,c,e){var f={loadHandler:com.trackplus.admin.Report.loadConfigPage},g={templateID:b},h=getText("admin.customize.reportTemplate.msg.waitForReportCreate");b={standardSubmit:!0,submitUrl:"reportDatasource.action",submitUrlParams:g,submitButtonText:getText("common.btn.executeReport"),submitMessage:h};e?(e={standardSubmit:!0,submitUrl:"reportDatasource!serializeDatasource.action",submitUrlParams:g,submitButtonText:getText("common.btn.XML"),submitMessage:h},
submit=[b,e]):submit=b;c={title:getText("admin.customize.reportTemplate.lbl.configure"),width:450,height:450,load:f,submit:submit,cancelButtonText:getText("common.btn.done"),formPanel:c};Ext.create("com.trackplus.util.WindowConfig",c).showWindowByConfig(a)};com.trackplus.admin.Report.loadConfigPage=function(){};
com.trackplus.admin.Report.executeReportFromIssueNavigator=function(a){var b=CWHF.createSingleTreePicker("admin.customize.reportTemplate.lblAlone","templateID",[],null,{allowBlank:!1,labelWidth:100});a={standardSubmit:!0,submitUrlParams:{fromIssueNavigator:!0,workItemIDs:a},submitButtonText:getText("common.btn.executeReport"),submitHandler:com.trackplus.admin.Report.submitReport};b={title:getText("admin.customize.reportTemplate.lbl.choose"),width:500,height:120,load:{loadUrl:"reportDatasource!chooseReport.action"},
submit:a,postDataProcess:com.trackplus.admin.Report.postDataProcess,items:[b]};Ext.create("com.trackplus.util.WindowConfig",b).showWindowByConfig(this)};com.trackplus.admin.Report.postDataProcess=function(a,b){var c=b.getComponent("templateID");null!=c&&(c.updateData(a.categoryTree),c.setValue(a.templateID))};
com.trackplus.admin.Report.submitReport=function(a,b,c){var e=this.formEdit.getComponent("templateID").getSubmitValue();null!=e&&(Ext.Ajax.request({url:"reportDatasource!hasDatasourcePlugin.action",params:{templateID:e},scope:this,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText).value;com.trackplus.admin.Report.executeReport(this,e,a,!0,c.workItemIDs)},failure:function(a){Ext.MessageBox.alert(scope.failureTitle,a.responseText)},method:"POST"}),a.close())};
Ext.define("com.trackplus.layout.ReportConfigLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,reportsConfig:null,selectedGroup:"reports",constructor:function(a){var b=this;b.callParent(arguments);var c=b.initData.fromIssueNavigator;b.borderLayoutController.setHelpContext("reportConfig");b.reportsConfig=Ext.create("com.trackplus.admin.customize.ReportConfig",{rootID:"report",fromIssueNavigator:c,replaceCenterPanel:function(a){b.borderLayoutController.setCenterContent.call(b.borderLayoutController,
a)}});b.onReady(function(){b.borderLayoutController.setActiveToolbarList(b.reportsConfig.getToolbarActions())})},createCenterPanel:function(){null==this.reportsConfig.centerPanel&&this.reportsConfig.createCenterPanel();return this.reportsConfig.centerPanel},createWestPanel:function(){null==this.reportsConfig.tree&&this.reportsConfig.createCenterPanel();this.reportsConfig.tree.addCls("westTreeNavigator");return this.reportsConfig.tree}});
Ext.define("GeneralLearning.ux.VerticalHeader",{alias:"plugin.verticalheader",grid:null,extraCfg:null,textMetric:null,init:function(a){this.grid=a;this.grid.addCls("v-vertical-header-grid");this.textMetric=new Ext.util.TextMetrics;if(this.isLocked()){a=Ext.create("GeneralLearning.ux.VerticalHeader",this.extraCfg);var b=Ext.create("GeneralLearning.ux.VerticalHeader",this.extraCfg);a.init(this.grid.normalGrid);b.init(this.grid.lockedGrid);this.grid.normalGrid.plugins.push(a);this.grid.lockedGrid.plugins.push(b)}else this.grid.on({afterlayout:{scope:this,
fn:this.handleAfterLayout}})},constructor:function(a){this.extraCfg=a;Ext.apply(this,a);this.callParent(arguments)},handleAfterLayout:function(a){var b=this,c=0,e;a.headerCt.items.each(function(a){(e=b.textMetric.getWidth(a.text))>c&&(c=e+10)});a.headerCt.el.select(".x-column-header-text").each(function(a){a.setSize(c,c)})},isLocked:function(){return this.grid.normalGrid&&this.grid.lockedGrid}});
Ext.define("com.trackplus.linking.LinkingController",{extend:"Ext.Base",config:{model:{}},view:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},createView:function(){null==this.view&&(this.view=Ext.create("com.trackplus.linking.LinkingView",{model:this.model}));return this.view}});
Ext.define("com.trackplus.linking.LinkingView",{extend:"Ext.panel.Panel",config:{model:{}},border:!1,layout:"border",cls:"linking",northPanel:null,centerPanel:null,readOnly:!1,initComponent:function(){this.items=this.createChildren();this.callParent()},createChildren:function(){this.createNorthPanel();this.centerPanel=Ext.create("Ext.panel.Panel",{region:"center",layout:"fit",html:"...."});return[this.northPanel,this.centerPanel]},createNorthPanel:function(){var a=this.model.rowsQueryID,b=this.model.linkTypeWithDirection;
this.cmbColumnsQuery=this.createFilterPickerCfg("linking.lbl.verticalQuery","columnsQueryID",this.model.columnsQueryID);this.cmbRowsQuery=this.createFilterPickerCfg("linking.lbl.horizontalQuery","rowsQueryID",a);this.cmbLinkType=CWHF.createCombo("linking.lbl.linkType","linkTypeWithDirection",{labelWidth:150,width:500,idType:"string"});this.cmbLinkType.store.loadData(this.model.linkTypesList,!1);this.cmbLinkType.setValue(b);this.btnApply=Ext.create("Ext.button.Button",{overflowText:getText("linking.lbl.search"),
text:getText("linking.lbl.search"),margin:"5 5 5 155",handler:this.applyHandler,scope:this});this.northPanel=Ext.create("Ext.panel.Panel",{layout:"anchor",region:"north",border:!1,margin:"10 0 5 0",bodyBorder:!1,items:[this.cmbRowsQuery,this.cmbColumnsQuery,this.cmbLinkType,this.btnApply]})},applyHandler:function(){var a=this,b=a.cmbColumnsQuery.getValue(),c=a.cmbRowsQuery.getValue(),e=a.cmbLinkType.getValue();if(null==b||null==c)return!1;borderLayout.setLoading(!0);a.linkTypeWithDirection=e;Ext.Ajax.request({url:"linking!search.action",
params:{columnsQueryID:b,rowsQueryID:c,linkTypeWithDirection:e},disableCaching:!0,success:function(b){var c=Ext.decode(b.responseText);a.emptyCols=null;if(!0==c.success){var e=c.data.itemsRows,k=c.data.itemsColumns,l=c.data.links,m=c.data.linksDescription,n=[];b=[];var p=[];a.readOnly=c.data.readOnly;for(c=0;c<e.length;c++){var q={};q.f=e[c].title;q.id=e[c].id;q.workItemID=e[c].objectID;var t=!1;if(null!=l)for(var r=0;r<k.length;r++){var v="",u=e[c].objectID+"_"+k[r].objectID;null!=l[u]&&(v=l[u],
t=!0);q["f"+k[r].objectID]=v;var v=!1,s;for(s in l)-1!=s.indexOf("_"+k[r].objectID)&&(v=!0);!1==v&&p.push(r)}!1==t&&b.push(e[c].objectID);n.push(q)}s={itemsColumns:k,itemsRows:e,linksDescription:m,data:n};a.emptyRows=b;a.emptyCols=p;a.createGrid(s);a.centerPanel.removeAll(!0);a.centerPanel.add(a.gridView)}else a.centerPanel.removeAll(!0),b=c.errorMessage,"tooManyItems"==b&&(b=getText("itemov.err.tooManyItems")),b=Ext.create("Ext.Component",{html:b,border:!1,cls:"infoBox1"}),a.centerPanel.add(b);borderLayout.setLoading(!1)},
failure:function(){borderLayout.setLoading(!1);CWHF.showMsgError("Failure")},method:"POST"})},createGrid:function(a){var b=a.itemsColumns;this.itemsColumns=b;b=this.createFields(b);b=Ext.create("Ext.data.Store",{fields:b,data:a.data});this.gridView=Ext.create("Ext.grid.Panel",{margins:"0 0 0 0",border:!1,bodyBorder:!1,columnLines:!0,cls:"simpleGridView gridNoBorder",viewConfig:{stripeRows:!0},store:b,columns:this.createColumnModel(a),plugins:[Ext.create("GeneralLearning.ux.VerticalHeader",{})]});
this.gridView.addListener("cellcontextmenu",this.onCellContextMenu,this);this.gridView.addListener("celldblclick",this.onItemDblClick,this);return this.gridView},createFields:function(a){var b=[];b.push({name:"f"});b.push({name:"id"});b.push({name:"workItemID",type:"int",useNull:!0});if(null!=a)for(var c=0;c<a.length;c++)b.push({name:"f"+a[c].objectID});return b},createColumnModel:function(a){var b=this,c=a.itemsColumns,e=[];e.push(Ext.create("Ext.grid.column.Column",{header:"",draggable:!1,menuDisabled:!0,
sortable:!1,width:200,dataIndex:"f",locked:!0,resizable:!0,renderer:function(a,b,c,e,f,g,h){b.tdAttr='data-qtip\x3d"'+(c.data.id+"\x3cb\x3e : \x3c/b\x3e"+c.data.f)+'"';return a}}));for(var f=0;f<c.length;f++){var g=c[f],h=g.title;17<h.length&&(h=h.substring(0,17)+"...");g=Ext.create("Ext.grid.column.Column",{header:h,tooltip:g.id+"\x3cB\x3e : \x3c/B\x3e"+g.title,draggable:!1,menuDisabled:!0,sortable:!1,width:25,dataIndex:"f"+g.objectID,resizable:!1,renderer:function(c,e,f,g,h,q,t){0==h&&null!=b.emptyRows&&
Ext.Array.contains(b.emptyRows,f.data.workItemID)&&(e.tdCls="linkingEmptyRow");0==g&&null!=b.emptyCols&&Ext.Array.contains(b.emptyCols,h)&&(e.tdCls+=" linkingEmptyCol");return null!=c&&""!=c?(c=a.linksDescription[c],null!=c&&(e.tdAttr='data-qtip\x3d"'+c+'"'),'\x3cimg src\x3d"'+com.trackplus.TrackplusConfig.icon16Path+'arrow_bent.png"\x3e'):c}});e.push(g)}return e},onCellContextMenu:function(a,b,c,e,f,g,h,k){var l=this;f=e.data.workItemID;null!=f&&-1!=f&&(l.lastTDOriginaClass=b.className,b.className+=
" linkCellFocus",l.lastTD=b,a=l.createPopupCell(e.data,a,c),null!=a&&(a.addListener("hide",function(){l.lastTD.className=l.lastTDOriginaClass}),a.showAt(h.getXY())))},onItemDblClick:function(a,b,c,e,f,g,h){a=e.data.workItemID;null!=a&&-1!=a&&(a=Ext.create("com.trackplus.item.ItemActionDialog",{workItemID:a,actionID:-2,parentID:null,modal:!1}),a.execute.call(a))},createPopupCell:function(a,b,c){null!=this.popupMenu&&(this.popupMenu.destroy(),this.popupMenu=null,delete this.popupMenu);return this.popupMenu=
Ext.create("Ext.menu.Menu",{floating:!0,items:this.getPopupMenuItems.call(this,a,b,c),closeAction:"destroy"})},getPopupMenuItems:function(a,b,c){var e=this,f=a.workItemID,g=e.itemsColumns[c].objectID,h=a["f"+g];a=[];e.readOnly||(null==h||""==h?a.push({text:getText("common.btn.addLink"),iconCls:"links16",handler:function(){borderLayout.setLoading(!0);Ext.Ajax.request({url:"itemLink!saveItemLink.action",params:{linkTypeWithDirection:e.linkTypeWithDirection,linkedWorkItemID:g,workItemID:f},success:function(a){borderLayout.setLoading(!1);
a=Ext.decode(a.responseText);!0==a.success?e.applyHandler():(a=a.errors,null!=a&&(linkedWorkItemTitle=a.linkedWorkItemTitle,null!=linkedWorkItemTitle&&Ext.MessageBox.show({title:getText("common.err.failure"),msg:linkedWorkItemTitle,buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR})))},failure:function(a){borderLayout.setLoading(!1)}})}}):a.push({text:getText("common.btn.delete"),iconCls:"delete16",handler:function(){borderLayout.setLoading(!0);Ext.Ajax.request({url:"itemLink!deleteLinks.action",params:{deletedItems:h,
workItemID:f},success:function(a){borderLayout.setLoading(!1);e.applyHandler()},failure:function(a){borderLayout.setLoading(!1)}})}}),a.push("-"));a.push({text:getText("item.action.viewInNewTab"),iconCls:"itemAction_viewAll16",handler:function(){window.open("printItem.action?key\x3d"+f,"printItem"+f)}});return a},createFilterPickerCfg:function(a,b,c,e){var f={allowBlank:!1,labelWidth:150,labelAlign:"right",width:500,margin:"0 0 5 0"};if(null!=e)for(var g in e)f[g]=e[g];var h=CWHF.createSingleTreePicker(a,
b,[],c,f);Ext.Ajax.request({url:"categoryPicker.action",params:{node:"issueFilter"},success:function(a){a=Ext.decode(a.responseText);h.updateData(a);h.setValue(c)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}});return h}});
Ext.define("com.trackplus.layout.LinkingLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,selectedGroup:"linking",constructor:function(a){this.callParent(arguments);this.borderLayoutController.setHelpContext("linking")},createCenterPanel:function(){return Ext.create("com.trackplus.linking.LinkingController",{model:this.initData}).createView()}});
Ext.define("com.trackplus.layout.CustomFrameLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.selectedGroup=this.initData.pluginID;this.borderLayoutController.setHelpContext("customFrame");this.onReady(function(){})},createCenterPanel:function(){var a={xtype:"component",border:!1,autoEl:{tag:"iframe",src:this.initData.url}};document.title=this.initData.title;return a}});
Ext.define("com.trackplus.admin.GridConfig",{extend:"com.trackplus.admin.CrudBase",config:{urlStore:null,autoLoadGrid:!0,fields:null,columnModel:null,useCopy:!1,enableColumnHide:!1,enableColumnMove:!1,features:[],entityID:"objectID"},enableColumnHide:!1,enableColumnMove:!1,actionAdd:null,actionEdit:null,actionCopy:null,actionDelete:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},init:function(){this.initActions()},initActions:function(){this.actionAdd=this.createAction(this.getAddButtonKey(),
this.getAddIconCls(),this.onAdd,!1,this.getAddTitleKey());this.actionEdit=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEdit,!0,this.getEditTitleKey());this.actionDelete=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDelete,!0,this.getDeleteTitleKey());!0==this.useCopy?(this.actionCopy=this.createAction(this.getCopyButtonKey(),this.getCopyIconCls(),this.onCopy,!0,this.getCopyTitleKey()),this.actions=[this.actionAdd,this.actionEdit,this.actionCopy,
this.actionDelete]):this.actions=[this.actionAdd,this.actionEdit,this.actionDelete]},getGridContextMenuActions:function(a,b){var c=[];b&&(c.push(this.actionEdit),this.useCopy&&c.push(this.actionCopy));c.push(this.actionDelete);return c},onGridRowCtxMenu:function(a,b,c,e,f){f.stopEvent();a.getSelectionModel().select(b);a=this.getSelectedRecords();c=this.selectionIsSimple();a=this.getGridContextMenuActions(a,c);this.createContextMenu(b,a).showAt(f.getXY());return!1},getGridFields:function(){return this.fields},
getColumnModel:function(){return this.columnModel},getLoadGridUrl:function(){return this.urlStore},getLoadGridParams:function(){return null},getDockedItems:function(){return null},initGrid:function(){var a=Ext.create("Ext.data.Store",{fields:this.getGridFields(),proxy:{type:"ajax",url:this.getLoadGridUrl(),extraParams:this.getLoadGridParams(),reader:{type:"json"}},listeners:{load:{fn:this.onGridStoreLoad,scope:this}},autoLoad:this.autoLoadGrid});this.grid=Ext.create("Ext.grid.Panel",{store:a,selModel:this.getGridSelectionModel(),
columns:this.getColumnModel(),region:"center",stripeRows:!0,border:!1,margin:"0 0 0 0",bodyBorder:!1,cls:"gridNoBorder",style:this.style,enableColumnHide:this.enableColumnHide,enableColumnMove:this.enableColumnMove,columnLines:!0,viewConfig:this.getViewConfig(),dockedItems:this.getDockedItems(),features:this.features,listeners:{itemdblclick:{fn:this.onItemDblClick,scope:this},itemcontextmenu:{fn:this.onGridRowCtxMenu,scope:this},selectionchange:{fn:this.onGridSelectionChange,scope:this}}})},getViewConfig:function(){return{forceFit:!0}},
onGridStoreLoad:function(a,b){},getGrid:function(){null==this.grid&&this.initGrid();return this.grid},getStrutsBaseAction:function(){return this.baseAction},getEditUrl:function(a,b){return this.baseAction+"!edit.action"},getAddParams:function(){return null},getEditParams:function(a){var b={};b[""+this.entityID]=this.getRecordID(a);return b},getCopyParams:function(a){a=this.getEditParams(a);a.copy=!0;return a},getLoadParams:function(a,b){null==b&&(b="add");return"add"==b?this.getAddParams():"edit"==
b?this.getEditParams(a):"copy"==b?this.getCopyParams(a):this.getEditParams(a)},getSaveUrl:function(){return this.baseAction+"!save.action"},getSaveParams:function(a,b){var c=null;null==b&&(b="add");"add"==b&&(c=this.getAddParams());"edit"==b&&(c=this.getEditParams(a));"copy"==b&&(c=this.getCopyParams(a));null==c&&(c={});return c},getRecordID:function(a,b){return null!=a?a.id:null},getDeleteParamName:function(){return this.entityID},reload:com.trackplus.util.RefreshAfterSubmit.refreshGridAfterSubmit,
getReloadParamsAfterSave:function(){return this.getLoadGridParams()},getReloadParamsAfterSaveFromResult:function(){return{parameterName:"rowToSelect",fieldNameFromResult:"id"}},onItemDblClick:function(a,b){this.onEdit.call(this)},onGridSelectionChange:function(a,b){null==b||0==b.length?(this.actionDelete.setDisabled(!0),this.actionEdit.setDisabled(!0),null!=this.actionCopy&&this.actionCopy.setDisabled(!0)):(this.actionDelete.setDisabled(!1),1==b.length?(this.actionEdit.setDisabled(!1),null!=this.actionCopy&&
this.actionCopy.setDisabled(!1)):(this.actionEdit.setDisabled(!0),null!=this.actionCopy&&this.actionCopy.setDisabled(!0)))},onAdd:function(){this.canCreateEntity()&&this.openEditEntity.call(this,this.getAddTitleKey(),{},"add")},onEdit:function(){var a=this.getSingleSelectedRecordData();if(null==a)return!0;this.openEditEntity(this.getEditTitleKey(),a,"edit")},onCopy:function(){var a=this.getSingleSelectedRecordData();if(null==a)return!0;this.openEditEntity(this.getCopyTitleKey(),a,"copy")},openEditEntity:function(a,
b,c){var e={loadUrl:this.getEditUrl(b,c),loadUrlParams:this.getLoadParams(b,c),loadHandler:this.loadHandler},f=this.getSaveParams(b,c),g={submitUrl:this.getSaveUrl(),submitUrlParams:f,submitButtonText:this.getSaveLabel(c),submitHandler:this.submitHandler,submitAction:c,refreshAfterSubmitHandler:this.reload,refreshParametersBeforeSubmit:this.getReloadParamsAfterSave(),refreshParametersAfterSubmit:this.getReloadParamsAfterSaveFromResult()},f=this.getAdditionalActions(b,f,c);null!=f&&(f.push(g),g=f);
this.formEdit=this.createEditForm(b,c);b=this.getEditPanelItems(b,c);Ext.create("com.trackplus.util.WindowConfig",{title:this.getTitle(a),width:this.editWidth,height:this.editHeight,load:e,submit:g,formPanel:this.formEdit,items:b,postDataProcess:this.afterLoadForm,preSubmitProcess:this.preSubmitProcess}).showWindowByConfig(this)},afterLoadForm:function(a,b){},onDelete:function(){var a=this.getSelectedRecords();null!=a&&this.deleteHandler(a)}});
Ext.define("com.trackplus.admin.SimpleAssignment",{extend:"Ext.Base",config:{baseAction:null,objectID:null,objectIDParamName:null,assignmentType:null,assignmentTypeParameterName:null,dynamicIcons:!1},leafDetailByFormLoad:!1,assignedGrid:null,availableGrid:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},getDetailUrl:function(){return this.baseAction+".action"},getDetailParams:function(a){a={};a[this.objectIDParamName]=this.objectID;null!=this.assignmentType&&null!=this.assignmentTypeParameterName&&
(a[this.assignmentTypeParameterName]=this.assignmentType);return a},getToolbarActions:function(){return[]},getToolbarActionChangesForTreeNodeSelect:function(a){},adjustToolbarButtonsTooltip:function(a){},getDetailPanel:function(a){var b=Ext.create("Ext.Panel",{layout:"border",region:"center",border:!1,items:[],autoScroll:!0});Ext.Ajax.request({url:this.getDetailUrl(),params:this.getDetailParams(a),scope:this,disableCaching:!0,success:function(c){c=Ext.decode(c.responseText);c=this.getDetailItems(a,
!1,c);b.add(c)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"});return b},getDetailItems:function(a,b,c){b={region:"north",xtype:"component",cls:"infoBox1",border:!0,html:c.assignmentInfo};a=this.createAssignmentGrids(a,c);return[b,a]},reloadAssigned:function(a,b){Ext.Ajax.request({url:a,params:b,disableCaching:!0,scope:this,success:function(a){var b=Ext.decode(a.responseText);!0===b.success?(this.assignedGrid.store.loadData(b.assigned,!1),this.availableGrid.store.loadData(b.unassigned,
!1)):com.trackplus.util.requestFailureHandler(a)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}})},getIconField:function(){return this.dynamicIcons?"icon":"iconCls"},getGridFields:function(a){return[{name:"id",type:"int"},{name:"text",type:"string"},{name:this.getIconField(),type:"string"}]},iconClsRenderer:function(a,b,c){b.tdCls=a;return null},iconRenderer:function(a,b,c){return'\x3cimg src\x3d"'+a+'"/\x3e'},getColumnModel:function(){var a;a=this.dynamicIcons?this.iconRenderer:
this.iconClsRenderer;return[{text:getText("admin.customize.list.lbl.icon"),width:28,sortable:!0,dataIndex:this.getIconField(),renderer:a},{text:getText("common.lbl.name"),flex:1,sortable:!0,dataIndex:"text"}]},createAssignmentGrids:function(a,b){var c=[];if(null!=b.assigned){var e=Ext.create("Ext.data.Store",{fields:this.getGridFields(a),data:b.assigned});this.assignedGrid=Ext.create("Ext.grid.Panel",{itemId:"assignedGrid",title:getText("common.lbl.assigned"),hideHeaders:!0,store:e,columns:this.getColumnModel(),
stripeRows:!0,multiSelect:!0,enableColumnHide:!1,enableColumnMove:!1,border:!1,bodyBorder:!1,cls:"gridNoBorder",viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"secondGridDDGroup",dropGroup:"firstGridDDGroup"},listeners:{drop:{scope:this,fn:function(a,b,c,e){if(null!=b&&null!=b.records&&0<b.records.length){a=[];for(c=0;c<b.records.length;c++)a[c]=b.records[c].data.id;b=this.getDetailParams();null==b&&(b={});b.assign=a.join();this.reloadAssigned(this.baseAction+"!assign.action",b)}}}}}});c.push(this.assignedGrid)}null!=
b.unassigned&&(e=Ext.create("Ext.data.Store",{fields:this.getGridFields(a),data:b.unassigned}),this.availableGrid=Ext.create("Ext.grid.Panel",{itemId:"availableGrid",title:getText("common.lbl.unassigned"),hideHeaders:!0,store:e,columns:this.getColumnModel(),stripeRows:!0,multiSelect:!0,enableColumnHide:!1,enableColumnMove:!1,border:!1,bodyBorder:!1,cls:"gridNoBorder",style:{borderLeft:"1px solid #D0D0D0"},viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"firstGridDDGroup",dropGroup:"secondGridDDGroup"},
listeners:{drop:{scope:this,fn:function(a,b,c,e){if(null!=b&&null!=b.records&&0<b.records.length){a=[];for(c=0;c<b.records.length;c++)a[c]=b.records[c].data.id;b=this.getDetailParams();null==b&&(b={});b.unassign=a.join();this.reloadAssigned(this.baseAction+"!unassign.action",b)}}}}}}),c.push(this.availableGrid));return Ext.create("Ext.Panel",{region:"center",margin:"0 0 0 0",border:!1,bodyBorder:!1,layout:{type:"hbox",align:"stretch"},defaults:{flex:1},items:c})}});
Ext.define("com.trackplus.admin.TreeDetailAssignment",{extend:"com.trackplus.admin.TreeDetail",config:{rootID:null,baseAction:null,rootMessage:null,dynamicIcons:!1,reloadGrids:!1},leafDetailByFormLoad:!1,assignedGrid:null,availableGrid:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},getRootMessage:function(){return this.rootMessage},loadSimpleDetailPanel:function(a,b){Ext.Ajax.request({url:this.getDetailUrl(a,b),params:this.getDetailParams(a,b),scope:this,disableCaching:!0,
success:function(b){var e=Ext.decode(b.responseText);null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);b={region:"north",xtype:"component",cls:"infoBox1",border:!0,html:e.assignmentInfo};e=this.createAssignmentGrids(a.id,e);this.centerPanel=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",cls:"gridNoBorder",border:!1,bodyBorder:!1,bodyPadding:0,autoScroll:!1,items:[b,e]});this.mainPanel.add(this.centerPanel)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,
a.responseText)},method:"POST"})},getDetailUrl:function(){return this.baseAction+".action"},reloadAssigned:function(a,b){b.node=this.selectedNodeID;Ext.Ajax.request({url:a,params:b,disableCaching:!0,scope:this,success:function(a){var b=Ext.decode(a.responseText);if(!0===b.success){a=b.nodeToReload;var f=this.tree.getStore(),g=f.getNodeById(a);a={node:a};var h=b.parentsToReload;null!=h&&0<h.length&&(a.oldParentIDs=h.join());Ext.Ajax.request({url:this.baseAction+"!refreshParent.action",params:a,scope:this,
disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);null!=a&&0<a.length&&Ext.Array.forEach(a,function(a,b,c){b=f.getNodeById(a.id);null!=b&&(b.set("text",a.label),b.commit(),b.isLoaded()&&(a=this.getTreeExpandExtraParams(g),f.proxy.extraParams=a,f.load({node:b})))},this)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"});this.reloadGrids&&(this.assignedGrid.store.loadData(b.assigned,!1),a=this.assignedGrid.filters.getFilterData(),Ext.Array.each(a,
function(a){this.assignedGrid.filters.filters.getByKey(a.field).setValue(a.data.value)},this),this.availableGrid.store.loadData(b.unassigned,!1),b=this.availableGrid.filters.getFilterData(),Ext.Array.each(b,function(a){this.availableGrid.filters.filters.getByKey(a.field).setValue(a.data.value)},this))}else com.trackplus.util.requestFailureHandler(a)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}})},getIconField:function(){return this.dynamicIcons?"icon":"iconCls"},getTreeFields:function(){var a=
this.getIconField();return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:a,mapping:a,type:"string"}]},getGridFields:function(a){return[{name:"id",type:"int"},{name:"text",type:"string"},{name:this.getIconField(),type:"string"}]},iconClsRenderer:function(a,b,c){b.tdCls=a;return null},iconRenderer:function(a,b,c){return'\x3cimg src\x3d"'+a+'"/\x3e'},getColumnModel:function(){var a;a=this.dynamicIcons?this.iconRenderer:
this.iconClsRenderer;return[{text:getText("admin.customize.list.lbl.icon"),width:28,sortable:!0,dataIndex:this.getIconField(),renderer:a},{text:getText("common.lbl.name"),flex:1,sortable:!0,dataIndex:"text"}]},hideGridHeaders:function(){return!0},enableColumnHide:function(){return!1},enableColumnMove:function(){return!1},getGridFeatures:function(){return null},getGroupingFeature:function(a){return null},createAssignmentGrids:function(a,b){var c=[];if(null!=b.assigned){var e=Ext.create("Ext.data.Store",
{fields:this.getGridFields(a),data:b.assigned}),f=this.getGridFeatures();this.assignedGrid=Ext.create("Ext.grid.Panel",{itemId:"assignedGrid",title:getText("common.lbl.assigned"),hideHeaders:this.hideGridHeaders(),store:e,columns:this.getColumnModel(),stripeRows:!0,multiSelect:!0,enableColumnHide:this.enableColumnHide(),enableColumnMove:this.enableColumnMove(),border:!1,bodyBorder:!1,cls:"gridNoBorder",features:f,viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"secondGridDDGroup",dropGroup:"firstGridDDGroup"},
listeners:{drop:{scope:this,fn:function(a,b,c,e){if(null!=b&&null!=b.records&&0<b.records.length){a=[];for(c=0;c<b.records.length;c++)a[c]=b.records[c].data.id;b={};b.assign=a.join();this.reloadAssigned(this.baseAction+"!assign.action",b)}}}}}});var g=this.getGroupingFeature(f);null!=g&&this.assignedGrid.addListener("afterrender",function(){g.disable()});c.push(this.assignedGrid)}if(null!=b.unassigned){e=Ext.create("Ext.data.Store",{fields:this.getGridFields(a),data:b.unassigned});f=this.getGridFeatures();
this.availableGrid=Ext.create("Ext.grid.Panel",{itemId:"availableGrid",title:getText("common.lbl.unassigned"),hideHeaders:this.hideGridHeaders(),store:e,columns:this.getColumnModel(),stripeRows:!0,multiSelect:!0,enableColumnHide:this.enableColumnHide(),enableColumnMove:this.enableColumnMove(),border:!1,bodyBorder:!1,cls:"gridNoBorder",style:{borderLeft:"1px solid #D0D0D0"},features:f,viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"firstGridDDGroup",dropGroup:"secondGridDDGroup"},listeners:{drop:{scope:this,
fn:function(a,b,c,e){if(null!=b&&null!=b.records&&0<b.records.length){a=[];for(c=0;c<b.records.length;c++)a[c]=b.records[c].data.id;b={};b.unassign=a.join();this.reloadAssigned(this.baseAction+"!unassign.action",b)}}}}}});var h=this.getGroupingFeature(f);null!=h&&this.availableGrid.addListener("afterrender",function(){h.disable()});c.push(this.availableGrid)}return Ext.create("Ext.Panel",{region:"center",margin:"0 0 0 0",border:!1,bodyBorder:!1,layout:{type:"hbox",align:"stretch"},defaults:{flex:1},
items:c})}});
Ext.define("com.trackplus.admin.ScreenListGridConfig",{extend:"com.trackplus.admin.GridConfig",urlStore:"indexScreens.action",fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"tagLabel",type:"string"},{name:"description",type:"string"},{name:"owner",type:"string"}],columnModel:[{header:getText("common.lbl.name"),width:220,dataIndex:"name",id:"name",sortable:!0,filterable:!0},{header:getText("common.lbl.tagLabel"),width:220,dataIndex:"tagLabel",id:"tagLabel",sortable:!0,filter:{}},
{header:getText("common.lbl.description"),flex:1,dataIndex:"description",id:"description",sortable:!0,filterable:!1},{header:getText("admin.customize.form.config.owner"),width:220,dataIndex:"owner",id:"owner",sortable:!0,filterable:!1}],features:[{ftype:"filters",encode:!1,local:!0,filters:[{type:"string",dataIndex:"tagLabel",disabled:!1},{type:"string",dataIndex:"name",disabled:!1}]}],confirmDeleteEntity:!0,baseAction:"indexScreens",entityID:"screenID",editWidth:500,editHeight:300,useCopy:!0,getEntityLabel:function(){return"Form"},
createEditForm:function(a,b){return new Ext.form.FormPanel({url:"indexScreens!save.action",fieldDefaults:{labelWidth:150},region:"center",layout:"anchor",border:!1,bodyBorder:!1,autoScroll:!0,bodyStyle:"padding:10px",defaultType:"textfield",items:[{fieldLabel:getText("common.lbl.name"),name:"screen.name",anchor:"100%",allowBlank:!1},{fieldLabel:getText("common.lbl.tagLabel"),name:"screen.tagLabel",anchor:"100%",allowBlank:!0},{xtype:"textareafield",fieldLabel:getText("common.lbl.description"),name:"screen.description",
anchor:"100%-75",allowBlank:!1}]})},initActions:function(){this.callParent();var a=this.createAction(getText("common.btn.config"),"btnConfig",this.onConfig,!1);this.actions.push(a)},onConfig:function(){var a=this.getSingleSelectedRecordData();if(null==a)return!1;window.location.href="screenEdit.action?componentID\x3d"+a.id+"\x26backAction\x3dcockpit.action"}});
Ext.define("com.trackplus.admin.customize.projectType.ProjectType",{extend:"com.trackplus.admin.TreeDetail",config:{},baseAction:"projectType",leafDetailByFormLoad:!0,folderDetailByFormLoad:!0,replaceToolbarOnTreeNodeSelect:!0,leafDetailUrl:null,entityID:"node",actionAdd:null,actionSave:null,actionDelete:null,actionImport:null,actionExport:null,fieldConfig:null,screenConfig:null,workflowConfig:null,issueTypeAssignment:null,childProjectTypeAssignment:null,roleAssignment:null,assignment:null,labelWidth:250,
textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:700,PROJECT_TYPE:0,STATUS_ASSIGNMENT:1,ISSUE_TYPE_ASSIGNMENT:2,PRIORITY_ASSIGNMENT:3,SEVERITY_ASSIGNMENT:4,FIELD_CONFIGURATION:5,SCREEN_ASSIGNMENT:6,WORKFLOW_ASSIGNMENT:7,CHILD_PROJECT_TYPE_ASSIGNMENT:8,ROLE_ASSIGNMENT:9,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},init:function(){this.initActions()},treeNodeSelect:function(a,b,c,e){a=!1;null!=b&&(a=b.data.leaf,this.selectedNodeID=b.data.id,
this.selectedNode=b);c=this.getSelectedNodeClass(b);this.getSelectedNodeIsTreeBased(b)?(b=this.loadTreeWithGrid(c,b),this.actualizeToolbarOnTreeSelect.call(c,b)):this.getSelectedNodeIsDetailBased(b)?(null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0),this.centerPanel=c.getDetailPanel(b,a,e),this.mainPanel.add(this.centerPanel),borderLayout.setActiveToolbarActionList([])):(c.loadDetailPanel(b,a,e),this.actualizeToolbarOnTreeSelect(b))},loadTreeWithGrid:function(a,b){var c=null;null!=
b&&(c=b.data.projectTypeID);null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);a.projectOrProjectTypeID=c;this.centerPanel=a.createCenterPanel();this.mainPanel.add(this.centerPanel);c=a.tree.getRootNode();a.selectedNode=c;borderLayout.setActiveToolbarActionList(a.getToolbarActions());return c},getSelectedNodeIsTreeBased:function(a){switch(a.data.configType){case this.STATUS_ASSIGNMENT:case this.PRIORITY_ASSIGNMENT:case this.SEVERITY_ASSIGNMENT:case this.FIELD_CONFIGURATION:case this.SCREEN_ASSIGNMENT:case this.WORKFLOW_ASSIGNMENT:return!0}return!1},
getSelectedNodeIsDetailBased:function(a){a=a.data.configType;return a==this.ISSUE_TYPE_ASSIGNMENT||a==this.CHILD_PROJECT_TYPE_ASSIGNMENT||a==this.ROLE_ASSIGNMENT},getSelectedNodeClass:function(a){var b=a.data.configType,c=a.data.id,e=a.data.branchRoot,f=a.data.projectTypeID;if(null==b)return this;switch(b){case this.PROJECT_TYPE:return this;case this.STATUS_ASSIGNMENT:case this.PRIORITY_ASSIGNMENT:case this.SEVERITY_ASSIGNMENT:return null==this.assignment&&(this.assignment=Ext.create("com.trackplus.admin.TreeDetailAssignment",
{rootID:c,baseAction:"projectTypeListAssignments",dynamicIcons:!0,reloadGrids:!0})),this.assignment.rootID=c,a=null,a=b==this.STATUS_ASSIGNMENT?"admin.customize.projectType.lbl.assignmentInfoStatusGeneral":b==this.PRIORITY_ASSIGNMENT?"admin.customize.projectType.lbl.assignmentInfoPriorityGeneral":"admin.customize.projectType.lbl.assignmentInfoSeverityGeneral",this.assignment.rootMessage=getText(a),this.assignment;case this.ISSUE_TYPE_ASSIGNMENT:return null==this.issueTypeAssignment&&(this.issueTypeAssignment=
Ext.create("com.trackplus.admin.SimpleAssignment",{baseAction:"projectTypeSimpleAssignment",assignmentType:this.ISSUE_TYPE_ASSIGNMENT,assignmentTypeParameterName:"configType",objectIDParamName:"projectTypeID",dynamicIcons:!0})),this.issueTypeAssignment.objectID=a.parentNode.data.id,this.issueTypeAssignment;case this.CHILD_PROJECT_TYPE_ASSIGNMENT:return null==this.childProjectTypeAssignment&&(this.childProjectTypeAssignment=Ext.create("com.trackplus.admin.SimpleAssignment",{baseAction:"projectTypeSimpleAssignment",
assignmentType:this.CHILD_PROJECT_TYPE_ASSIGNMENT,assignmentTypeParameterName:"configType",objectIDParamName:"projectTypeID"})),this.childProjectTypeAssignment.objectID=a.parentNode.data.id,this.childProjectTypeAssignment;case this.ROLE_ASSIGNMENT:return null==this.roleAssignment&&(this.roleAssignment=Ext.create("com.trackplus.admin.SimpleAssignment",{baseAction:"projectTypeSimpleAssignment",assignmentType:this.ROLE_ASSIGNMENT,assignmentTypeParameterName:"configType",objectIDParamName:"projectTypeID"})),
this.roleAssignment.objectID=a.parentNode.data.id,this.roleAssignment;case this.FIELD_CONFIGURATION:return null==this.fieldConfig&&(e=a.data.branchRoot,this.fieldConfig=Ext.create("com.trackplus.admin.customize.treeConfig.FieldConfig",{rootID:e})),this.fieldConfig;case this.SCREEN_ASSIGNMENT:return null==this.screenConfig&&(e=a.data.branchRoot,this.screenConfig=Ext.create("com.trackplus.admin.customize.treeConfig.ScreenConfig",{rootID:e})),this.screenConfig;case this.WORKFLOW_ASSIGNMENT:return null==
this.workflowConfig&&(e=a.data.branchRoot,this.workflowConfig=Ext.create("com.trackplus.admin.customize.treeConfig.WorkflowConfig",{rootID:e,projectOrProjectTypeID:f})),this.workflowConfig}},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"},{name:"icon",mapping:"icon",type:"string"},{name:"configType",mapping:"configType",type:"int"},{name:"projectTypeID",
mapping:"projectTypeID",type:"int"},{name:"branchRoot",mapping:"branchRoot",type:"string"}]},getWrappedControl:function(){return CWHF.getWrappedControl.apply(this.centerPanel,arguments)},getHelpWrapper:function(){return CWHF.getHelpWrapper.apply(this.centerPanel,arguments)},getEntityLabel:function(a){return getText("common.lbl.projectType")},getSaveIconCls:function(){return"save"},initActions:function(){this.actionAdd=this.createLocalizedAction(this.getTitle(this.getAddTitleKey()),this.getAddIconCls(),
this.onAdd,this.getTitle(this.getAddTitleKey()));this.actionSave=this.createLocalizedAction(getText("common.btn.save"),this.getSaveIconCls(),this.onSave,this.getTitle("common.lbl.save"),!0);this.actionDelete=this.createLocalizedAction(getText("common.btn.delete"),this.getDeleteIconCls(),this.onDelete,this.getTitle("common.lbl.delete"),!0);this.actionImport=this.createLocalizedAction(getText("common.btn.import"),"import",this.onImport,getText("common.lbl.import",getText("menu.admin.custom.projectType")),
!1);this.actionExport=this.createLocalizedAction(getText("common.btn.export"),"export",this.onExport,getText("common.lbl.export",getText("menu.admin.custom.projectType")),!0)},getToolbarActions:function(){return com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS?[this.actionAdd,this.actionSave,this.actionDelete,this.actionImport,this.actionExport]:[this.actionSave,this.actionExport]},onAdd:function(){this.tree.getSelectionModel().deselectAll(!0);var a=this.getSingleSelectedRecord(!0);this.loadDetailPanelWithFormLoad(a,
!0);this.actionSave.setDisabled(!1)},onSave:function(){this.centerPanel.getForm().submit({url:this.baseAction+"!save.action",params:this.getSubmitParams(!0),scope:this,success:function(a,b){var c=b.result;c.success?(CWHF.showMsgInfo(getText("admin.customize.projectType.successSave")),this.reload(c)):(CWHF.showMsgError(getText("admin.customize.projectType.errorSave")),errorHandlerSave(c))},failure:function(a,b){CWHF.showMsgError(getText("admin.customize.projectType.errorSave"))}})},getSubmitParams:function(a){var b=
this.getSingleSelectedRecord(a),c=null,c=null;null!=b&&(c=b.data,c=a?c.id:c.node);a={};null!=c&&(a.node=c);return a},onDelete:function(){var a=this.getSelectedRecords(!0);null!=a&&this.deleteHandler(a,{fromTree:!0,isLeaf:!1})},onImport:function(){var a=[{submitUrl:"projectType!importProjectTypes.action",submitButtonText:getText("common.btn.upload"),validateHandler:Upload.validateUpload,expectedFileType:/^.*\.(xml)$/,refreshAfterSubmitHandler:this.reload}],a={title:getText("common.lbl.upload",getText("admin.customize.mailTemplate.lbl.uploadFile")),
width:500,height:200,submit:a,formPanel:this.getImportPanel(),cancelButtonText:getText("common.btn.done")};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},onExport:function(){if(null!=this.getSelectedRecords(!0)){var a=[{submitHandler:this.doExport,submitButtonText:getText("common.btn.export")}],a={title:getText("common.lbl.export",getText("menu.admin.custom.projectType")),width:500,height:200,submit:a,formPanel:this.getExportPanel(),cancelButtonText:getText("common.btn.cancel")};
Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this);return!0}},doExport:function(a,b,c,e){b=this.getSelectedRecords(!0).data.id;c=this.checkIncludeGlobal.getInputComponent().getValue();a.close();window.open(this.baseAction+"!export.action?projectTypeID\x3d"+b+"\x26includeGlobal\x3d"+c)},getImportPanel:function(){return this.formPanel=new Ext.form.FormPanel({region:"center",border:!1,bodyStyle:"padding:5px",defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"under",
anchor:"-20"},method:"POST",fileUpload:!0,items:[CWHF.createCheckbox("common.lbl.overwriteExisting","overwriteExisting",{labelWidth:200}),CWHF.createFileField("common.lbl.attachment.file","uploadFile",{allowBlank:!1,labelWidth:200})]})},getExportPanel:function(){var a=this.getSelectedRecords(!0);this.checkIncludeGlobal=CWHF.createCheckboxWithHelp("admin.customize.projectType.lbl.includeGlobal","includeGlobal",{labelWidth:200,width:250});return this.formPanelExport=new Ext.form.FormPanel({region:"center",
border:!1,bodyStyle:"padding:5px",defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"under",anchor:"-20"},method:"POST",items:[CWHF.createLabelComponent("common.lbl.projectType",null,{labelWidth:200,value:a.data.text}),this.checkIncludeGlobal]})},reload:com.trackplus.util.RefreshAfterSubmit.refreshSimpleTree,getReloadParamsAfterDelete:function(a,b,c){return{reloadTree:!0}},getToolbarActionsForTreeNodeSelect:function(a){null!=a?(this.actionSave.setDisabled(!1),a=a.data.projectTypeID,
null!=a&&0>a?(this.actionDelete.setDisabled(!0),this.actionExport.setDisabled(!0)):(this.actionDelete.setDisabled(!1),this.actionExport.setDisabled(!1))):(this.actionSave.setDisabled(!0),this.actionDelete.setDisabled(!0),this.actionExport.setDisabled(!0));return com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS?[this.actionAdd,this.actionSave,this.actionDelete,this.actionImport,this.actionExport]:[this.actionSave,this.actionExport]},getDetailUrl:function(a,b){return this.baseAction+"!edit.action"},
getDetailParams:function(a,b){var c={};null!=a&&(nodeID=a.data.id,c.node=nodeID);c.add=b;return c},getDetailItems:function(a,b){var c=null;null!=a&&(c=a.data.projectTypeID);var c=!b&&null!=c&&0>c,e=[CWHF.createTextField("common.lbl.name","projectTypeTO.label",{allowBlank:!1,labelWidth:this.labelWidth,width:this.textFieldWidth})];c||(e.push(CWHF.createComboWithHelp("admin.customize.projectType.lbl.projectTypeFlag","projectTypeTO.projectTypeFlag",{itemId:"projectTypeFlag",labelWidth:this.labelWidth})),
e.push(CWHF.createCheckboxWithHelp("admin.customize.projectType.lbl.enableRelease","projectTypeTO.useReleases")),e.push(CWHF.createCheckboxWithHelp("admin.customize.projectType.lbl.enableVersionControl","projectTypeTO.useVersionControl")));com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&(e.push(CWHF.createCheckboxWithHelp("admin.customize.projectType.lbl.enableAccounting","projectTypeTO.useAccounts",null,{change:{fn:this.onAccountingChange,scope:this}})),e.push(CWHF.createNumberFieldWithHelp("common.lbl.hoursPerWorkday",
"projectTypeTO.hoursPerWorkday",2,0,24,{labelWidth:this.labelWidth,width:this.textFieldWidthShort})),e.push(CWHF.createComboWithHelp("admin.project.lbl.defaultWorkUnit","projectTypeTO.defaultWorkUnit",{itemId:"defaultWorkUnit",labelWidth:this.labelWidth})),e.push(CWHF.createTextFieldWithHelp("admin.project.lbl.currencyName","projectTypeTO.currencyName",{labelWidth:this.labelWidth,width:this.textFieldWidthShort})),e.push(CWHF.createTextFieldWithHelp("admin.project.lbl.currencySymbol","projectTypeTO.currencySymbol",
{labelWidth:this.labelWidth,width:this.textFieldWidthShort})),com.trackplus.TrackplusConfig.appType!=APPTYPE_DESK&&e.push(CWHF.createCheckboxWithHelp("admin.customize.projectType.lbl.enableMsProjectExportImport","projectTypeTO.useMsProjectExportImport",{labelWidth:this.labelWidth,width:this.textFieldWidthShort})));return[{xtype:"hidden",name:"add",value:b},{xtype:"fieldset",itemId:"projectTypeFS",width:this.FieldSetWidth,style:{marginTop:"6px"},title:getText("admin.customize.projectType.fieldset"),
items:e}]},onAccountingChange:function(a,b,c,e){a=a.getValue();this.enableAccountingFields(a)},enableAccountingFields:function(a){this.getHelpWrapper("projectTypeFS","projectTypeTO.hoursPerWorkday").setDisabled(!a);this.getHelpWrapper("projectTypeFS","defaultWorkUnit").setDisabled(!a);this.getHelpWrapper("projectTypeFS","projectTypeTO.currencyName").setDisabled(!a);this.getHelpWrapper("projectTypeFS","projectTypeTO.currencySymbol").setDisabled(!a)},getEditPostDataProcess:function(a,b,c){return this.postDataLoadCombo},
postDataLoadCombo:function(a,b){var c=this.getWrappedControl("projectTypeFS","projectTypeFlag");null!=c&&(c.store.loadData(a.projectTypeFlagList),c.setValue(a["projectTypeTO.projectTypeFlag"]));c=this.getWrappedControl("projectTypeFS","defaultWorkUnit");null!=c&&(c.store.loadData(a.workUnitList),c.setValue(a["projectTypeTO.defaultWorkUnit"]));this.enableAccountingFields(a["projectTypeTO.useAccounts"])}});
Ext.define("com.trackplus.admin.customize.role.RolesGridConfig",{extend:"com.trackplus.admin.GridConfig",urlStore:"roleView!loadRoles.action",autoLoadGrid:!1,fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"accessFlags"},{name:"issueTypesAssigned"},{name:"noReadFields"},{name:"noEditFields"}],columnModel:[{header:getText("admin.customize.role.lbl.role"),width:175,dataIndex:"name",id:"name",sortable:!0},{xtype:"templatecolumn",header:getText("admin.customize.role.lbl.accessFlags"),
tpl:new Ext.XTemplate("\x3ctable\x3e\x3ctr\x3e",'\x3ctd valign\x3d"top"\x3e','\x3ctpl for\x3d"accessFlags.fullAccessFlags"\x3e','\x3cdiv\x3e\x3cinput type\x3d"checkbox" disabled\x3d"disabled"  style\x3d"vertical-align: middle; margin: 0px;" ','\x3ctpl if\x3d"selected"\x3e','checked\x3d"true"',"\x3c/tpl\x3e",'value\x3d"true"/\x3e {label}\x3c/div\x3e',"\x3c/tpl\x3e","\x3c/td\x3e","\x3c/tr\x3e\x3c/table\x3e"),width:175,sortable:!0},{xtype:"templatecolumn",header:getText("admin.customize.role.lbl.inSelections"),
tpl:new Ext.XTemplate("\x3ctable\x3e\x3ctr\x3e",'\x3ctd valign\x3d"top"\x3e','\x3ctpl for\x3d"accessFlags.raciRoles"\x3e','\x3cdiv\x3e\x3cinput type\x3d"checkbox" disabled\x3d"disabled"  style\x3d"vertical-align: middle; margin: 0px;" ','\x3ctpl if\x3d"selected"\x3e','checked\x3d"true"',"\x3c/tpl\x3e",'value\x3d"true"/\x3e {label}\x3c/div\x3e',"\x3c/tpl\x3e","\x3c/td\x3e","\x3c/tr\x3e","\x3c/table\x3e"),width:175,sortable:!0},{xtype:"templatecolumn",header:getText("admin.customize.role.lbl.allowedListTypes"),
tpl:new Ext.XTemplate("\x3ctable\x3e",'\x3ctpl for\x3d"issueTypesAssigned"\x3e','\x3ctr\x3e\x3ctd\x3e\x3cimg src\x3d"optionIconStream.action?fieldID\x3d-2\x26optionID\x3d{id}"\x3e\x3c/td\x3e','\x3ctd style\x3d"padding:2px"\x3e{label}\x3c/td\x3e\x3c/tr\x3e',"\x3c/tpl\x3e","\x3c/table\x3e"),width:175,sortable:!1},{xtype:"templatecolumn",header:getText("admin.customize.role.fieldsRestrictions.lbl.hiddenFields"),tpl:new Ext.XTemplate("\x3ctable\x3e",'\x3ctpl for\x3d"noReadFields"\x3e','\x3ctd style\x3d"padding:2px"\x3e{label}\x3c/td\x3e\x3c/tr\x3e',
"\x3c/tpl\x3e","\x3c/table\x3e"),width:175,sortable:!1},{xtype:"templatecolumn",header:getText("admin.customize.role.fieldsRestrictions.lbl.readOnlyFields"),tpl:new Ext.XTemplate("\x3ctable\x3e",'\x3ctpl for\x3d"noEditFields"\x3e','\x3ctd style\x3d"padding:2px"\x3e{label}\x3c/td\x3e\x3c/tr\x3e',"\x3c/tpl\x3e","\x3c/table\x3e"),width:175,sortable:!1}],confirmDeleteEntity:!0,baseAction:"roleView",entityID:"roleID",editWidth:520,editHeight:335,useCopy:!0,actionIssueTypes:null,actionFieldsRestictions:null,
chekListPanel:null,checkList:null,panelGrids:null,gridNoAccessSelected:null,gridAssignedSelected:null,getEntityLabel:function(){return getText("admin.customize.role.lbl")},initActions:function(){this.callParent();com.trackplus.TrackplusConfig.user.sys?(this.actionIssueTypes=this.createAction("common.btn.issueType","issueTypeLock",this.onAssignIssueType,!0,"admin.customize.role.issueTypeToRole.lbl.explanation"),this.actionFieldsRestictions=this.createAction("admin.customize.role.lbl.fieldsRestrictions",
"fieldsRestrictions",this.onFieldsRestrictions,!0,"admin.customize.role.fieldsRestrictions.lbl.explanation"),this.actions=[this.actionAdd,this.actionEdit,this.actionCopy,this.actionIssueTypes,this.actionFieldsRestictions,this.actionDelete]):this.actions=[]},onItemDblClick:function(a,b){return com.trackplus.TrackplusConfig.user.sys?this.callParent(arguments):[]},onGridSelectionChange:function(a,b){com.trackplus.TrackplusConfig.user.sys&&(null===b||0===b.length?(this.actionDelete.setDisabled(!0),this.actionEdit.setDisabled(!0),
this.actionCopy.setDisabled(!0),this.actionIssueTypes.setDisabled(!0),this.actionFieldsRestictions.setDisabled(!0)):(this.actionDelete.setDisabled(!1),this.actionEdit.setDisabled(!1),this.actionCopy.setDisabled(!1),this.actionIssueTypes.setDisabled(!1),this.actionFieldsRestictions.setDisabled(!1)))},getGridContextMenuActions:function(a,b){var c=[];com.trackplus.TrackplusConfig.user.sys&&(b&&(c.push(this.actionEdit),c.push(this.actionCopy),c.push(this.actionIssueTypes),c.push(this.actionFieldsRestictions)),
c.push(this.actionDelete));return c},createEditForm:function(a,b){this.chekListPanel=Ext.create("Ext.panel.Panel",{border:!1,bodyBorder:!1,autoScroll:!0,style:{border:"none",background:"none"},layout:{type:"table",columns:2,tableAttrs:{style:{width:"100%"}},tdAttrs:{width:"50%",style:{"vertical-align":"top"}}},defaults:{frame:!1,border:!1},anchor:"100%",items:[]});return new Ext.form.FormPanel({url:"roleSave.action",labelWidth:130,region:"center",border:!1,autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"10px"},
defaultType:"textfield",items:[CWHF.createTextField("admin.customize.role.lbl.role","label",{anchor:"100%",allowBlank:!1,labelWidth:80,labelAlign:"left"}),this.chekListPanel]})},afterLoadForm:function(a){this.chekListPanel.removeAll();this.chekList=[];for(var b=[],c=0;c<a.fullAccessFlags.length;c++){var e=a.fullAccessFlags[c];b.push(Ext.create("Ext.form.field.Checkbox",{boxLabel:e.label,checked:e.selected,name:"f"+e.id,inputValue:"true"}))}for(var f=Ext.create("Ext.form.FieldSet",{title:getText("admin.customize.role.lbl.generalAccess"),
defaultType:"checkbox",layout:"anchor",items:b,margin:"5 15 5 0"}),g=[],c=0;c<a.raciRoles.length;c++)e=a.raciRoles[c],g.push(Ext.create("Ext.form.field.Checkbox",{boxLabel:e.label,checked:e.selected,name:"f"+e.id,inputValue:"true"}));a=Ext.create("Ext.form.FieldSet",{title:getText("admin.customize.role.lbl.raci"),defaultType:"checkbox",layout:"anchor",items:g,margin:"5 0 5 0"});for(c=0;c<b.length;c++)this.chekList.push(b[c]);for(c=0;c<g.length;c++)this.chekList.push(g[c]);this.chekListPanel.add(f);
this.chekListPanel.add(a);this.chekListPanel.doLayout()},preSubmitProcess:function(a,b){for(var c=Array(21),e=0;e<c.length;e++)c[e]=0;if(null!=this.chekList)for(e=0;e<this.chekList.length;e++){var f=this.chekList[e].getName().substring(1);!0==this.chekList[e].getRawValue()?c[f]=1:c[f]=0}f="";for(e=0;e<c.length;e++)f=1==c[e]?f+"1":f+"0";a.extendedAccessKey=f;return a},createFieldRestrictionsForm:function(a){var b={region:"north",xtype:"component",cls:"infoBox_bottomBorder",border:!0,html:getText("admin.customize.role.fieldsRestrictions.lbl.explanation")},
c=[{text:getText("common.lbl.field"),menuDisabled:!0,dataIndex:"fieldLabel",flex:3},{text:getText("admin.customize.role.fieldsRestrictions.lbl.hide")+'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"hidden"\x3e',menuDisabled:!0,dataIndex:"hidden",flex:2,xtype:"checkcolumn"},{text:getText("admin.customize.role.fieldsRestrictions.lbl.readOnly")+'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"configuredReadOnly"\x3e',menuDisabled:!0,dataIndex:"configuredReadOnly",flex:2,xtype:"checkcolumn",renderer:function(a,
b,c){return c.get("forcedReadOnly")?"":(new Ext.ux.CheckColumn).renderer(a,b,c)}}];this.roleFieldGridStore=new Ext.data.Store({proxy:{type:"ajax",api:{read:"fieldsRestrictionsToRole!edit.action",update:"fieldsRestrictionsToRole!save.action"},extraParams:{roleID:a},reader:{type:"json",root:"records"},writer:{type:"json",allowSingle:!1,writeAllFields:!0,root:"records",encode:!0}},fields:[{name:"id",mapping:"id",type:"string"},{name:"objectID",mapping:"objectID",type:"int"},{name:"fieldLabel",mapping:"fieldLabel",
type:"string"},{name:"hidden",mapping:"hidden",type:"boolean"},{name:"forcedReadOnly",mapping:"forcedReadOnly",type:"boolean"},{name:"configuredReadOnly",mapping:"configuredReadOnly",type:"boolean"}],remoteSort:!0,idProperty:"id",successProperty:"success",autoSync:!1,listeners:{load:{scope:this,fn:function(a,b){var c=a.getProxy().getReader().rawData;this.win.getDockedItems('toolbar[dock\x3d"bottom"]')[0].getComponent(0).setDisabled(c.disabled);for(i=1;2>=i;i++){var h=this.getColumnByIndex(i);document.getElementById(h).checked=
c[h]}}},beforesync:function(){this.getProxy().extraParams={roleID:a}},datachanged:{scope:this,fn:function(a,b){this.reload.call(this)}}}});c={xtype:"grid",itemId:"detailGrid",columns:c,sortableColumns:!1,draggable:!1,store:this.roleFieldGridStore,border:!1,bodyBorder:!1,loadMask:!0,stripeRows:!0,region:"center",style:{borderTop:"1px solid #D0D0D0"},viewConfig:{forceFit:!0},listeners:{afterrender:{fn:function(){for(i=1;2>=i;i++){var a=this.getColumnByIndex(i);Ext.get(a).addListener("click",this.headerChkHandler,
this,{column:a})}},scope:this}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})]};return new Ext.panel.Panel({border:!1,layout:"border",autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"0px"},items:[b,c]})},getColumnByIndex:function(a){switch(a){case 1:return"hidden";case 2:return"configuredReadOnly"}},headerChkHandler:function(a,b,c){a=b.checked;b=this.roleFieldGridStore.getTotalCount();c=c.column;for(i=0;i<b;i++)this.roleFieldGridStore.getAt(i).set(c,a)},onFieldsRestrictions:function(){var a=
null,b=this.grid.getSelectionModel().getSelection();1==b.length&&(a=b[0].data);if(null==a)return!0;var b=a.id,c={loadHandler:this.loadRoleFieldsHandler},e={submitHandler:this.submitRoleFieldsHandler},a=getText("admin.customize.role.fieldsRestrictions.lbl.header")+' "'+a.name+'"';Ext.create("com.trackplus.util.WindowConfig",{title:a,width:400,height:500,load:c,submit:e,formPanel:this.createFieldRestrictionsForm(b)}).showWindowByConfig(this)},loadRoleFieldsHandler:function(){this.roleFieldGridStore.load()},
submitRoleFieldsHandler:function(a,b,c){a=this.roleFieldGridStore.getUpdatedRecords();null!=a&&0<a.length&&this.roleFieldGridStore.sync();this.win.close()},onAssignIssueType:function(a){var b=this;a=null;var c=b.grid.getSelectionModel().getSelection();1==c.length&&(a=c[0].data);if(null==a)return!0;var c=getText("admin.customize.role.issueTypeToRole.lbl.header")+' "'+a.name+'"',e={region:"north",xtype:"component",cls:"infoBox_bottomBorder",border:!0,html:getText("admin.customize.role.issueTypeToRole.lbl.explanation")};
b.panelGrids=b.createPanelIssueTypeAssign(a.id);var f=Ext.create("Ext.window.Window",{layout:"border",width:500,height:350,minWidth:425,closeAction:"destroy",title:c,modal:!0,items:[e,b.panelGrids],cls:"bottomButtonsDialog",border:!1,bodyBorder:!1,margin:"0 0 0 0",style:{padding:"0px"},bodyPadding:"0px",buttons:[{text:getText("common.btn.done"),handler:function(){f.hide();f.destroy();b.grid.store.load()}}]});f.show();b.reloadAssigned("issueTypeToRole.action?roleID\x3d"+a.id)},reloadAssigned:function(a,
b,c){var e=this,f=!0;!1===c&&(f=!1);e.panelGrids.setLoading(f);Ext.Ajax.request({url:a,params:b,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);!0===a.success?(e.gridNoAccessSelected.store.loadData(a.data.noAccess,!1),e.gridAssignedSelected.store.loadData(a.data.assiged,!1)):alert("failure"+a.errorMessage);e.panelGrids.setLoading(!1)},failure:function(a){a=Ext.decode(a.responseText).errorMessage;alert("failure"+a);e.panelGrids.setLoading(!1)}})},renderFieldTypeIcon:function(a){return""},
renderIssueTypeIcon:function(a){return null==a||""==a?"":'\x3cimg src\x3d"optionIconStream.action?fieldID\x3d-2\x26optionID\x3d'+a+'"\x3e'},createPanelIssueTypeAssign:function(a){var b=this,c=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},{name:"label",type:"string"},{name:"symbol",type:"string"}],data:[]}),e=[{text:"symbol",width:30,sortable:!0,dataIndex:"id",renderer:b.renderIssueTypeIcon},{text:"Name",flex:1,sortable:!0,dataIndex:"label"}];b.gridNoAccessSelected=Ext.create("Ext.grid.Panel",
{viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"firstGridDDGroup",dropGroup:"secondGridDDGroup"},listeners:{drop:function(c,e,h,k){null!=e&&null!=e.records&&0<e.records.length&&(c={},c.assignedSelected=e.records[0].data.id,b.reloadAssigned("issueTypeToRole!unassign.action?roleID\x3d"+a,c,!1))}}},store:c,columns:e,stripeRows:!0,title:getText("admin.customize.role.issueTypeToRole.lbl.unassigned"),hideHeaders:!0,border:!1,bodyBorder:!1,cls:"gridNoBorder",style:{borderBottom:"1px solid #D0D0D0"}});
c=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},{name:"label",type:"string"},{name:"symbol",type:"string"}],data:[]});b.gridAssignedSelected=Ext.create("Ext.grid.Panel",{viewConfig:{plugins:{ptype:"gridviewdragdrop",dragGroup:"secondGridDDGroup",dropGroup:"firstGridDDGroup"},listeners:{drop:function(c,e,h,k){null!=e&&null!=e.records&&0<e.records.length&&(c={},c.noAccessSelected=e.records[0].data.id,b.reloadAssigned("issueTypeToRole!assign.action?roleID\x3d"+a,c,!1))}}},store:c,columns:e,
stripeRows:!0,title:getText("admin.customize.role.issueTypeToRole.lbl.assigned"),hideHeaders:!0,border:!1,bodyBorder:!1,cls:"gridNoBorder",style:{borderLeft:"1px solid #D0D0D0",borderBottom:"1px solid #D0D0D0"}});return Ext.create("Ext.Panel",{region:"center",margin:"0 0 0 0",border:!1,bodyBorder:!1,layout:{type:"hbox",align:"stretch"},defaults:{flex:1},items:[b.gridNoAccessSelected,b.gridAssignedSelected]})},getAddIconCls:function(){return"rolesAdd"},getEditIconCls:function(){return"rolesEdit"}});
com.trackplus.admin.server={};com.trackplus.admin.adminEntityWin=null;com.trackplus.admin.sections={};com.trackplus.admin.lastSelectedSection=null;com.trackplus.admin.lastSelectedNode=null;
com.trackplus.admin.createAdminWestPanel=function(a){var b=new Ext.create("Ext.panel.Panel",{region:"west",layout:"accordion",id:"AdminWestPanel",width:200,border:!1,split:!0,collapseMode:"mini",margins:"0 -5 0 0",defaults:{border:!1},cls:"west-accordion"}),c=[];c.push(com.trackplus.admin.getMyPreferencesSection());(com.trackplus.TrackplusConfig.user.projectAdmin||com.trackplus.TrackplusConfig.user.privateWorkspace)&&c.push(com.trackplus.admin.getProjectsSection(a,!1));com.trackplus.TrackplusConfig.user.sys&&
c.push(com.trackplus.admin.getUsersSection());a=com.trackplus.admin.getCustomizationSection();null!=a&&c.push(a);(com.trackplus.TrackplusConfig.user.sys||com.trackplus.TrackplusConfig.user.actions)&&c.push(com.trackplus.admin.getActionSection());com.trackplus.TrackplusConfig.user.sysAdmin&&c.push(com.trackplus.admin.getServerSection());b.add(c);return b};
com.trackplus.admin.sectionSelectHandler=function(a,b){var c=a.id,e=com.trackplus.admin.lastSelectedSection,f=com.trackplus.admin.lastSelectedNode,g=null,g=null!=b?b:Ext.getCmp("tree-"+c),h={},k=null,k=null,l=g.getSelectionModel().getSelection();null!=l&&0<l.length&&(k=l[0].data.id,h=l[0].data);null==k&&(l=g.getStore().getRootNode(),null!=l&&l.hasChildNodes()&&(h=l.getChildAt(0),g.getSelectionModel().select(h),h=h.data,k=h.id));e==c&&f==k||com.trackplus.admin.replaceCenterContent(c,k,h)};
com.trackplus.admin.myClick=function(a,b,c,e,f){c=b.data;a=a.ownerCt.id.substring(5);com.trackplus.admin.replaceCenterContent(a,b.data.id,c)};com.trackplus.admin.replaceCenterContent=function(a,b,c){com.trackplus.admin.storeLastSelectedNode(a,b);borderLayout.controller.replaceCenterContent.call(borderLayout.controller,c);c="admin."+a;"projectTreePanel"!=a&&"projectTemplateTreePanel"!=a&&null!=b&&(c+="."+b);borderLayout.addHistoryToken(a+":"+b);borderLayout.setHelpContext(c)};
com.trackplus.admin.storeLastSelectedNode=function(a,b){com.trackplus.admin.lastSelectedSection=a;com.trackplus.admin.lastSelectedNode=b;Ext.Ajax.request({fromCenterPanel:!0,url:"admin!storeLastSelectedNode.action",params:{sectionSelected:a,selectedNodeID:b}})};
com.trackplus.admin.createSectionTree=function(a,b,c,e,f){this.sections[a]=b;b=Ext.create("Ext.data.TreeStore",{fields:"id text tt menuPath url useAJAX script iconCls".split(" "),root:{expanded:!0,text:"",user:"",status:"",children:b}});b=Ext.create("Ext.tree.Panel",{id:"tree-"+a,useArrows:!0,autoScroll:!0,store:b,rootVisible:!1,border:!1,margins:"0 0 0 0",cls:"westTreeNavigator"});b.on("itemclick",com.trackplus.admin.myClick);return new Ext.create("Ext.panel.Panel",{id:a,title:c,layout:"fit",margins:"0 0 0 0",
iconCls:f,cls:"accordionSection",listeners:{expand:{fn:function(a){a.addCls("accordionSection-active");com.trackplus.admin.sectionSelectHandler(a)}},collapse:{fn:function(a){a.removeCls("accordionSection-active")}},afterrender:function(a){}},items:[b]})};
com.trackplus.admin.createProjectTree=function(a,b){var c=Ext.create("Ext.data.TreeStore",{root:{expanded:!0,id:null},fields:[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"tt",mapping:"tt",type:"string"},{name:"menuPath",mapping:"menuPath",type:"string"},{name:"url",mapping:"url",type:"string"},{name:"useAJAX",mapping:"useAJAX",type:"boolean"},{name:"script",mapping:"script",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"}],autoLoad:!1,proxy:{type:"ajax",
url:"project!projects.action",extraParams:{isTemplate:b}}});if("projectTreePanel"==a.sectionSelected||"projectTemplateTreePanel"==a.sectionSelected)c.on("load",function(b,c){if(c.isRoot()){var e=null;null!=a.selectedNodeID&&(e=b.getNodeById(a.selectedNodeID));null==e&&(e=c.firstChild);null!=e&&(Ext.getCmp("tree-projectTreePanel").getSelectionModel().select(e),com.trackplus.admin.replaceCenterContent(a.sectionSelected,e,e.data))}},c);var e=Ext.create("Ext.tree.Panel",{xtype:"treepanel",itemId:"projectTree",
id:"tree-projectTreePanel",useArrows:!0,autoScroll:!0,store:c,rootVisible:!1,border:!1,margins:"0 0 0 0",baseCls:"x-plain",bodyStyle:{border:"none"},cls:"westTreeNavigator",listeners:{itemcontextmenu:{fn:function(a,b,e,f,g){g.stopEvent();com.trackplus.admin.createCtxMenuProject(b,c).showAt(g.getXY());return!1}}},viewConfig:{plugins:{ptype:"treeviewdragdrop",dragGroup:"projectAdminDDGroup",dropGroup:"projectAdminDDGroup",appendOnly:!0,enableDrag:!0,enableDrop:!0},listeners:{beforedrop:{fn:function(a,
b,c,e){return!0==b.records[0].data.leaf||!0==c.data.leaf?!1:!0}},drop:{fn:function(a,b,e,f){com.trackplus.admin.dropAdminProject(b.records[0],e,c)}}}}});this.sections.projects=e;var f=Ext.create("com.trackplus.admin.project.ProjectConfig",{projectTree:this.sections.projects,sys:com.trackplus.TrackplusConfig.user.sys,isTemplate:b});e.on("itemclick",com.trackplus.admin.myClick);var g=getText("menu.admin.project");return new Ext.create("Ext.panel.Panel",{id:"projectTreePanel",title:g,layout:"fit",margins:"0 0 0 0",
iconCls:"projects-ticon",cls:"accordionSection",listeners:{expand:{fn:function(a){a.addCls("accordionSection-active");var b=a.getComponent("projectTree");null!=b&&(rootNode=b.getRootNode(),null==rootNode||rootNode.hasChildNodes()||(borderLayout.controller.setCenterContent(null),borderLayout.setActiveToolbarActionList(this.getToolbarActions.call(this,!1))),com.trackplus.admin.sectionSelectHandler(a,b))},scope:f},collapse:{fn:function(a){a.removeCls("accordionSection-active")}},afterrender:function(a){}},
items:[e]})};com.trackplus.admin.dropAdminProject=function(a,b,c){Ext.Ajax.request({url:"project!updateParent.action",params:{projectID:a.data.id,parentID:b.data.id},disableCaching:!0,success:function(a){}})};
com.trackplus.admin.clearProjectParent=function(a,b){Ext.Ajax.request({url:"project!clearParent.action",params:{projectID:a},disableCaching:!0,success:function(c){b.load({callback:function(){var c=Ext.getCmp("tree-projectTreePanel"),f=b.getNodeById(a);c.getSelectionModel().select(f);com.trackplus.admin.myClick(c.getView,f)}})}})};
com.trackplus.admin.deleteProject=function(a,b,c){var e=getText("common.lbl.delete",getText("admin.project.lbl.projectForOp")),f=getText("common.lbl.removeWarning",getText("admin.project.lbl.projectForOp"));Ext.MessageBox.confirm(e,f,function(f){if("no"==f)return!1;Ext.Ajax.request({url:"project!delete.action",params:{projectID:a,deleteConfirmed:c},disableCaching:!0,success:function(c){c=Ext.decode(c.responseText);!0==c.success?window.location.href="admin.action":Ext.MessageBox.confirm(e,c.errorMessage,
function(c){if("no"==c)return!1;com.trackplus.admin.deleteProject(a,b,!0)})}})})};com.trackplus.admin.createCtxMenuProject=function(a,b){var c=a.data.id,e=a.data.text,f=[{text:getText("common.btn.delete"),iconCls:"delete16",handler:function(){com.trackplus.admin.deleteProject(c,e,!1)}}];null==a||null==a.parentNode||a.parentNode.isRoot()||f.push({text:getText("menu.admin.project.removeFromParent"),iconCls:"clear16",handler:function(){com.trackplus.admin.clearProjectParent(c,b)}});return new Ext.menu.Menu({items:f})};
com.trackplus.admin.getMyPreferencesSection=function(){var a=getText("menu.admin")+"\x3e"+getText("menu.admin.myProfile")+"\x3e",a=[{id:"myProfile",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.myProfile.myProfile"),tooltip:getText("menu.admin.myProfile.myProfile.tt"),menuPath:a+getText("menu.admin.myProfile.myProfile"),url:"com.trackplus.admin.myProfile()",useAJAX:!0,leaf:!0,iconCls:"userprefs-ticon"},{id:"myAutomail",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.automail"),
tooltip:getText("menu.admin.custom.automail.tt"),menuPath:a+getText("menu.admin.custom.automail"),url:"com.trackplus.admin.notify(false)",useAJAX:!0,leaf:!0,iconCls:"automailc-ticon"},{id:"iCalendarURL",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.myProfile.iCalendar"),tooltip:getText("menu.admin.myProfile.iCalendar.tt"),menuPath:a+getText("menu.admin.myProfile.iCalendar"),url:"com.trackplus.admin.iCalendarURL()",useAJAX:!0,leaf:!0,iconCls:"calendar-ticon"}];return com.trackplus.admin.createSectionTree("myPreferenceSection",
a,getText("menu.admin.myProfile"),getText("menu.admin.myProfile.tt"),"userprefs-ticon")};com.trackplus.admin.getProjectsSection=function(a,b){return com.trackplus.admin.createProjectTree(a,b)};
com.trackplus.admin.getUsersSection=function(){var a=getText("menu.admin")+"\x3e"+getText("menu.admin.user")+"\x3e",b=[{id:"users",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.users.users"),tooltip:getText("menu.admin.users.users.tt"),menuPath:a+getText("menu.admin.users.users"),url:"com.trackplus.admin.user.person(true)",useAJAX:!0,leaf:!0,iconCls:"user-ticon"}];com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&b.push({id:"clients",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.users.clients"),
tooltip:getText("menu.admin.users.clients.tt"),menuPath:a+getText("menu.admin.users.clients"),url:"com.trackplus.admin.user.person(false)",useAJAX:!0,leaf:!0,iconCls:"user-ticon"});b.push({id:"groups",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.users.groups"),tooltip:getText("menu.admin.users.groups.tt"),menuPath:a+getText("menu.admin.users.groups"),url:"com.trackplus.admin.user.group()",useAJAX:!0,leaf:!0,iconCls:"group-ticon"});b.push({id:"departments",script:!0,cls:"treeItem-level-1",
text:getText("menu.admin.users.departments"),tooltip:getText("menu.admin.users.departments.tt"),menuPath:a+getText("menu.admin.users.departments"),url:"com.trackplus.admin.user.department()",useAJAX:!0,leaf:!0,iconCls:"department-ticon"});return com.trackplus.admin.createSectionTree("usersSection",b,getText("menu.admin.user"),getText("menu.admin.user.tt"),"users-ticon")};
com.trackplus.admin.getActionSection=function(){var a=getText("menu.admin")+"\x3e"+getText("menu.admin.action")+"\x3e",a=[{id:"importTrackplus",script:!0,text:getText("menu.admin.action.importTrackplus"),tooltip:getText("menu.admin.action.importTrackplus.tt"),menuPath:a+getText("menu.admin.action.importTrackplus"),url:"com.trackplus.admin.action.importTrackplus()",useAJAX:!0,leaf:!0,iconCls:"trackPlus-ticon"},{id:"broadcastEmail",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.manServer.sendEmail"),
tooltip:getText("menu.admin.manServer.sendEmail.tt"),menuPath:a+getText("menu.admin.manServer.sendEmail"),url:"com.trackplus.admin.sendEmail()",useAJAX:!1,leaf:!0,iconCls:"broadcast-ticon"}];return com.trackplus.admin.createSectionTree("actionSection",a,getText("menu.admin.action"),getText("menu.admin.action.tt"),"action-ticon")};
com.trackplus.admin.getCustomizationSection=function(){var a=getText("menu.admin")+"\x3e"+getText("menu.admin.custom")+"\x3e",b=[];com.trackplus.TrackplusConfig.user.manageFilters&&b.push({id:"queryFilters",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.queryFilters"),menuPath:a+getText("menu.admin.custom.queryFilters"),url:'com.trackplus.admin.categoryConfig("issueFilter")',useAJAX:!0,leaf:!0,iconCls:"filter-ticon"});com.trackplus.TrackplusConfig.user.reportTemplates&&b.push({id:"reportTemplates",
script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.reportTemplates"),menuPath:a+getText("menu.admin.custom.reportTemplates"),url:'com.trackplus.admin.categoryConfig("report")',useAJAX:!0,leaf:!0,iconCls:"report-ticon"});(com.trackplus.TrackplusConfig.user.sys||com.trackplus.TrackplusConfig.user.projectAdmin&&com.trackplus.TrackplusConfig.user.userRoles)&&b.push({id:"roles",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.roles"),tooltip:getText("menu.admin.custom.roles.tt"),
menuPath:a+getText("menu.admin.custom.roles"),url:"com.trackplus.admin.refreshRoles()",useAJAX:!0,leaf:!0,iconCls:"roles-ticon"});(com.trackplus.TrackplusConfig.user.sys||com.trackplus.TrackplusConfig.user.projectAdmin&&com.trackplus.TrackplusConfig.user.userLevels)&&b.push({id:"userLevels",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.userLevels"),tooltip:getText("menu.admin.custom.userLevels.tt"),menuPath:a+getText("menu.admin.custom.userLevels"),url:"com.trackplus.admin.userLevelConfig()",
useAJAX:!0,leaf:!0,iconCls:"personSystemAdmin"});com.trackplus.TrackplusConfig.user.sys&&(com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&b.push({id:"accounts",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.account"),tooltip:getText("menu.item.account.tt"),menuPath:a+getText("menu.admin.custom.account"),url:"com.trackplus.admin.accountConfig()",useAJAX:!0,leaf:!0,iconCls:"account-ticon"}),b.push({id:"defaultAutomail",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.automail"),
tooltip:getText("menu.admin.custom.automail.tt"),menuPath:a+getText("menu.admin.custom.automail"),url:"com.trackplus.admin.notify(true)",useAJAX:!0,leaf:!0,iconCls:"automailc-ticon"}));com.trackplus.TrackplusConfig.user.sys&&com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&b.push({id:"linkTypes",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.linkType"),tooltip:getText("menu.admin.custom.linkType"),menuPath:a+getText("menu.admin.custom.linkType"),url:"com.trackplus.admin.refreshLinkTypes()",
useAJAX:!0,leaf:!0,iconCls:"links-ticon"});(com.trackplus.TrackplusConfig.user.sys||com.trackplus.TrackplusConfig.user.projectAdmin&&com.trackplus.TrackplusConfig.user.forms)&&b.push({id:"customForms",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.customForms"),tooltip:getText("menu.admin.custom.customForms"),menuPath:a+getText("menu.admin.custom.customForms"),url:"com.trackplus.admin.screenConfig()",useAJAX:!0,leaf:!0,iconCls:"forms-ticon"});(com.trackplus.TrackplusConfig.user.sys||
com.trackplus.TrackplusConfig.user.projectAdmin&&com.trackplus.TrackplusConfig.user.fields)&&b.push({id:"customFields",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.customField"),tooltip:getText("menu.admin.custom.customField.tt"),menuPath:a+getText("menu.admin.custom.customField"),url:"com.trackplus.admin.fieldConfig()",useAJAX:!0,leaf:!0,iconCls:"fields-ticon"});(com.trackplus.TrackplusConfig.user.sys||com.trackplus.TrackplusConfig.user.projectAdmin&&com.trackplus.TrackplusConfig.user.lists)&&
b.push({id:"pickLists",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.list"),tooltip:getText("menu.admin.custom.list.tt"),menuPath:a+getText("menu.admin.custom.list"),url:"com.trackplus.admin.listConfig()",useAJAX:!0,leaf:!0,iconCls:"picklists-ticon"});com.trackplus.TrackplusConfig.user.sys&&(b.push({id:"objectStatus",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.objectStatus"),tooltip:getText("menu.admin.custom.objectStatus.tt"),menuPath:a+getText("menu.admin.custom.objectStatus"),
url:"com.trackplus.admin.objectStatusConfig()",useAJAX:!0,leaf:!0,iconCls:"objectStatus-ticon"}),b.push({id:"projectTypes",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.projectType"),tooltip:getText("menu.admin.custom.projectType.tt"),menuPath:a+getText("menu.admin.custom.projectType"),url:"com.trackplus.admin.projectTypes()",useAJAX:!0,leaf:!0,iconCls:"projecttypes-ticon"}));com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&(com.trackplus.TrackplusConfig.user.sys||com.trackplus.TrackplusConfig.user.projectAdmin&&
com.trackplus.TrackplusConfig.user.workflows)&&b.push({id:"workflows",script:!0,text:getText("menu.admin.custom.workflow"),tooltip:getText("menu.admin.custom.workflow.tt"),menuPath:a+getText("menu.admin.custom.workflow"),url:"com.trackplus.admin.workflowConfig()",useAJAX:!1,leaf:!0,iconCls:"workflow-ticon"});com.trackplus.TrackplusConfig.user.sys&&(com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&(b.push({id:"scripts",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.script"),tooltip:getText("menu.admin.custom.script.tt"),
menuPath:a+getText("menu.admin.custom.script"),url:"com.trackplus.admin.refreshScript()",useAJAX:!0,leaf:!0,iconCls:"scripts-ticon"}),b.push({id:"localization",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.localeEditor"),tooltip:getText("menu.admin.custom.localeEditor.tt"),menuPath:a+getText("menu.admin.custom.localeEditor"),url:"com.trackplus.admin.localeEditor()",useAJAX:!0,leaf:!0,iconCls:"localize-ticon"})),com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&(b.push({id:"mailTemplates",
script:!0,cls:"treeItem-level-1",text:getText("menu.admin.custom.mailTemplate"),tooltip:getText("menu.admin.custom.mailTemplate.tt"),menuPath:a+getText("menu.admin.custom.mailTemplate"),url:"com.trackplus.admin.mailTemplateConfig()",useAJAX:!0,leaf:!0,iconCls:"mailTemplate-ticon"}),b.push({id:"dashboardAssign",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.users.cockpitDefault"),tooltip:getText("menu.admin.users.cockpitDefault.tt"),menuPath:a+getText("menu.admin.users.cockpitDefault"),
url:"com.trackplus.admin.user.dashboardAssign()",useAJAX:!0,leaf:!0,iconCls:"cockpit-ticon"})));return 0<b.length?com.trackplus.admin.createSectionTree("customizationSection",b,getText("menu.admin.custom"),getText("menu.admin.custom.tt"),"customize-ticon"):null};
com.trackplus.admin.getServerSection=function(){var a=getText("menu.admin")+"\x3e"+getText("menu.admin.manServer")+"\x3e",a=[{id:"serverConfiguration",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.manServer.serverConfig"),tooltip:getText("menu.admin.manServer.serverConfig.tt"),menuPath:a+getText("menu.admin.manServer.serverConfig"),url:"com.trackplus.admin.serverConfiguration()",useAJAX:!0,leaf:!0,iconCls:"server-ticon"},{id:"logonPageText",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.manServer.logonText"),
tooltip:getText("menu.admin.manServer.logonText.tt"),menuPath:a+getText("menu.admin.manServer.logonText"),url:"com.trackplus.admin.logonPageText()",useAJAX:!1,leaf:!0,iconCls:"motd-ticon"},{id:"serverStatus",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.manServer.serverStatus"),tooltip:getText("menu.admin.manServer.serverStatus.tt"),menuPath:a+getText("menu.admin.manServer.serverStatus"),url:"com.trackplus.admin.serverStatus()",useAJAX:!1,leaf:!0,iconCls:"serverStatus-ticon"},{id:"loggingConfiguration",
script:!0,cls:"treeItem-level-1",text:getText("menu.admin.manServer.loggingConfig"),tooltip:getText("menu.admin.manServer.loggingConfig.tt"),menuPath:a+getText("menu.admin.manServer.loggingConfig"),url:"com.trackplus.admin.loggingConfiguration()",useAJAX:!1,leaf:!0,iconCls:"logging-ticon"},{id:"dataBackup",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.manServer.databaseBackup"),tooltip:getText("menu.admin.manServer.databaseBackup.tt"),menuPath:a+getText("menu.admin.manServer.databaseBackup"),
url:"com.trackplus.admin.databaseBackup()",useAJAX:!1,leaf:!0,iconCls:"backup-ticon"},{id:"dataRestore",script:!0,cls:"treeItem-level-1",text:getText("menu.admin.manServer.databaseRestore"),tooltip:getText("menu.admin.manServer.databaseRestore.tt"),menuPath:a+getText("menu.admin.manServer.databaseRestore"),url:"com.trackplus.admin.databaseRestore()",useAJAX:!1,leaf:!0,iconCls:"restore-ticon"}];return com.trackplus.admin.createSectionTree("serverSection",a,getText("menu.admin.manServer"),getText("menu.admin.manServer.tt"),
"server-ticon")};com.trackplus.admin.getNodeJsonData=function(a,b){var c=this.sections[a];if(null!=c)for(var e=0;e<c.length;e++)if(c[e].id==b)return c[e];return null};com.trackplus.admin.myProfile=function(){var a=Ext.create("com.trackplus.admin.user.Profile",{context:1});borderLayout.setActiveToolbarList([a.createSaveButton()]);a=a.loadProfile();borderLayout.setCenterContent(a)};
com.trackplus.admin.projectConfig=function(a,b){borderLayout.setLoading(!0);Ext.Ajax.request({fromCenterPanel:!0,url:"project!loadLasSelections.action",disableCaching:!0,scope:this,success:function(c){c=Ext.decode(c.responseText);c=Ext.create("com.trackplus.admin.project.ProjectConfig",{projectTree:this.sections.projects,sys:com.trackplus.TrackplusConfig.user.sys,rootID:a,treeWidth:200,lastSelections:c,isTemplate:b});borderLayout.controller.setCenterContent(c.createCenterPanel());borderLayout.setLoading(!1)},
failure:function(b){b=Ext.create("com.trackplus.admin.project.ProjectConfig",{projectTree:this.sections.projects,rootID:a,sys:com.trackplus.TrackplusConfig.user.sys,treeWidth:200,lastSelections:{}});borderLayout.controller.setCenterContent(b.createCenterPanel());borderLayout.setLoading(!1)}})};
com.trackplus.admin.user.person=function(a){var b=Ext.create("com.trackplus.admin.user.Person",{isUser:a});com.trackplus.admin.replaceGridConfig(b);Ext.Ajax.request({url:"person!getUserConfigs.action",scope:this,success:function(b){b=Ext.decode(b.responseText);b=Ext.create("com.trackplus.admin.user.Person",{isUser:a,userLevels:b.userLevelList,featureList:b.featureList});com.trackplus.admin.replaceGridConfig(b)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})};
com.trackplus.admin.user.group=function(){var a=Ext.create("com.trackplus.admin.user.Group",{});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.user.department=function(){var a=Ext.create("com.trackplus.admin.user.Department",{rootID:"",reloadGrids:!0});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.user.dashboardAssign=function(){var a=Ext.create("com.trackplus.admin.user.DashboardAssignment",{rootID:""});com.trackplus.admin.replaceTreeWithGridConfig(a)};
com.trackplus.admin.action.importExcel=function(){var a=Ext.create("com.trackplus.admin.action.ImportExcel");com.trackplus.admin.replaceWizardConfig(a)};com.trackplus.admin.action.importDocx=function(){var a=Ext.create("com.trackplus.admin.action.ImportDocx");com.trackplus.admin.replaceWizardConfig(a)};com.trackplus.admin.action.importMsProject=function(){var a=Ext.create("com.trackplus.admin.action.ImportMsProject");com.trackplus.admin.replaceWizardConfig(a)};
com.trackplus.admin.action.importTrackplus=function(){var a=Ext.create("com.trackplus.admin.action.ImportTrackplus");borderLayout.controller.setActiveToolbarList(a.createToolbar());a=a.createMainComponent();borderLayout.controller.setCenterContent(a)};
com.trackplus.admin.serverConfiguration=function(){var a=Ext.create("com.trackplus.admin.server.SiteConfig",{});borderLayout.controller.setActiveToolbarList([a.createSaveButton()]);var b=a.createMainComponent();borderLayout.controller.setCenterContent(b);a.loadMyForm.call(a)};com.trackplus.admin.logonPageText=function(){var a=Ext.create("com.trackplus.admin.server.LogonPageText",{});borderLayout.controller.setActiveToolbarList([a.createSaveButton()]);var b=a.createMainComponent();a.reload();borderLayout.controller.setCenterContent(b)};
com.trackplus.admin.sendEmail=function(){var a=Ext.create("com.trackplus.admin.server.SendEmail",{});borderLayout.controller.setActiveToolbarList(a.getToolbar());a=a.createMainComponent();borderLayout.controller.setCenterContent(a)};com.trackplus.admin.serverStatus=function(){var a=Ext.create("com.trackplus.admin.server.ServerStatus",{});borderLayout.controller.setActiveToolbarList(a.createToolbar());a.reloadAndReplaceComp()};
com.trackplus.admin.loggingConfiguration=function(){var a=Ext.create("com.trackplus.admin.server.LoggingConfig",{});borderLayout.controller.setActiveToolbarList([]);var b=a.createMainComponent();a.reload();borderLayout.controller.setCenterContent(b)};com.trackplus.admin.databaseBackup=function(){var a=Ext.create("com.trackplus.admin.server.DatabaseBackup",{});borderLayout.controller.setActiveToolbarList(a.createToolbar());a=a.createMainComponent();borderLayout.controller.setCenterContent(a)};
com.trackplus.admin.databaseRestore=function(){var a=Ext.create("com.trackplus.admin.server.DatabaseRestore",{});borderLayout.controller.setActiveToolbarList(a.createToolbar());var b=a.createMainComponent();a.reload();borderLayout.controller.setCenterContent(b)};com.trackplus.admin.refreshLinkTypes=function(){var a=Ext.create("com.trackplus.admin.customize.linkType.LinkTypeGridConfig",{});com.trackplus.admin.replaceGridConfig(a)};
com.trackplus.admin.projectTypes=function(){var a=Ext.create("com.trackplus.admin.customize.projectType.ProjectType",{treeWidth:250});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.refreshScript=function(){var a=Ext.create("com.trackplus.admin.customize.script.ScriptGridConfig",{});com.trackplus.admin.replaceGridConfig(a)};
com.trackplus.admin.workflowConfig=function(){var a=Ext.create("com.trackplus.admin.customize.treeConfig.WorkflowConfig",{rootID:"workflow",treeWidth:300});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.refreshRoles=function(){var a=Ext.create("com.trackplus.admin.customize.role.RolesGridConfig",{});com.trackplus.admin.replaceGridConfig(a)};
com.trackplus.admin.accountConfig=function(){var a=Ext.create("com.trackplus.admin.customize.account.AccountConfig",{rootID:"_false"});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.replaceTreeWithGridConfig=function(a){borderLayout.controller.setCenterContent(a.createCenterPanel());borderLayout.controller.setActiveToolbarActionList(a.getToolbarActions())};com.trackplus.admin.notify=function(a){a=Ext.create("com.trackplus.admin.NotifyConfig",{defaultSettings:a});com.trackplus.admin.replaceTreeWithGridConfig(a)};
com.trackplus.admin.iCalendarURL=function(){var a=Ext.create("com.trackplus.admin.ICalendarURL",{data:{}});borderLayout.setActiveToolbarList(a.getToolbarButtons.call(a));a=a.createView.call(a);borderLayout.setCenterContent(a)};com.trackplus.admin.fieldConfig=function(){var a=Ext.create("com.trackplus.admin.customize.treeConfig.FieldConfig",{rootID:"field",treeWidth:250});com.trackplus.admin.replaceTreeWithGridConfig(a)};
com.trackplus.admin.screenConfig=function(){var a=Ext.create("com.trackplus.admin.customize.treeConfig.ScreenConfig",{rootID:"screen",treeWidth:250});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.mailTemplateConfig=function(){var a=Ext.create("com.trackplus.admin.customize.treeConfig.MailTemplateConfig",{rootID:"mailTemplate",treeWidth:250});com.trackplus.admin.replaceTreeWithGridConfig(a)};
com.trackplus.admin.localeEditor=function(){var a=Ext.create("com.trackplus.admin.customize.locale.LocaleEditor");com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.userLevelConfig=function(){var a=Ext.create("com.trackplus.admin.customize.userLevel.userLevelConfig",{rootID:""});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.listConfig=function(){var a=Ext.create("com.trackplus.admin.customize.list.ListConfig");com.trackplus.admin.replaceTreeWithGridConfig(a)};
com.trackplus.admin.objectStatusConfig=function(){var a=Ext.create("com.trackplus.admin.customize.objectStatus.ObjectStatusConfig");com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.categoryConfig=function(a){a=Ext.create("com.trackplus.admin.customize.category.CategoryConfig",{rootID:a});com.trackplus.admin.replaceTreeWithGridConfig(a)};com.trackplus.admin.replaceGridConfig=function(a){var b=a.getGrid();borderLayout.controller.setCenterContent(b);a.reload();borderLayout.controller.setActiveToolbarActionList(a.getToolbarActions())};
com.trackplus.admin.replaceWizardConfig=function(a){var b=a.getWizardPanel();borderLayout.controller.setCenterContent(b);borderLayout.controller.setActiveToolbarActionList(a.getToolbarActions())};
Ext.define("com.trackplus.layout.AdminLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!0,sectionSelected:null,selectedNodeID:null,selectedGroup:"admin",constructor:function(a){var b=this;b.callParent(arguments);b.reportsConfig=Ext.create("com.trackplus.admin.customize.ReportConfig",{rootID:"report"});var c=b.initData;com.trackplus.TrackplusConfig.user.sysAdmin?(b.sectionSelected="serverSection",b.selectedNodeID="serverConfiguration"):(b.sectionSelected="myPreferenceSection",b.selectedNodeID=
"myProfile");null!=c.sectionSelected&&(b.sectionSelected=c.sectionSelected);null!=c.selectedNodeID&&(b.selectedNodeID=c.selectedNodeID);b.onReady(function(){null!=b.sectionSelected&&b.setSelectedContext(b.sectionSelected,b.selectedNodeID)})},createWestPanel:function(){return com.trackplus.admin.createAdminWestPanel(this.initData)},historyChange:function(a){a=a.split(":");this.setSelectedContext(a[0],a[1])},setSelectedContext:function(a,b){if(com.trackplus.admin.lastSelectedSection==a&&com.trackplus.admin.lastSelectedNode==
b)return!0;this.sectionSelected=a;this.selectedNodeID=b;if(null!=this.sectionSelected){Ext.getCmp(this.sectionSelected).expand();var c=Ext.getCmp("tree-"+this.sectionSelected);if(null!=c){var e=c.getStore().getNodeById(this.selectedNodeID);null!=e&&(c.getSelectionModel().select(e),c.expandPath(e.getPath()),com.trackplus.admin.replaceCenterContent(this.sectionSelected,this.selectedNodeID,e.data))}}}});
Ext.define("com.trackplus.admin.user.Profile",{extend:"Ext.Base",config:{context:1,isUser:!0},personId:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},CONTEXT:{SELFREGISTRATION:0,PROFILEEDIT:1,USERADMINADD:2,USERADMINEDIT:3},mainForm:null,btnSave:null,labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:700,context:1,reqTpl:'\x3cspan class\x3d"required"\x3e\x26nbsp;\x3c/span\x3e',createSaveButton:function(){null==this.btnSave&&(this.btnSave=
new Ext.button.Button({overflowText:getText("common.btn.save"),tooltip:getText("common.btn.save"),text:getText("common.btn.save"),iconCls:"save",disabled:!0,scope:this,handler:function(){this.save.call(this)}}));return this.btnSave},getTabPanel:function(){return this.mainForm.getComponent(0)},getControl:function(){return CWHF.getControl.apply(this.getTabPanel(),arguments)},getHelpWrapper:function(){return CWHF.getHelpWrapper.apply(this.getTabPanel(),arguments)},getWrappedControl:function(){return CWHF.getWrappedControl.apply(this.getTabPanel(),
arguments)},changeLdap:function(){var a=this.getWrappedControl("tab.main","fslogin","main.ldapUser").getValue();this.getControl("tab.main","fslogin","main.passwd").setDisabled(a);this.getControl("tab.main","fslogin","main.passwd2").setDisabled(a)},changeLdapSelReg:function(a,b,c){a=a.getValue();this.selfRegForm.getComponent("main.passwd").setDisabled(a);this.selfRegForm.getComponent("main.passwd2").setDisabled(a)},createTabMain:function(){return new Ext.form.Panel({itemId:"tab.main",title:getText("admin.user.profile.lbl.tabMain"),
layout:{type:"anchor"},padding:"0 0 0 0",bodyPadding:"5 0 0 0",items:[{xtype:"label",html:'\x3cdiv style\x3d"width:'+this.FieldSetWidth+'px;"\x3e\x3cspan class\x3drequiredHint\x3e\x3cspan class\x3d"requiredHintBar"\x3e\x26nbsp;\x3c/span\x3e \x3d '+getText("common.lbl.requiredInfo")+"\x3c/span\x3e\x3c/div\x3e",margin:"8 0 0 0",width:this.FieldSetWidth},{xtype:"fieldset",itemId:"fslogin",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.basic"),collapsible:!1,layout:"anchor",items:[CWHF.createTextFieldWithHelp("admin.user.profile.lbl.userName",
"main.userName",{enableKeyEvents:!0,allowBlank:!1,maxLength:60,afterLabelTextTpl:this.reqTpl},{blur:{element:"el",scope:this,fn:function(){this.validateLoginName.call(this)}}}),CWHF.createCheckboxWithHelp("admin.user.profile.lbl.ldapUser","main.ldapUser",{},{change:{fn:this.changeLdap,scope:this}}),CWHF.createTextField("admin.user.profile.lbl.passwd","main.passwd",{inputType:"password",minLength:5,id:"main.passwd",afterLabelTextTpl:this.reqTpl}),CWHF.createTextField("admin.user.profile.lbl.passwd2",
"main.passwd2",{inputType:"password",vtype:"password",initialPassField:"main.passwd",afterLabelTextTpl:this.reqTpl})]},{xtype:"fieldset",itemId:"fsname",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.nameLang"),collapsible:!1,layout:"anchor",items:[CWHF.createTextField("admin.user.profile.lbl.lastName","main.lastName",{allowBlank:!1,maxLength:25,afterLabelTextTpl:this.reqTpl},{blur:{element:"el",fn:function(){this.validateUser.call(this)},scope:this}}),CWHF.createTextField("admin.user.profile.lbl.firstName",
"main.firstName",{allowBlank:!1,maxLength:25,afterLabelTextTpl:this.reqTpl},{blur:{element:"el",fn:function(){this.validateUser.call(this)},scope:this}}),CWHF.createComboWithHelp("admin.user.profile.lbl.locale","main.locale",{idType:"string"}),CWHF.createComboWithHelp("admin.user.profile.lbl.usertz","main.userTz",{idType:"string"})]}]})},changeNoEmail:function(){var a=this.getWrappedControl("tab.remail","fsremail1","remail.noEmail").getValue();this.getControl("tab.remail","fsremail1","remail.prefEmailType").setDisabled(a);
this.getHelpWrapper("tab.remail","fsremail2","remail.remindMeAsOriginator").setDisabled(a);this.getHelpWrapper("tab.remail","fsremail2","remail.remindMeAsManager").setDisabled(a);this.getHelpWrapper("tab.remail","fsremail2","remail.remindMeAsResponsible").setDisabled(a);this.getHelpWrapper("tab.remail","fsremail3","remail.remindPriorityLevel").setDisabled(a);this.getHelpWrapper("tab.remail","fsremail3","remail.remindSeverityLevel").setDisabled(a);this.getHelpWrapper("tab.remail","fsremail3","remail.remindMeOnDays").setDisabled(a)},
createTabEmail:function(){return new Ext.Panel({id:"tab.remail",title:getText("admin.user.profile.lbl.tabEmail"),layout:{type:"anchor"},padding:"0 0 0 0",bodyPadding:"5 0 0 0",items:[{xtype:"fieldset",itemId:"fsremail1",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.generalEmail"),collapsible:!1,layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.user.profile.lbl.noEmail","remail.noEmail",{},{change:{fn:this.changeNoEmail,scope:this}}),CWHF.getRadioGroup("remail.prefEmailType",
"admin.user.profile.lbl.prefEmailType",400,[{boxLabel:"HTML",name:"remail.prefEmailType",inputValue:"HTML",checked:!0},{boxLabel:"Plain",name:"remail.prefEmailType",inputValue:"Plain"}])]},{xtype:"fieldset",itemId:"fsremail2",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.rrole"),collapsible:!1,layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.user.profile.lbl.remindMeAsOriginator","remail.remindMeAsOriginator"),CWHF.createCheckboxWithHelp("admin.user.profile.lbl.remindMeAsManager",
"remail.remindMeAsManager"),CWHF.createCheckboxWithHelp("admin.user.profile.lbl.remindMeAsResponsible","remail.remindMeAsResponsible")]},{xtype:"fieldset",itemId:"fsremail3",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.rlevelLead"),collapsible:!1,layout:"anchor",items:[CWHF.createComboWithHelp("admin.user.profile.lbl.remindPriorityLevel","remail.remindPriorityLevel",null,null,"remail.remindPriorityLevel"),CWHF.createComboWithHelp("admin.user.profile.lbl.remindSeverityLevel",
"remail.remindSeverityLevel",null,null,"remail.remindSeverityLevel"),CWHF.createNumberFieldWithHelp("admin.user.profile.lbl.emailLead","remail.emailLead",0,-100,100,{width:this.labelWidth+30,hideTrigger:!0}),CWHF.createComboWithHelp("admin.user.profile.lbl.remindMeOnDays","remail.remindMeOnDays",{multiSelect:!0},null,"remail.remindMeOnDays")]}]})},createTabOther:function(){var a=Ext.create("Ext.Img",{src:Ext.BLANK_IMAGE_URL,width:100,height:100,itemId:"avatarIcon"}),b={xtype:"button",style:{marginBottom:"5px",
marginLeft:"5px"},enableToggle:!1,itemId:"modifyBtn",text:getText("common.btn.modify"),scope:this,handler:function(a){this.modifyIcon(a)}};iconWrapperItems=[a,b];2==this.context&&(iconWrapperItems.push(CWHF.createHiddenField("iconKey")),iconWrapperItems.push(CWHF.createHiddenField("iconName")));var a=Ext.create("Ext.form.FieldContainer",{combineErrors:!0,itemId:"iconPanel",fieldLabel:getText("admin.user.profile.lbl.avatar"),labelWidth:this.labelWidth,labelAlign:this.alignR,labelStyle:{overflow:"hidden"},
layout:"hbox",items:iconWrapperItems}),b=!1,c=!0;null==this.isUser||this.isUser||(b=!0,c=!1);return new Ext.Panel({id:"tab.other",title:getText("admin.user.profile.lbl.tabOther"),layout:{type:"anchor"},padding:"0 0 0 0",bodyPadding:"5 0 0 0",items:[{xtype:"fieldset",itemId:"fsother1",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.organization"),collapsible:!1,defaultType:"textfield",layout:"anchor",items:[CWHF.createLabelComponent("admin.user.profile.lbl.lastLogin","other.lastLogin"),
CWHF.createSingleTreePickerWithHelp("admin.user.profile.lbl.department","other.department",[],null,{labelWidth:this.labelWidth,width:550}),CWHF.createTextField("admin.user.profile.lbl.phone","other.phone"),CWHF.createTextField("admin.user.profile.lbl.employeeId","other.employeeId"),a,CWHF.createNumberField("admin.user.profile.lbl.workingHours","other.workingHours",2,0,24,{labelWidth:this.labelWidth,width:this.labelWidth+80}),CWHF.createNumberField("admin.user.profile.lbl.hourlyWage","other.hourlyWage",
2,0,null,{labelWidth:this.labelWidth,width:this.labelWidth+80}),CWHF.createNumberField("admin.user.profile.lbl.extraHourWage","other.extraHourWage",2,0,null,{labelWidth:this.labelWidth,width:this.labelWidth+80})]},{xtype:"fieldset",itemId:"fsother2",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.behaviour"),collapsible:!1,defaultType:"textfield",layout:"anchor",items:[CWHF.createComboWithHelp("admin.user.profile.lbl.csvEncoding","other.csvEncoding",{data:[{id:"UTF-8",label:"Unicode UTF-8"},
{id:"ISO-8859-1",label:"Western (ISO-8859-1)"},{id:"ISO-8859-2",label:"Central Europe (ISO-8859-2)"},{id:"ISO-8859-3",label:"Southern Europe (ISO-8859-3)"},{id:"ISO-8859-4",label:"Northern Europe (ISO-8859-4)"},{id:"ISO-8859-6",label:"Arabic (ISO-8859-6)"},{id:"ISO-8859-7",label:"Greek (ISO-8859-7)"},{id:"ISO-8859-8",label:"Hebrew (ISO-8859-8)"},{id:"ISO-8859-9",label:"Turkish (ISO-8859-9)"},{id:"ISO-8859-10",label:"Nordic (ISO-8859-10)"},{id:"ISO-8859-11",label:"Thai (ISO-8859-11)"},{id:"ISO-8859-13",
label:"Baltic (ISO-8859-13)"},{id:"ISO-8859-14",label:"Celtic (ISO-8859-14)"},{id:"ISO-8859-16",label:"S.E. Europe (ISO-8859-16)"},{id:"KOI8-R",label:"Russian (KOI8-R)"},{id:"KOI8-U",label:"Ukraine (KOI8-U)"},{id:"Shift-JIS",label:"Japanese (Shift-JIS)"},{id:"ISO-2022-JP",label:"Japanese (ISO-2022-JP)"},{id:"GB18030",label:"Chinese (simplified)"},{id:"Big5",label:"Chinese (traditional)"},{id:"UTF-16",label:"Unicode UTF-16"}],idType:"string"}),CWHF.createTextFieldWithHelp("admin.user.profile.lbl.csvSeparator",
"other.csvSeparator",{width:this.labelWidth+20,enforceMaxLength:!0,maxLength:1}),CWHF.createCheckboxWithHelp("admin.user.profile.lbl.saveAttachments","other.saveAttachments"),CWHF.createComboWithHelp("admin.user.profile.lbl.designPath","other.designPath",{idType:"string"}),CWHF.createCheckboxWithHelp("admin.user.profile.lbl.activateInlineEdit","other.activateInlineEdit"),CWHF.createCheckboxWithHelp("admin.user.profile.lbl.activateLayout","other.activateLayout"),CWHF.getRadioGroupWithHelp("other.homePage",
"admin.user.profile.lbl.homePage",this.textFieldWidth,[{boxLabel:getText("menu.cockpit"),name:"other.homePage",inputValue:"cockpit",checked:b},{boxLabel:getText("menu.findItems"),name:"other.homePage",inputValue:"itemNavigator",checked:c}]),CWHF.createComboWithHelp("admin.user.manage.lbl.userLevel","other.userLevel")]},{xtype:"fieldset",itemId:"fsother3",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.timer"),collapsible:!1,defaultType:"textfield",layout:"anchor",items:[CWHF.createNumberFieldWithHelp("admin.user.profile.lbl.sessionTimeout",
"other.sessionTimeout",0,1,99999,{width:this.labelWidth+40,hideTrigger:!0,disabled:!0})]},{xtype:"fieldset",itemId:"fsother4",width:this.FieldSetWidth,title:getText("admin.user.profile.fieldset.substitute"),collapsible:!1,defaultType:"textfield",layout:"anchor",items:[CWHF.createComboWithHelp("admin.user.profile.lbl.substitutePerson","other.substituteID")]}]})},modifyIcon:function(a){var b={personID:this.personId,context:this.context};if(2==this.context){var c=a.ownerCt.getComponent("iconKey");null!=
c&&(b.iconKey=c.getValue());c=a.ownerCt.getComponent("iconName");null!=c&&(b.iconName=c.getValue())}b={loadUrl:"avatar.action",loadUrlParams:b};c={personID:this.personId,context:this.context};c=[{submitUrl:"avatar!upload.action",submitUrlParams:c,submitButtonText:getText("common.btn.upload"),submitHandler:this.uploadFileHandler},{submitUrl:"avatar!delete.action",submitUrlParams:c,submitButtonText:getText("common.btn.delete"),submitHandler:this.deleteUploadedFileHandler}];a={title:getText("common.lbl.upload",
getText("admin.customize.list.lbl.icon")),width:550,height:250,load:b,submit:c,formPanel:this.getFormPanel(),postDataProcess:this.renderUploadPostDataProcess,cancelButtonText:getText("common.btn.done"),refreshAfterCancel:!0,extraConfig:{avatarIcon:a.ownerCt.getComponent("avatarIcon")}};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},getFormPanel:function(a,b){var c=Ext.create("Ext.Img",{src:Ext.BLANK_IMAGE_URL,width:100,height:100,itemId:"avatarIcon"}),c=[Ext.create("Ext.form.FieldContainer",
{combineErrors:!0,itemId:"iconPanel",fieldLabel:getText("admin.user.profile.lbl.avatarActual"),labelWidth:this.labelWidth,labelAlign:this.alignR,labelStyle:{overflow:"hidden"},layout:"hbox",items:[c]}),CWHF.createLabelComponent("admin.user.profile.lbl.avatarName","avatarName",{labelWidth:this.labelWidth}),CWHF.createFileField("admin.user.profile.lbl.avatarNew","iconFile",{allowBlank:!1,labelWidth:this.labelWidth})];return Ext.create("Ext.form.Panel",{bodyStyle:"padding:5px",url:"avatar!upload.action",
defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"under",anchor:"-20"},method:"POST",fileUpload:!0,items:c})},uploadFileHandler:function(a,b,c,e){a=this.formEdit.getForm();a.isValid()?(b=this.formEdit.getComponent("iconFile"),this.validateFileExtension(b.getRawValue())?a.submit({scope:this,params:c,success:function(a,b){this.renderUploadPostDataProcess(b.result.data,this.formEdit,e)},failure:function(a,b){com.trackplus.util.submitFailureHandler(a,b)}}):Ext.MessageBox.alert(getText("admin.customize.list.title.upload",
"icon"),getText("admin.customize.list.lbl.iconFileWrongType"))):Ext.MessageBox.alert(getText("admin.customize.list.title.upload",getText("admin.user.profile.lbl.avatar")),getText("admin.customize.list.lbl.iconFileNotSpecified"))},validateFileExtension:function(a){return/^.*\.(jpg|JPG|png|PNG|gif|GIF)$/.test(a)},deleteUploadedFileHandler:function(a,b,c,e){var f=this.formEdit;Ext.Ajax.request({url:b,scope:this,params:c,success:function(a){a=Ext.decode(a.responseText);this.renderUploadPostDataProcess(a.data,
f,e)}})},renderUploadPostDataProcess:function(a,b,c){var e=b.getComponent("iconPanel").getComponent("avatarIcon");e.setSrc(a.icon);b.getComponent("avatarName").setValue(a.iconName);b.getComponent("iconFile").setValue("");e=this.win.getDockedItems('toolbar[dock\x3d"bottom"]');null!=e&&e[0].getComponent(1).setDisabled(null==a.iconName||""==a.iconName);null!=c&&(e=c.avatarIcon,null!=e&&(e.setSrc(a.icon),2==this.context&&(c=e.ownerCt.getComponent("iconKey"),null!=c&&c.setValue(a.iconKey),c=e.ownerCt.getComponent("iconName"),
null!=c&&c.setValue(a.iconName))))},getEditUrl:function(a){switch(a){case this.CONTEXT.SELFREGISTRATION:return"userProfile!loadSelfRegistration.action";case this.CONTEXT.PROFILEEDIT:return"userProfile!loadEditMyProfile.action";case this.CONTEXT.USERADMINADD:return"userProfile!loadAddUser.action";case this.CONTEXT.USERADMINEDIT:return"userProfile!loadEditUser.action"}},loadProfile:function(){this.createMainForm();var a=this.getEditUrl(this.context);borderLayout.setLoading(!0);this.mainForm.getForm().load({url:a,
params:{context:this.context},scope:this,clientValidation:!1,success:function(a,c){try{null==this.btnSave&&this.createSaveButton(),this.btnSave.setDisabled(!1),this.jsonData=c.result.data,this.postDataLoadCombos(this.jsonData,this.mainForm)}catch(e){}borderLayout.setLoading(!1)},failure:function(a,c){borderLayout.setLoading(!1);com.trackplus.util.submitFailureHandler(a,c)}});return this.mainForm},createMainForm:function(a){var b={url:"userProfile!save.action",border:!1,margin:"3 0 0 0",baseCls:"x-plain",
layout:"fit",items:[this.createTabPanel()]};if(null!=a)for(propertyName in a)b[propertyName]=a[propertyName];return this.mainForm=Ext.create("Ext.form.Panel",b)},createTabPanel:function(){this.applyPasswordVType();var a=new Ext.TabPanel({itemId:"tabPanel",plain:!0,border:!1,bodyBorder:!1,defaults:{border:!1,autoScroll:!0,bodyStyle:{border:"none"}}});a.add(this.createTabMain());this.context!=this.CONTEXT.SELFREGISTRATION&&(a.add(this.createTabEmail()),a.add(this.createTabOther()));return a},save:function(){borderLayout.setLoading(!0);
for(var a=this.getTabPanel().getTabBar(),b=0;b<a.items.length;b++)a.getComponent(b).removeCls("errorTab");if(!this.mainForm.getForm().isValid()){for(var a=this.mainForm.getForm().getFields().filterBy(function(a){return!a.validate()}),c=[],b=0;b<a.items.length;b++){var e=a.items[b].getItemId(),e=e.substring(0,e.indexOf("."));Ext.Array.contains(c,e)||c.push(e)}this.markErrorTabs(c);borderLayout.setLoading(!1);CWHF.showMsgError(getText("admin.user.profile.err.errorSave"));return!1}borderLayout.setLoading(!0);
this.mainForm.getForm().submit({url:"userProfile!save.action",params:{context:this.context},scope:this,success:function(a,b){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("admin.user.profile.lbl.successSave"));b.result.localeChange&&(window.location.href=com.trackplus.TrackplusConfig.contextPath+"/admin.action")},failure:function(a,b){borderLayout.setLoading(!1);"client"!=b.failureType&&this.handleErrors(b.result.errors);CWHF.showMsgError(getText("admin.user.profile.err.errorSave"))}})},validateLoginName:function(a){this.validateUser(a,
"userProfile!validateLoginName.action")},validateUser:function(a,b){var c="userProfile!validateUser.action";null!=b&&(c=b);var e=this.mainForm;if(!0==a)e=this.selfRegForm;else for(var f=this.getTabPanel().getTabBar(),g=0;g<f.items.length;g++)f.getComponent(g).removeCls("errorTab");e.getForm().submit({url:c,params:{context:this.context,personId:this.personId},clientValidation:!1,scope:this,success:function(a,b){},failure:function(b,c){"client"!=c.failureType&&(!0==a?this.handleErrorsSelfReg(c.result.errors):
this.handleErrors(c.result.errors))}})},postDataLoadCombos:function(a,b){tabPanel=b.getComponent(0);var c=tabPanel.getComponent("tab.main"),e=tabPanel.getComponent("tab.remail"),f=tabPanel.getComponent("tab.other");!0==a["main.adminOrGuest"]&&this.getWrappedControl("tab.main","fslogin","main.userName").setReadOnly(!0);var g=this.getWrappedControl("tab.main","fsname","main.locale");g.store.loadData(a["main.locales"]);g.setValue(a["main.locale"]);g=this.getWrappedControl("tab.main","fsname","main.userTz");
g.store.loadData(a["main.timeZones"]);g.setValue(a["main.userTz"]);this.getHelpWrapper("tab.main","fslogin","main.ldapUser").setDisabled(!a["main.ldapOn"]||a["main.forceLdap"]);a.context==this.CONTEXT.SELFREGISTRATION&&(null!=e&&e.setDisabled(!0),null!=f&&f.setDisabled(!0));e=this.getWrappedControl("tab.remail","fsremail3","remail.remindPriorityLevel");e.store.loadData(a["remail.remindPriorityLevels"]);e.setValue(a["remail.remindPriorityLevel"]);e=this.getWrappedControl("tab.remail","fsremail3","remail.remindSeverityLevel");
e.store.loadData(a["remail.remindSeverityLevels"]);e.setValue(a["remail.remindSeverityLevel"]);e=this.getWrappedControl("tab.remail","fsremail3","remail.remindMeOnDays");e.store.loadData(a["remail.remindMeOnDaysList"]);e.setValue(a["remail.remindMeOnDays"]);e=this.getWrappedControl("tab.other","fsother1","other.department");e.updateData(a.departmentTree);e.setValue(a.department);e=this.getWrappedControl("tab.other","fsother2","other.designPath");e.store.loadData(a["other.designPaths"]);e.setValue(a["other.designPath"]);
a.context==this.CONTEXT.USERADMINEDIT||a.context==this.CONTEXT.USERADMINADD?this.getHelpWrapper("tab.other","fsother3","other.sessionTimeout").setDisabled(!1):this.getHelpWrapper("tab.other","fsother3","other.sessionTimeout").setDisabled(!0);tabPanel.setActiveTab(c);this.getControl("tab.main","fslogin").add(CWHF.createTextFieldWithHelp("admin.user.profile.lbl.userEmail","main.userEmail",{vtype:"email",vtypeText:getText("admin.user.profile.err.emailAddress.format"),allowBlank:!1,maxLength:60,afterLabelTextTpl:this.reqTpl,
value:a["main.userEmail"],listeners:{blur:{element:"el",scope:this,fn:function(){this.validateUser.call(this)}}}}));c=this.getControl("tab.other","fsother1","iconPanel","avatarIcon");e=a["other.iconUrl"];null!=e&&c.setSrc(e);c=this.getWrappedControl("tab.other","fsother2","other.userLevel");null!=c&&(c.store.loadData(a.userLevelList),c.setValue(a["other.userLevel"]),c.setDisabled(a.readOnly));c=this.getWrappedControl("tab.other","fsother4","other.substituteID");null!=c&&(c.store.loadData(a["other.substituteList"]),
c.setValue(a["other.substituteID"]))},applyMyDomainVType:function(a){Ext.apply(Ext.form.field.VTypes,{myDomain:function(b){var c=/\b[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}\b/.test(b.toLowerCase());if(!c)return Ext.form.field.VTypes.myDomainText=getText("admin.user.profile.err.emailAddress.format"),c;(c=RegExp(a).test(b.toLowerCase()))||(Ext.form.field.VTypes.myDomainText=getText("admin.user.profile.err.emailAddress.domain"));return c},myDomainText:""})},applyPasswordVType:function(){Ext.apply(Ext.form.field.VTypes,
{password:function(a,b){if(b.initialPassField){var c=Ext.getCmp(b.initialPassField);return a==c.getValue()}return!0},passwordText:getText("admin.user.profile.err.password.match")})},handleErrorsSelfReg:function(a){var b="";if(null!=a&&0<a.length){for(var c=0;c<a.length;c++){var e=a[c],f=e.id,g=null;null!=f&&(g=CWHF.getWrappedControl.apply(this.selfRegForm,[f]));null!=g?g.markInvalid(e.label):b+=e.label+"\x3c/br\x3e"}""!=b&&CWHF.showMsgError(e.label)}},handleErrors:function(a){var b="",c=[];if(null!=
a&&0<a.length){for(var e=0;e<a.length;e++){var f=a[e],g=f.id,h=null;null!=g&&(h=Ext.getCmp(g),g=g.substring(0,g.indexOf(".")),Ext.Array.contains(c,g)||c.push(g));null!=h?h.markInvalid(f.label):b+=f.label+"\x3c/br\x3e"}""!=b&&CWHF.showMsgError(f.label);this.markErrorTabs(c)}},markErrorTabs:function(a){var b=[];if(0<a.length){for(var c=0;c<a.length;c++){var e=this.getControl("tab."+a[c]);null!=e&&b.push(e)}if(0<b.length)for(c=this.getTabPanel().getActiveTab(),Ext.Array.contains(b,c)||this.getTabPanel().setActiveTab(b[0]),
a=this.getTabPanel().getTabBar(),c=0;c<b.length;c++)e=this.getTabPanel().items.findIndex("id",b[c].id),a.getComponent(e).addCls("errorTab")}},createSelfRegFormPanel:function(){this.applyPasswordVType();var a=Ext.create("Ext.form.Panel",{layout:"anchor",border:!1,autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"10px"},itemId:"panel.selfreg",items:[CWHF.createTextFieldWithHelp("admin.user.profile.lbl.userName","main.userName",{enableKeyEvents:!0,allowBlank:!1,listeners:{blur:{scope:this,fn:function(){this.validateLoginName.call(this,
!0)}}}}),CWHF.createCheckboxWithHelp("admin.user.profile.lbl.ldapUser","main.ldapUser",{},{change:{fn:this.changeLdapSelReg,scope:this}}),CWHF.createTextField("admin.user.profile.lbl.passwd","main.passwd",{inputType:"password",minLength:5,id:"main.passwd"}),CWHF.createTextField("admin.user.profile.lbl.passwd2","main.passwd2",{inputType:"password",vtype:"password",initialPassField:"main.passwd"}),CWHF.createTextFieldWithHelp("admin.user.profile.lbl.userEmail","main.userEmail",{vtype:"email",allowBlank:!1}),
CWHF.createTextField("admin.user.profile.lbl.lastName","main.lastName",{allowBlank:!1},{blur:{element:"el",fn:function(){this.validateUser.call(this,!0)},scope:this}}),CWHF.createTextField("admin.user.profile.lbl.firstName","main.firstName",{allowBlank:!1},{blur:{element:"el",fn:function(){this.validateUser.call(this,!0)},scope:this}}),CWHF.createComboWithHelp("admin.user.profile.lbl.locale","main.locale",{idType:"string"}),CWHF.createComboWithHelp("admin.user.profile.lbl.usertz","main.userTz",{idType:"string"})]});
return this.selfRegForm=a}});com.trackplus.admin.user.selfRegistrationAfterSubmit=function(a,b){var c=getText("logon.lbl.register"),e=b.email,f="",f=!0==b.emailSent?getText("logon.register.msg.registeredWithEmailSent",e):getText("logon.register.msg.registeredNoEmailSent");Ext.MessageBox.show({title:c,msg:f,width:400,buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})};
com.trackplus.admin.user.createSelfRegistrationDialog=function(){var a={selfRegistration:0},b=Ext.create("com.trackplus.admin.user.Profile",{context:a}),c={submitUrl:"userProfile!save.action?context\x3d0",refreshAfterSubmitHandler:com.trackplus.admin.user.selfRegistrationAfterSubmit},e=b.createSelfRegFormPanel(),c={title:getText("admin.user.profile.title.create"),width:640,height:350,submit:c,submitButtonText:getText("logon.lbl.register"),formPanel:e};e.getForm().load({url:"userProfile!loadSelfRegistration.action",
params:{context:a},scope:this,clientValidation:!1,success:function(a,c){try{var h=b.jsonData=c.result.data,k=CWHF.getWrappedControl.call(e,"main.locale");k.store.loadData(h["main.locales"]);k.setValue(h["main.locale"]);var l=CWHF.getWrappedControl.call(e,"main.userTz");null!=l&&(l.store.loadData(h["main.timeZones"]),l.setValue(h["main.userTz"]));CWHF.getWrappedControl.call(e,"main.ldapUser").setDisabled(!h["main.ldapOn"]||h["main.forceLdap"])}catch(m){}},failure:function(a,b){com.trackplus.util.submitFailureHandler(a,
b)}});a=Ext.create("com.trackplus.util.WindowConfig",c);a.showWindowByConfig(b);return{profile:b,windowConfig:a}};
Ext.define("com.trackplus.admin.user.Person",{extend:"com.trackplus.admin.GridConfig",config:{context:null,isUser:null,userLevels:null,featureList:null},urlStore:"person.action",autoLoadGrid:!1,getEntityLabel:function(){return getText("admin.user.lbl.user")},allowMultipleSelections:!0,confirmDeleteEntity:!0,baseAction:"person",entityID:"objectID",editWidth:780,editHeight:500,userLevels:null,profile:null,actionActivate:null,actionDeactivate:null,actionUserLevel:null,actionRoleAssignments:null,actionFilterAssignments:null,
actionCokpitAssignment:null,actionSyncLdap:null,constructor:function(a){a=a||{};this.isUser=a.isUser;this.initialConfig=a;this.profile=Ext.create("com.trackplus.admin.user.Profile",{context:a.context});this.profile.isUser=this.isUser;a.enableColumnHide=!0;a.enableColumnMove=!0;a.features=this.getGridFeatures(a.userLevels);Ext.apply(this,a);this.init()},init:function(){this.initActions();Ext.Ajax.request({url:this.baseAction+"!getLdapIsOn.action",scope:this,success:function(a){a=Ext.decode(a.responseText).value?
!1:!0;this.actionSyncLdap.setDisabled(a)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},initActions:function(){this.actionAdd=this.createAction(this.getAddButtonKey(),this.getAddIconCls(),this.onAdd,!1,this.getAddTitleKey());this.actionEdit=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEdit,!0,this.getEditTitleKey());this.actionDelete=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDelete,!0,this.getDeleteTitleKey());
this.actionActivate=this.createAction("common.btn.activate",this.getActivateIconCls(),this.onActivate,!0,"common.lbl.activate");this.actionDeactivate=this.createAction("common.btn.deactivate",this.getDeactivateIconCls(),this.onDeactivate,!0,"common.lbl.deactivate");this.actionUserLevel=this.createAction("common.btn.userLevel","personSystemAdmin",this.onUserLevel,!0,"common.btn.userLevel");this.actionRoleAssignments=this.createAction("admin.user.manage.lbl.roleAssignments",this.getRoleAssignCls(),
this.onShowAssignments,!0,"admin.user.manage.lbl.roleAssignments");this.actionFilterAssignments=this.createAction("admin.user.manage.lbl.filterAssignments",this.getFilterAssignCls(),this.onFilterAssignments,!0,"admin.user.manage.lbl.filterAssignments");this.actionCokpitAssignment=this.createAction("admin.user.manage.lbl.cokpitAssignment",this.getCokpitAssignmentIconCls(),this.onCokpitAssignment,!0,"admin.user.manage.lbl.cokpitAssignment");this.actionSyncLdap=this.createAction("common.btn.syncLdap",
this.getAddIconCls(),this.onSyncLdap,!1,"common.btn.syncLdap.tt");this.actions=[this.actionAdd,this.actionEdit,this.actionDelete,this.actionActivate,this.actionDeactivate,this.actionUserLevel];this.isUser&&this.actions.push(this.actionRoleAssignments);this.actions.push(this.actionFilterAssignments);com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&this.actions.push(this.actionCokpitAssignment);this.isUser&&this.actions.push(this.actionSyncLdap)},getGridFields:function(){var a=[{name:"id",type:"int"},
{name:"userName",type:"string"},{name:"name",type:"string"},{name:"userEmail",type:"string"},{name:"active",type:"boolean"},{name:"activeLabel",type:"string"},{name:"userLevelLabel",type:"string"},{name:"locale",type:"string"},{name:"phone",type:"string"},{name:"employeeId",type:"string"},{name:"lastLogin",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateTimeFormat},{name:"department",type:"string"},{name:"substituteName",type:"string"}];this.isUser&&null!=this.featureList&&Ext.Array.forEach(this.featureList,
function(b){a.push({name:b.featureID,type:"boolean"})},this);return a},getViewConfig:function(){return{forceFit:!0,markDirty:!1}},getGridFeatures:function(a){var b=[];null!=a&&Ext.Array.forEach(a,function(a){b.push(a.label)},this);return[{ftype:"filters",encode:!1,local:!0,filters:[{type:"string",dataIndex:"userName"},{type:"string",dataIndex:"name"},{type:"string",dataIndex:"userEmail"},{type:"boolean",dataIndex:"active"},{type:"list",dataIndex:"userLevelLabel",options:b},{type:"list",dataIndex:"activeLabel",
options:[getText("common.boolean.Y"),getText("common.boolean.N")]},{type:"string",dataIndex:"department"}]}]},getAddIconCls:function(){return"personAdd"},getEditIconCls:function(){return"personEdit"},getActivateIconCls:function(){return"personActivate"},getDeactivateIconCls:function(){return"personDeactivate"},getRoleAssignCls:function(){return"roleAssign"},getFilterAssignCls:function(){return"filter"},getCokpitAssignmentIconCls:function(){return"cockpitReset"},getSelectedPersonIDs:function(){var a=
[],b=this.getSelection();null!=b&&Ext.Array.forEach(b,function(b,e,f){a.push(b.data.id)},this);return a.join(",")},getDeleteParamName:function(){return"selectedPersonIDs"},onActivate:function(){Ext.Ajax.request({url:this.baseAction+"!activate.action",params:{selectedPersonIDs:this.getSelectedPersonIDs()},scope:this,success:function(a){a=Ext.decode(a.responseText);a.success?this.reload():com.trackplus.util.showError(a)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},
onDeactivate:function(){Ext.Ajax.request({url:this.baseAction+"!deactivate.action",params:{selectedPersonIDs:this.getSelectedPersonIDs()},scope:this,success:function(a){a=Ext.decode(a.responseText);a.success?this.reload():com.trackplus.util.showError(a)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},onUserLevel:function(a){a=this.baseAction+"!userLevel.action";var b={selectedPersonIDs:this.getSelectedPersonIDs()};a={submitUrl:a,submitUrlParams:b,submitButtonText:getText("common.btn.save"),
refreshAfterSubmitHandler:this.reload};b=this.getUserLevelItems();a={title:getText("common.btn.userLevel"),width:300,height:120,submit:a,items:b};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},getUserLevelItems:function(){var a=null;com.trackplus.TrackplusConfig.user.sysAdmin?a=this.userLevels:(a=[],Ext.Array.forEach(this.userLevels,function(b){var c=b.id;null!=c&&2!=c&&a.push(b)},this));return[CWHF.createCombo("admin.user.manage.lbl.userLevel","userLevel",{data:a,labelWidth:100,
allowBlank:!1})]},onShowAssignments:function(){var a=getText("admin.user.manage.lbl.roleAssignments");this.getEditParams();var b={loadHandler:this.showAssignmentsLoadHandler},c=null,e=this.getSingleSelectedRecordData(!0);null!=e&&(c=e.id);a={title:a,width:500,height:350,load:b,cancelButtonText:getText("common.btn.done"),layout:"border",formPanel:this.getRoleAssignmentGrid(c)};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},onFilterAssignments:function(){var a=getText("admin.user.manage.lbl.filterAssignments");
this.getEditParams();var b={loadHandler:this.showAssignmentsLoadHandler},c=this.getSelectedPersonIDs(),a={title:a,width:500,height:350,load:b,cancelButtonText:getText("common.btn.done"),layout:"border",formPanel:this.getFilterAssignmentGrid(c)};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},onCokpitAssignment:function(){com.trackplus.dashboard.resetDashboard(this.baseAction+"!cokpitAssignment.action",{selectedPersonIDs:this.getSelectedPersonIDs()},this.cokpitAssignmentSuccess,
this)},cokpitAssignmentSuccess:function(){this.reload()},showAssignmentsLoadHandler:function(a,b){},getRoleAssignmentGrid:function(a){return[Ext.create("com.trackplus.admin.user.UserRolesInProject",{urlStore:"rolesInProjects.action",personID:a,group:!1}).getGrid()]},getFilterAssignmentGrid:function(a){return[Ext.create("com.trackplus.admin.user.FiltersInUserMenus",{urlStore:"filtersInMenu.action",personIDs:a}).getGrid()]},onSyncLdap:function(){Ext.Ajax.request({url:this.baseAction+"!syncldap.action",
scope:this,success:function(a){a=Ext.decode(a.responseText);a.success?this.reload():com.trackplus.util.showError(a)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},getColumnModel:function(){var a=[{text:getText("admin.user.profile.lbl.userName"),flex:2,dataIndex:"userName",sortable:!0,renderer:this.renderer},{text:getText("common.lbl.name"),flex:2,dataIndex:"name",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.userEmail"),flex:2,
dataIndex:"userEmail",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.manage.lbl.userLevel"),flex:1,dataIndex:"userLevelLabel",sortable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.department"),flex:2,dataIndex:"department",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.manage.lbl.activ"),flex:1,dataIndex:"activeLabel",sortable:!0,hidden:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.locale"),flex:1,dataIndex:"locale",
sortable:!0,hidden:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.phone"),flex:1,dataIndex:"phone",sortable:!0,hidden:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.employeeId"),flex:1,dataIndex:"employeeId",sortable:!0,hidden:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.lastLogin"),flex:1,dataIndex:"lastLogin",sortable:!0,hidden:!0,filterable:!0,renderer:this.dateRenderer},{text:getText("admin.user.profile.lbl.substitutePerson"),
flex:2,dataIndex:"substituteName",sortable:!0,hidden:!0,filterable:!0,renderer:this.renderer}];this.isUser&&null!=this.featureList&&Ext.Array.forEach(this.featureList,function(b){a.push({text:b.featureName,xtype:"checkcolumn",flex:1,dataIndex:b.featureID,sortable:!0,hidden:!1,listeners:{checkchange:{fn:this.onCheckChange,scope:this,feature:b},beforecheckchange:{fn:this.onBeforeCheckChange,scope:this,feature:b}}})},this);return a},onCheckChange:function(a,b,c,e){a=this.grid.getStore().getAt(b);var f=
e.feature;e=f.featureID;null!=a&&null!=f&&Ext.Ajax.request({url:this.baseAction+"!changeFeature.action",params:{personID:a.data.id,featureID:e,featureValue:c},scope:this,success:function(a){a=Ext.decode(a.responseText);a.success?f.activeWithFeature=a.activeWithFeature:com.trackplus.util.showError(a)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},onBeforeCheckChange:function(a,b,c,e){a=e.feature;b=this.grid.getStore().getAt(b);e=a.featureName;var f=a.maxWithFeature;
a=a.activeWithFeature;if(!0==c&&a>=f&&b.data.active)return Ext.MessageBox.alert(this.failureTitle,getText("admin.user.manage.err.featureExceeded",f,a,e)),!1},dateRenderer:function(a,b,c){c.data.active||(b.style="color:#909090");return Ext.util.Format.date(a,com.trackplus.TrackplusConfig.DateTimeFormat)},renderer:function(a,b,c){c.data.active||(b.style="color:#909090");return a},getGridSelectionModel:function(){return Ext.create("Ext.selection.CheckboxModel",{mode:"MULTI"})},onGridSelectionChange:function(a,
b){null==b||0==b.length?(this.actionDelete.setDisabled(!0),this.actionEdit.setDisabled(!0),this.actionActivate.setDisabled(!0),this.actionDeactivate.setDisabled(!0),this.actionUserLevel.setDisabled(!0),this.actionRoleAssignments.setDisabled(!0),this.actionFilterAssignments.setDisabled(!0),this.actionCokpitAssignment.setDisabled(!0)):(1==b.length?(this.actionEdit.setDisabled(!1),this.actionRoleAssignments.setDisabled(!1)):(this.actionEdit.setDisabled(!0),this.actionRoleAssignments.setDisabled(!0)),
this.actionDelete.setDisabled(!1),this.actionActivate.setDisabled(!1),this.actionDeactivate.setDisabled(!1),this.actionUserLevel.setDisabled(!1),this.actionFilterAssignments.setDisabled(!1),this.actionCokpitAssignment.setDisabled(!1))},getGridContextMenuActions:function(a,b){var c=[];b&&c.push(this.actionEdit);c.push(this.actionDelete);c.push(this.actionActivate);c.push(this.actionDeactivate);c.push(this.actionUserLevel);c.push(this.actionFilterAssignments);b&&c.push(this.actionRoleAssignments);return c},
getLoadParams:function(a,b){return{context:this.getContext(a,b),personId:a.id}},getSaveParams:function(a,b){return{isUser:this.isUser,context:this.getContext(a,b),personId:a.id}},getContext:function(a,b){return null==a.id?this.profile.CONTEXT.USERADMINADD:this.profile.CONTEXT.USERADMINEDIT},getEditUrl:function(a,b){var c=this.getContext(a,b);return this.profile.getEditUrl(c)},getSaveUrl:function(a,b){return"userProfile!save.action"},createEditForm:function(a,b){var c=this.getContext(a,b);this.profile.context=
c;this.profile.personId=a.id;return this.profile.createMainForm({})},afterLoadForm:function(a,b){this.profile.postDataLoadCombos(a,b)},getLoadGridUrl:function(){return this.urlStore+("?isUser\x3d"+this.isUser)}});
Ext.define("com.trackplus.admin.user.Group",{extend:"com.trackplus.admin.TreeDetailAssignment",config:{rootID:"",baseAction:null,dynamicIcons:!1},baseAction:"group",editWidth:475,editHeight:305,labelWidth:145,allowMultipleNodeSelections:!0,treeHasItemdblclick:!0,actionAddGroup:null,actionEditGroup:null,actionShowAssignments:null,actionDeleteGroup:null,actionRemovePerson:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},getEntityLabel:function(a){return getText("admin.user.group.lbl.group")},
getAddIconCls:function(){return"groupAdd"},getEditIconCls:function(){return"groupEdit"},getRoleAssignCls:function(){return"roleAssign"},initActions:function(){this.actionAddGroup=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),{isLeaf:!1}),this.getAddIconCls(),this.onAddGroup,this.getTitle(this.getAddTitleKey(),{isLeaf:!1}));this.actionEditGroup=this.createLocalizedAction(this.getTitle(this.getEditTitleKey(),{isLeaf:!1}),this.getEditIconCls(),this.onEditGroup,this.getTitle(this.getEditTitleKey(),
{isLeaf:!1}),!0);this.actionShowAssignments=this.createLocalizedAction(getText("admin.user.group.lbl.roleAssignments"),this.getRoleAssignCls(),this.onShowAssignments,getText("admin.user.group.lbl.roleAssignments"),!0);this.actionDeleteGroup=this.createLocalizedAction(this.getTitle(this.getDeleteTitleKey(),{isLeaf:!1}),this.getDeleteIconCls(),this.onDeleteGroup,this.getTitle(this.getDeleteTitleKey(),{isLeaf:!1}),!0);this.actionRemovePerson=this.createLocalizedAction(getText("common.lbl.remove",getText("admin.user.lbl.user")),
this.getDeleteIconCls(),this.onRemovePerson,getText("common.lbl.remove",getText("admin.user.lbl.user")));this.actions=[this.actionAddGroup,this.actionEditGroup,this.actionDeleteGroup,this.actionShowAssignments]},getTreeContextMenuActions:function(a,b){return b?a.isLeaf()?[this.actionRemovePerson]:[this.actionEditGroup,this.actionShowAssignments,this.actionDeleteGroup]:[this.actionDeleteGroup]},onTreeNodeDblClick:function(a,b){if(!b.isLeaf())this.onEditGroup()},getToolbarActionChangesForTreeNodeSelectionChange:function(a){var b=
!1,c=!1;null==a?b=!0:c=1<a.length;this.actionEditGroup.setDisabled(b||c);this.actionShowAssignments.setDisabled(b||c);this.actionDeleteGroup.setDisabled(b)},getRootMessage:function(){return getText("menu.admin.users.groups.tt")},onAddGroup:function(){var a=this.getTitle(this.getAddTitleKey(),{isLeaf:!1});return this.onAddEdit(a,{add:!0},{add:!0})},onEditGroup:function(){var a=this.getTitle(this.getEditTitleKey(),{isLeaf:!1}),b=this.getEditParams(),c=this.getEditParams();return this.onAddEdit(a,b,
c)},onShowAssignments:function(){var a=getText("admin.user.group.lbl.roleAssignments");this.getEditParams();var b={loadHandler:this.showAssignmentsLoadHandler},c=null,e=this.getSingleSelectedRecordData(!0);null!=e&&(c=e.id);a={title:a,width:500,height:500,load:b,cancelButtonText:getText("common.btn.done"),formPanel:this.getAssignmentGrid(c)};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},showAssignmentsLoadHandler:function(a,b){},getAssignmentGrid:function(a){return[Ext.create("com.trackplus.admin.user.UserRolesInProject",
{urlStore:"rolesInProjects.action",personID:a,group:!0}).getGrid()]},getEditParams:function(){var a=this.getSingleSelectedRecordData(!0);if(null!=a&&(a=a.id,null!=a))return{node:a}},onAddEdit:function(a,b,c){b={loadUrl:this.baseAction+"!edit.action",loadUrlParams:b};c={submitUrl:this.baseAction+"!save.action",submitUrlParams:c,submitButtonText:getText("common.btn.save"),refreshAfterSubmitHandler:com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit,refreshParametersBeforeSubmit:{nodeIDToReload:this.rootID},
refreshParametersAfterSubmit:[{parameterName:"nodeIDToSelect",fieldNameFromResult:"node"},{parameterName:"reloadTree",fieldNameFromResult:"reloadTree"}]};var e=this.getPanelItems();Ext.create("com.trackplus.util.WindowConfig",{title:a,width:this.editWidth,height:this.editHeight,load:b,submit:c,items:e}).showWindowByConfig(this)},getPanelItems:function(){return[CWHF.createTextField("common.lbl.name","name",{anchor:"95%",allowBlank:!1,labelWidth:this.labelWidth,maxLength:60,enforceMaxLength:!0}),{xtype:"fieldset",
title:getText("admin.user.group.lbl.groupFlags"),collapsible:!1,layout:"anchor",anchor:"95%",height:145,items:[CWHF.createCheckbox("admin.user.group.lbl.groupFlagOriginator","originator",{labelWidth:this.labelWidth}),CWHF.createCheckbox("admin.user.group.lbl.groupFlagManager","manager",{labelWidth:this.labelWidth}),CWHF.createCheckbox("admin.user.group.lbl.groupFlagResponsible","responsible",{labelWidth:this.labelWidth}),CWHF.createCheckbox("admin.user.group.lbl.groupFlagJoinNewUserToThisGroup","joinNewUserToThisGroup",
{labelWidth:this.labelWidth})]}]},onRemovePerson:function(){this.reloadAssigned(this.baseAction+"!unassign.action",{})},reload:com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit,getReloadParamsAfterDelete:function(a,b,c){b={reloadTree:!0};null!=a&&0<a.length&&(c=a[0],b.nodeIDToReload=c.parentNode.data.id,1==a.length?null!=c&&(a=c.previousSibling,null!=a?b.nodeIDToSelect=a.data.id:(a=c.nextSibling,null!=a?b.nodeIDToSelect=a.data.id:b.resetDetail=!0)):b.resetDetail=!0);return b},loadDetailPanel:function(a,
b,c){this.selectionIsSimple(!0)?this.loadSimpleDetailPanel(a,!1):this.resetDetailPanel()},onDeleteGroup:function(){var a=this.getSelection(!0);null!=a&&this.deleteHandler(a,{fromTree:!0})},getDeleteUrl:function(a){return this.baseAction+"!delete.action"},getDeleteParamName:function(){return"selectedGroupIDs"},getGridFields:function(a){return[{name:"id",type:"int"},{name:"userName",type:"string"},{name:"name",type:"string"},{name:"active",type:"boolean"},{name:"activeLabel",type:"string"},{name:"employeeId",
type:"string"},{name:"department",type:"string"}]},getColumnModel:function(){return[{text:getText("admin.user.profile.lbl.userName"),flex:2,dataIndex:"userName",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("common.lbl.name"),flex:2,dataIndex:"name",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.department"),flex:2,dataIndex:"department",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.employeeId"),flex:1,
dataIndex:"employeeId",sortable:!0,filterable:!0,renderer:this.renderer,hidden:!0},{text:getText("admin.user.manage.lbl.activ"),flex:1,dataIndex:"activeLabel",sortable:!0,filterable:!0,renderer:this.renderer,hidden:!0}]},renderer:function(a,b,c){c.data.active||(b.style="color:#909090");return a},hideGridHeaders:function(){return!1},enableColumnHide:function(){return!0},getGridFeatures:function(){return[{ftype:"filters",encode:!1,local:!0,filters:[{type:"string",dataIndex:"userName"},{type:"string",
dataIndex:"name"},{type:"string",dataIndex:"department"},{type:"string",dataIndex:"activeLabel"},{type:"string",dataIndex:"employeeId"}]}]},getDetailWidth:function(){return 800},getDetailHeight:function(){return 600},getMinWidth:function(){return 425}});
Ext.define("com.trackplus.admin.user.UserRolesInProject",{extend:"com.trackplus.admin.GridConfig",config:{urlStore:null,personID:null,group:null},urlStore:null,allowMultipleSelections:!0,personID:null,group:null,fields:[{name:"projectID",type:"int"},{name:"projectLabel",type:"string"},{name:"roleID",type:"int"},{name:"roleLabel",type:"string"},{name:"direct",type:"boolean"},{name:"first",type:"boolean"}],confirmDeleteEntity:!0,baseAction:"rolesInProjects",labelWidth:100,editWidth:400,editHeight:175,
constructor:function(a){this.initialConfig=a=a||{};a.features=this.getGridFeatures();a.region="center";a.style={borderTop:"1px solid #D0D0D0",borderBottom:"1px solid #D0D0D0"};Ext.apply(this,a);this.init()},getEntityLabel:function(){return getText("admin.user.group.lbl.roleAssignment")},getAddIconCls:function(){return"add16"},getDeleteIconCls:function(){return"delete16"},getColumnModel:function(){return[{header:getText("admin.project.lbl.project"),flex:1,dataIndex:"projectLabel",sortable:!0,renderer:this.projectRenderer},
{header:getText("admin.customize.role.lbl.role"),flex:1,dataIndex:"roleLabel",sortable:!1,renderer:this.roleRenderer}]},projectRenderer:function(a,b,c){return c.data.first?a:""},roleRenderer:function(a,b,c){c.data.direct||(b.style="color:#909090");return a},getGridSelectionModel:function(){return Ext.create("Ext.selection.CheckboxModel",{mode:"MULTI"})},getDockedItems:function(){return[{xtype:"toolbar",dock:"top",margin:"4 0 0 0",items:[this.actionAdd,this.actionEdit,this.actionDelete]}]},getLoadGridParams:function(){return{personID:this.personID,
group:this.group}},getAddParams:function(){return{personID:this.personID,add:!0}},getEditParams:function(a){return{personID:this.personID,projectID:a.projectID,roleID:a.roleID}},getGridFeatures:function(){return[{ftype:"filters",encode:!1,local:!0,filters:[{type:"string",dataIndex:"projectLabel"}]}]},getRecordID:function(a){return null!=a?a.projectID+"|"+a.roleID:null},getDeleteParams:function(a,b){var c={},e=this.getSelectionParam(a,b);c.unassign=e;c.personID=this.personID;return c},createEditForm:function(a,
b){var c=!1;"add"==b||a.direct||(c=!0);var e=CWHF.createCombo("admin.customize.role.lbl.role","roleID",{allowBlank:!1,labelWidth:this.labelWidth,disabled:c});return Ext.create("Ext.form.FormPanel",{url:this.baseAction+"!save.action",autoScroll:!0,border:!1,margin:"0 0 0 0",bodyStyle:{padding:"10px"},style:{borderBottom:"1px solid #D0D0D0"},defaults:{labelStyle:"overflow: hidden;",msgTarget:"side",anchor:"100%"},items:[CWHF.createSingleTreePicker("admin.project.lbl.project","projectID",[],null,{allowBlank:!1,
disabled:c,margin:"0 0 5 0"},{select:{fn:this.onProjectSelect,scope:this,roleCombo:e}}),e,CWHF.createHiddenField("projectIDOld",{value:a.projectID}),CWHF.createHiddenField("roleIDOld",{value:a.roleID})]})},afterLoadForm:function(a,b){projectControl=b.getComponent("projectID");projectControl.updateData(a.projects);projectControl.setValue(a.projectID);roleControl=b.getComponent("roleID");null!=roleControl&&roleControl.store.loadData(a.roles);roleControl.setValue(a.roleID)},onProjectSelect:function(a,
b,c){var e=c.roleCombo;Ext.Ajax.request({url:"rolesInProjects!projectChange.action",params:{projectID:a.getValue(),roleID:e.getValue()},scope:this,success:function(a){a=Ext.decode(a.responseText);e.store.loadData(a.roles);e.setValue(a.roleID)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}})}});
Ext.define("com.trackplus.admin.user.FiltersInUserMenus",{extend:"com.trackplus.admin.GridConfig",config:{urlStore:null,personIDs:null},urlStore:null,allowMultipleSelections:!0,personIDs:null,fields:[{name:"filterID",type:"int"},{name:"filterLabel",type:"string"},{name:"personID",type:"int",useNull:!0},{name:"personName",type:"string"},{name:"first",type:"boolean"}],confirmDeleteEntity:!0,baseAction:"filtersInMenu",labelWidth:100,editWidth:400,editHeight:125,constructor:function(a){this.initialConfig=
a=a||{};a.features=this.getGridFeatures();a.region="center";a.style={borderTop:"1px solid #D0D0D0",borderBottom:"1px solid #D0D0D0"};Ext.apply(this,a);this.init()},getEntityLabel:function(){return getText("admin.user.manage.lbl.filterAssignments")},getAddIconCls:function(){return"add16"},getDeleteIconCls:function(){return"delete16"},getColumnModel:function(){return[{header:getText("common.lbl.filter"),flex:1,dataIndex:"filterLabel",sortable:!0,renderer:this.filterRenderer},{header:getText("admin.user.manage.lbl.filterAssignments.user"),
flex:1,dataIndex:"personName",sortable:!1}]},filterRenderer:function(a,b,c){return c.data.first?a:""},getGridSelectionModel:function(){return Ext.create("Ext.selection.CheckboxModel",{mode:"MULTI"})},getDockedItems:function(){return[{xtype:"toolbar",dock:"top",margin:"4 0 0 0",items:[this.actionAdd,this.actionDelete]}]},getLoadGridParams:function(){return{personIDs:this.personIDs}},getAddParams:function(){return{personIDs:this.personIDs}},getGridFeatures:function(){return[{ftype:"filters",encode:!1,
local:!0,filters:[{type:"string",dataIndex:"filterLabel"}]}]},getRecordID:function(a){if(null!=a){var b=a.filterID;a=a.personID;return null==a?b:b+"|"+a}return null},getDeleteParams:function(a,b){var c={},e=this.getSelectionParam(a,b);c.unassign=e;c.personIDs=this.personIDs;return c},createEditForm:function(a,b){var c=!1;"add"==b||a.direct||(c=!0);return Ext.create("Ext.form.FormPanel",{url:this.baseAction+"!save.action",autoScroll:!0,border:!1,margin:"0 0 0 0",bodyStyle:{padding:"10px"},style:{borderBottom:"1px solid #D0D0D0"},
defaults:{labelStyle:"overflow: hidden;",msgTarget:"side",anchor:"100%"},items:[CWHF.createMultipleTreePicker(null,"filterIDs",[],null,{allowBlank:!1,disabled:c,margin:"0 0 5 0",useRemoveBtn:!1,useNull:!0,useTooltip:!1,fieldLabel:getText("common.lbl.filter")})]})},afterLoadForm:function(a,b){b.getComponent("filterIDs").updateData(a.filterTree)}});
Ext.define("com.trackplus.admin.user.Department",{extend:"com.trackplus.admin.TreeDetailAssignment",config:{rootID:"",baseAction:null,dynamicIcons:!1},baseAction:"department",editWidth:400,editHeight:150,treeHasItemdblclick:!0,dragAndDropOnTree:!0,actionAddDepartment:null,actionAddSubdepartment:null,actionEditDepartment:null,actionDeleteDepartment:null,actionDetachFromParentDepartment:null,actionRemovePerson:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},getEntityLabel:function(a){return getText("admin.user.department.lbl.department")},
getAddIconCls:function(){return"departmentAdd"},getEditIconCls:function(){return"departmentEdit"},getAddSubdepartmentLabel:function(){return getText(this.getAddTitleKey(),getText("admin.user.department.lbl.subdepartment"))},initActions:function(){this.actionAddDepartment=this.createLocalizedAction(this.getTitle(this.getAddTitleKey(),{isLeaf:!1}),this.getAddIconCls(),this.onAddMainDepartment,this.getTitle(this.getAddTitleKey(),{isLeaf:!1}));this.actionAddSubdepartment=this.createLocalizedAction(this.getAddSubdepartmentLabel(),
this.getAddIconCls(),this.onAddSubdepartment,this.getAddSubdepartmentLabel());this.actionEditDepartment=this.createLocalizedAction(this.getTitle(this.getEditTitleKey(),{isLeaf:!1}),this.getEditIconCls(),this.onEditDepartment,this.getTitle(this.getEditTitleKey()));this.actionDeleteDepartment=this.createLocalizedAction(this.getTitle(this.getDeleteTitleKey(),{isLeaf:!1}),this.getDeleteIconCls(),this.onDeleteDepartment,this.getTitle(this.getDeleteTitleKey(),{isLeaf:!1}));this.actionDetachFromParentDepartment=
this.createLocalizedAction(getText("menu.admin.users.departments.removeFromParent"),"clear",this.onDetachFromParentDepartment,getText("menu.admin.users.departments.removeFromParent"));this.actionRemovePerson=this.createLocalizedAction(getText("common.lbl.remove",getText("admin.user.lbl.user")),this.getDeleteIconCls(),this.onRemovePerson,getText("common.lbl.remove",getText("admin.user.lbl.user")));this.actions=[this.actionAddDepartment,this.actionAddSubdepartment]},getTreeContextMenuActions:function(a,
b){if(a.isLeaf())return[this.actionRemovePerson];var c=[this.actionAddSubdepartment,this.actionEditDepartment,this.actionDeleteDepartment];null==a||null==a.parentNode||a.parentNode.isRoot()||c.push(this.actionDetachFromParentDepartment);return c},onTreeNodeDblClick:function(a,b){if(!b.isLeaf())this.onEditDepartment()},canDragDropNode:function(a,b,c){return!a.isAncestor(c)},getRootMessage:function(){return getText("menu.admin.users.departments.tt")},onAddMainDepartment:function(){return this.onAddDepartment(!1)},
onAddSubdepartment:function(){return this.onAddDepartment(!0)},onAddDepartment:function(a){var b=this.getTitle(this.getAddTitleKey(),{isLeaf:!1}),c=this.getEditParams();c.add=!0;var e=this.getEditParams();e.addAsSubdepartment=a;e.add=!0;return this.onAddEdit(b,c,e,a?this.selectedNodeID:this.rootID)},onEditDepartment:function(){var a=this.getTitle(this.getEditTitleKey(),{isLeaf:!1}),b=this.getEditParams(),c=this.getEditParams();return this.onAddEdit(a,b,c,this.getParentNodeId())},getEditParams:function(){var a=
this.getSingleSelectedRecordData(!0);return null!=a&&(a=a.id,null!=a)?{node:a}:{}},getTreeExpandExtraParams:function(){return{includePersons:!0}},getParentNodeId:function(){if(null!=this.selectedNode){var a=this.selectedNode.parentNode;if(null!=a)return{nodeIDToReload:a.data.id}}return{nodeIDToReload:this.rootID}},onAddEdit:function(a,b,c,e){b={loadUrl:this.baseAction+"!edit.action",loadUrlParams:b};c={submitUrl:this.baseAction+"!save.action",submitUrlParams:c,submitButtonText:getText("common.btn.save"),
refreshAfterSubmitHandler:com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit,refreshParametersBeforeSubmit:{nodeIDToReload:e},refreshParametersAfterSubmit:[{parameterName:"nodeIDToSelect",fieldNameFromResult:"node"},{parameterName:"reloadTree",fieldNameFromResult:"reloadTree"}]};e=this.getPanelItems();Ext.create("com.trackplus.util.WindowConfig",{title:a,width:this.editWidth,height:this.editHeight,load:b,submit:c,items:e}).showWindowByConfig(this)},getPanelItems:function(){return[CWHF.createTextField("common.lbl.name",
"name",{anchor:"100%",allowBlank:!1,labelWidth:80,maxLength:255,enforceMaxLength:!0})]},onRemovePerson:function(){this.reloadAssigned(this.baseAction+"!unassign.action",{})},reload:com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit,getReloadParamsAfterDelete:function(a,b,c){b={reloadTree:!0};null!=a&&null!=a&&(b.nodeIDToReload=a.parentNode.data.id,c=a.previousSibling,null!=c?b.nodeIDToSelect=c.data.id:(a=a.nextSibling,null!=a?b.nodeIDToSelect=a.data.id:b.resetDetail=!0));return b},onDeleteDepartment:function(){var a=
this.getSelectedRecords(!0);null!=a&&this.deleteHandler(a,{fromTree:!0})},onDetachFromParentDepartment:function(){var a=this.getLastSelected(!0);if(null!=a){var b=a.data.id;Ext.Ajax.request({url:this.baseAction+"!clearParent.action",params:{node:b},disableCaching:!0,scope:this,success:function(a){com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit.call(this,{nodeIDToSelect:b,reloadTree:!0})}})}},getDeleteUrl:function(a){return this.baseAction+"!delete.action"},getDeleteParams:function(a,
b){return this.getEditParams()},getReplacementItems:function(a,b,c){return[{xtype:"label",itemId:"replacementWarning"},CWHF.createSingleTreePicker("Replacement","replacementID",a.replacementTree,null,{allowBlank:!1,blankText:getText("common.err.replacementRequired",this.getEntityLabel(c)),labelWidth:200,margin:"5 0 0 0"})]},loadReplacementOptionData:function(a,b){a.updateData(b.replacementTree)},getGridFields:function(a){return[{name:"id",type:"int"},{name:"userName",type:"string"},{name:"name",type:"string"},
{name:"active",type:"boolean"},{name:"activeLabel",type:"string"},{name:"employeeId",type:"string"},{name:"department",type:"string"}]},getColumnModel:function(){return[{text:getText("admin.user.profile.lbl.userName"),flex:2,dataIndex:"userName",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("common.lbl.name"),flex:2,dataIndex:"name",sortable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.department"),flex:2,dataIndex:"department",sortable:!0,filterable:!0,
renderer:this.renderer},{text:getText("admin.user.profile.lbl.employeeId"),flex:1,dataIndex:"employeeId",sortable:!0,filterable:!0,renderer:this.renderer,hidden:!0},{text:getText("admin.user.manage.lbl.activ"),flex:1,dataIndex:"activeLabel",sortable:!0,filterable:!0,renderer:this.renderer,hidden:!0}]},renderer:function(a,b,c){c.data.active||(b.style="color:#909090");return a},hideGridHeaders:function(){return!1},enableColumnHide:function(){return!0},getGridFeatures:function(){return features=[{ftype:"filters",
encode:!1,local:!0,filters:[{type:"string",dataIndex:"userName"},{type:"string",dataIndex:"name"},{type:"string",dataIndex:"department"},{type:"string",dataIndex:"activeLabel"},{type:"string",dataIndex:"employeeId"}]}]},getDetailWidth:function(){return 800},getDetailHeight:function(){return 600},getMinWidth:function(){return 425}});
Ext.define("com.trackplus.admin.user.DashboardAssignment",{extend:"Ext.Base",baseAction:"dashboardAssignment",entityName:getText("menu.admin.users.cockpitDefault"),constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.myInit()},myInit:function(){this.initActions();this.initGrid()},createCenterPanel:function(){return this.grid},getGridFields:function(){return[{name:"id",type:"int"},{name:"name",type:"string"},{name:"description",type:"string"},{name:"owner",type:"string"}]},getGridColumns:function(){return[{header:getText("common.lbl.name"),
width:300,dataIndex:"name",id:"name",sortable:!0,filterable:!0},{header:getText("common.lbl.description"),flex:1,dataIndex:"description",id:"description",sortable:!0,filterable:!0},{header:getText("admin.customize.form.config.owner"),width:200,dataIndex:"owner",id:"owner",sortable:!0,filterable:!0}]},initGrid:function(){var a={xtype:"grid",region:"center",store:Ext.create("Ext.data.Store",{fields:this.getGridFields(),proxy:{type:"ajax",url:"dashboardAssign.action",reader:{type:"json"}},autoLoad:!0}),
selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"MULTI"}),columns:this.getGridColumns(),autoWidth:!0,border:!1,bodyBorder:!1,cls:"gridNoBorder",stripeRows:!0,features:[{ftype:"filters",encode:!1,local:!0,filters:[{type:"string",dataIndex:"name"},{type:"string",dataIndex:"description"},{type:"string",dataIndex:"owner"}]}]},b={selectionchange:{fn:this.onGridSelectionChange,scope:this}};b.itemcontextmenu={fn:this.onGridRowCtxMenu,scope:this};b.itemdblclick={fn:this.editDashboard,scope:this};
a.listeners=b;this.grid=Ext.create("Ext.grid.Panel",a)},onGridSelectionChange:function(a,b){this.enableDisableToolbarButtons(a,b)},enableDisableToolbarButtons:function(a,b){null==b||0==b.length?(this.actionEdit.setDisabled(!0),this.actionCopy.setDisabled(!0),this.actionDelete.setDisabled(!0),this.actionConfig.setDisabled(!0)):(this.actionEdit.setDisabled(!1),this.actionCopy.setDisabled(!1),this.actionDelete.setDisabled(!1),this.actionConfig.setDisabled(!1))},onGridRowCtxMenu:function(a,b,c,e,f){this.onCtxMenu(!1,
b,f);return!1},initActions:function(){this.actions=[];this.actionAdd=Ext.create("Ext.Action",{text:getText("common.btn.add"),overflowText:getText("common.btn.add"),iconCls:"add",scope:this,handler:this.addDashboard});this.actions.push(this.actionAdd);this.actionEdit=Ext.create("Ext.Action",{text:getText("common.btn.edit"),overflowText:getText("common.btn.edit"),iconCls:"edit",scope:this,handler:this.editDashboard});this.actions.push(this.actionEdit);this.actionDelete=Ext.create("Ext.Action",{text:getText("common.btn.delete"),
overflowText:getText("common.btn.delete"),iconCls:"delete",scope:this,handler:this.deleteItems});this.actions.push(this.actionDelete);this.actionCopy=Ext.create("Ext.Action",{text:getText("common.btn.copy"),overflowText:getText("common.btn.copy"),iconCls:"copy",scope:this,handler:this.copyDashboard});this.actions.push(this.actionCopy);this.actionConfig=Ext.create("Ext.Action",{text:getText("common.btn.config"),overflowText:getText("common.btn.config"),iconCls:"btnConfig",scope:this,handler:this.configDashboard});
this.actions.push(this.actionConfig)},getToolbarActions:function(){return this.actions},addDashboard:function(){var a=getText("common.lbl.add",this.entityName);return this.onAddEdit(a,!0,null,null)},editDashboard:function(){var a=getText("common.lbl.edit",this.entityName),b=this.getSelectedId();return null==b?null:this.onAddEdit(a,!1,{copy:!1,objectID:b},{objectID:b,copy:!1})},deleteItems:function(){var a=this,b=a.grid.getSelectionModel().getSelection(),c=getText("common.lbl.messageBox.title.notSelected"),
e=getText("common.lbl.messageBox.removeSelected.confirm"),f=getText("common.lbl.messageBox.removeSelected.notSelected"),g=getText("common.btn.delete"),h=getText("common.btn.ok");null==b||0==b.length?Ext.MessageBox.show({title:c,msg:f,buttons:{ok:h},icon:Ext.MessageBox.WARNING}):Ext.MessageBox.show({title:g,msg:e,buttons:Ext.MessageBox.YESNO,fn:function(b){if("yes"==b){b=a.grid.getSelectionModel().getSelection();var c="",e,f;for(f=0;f<b.length;f++)e=b[f].data,c=c+e.id+";";Ext.Ajax.request({url:"dashboardAssign!deleteCockpitTemplate.action",
disableCaching:!0,success:function(b){b=Ext.decode(b.responseText);b.success||Ext.MessageBox.show({title:getText("common.warning"),msg:b.errorMessage,width:200,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});a.refresh.call(a)},failure:function(){},method:"POST",params:{deletedItems:c}})}},icon:Ext.MessageBox.QUESTION})},copyDashboard:function(){var a=getText("common.lbl.copy",this.entityName),b=this.getSelectedId();return null==b?null:this.onAddEdit(a,!1,{copy:!0,objectID:b},{objectID:b,copy:!0},
null)},getSelectedId:function(){var a=this.grid.getSelectionModel().getSelection();return null!=a&&0<a.length?a[0].data.id:null},configDashboard:function(){var a=this.getSelectedId();if(null==a)return null;window.location.href="dashboardEdit.action?backAction\x3dadmin.action\x26componentID\x3d"+a},onAddEdit:function(a,b,c,e,f){b={loadUrl:"dashboardAssign!edit.action",loadUrlParams:c};e={submitUrl:"dashboardAssign!save.action",submitUrlParams:e,submitButtonText:getText("common.btn.save"),refreshAfterSubmitHandler:com.trackplus.util.RefreshAfterSubmit.refreshGridAfterSubmit,
refreshParametersAfterSubmit:f};f=this.getPanelItems();Ext.create("com.trackplus.util.WindowConfig",{title:a,width:500,height:300,load:b,submit:e,items:f}).showWindowByConfig(this)},refresh:function(){this.grid.getStore().load()},getPanelItems:function(){return[CWHF.createTextField("common.lbl.name","name",{anchor:"100%",allowBlank:!1,labelWidth:this.labelWidth,width:this.textFieldWidth}),CWHF.createTextAreaField("common.lbl.description","description",{anchor:"100%",labelWidth:this.labelWidth,width:this.textFieldWidth})]}});
Ext.define("com.trackplus.admin.customize.script.ScriptGridConfig",{extend:"com.trackplus.admin.GridConfig",urlStore:"script!loadScripts.action",autoLoadGrid:!1,fields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"scriptType",type:"int"},{name:"typeLabel",type:"string"}],columnModel:[{header:getText("admin.customize.script.lbl.className"),width:400,dataIndex:"name",id:"name",sortable:!0},{header:getText("admin.customize.script.lbl.scriptType"),width:150,dataIndex:"typeLabel",id:"scriptType",
sortable:!0}],confirmDeleteEntity:!0,confirmDeleteNotEmpty:!0,baseAction:"script",entityID:"scriptID",editWidth:800,editHeight:600,labelWidth:120,useCopy:!0,getEntityLabel:function(){return getText("admin.customize.script.lbl")},createEditForm:function(a,b){return new Ext.form.FormPanel({url:"script!save.action",border:!1,autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"10px"},items:[CWHF.createTextField("admin.customize.script.lbl.className","clazzName",{allowBlank:!1,labelWidth:this.labelWidth,
anchor:"100%"}),CWHF.createCombo("admin.customize.script.lbl.scriptType","scriptType",{width:300,allowBlank:!1,labelWidth:this.labelWidth},{select:{fn:this.scriptTypeChange,scope:this}}),CWHF.createTextAreaField("admin.customize.script.lbl.sourceCode","sourceCode",{labelWidth:this.labelWidth,anchor:"100% -60"})]})},afterLoadForm:function(a,b){var c=b.getComponent("scriptType");c.store.loadData(a.scriptTypeList);c.setValue(a.scriptType)},scriptTypeChange:function(a,b,c){a=a.getValue();b=this.win.getDockedItems('toolbar[dock\x3d"bottom"]');
null!=b&&b[0].getComponent(0).setDisabled(this.compileIsDisabled(a))},compileIsDisabled:function(a){return null!=a&&3==a?!0:!1},getAdditionalActions:function(a,b,c){c=!1;null!=a&&(c=this.compileIsDisabled(a.scriptType));return[{submitUrl:this.baseAction+"!compile.action",submitUrlParams:b,submitButtonText:getText("common.btn.compile"),disabled:c,closeAfterSubmit:!1,refreshAfterSubmitHandler:this.showCompileResult}]},showCompileResult:function(a,b){Ext.MessageBox.show({title:b.title,msg:b.message,
buttons:Ext.Msg.OK,icon:Ext.MessageBox.INFO})},getAddIconCls:function(){return"scriptAdd"},getEditIconCls:function(){return"scriptEdit"}});
Ext.define("com.trackplus.admin.server.SiteConfig",{extend:"Ext.Base",constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},SECURITY_CONNECTIONS_MODES:{NEVER:0,TLS_IF_AVAILABLE:1,TLS:2,SSL:3},mainForm:null,btnSave:null,jsonData:null,mainComponent:null,labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:700,createSaveButton:function(){var a=this;null==a.btnSave&&(a.btnSave=new Ext.button.Button({overflowText:getText("common.btn.save"),tooltip:getText("common.btn.save"),
text:getText("common.btn.save"),iconCls:"save",disabled:!0,handler:function(){a.save.call(a)}}));return a.btnSave},getControl:function(){return CWHF.getControl.apply(this.mainForm.getComponent(0),arguments)},getHelpWrapper:function(){return CWHF.getHelpWrapper.apply(this.mainForm.getComponent(0),arguments)},getWrappedControl:function(){return CWHF.getWrappedControl.apply(this.mainForm.getComponent(0),arguments)},createTabEmailOutgoing:function(){this.emailOutgoingController=Ext.create("com.trackplus.admin.server.EmailOutgoingController",
{labelWidth:this.labelWidth,textFieldWidth:this.textFieldWidth,textFieldWidthShort:this.textFieldWidthShort,alignR:this.alignR,FieldSetWidth:this.FieldSetWidth,siteCfgController:this});return this.emailOutgoingController.createView.call(this.emailOutgoingController)},changeFtsOn:function(){var a=this.getWrappedControl("tab.fullTextSearch","fsFullTextSearch","fullTextSearch.useLucene").getValue();this.getHelpWrapper("tab.fullTextSearch","fsFullTextSearch","fullTextSearch.reindexOnStartup").setDisabled(!a);
this.getHelpWrapper("tab.fullTextSearch","fsFullTextSearch","fullTextSearch.indexAttachments").setDisabled(!a);this.getHelpWrapper("tab.otherSiteConfig","fsDirectories","fullTextSearch.indexPath").setDisabled(!a);this.getHelpWrapper("tab.fullTextSearch","fsFullTextSearch","fullTextSearch.analyzer").setDisabled(!a)},createTabTextSearch:function(){var a=this;return new Ext.Panel({itemId:"tab.fullTextSearch",title:getText("admin.server.config.tabTextSearch"),layout:{type:"anchor"},items:[{xtype:"fieldset",
itemId:"fsFullTextSearch",width:a.FieldSetWidth,title:"",margin:"8 0 0 6",style:{paddingLeft:"13px",paddingTop:"18px"},collapsible:!1,defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.server.config.useLucene","fullTextSearch.useLucene",{},{change:function(){a.changeFtsOn.call(a)}}),CWHF.createCheckboxWithHelp("admin.server.config.reindexOnStartup","fullTextSearch.reindexOnStartup"),CWHF.createCheckboxWithHelp("admin.server.config.indexAttachments","fullTextSearch.indexAttachments"),
CWHF.createComboWithHelp("admin.server.config.analyzer","fullTextSearch.analyzer",{idType:"string"})]}]})},createTabLdap:function(){this.ldapController=Ext.create("com.trackplus.admin.server.LdapController",{labelWidth:this.labelWidth,textFieldWidth:this.textFieldWidth,textFieldWidthShort:this.textFieldWidthShort,alignR:this.alignR,FieldSetWidth:this.FieldSetWidth,siteCfgController:this});return this.ldapController.createView.call(this.ldapController)},createTabOther:function(){return new Ext.Panel({itemId:"tab.otherSiteConfig",
title:getText("admin.server.config.tabOther"),layout:{type:"anchor"},items:[{xtype:"fieldset",itemId:"fsDirectories",width:this.FieldSetWidth,title:getText("admin.server.config.tabOther.paths"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createTextFieldWithHelp("admin.server.config.attachmentRootDir","otherSiteConfig.attachmentRootDir"),CWHF.createTextFieldWithHelp("admin.server.config.backupDir","otherSiteConfig.backupDir"),CWHF.createTextFieldWithHelp("admin.server.config.indexPath",
"fullTextSearch.indexPath"),CWHF.createTextFieldWithHelp("admin.server.config.serverURL","otherSiteConfig.serverURL")]},{xtype:"fieldset",width:this.FieldSetWidth,title:getText("admin.server.config.tabOther.limits"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createNumberFieldWithHelp("admin.server.config.attachmentMaxSize","otherSiteConfig.maxAttachmentSize",2,0,9999,{hideTrigger:!0})]},{xtype:"fieldset",width:this.FieldSetWidth,title:getText("admin.server.config.tabOther.various"),
collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:this.getVariousSettings()}]})},getVariousSettings:function(){var a=[CWHF.createCheckboxWithHelp("admin.server.config.isSelfRegisterAllowed","otherSiteConfig.selfRegisterAllowed"),CWHF.createCheckboxWithHelp("admin.server.config.projectSpecificIDsOn","otherSiteConfig.projectSpecificIDsOn")];com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&com.trackplus.TrackplusConfig.appType!=APPTYPE_DESK&&(a.push(CWHF.createCheckboxWithHelp("admin.server.config.summaryItemsBehavior",
"otherSiteConfig.summaryItemsBehavior")),a.push(CWHF.createCheckboxWithHelp("admin.server.config.budgetActive","otherSiteConfig.budgetActive")),a.push(CWHF.createCheckboxWithHelp("admin.server.config.isDemoSite","otherSiteConfig.demoSite")));a.push(CWHF.createCheckboxWithHelp("admin.server.config.isVersionReminderOn","otherSiteConfig.versionReminder"));a.push(CWHF.createCheckboxWithHelp("admin.server.config.isWSOn","otherSiteConfig.webserviceEnabled"));a.push(CWHF.createCheckboxWithHelp("admin.server.config.isDatabaseBackupJobOn",
"otherSiteConfig.automatedDatabaseBackup"));return a},createMainComponent:function(){var a=[];a.push(this.createTabEmailOutgoing());a.push(this.createTabTextSearch());a.push(this.createTabLdap());a.push(this.createTabOther());this.tabPanel=Ext.create("Ext.tab.Panel",{plain:!0,border:!1,bodyBorder:!1,defaults:{border:!1,autoScroll:!0,bodyStyle:{border:"none",padding:"0px"}},items:a});return this.mainForm=a=Ext.create("Ext.form.Panel",{url:"saveAdminSiteConfig!save.action",margins:"3 0 0 0",border:!1,
baseCls:"x-plain",layout:"fit",items:[this.tabPanel]})},loadMyForm:function(){var a=this;borderLayout.setLoading(!0);a.mainForm.getForm().load({url:"editAdminSiteConfig!load.action",scope:this,success:function(b,c){borderLayout.setLoading(!1);try{a.btnSave.setDisabled(!1),null!=a.postDataProcess&&a.postDataProcess.call(this,c.result.data,a.formPanel,a.extraConfig)}catch(e){}},failure:function(a,c){borderLayout.setLoading(!1);Ext.MessageBox.alert(this.failureTitle,c.response.responseText)}})},postDataProcess:function(a,
b){this.emailOutgoingController.postDataProcess.call(this.emailOutgoingController,a);var c=this.getWrappedControl("tab.fullTextSearch","fsFullTextSearch","fullTextSearch.analyzer");c.store.loadData(a["fullTextSearch.analyzers"]);c.setValue(a["fullTextSearch.analyzer"]);this.changeFtsOn();this.ldapController.postDataProcess.call(this.ldapController,a)},clearErrorTabs:function(){for(var a=this.tabPanel.getTabBar(),b=0;b<a.items.length;b++)a.getComponent(b).removeCls("errorTab");null!=this.ldapController&&
this.ldapController.clearErrorTabs.call(this.ldapController)},save:function(){var a=this;a.clearErrorTabs();a.emailOutgoingController.beforeSave.call(a.emailOutgoingController);if(!a.isValidForm())return this.handleInvalidForm(),!1;borderLayout.setLoading(!0);a.mainForm.getForm().submit({scope:this,timeout:6E4,success:function(a,c){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("admin.server.config.successSave"))},failure:function(b,c){borderLayout.setLoading(!1);a.handleErrors(c.result.errors)}})},
handleErrors:function(a){var b=[];if(null!=a&&0<a.length){for(var c=0;c<a.length;c++){var e=a[c],f=e.controlPath,g=null;null!=f&&0<f.length&&(g=this.getControl.apply(this,f),f=f[0],Ext.Array.contains(b,f)||b.push(f));null!=g&&g.markInvalid(e.errorMessage)}this.markErrorTabs(b)}CWHF.showMsgError(getText("admin.server.config.errorSave"))},markErrorTabs:function(a){var b=[];if(0<a.length){for(var c=0;c<a.length;c++){var e=this.getControl(a[c]);null!=e&&b.push(e)}if(0<b.length)for(c=this.tabPanel.getActiveTab(),
Ext.Array.contains(b,c)||this.tabPanel.setActiveTab(b[0]),a=this.tabPanel.getTabBar(),c=0;c<b.length;c++)e=this.tabPanel.items.findIndex("itemId",b[c].getItemId()),a.getComponent(e).addCls("errorTab")}},testLdap:function(){this.emailOutgoingController.beforeSave.call(this.emailOutgoingController);this.test.call(this,"saveAdminSiteConfig!testLdap.action",this.ldapController.failureHandler,this.ldapController)},isValidForm:function(){return this.mainForm.getForm().isValid()},handleInvalidForm:function(){CWHF.showMsgError(getText("admin.server.config.errorSave"));
for(var a=this.mainForm.getForm().getFields().filterBy(function(a){return!a.validate()}),b=[],c=0;c<a.items.length;c++){var e=a.items[c].getItemId(),e="tab."+e.substring(0,e.indexOf("."));Ext.Array.contains(b,e)||b.push(e)}this.markErrorTabs(b)},test:function(a,b,c){var e=this;e.clearErrorTabs();if(!e.isValidForm())return this.handleInvalidForm(),!1;borderLayout.setLoading(!0);e.mainForm.getForm().submit({url:a,timeout:70,success:function(a,b){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("admin.server.config.mailReceivingTestSuccess"))},
failure:function(a,g){borderLayout.setLoading(!1);null!=g.result&&null!=g.result.errors?e.handleErrors(g.result.errors):CWHF.showMsgError(getText("admin.server.config.mailReceivingTestFailure"));null!=b&&b.call(null==c?e:c,a,g)}})}});
Ext.define("com.trackplus.admin.server.EmailOutgoingController",{extend:"Ext.Base",portSMTP:25,portSMTP_SSL:465,SECURITY_CONNECTIONS_MODES:{NEVER:0,TLS_IF_AVAILABLE:1,TLS:2,SSL:3},SMTP_AUTHENTICATION_MODES:{CONNECT_USING_SMTP_SETTINGS:1,CONNECT_WITH_SAME_SETTINGS_AS_INCOMING_MAIL_SERVER:2,CONNECT_TO_INCOMING_MAIL_SERVER_BEFORE_SENDING:3},config:{labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:600,siteCfgController:null},constructor:function(a){this.initialConfig=
a=a||{};Ext.apply(this,a)},view:null,createView:function(){return this.view=Ext.create("com.trackplus.admin.server.EmailOutgoingView",{labelWidth:this.labelWidth,textFieldWidth:this.textFieldWidth,textFieldWidthShort:this.textFieldWidthShort,alignR:this.alignR,FieldSetWidth:this.FieldSetWidth,controller:this})},postDataProcess:function(a){var b=!a["outgoingEmail.reqAuth"]||1!=a["outgoingEmail.authMode"];CWHF.getControl.call(this.view,"fsSmtpAuth","outgoingEmail.user").setDisabled(b);CWHF.getControl.call(this.view,
"fsSmtpAuth","passwPanel","outgoingEmail.password").setDisabled(b);b=CWHF.getRadioButtonItems(a["outgoingEmail.securityConnectionsModes"],"outgoingEmail.securityConnection","id","label",a["outgoingEmail.securityConnection"],!1,!0);CWHF.getWrappedControl.call(this.view,"fsSmtpServer","outgoingEmail.securityConnection").add(b);b=CWHF.getRadioButtonItems(a["outgoingEmail.authenticationModes"],"outgoingEmail.authMode","id","label",a["outgoingEmail.authMode"],!a["outgoingEmail.reqAuth"],!0);CWHF.getWrappedControl.call(this.view,
"fsSmtpAuth","outgoingEmail.authMode").add(b);b=CWHF.getRadioButtonItems(a["outgoingEmail.sendFromModes"],"outgoingEmail.sendFromMode","id","label",a["outgoingEmail.sendFromMode"],!1,!0);CWHF.getWrappedControl.call(this.view,"fsSmtpMore","outgoingEmail.sendFromMode").add(b);CWHF.getWrappedControl.call(this.view,"fsSmtpMore","outgoingEmail.mailEncoding").setValue(a["outgoingEmail.mailEncoding"])},changeSecurityMode:function(a,b,c,e){a=CWHF.getSelectedRadioButtonValue(CWHF.getWrappedControl.call(this.view,
"fsSmtpServer","outgoingEmail.securityConnection"))==this.SECURITY_CONNECTIONS_MODES.SSL?this.portSMTP_SSL:this.portSMTP;CWHF.getWrappedControl.call(this.view,"fsSmtpMore","outgoingEmail.port").setValue(a)},changeRequireAuthentication:function(){var a=CWHF.getWrappedControl.call(this.view,"fsSmtpAuth","outgoingEmail.reqAuth").getValue(),b=CWHF.getHelpWrapper.call(this.view,"fsSmtpAuth","outgoingEmail.authMode");b.setDisabled(!a);for(var b=b.getInputComponent(),c=0;3>c;c++){var e=b.getComponent(c);
null!=e&&e.setDisabled(!a)}CWHF.getControl.call(this.view,"fsSmtpAuth","passwPanel","ClearBtn").setDisabled(!a);a?this.changeAuthenticationMode():(CWHF.getControl.call(this.view,"fsSmtpAuth","outgoingEmail.user").setDisabled(!0),CWHF.getControl.call(this.view,"fsSmtpAuth","passwPanel","outgoingEmail.password").setDisabled(!0))},changeAuthenticationMode:function(a,b,c,e){a=CWHF.getWrappedControl.call(this.view,"fsSmtpAuth","outgoingEmail.authMode");a=1==CWHF.getSelectedRadioButtonValue(a);CWHF.getControl.call(this.view,
"fsSmtpAuth","outgoingEmail.user").setDisabled(!a);CWHF.getControl.call(this.view,"fsSmtpAuth","passwPanel","outgoingEmail.password").setDisabled(!a)},clearSMTPPassword:function(){borderLayout.setLoading(!0);Ext.Ajax.request({url:"editAdminSiteConfig!clearSMTPPassword.action",success:function(a){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("admin.server.config.smtpPasswordCleared"))},failure:function(a){borderLayout.setLoading(!1);CWHF.showMsgError(getText("admin.server.config.err.smtpPasswordClearFailed"))}})},
beforeSave:function(){this.view.checkEmailTest.setValue(!1)},changeEmailTest:function(){var a=this.view.checkEmailTest.getValue();this.view.txtEmailTestTo.setDisabled(!a);var b=a&&this.view.txtEmailTestTo.isValid();Ext.apply(this.view.btnEmailTest,{formBind:a},{});this.view.btnEmailTest.setDisabled(!b);a&&this.view.txtEmailTestTo.focus(!1,100)},testOutgoingEmail:function(){borderLayout.setLoading(!0);null!=this.siteCfgController&&this.siteCfgController.test.call(this.siteCfgController,"saveAdminSiteConfig!testOutgoingEmail.action")},
onTxtEmailTestInputKeyPressed:function(a,b){b.getKey()==b.ENTER&&this.view.txtEmailTestTo.isValid()&&this.testOutgoingEmail()}});
Ext.define("com.trackplus.admin.server.EmailOutgoingView",{extend:"Ext.form.Panel",config:{labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:600,controller:null},itemId:"tab.outgoingEmail",title:getText("admin.server.config.tabEmailOut"),checkEmailTest:null,txtEmailTestTo:null,layout:{type:"anchor"},initComponent:function(){this.items=this.createChildren();this.callParent()},createChildren:function(){var a=this,b=CWHF.createTextField("admin.server.config.smtpPassWord",
"outgoingEmail.password",{inputType:"password"}),c={xtype:"button",style:{marginBottom:"5px",marginLeft:"5px"},enableToggle:!1,itemId:"ClearBtn",text:getText("common.btn.clear"),handler:function(){a.controller.clearSMTPPassword.call(a.controller)}},b={xtype:"panel",itemId:"passwPanel",border:!1,bodyBorder:!1,layout:"hbox",items:[b,c]};return[{xtype:"fieldset",itemId:"fsTrackEmail",width:a.FieldSetWidth,title:getText("admin.server.config.smtpUser"),collapsible:!1,defaults:{anchor:"100%"},layout:"anchor",
items:[CWHF.createTextFieldWithHelp("admin.server.config.trackEmailPersonalName","outgoingEmail.emailPersonalName"),CWHF.createTextFieldWithHelp("admin.server.config.trackEmail","outgoingEmail.trackEmail",{allowBlank:!1,vtype:"email"})]},{xtype:"fieldset",itemId:"fsSmtpServer",width:a.FieldSetWidth,title:getText("admin.server.config.smtpServer"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createTextFieldWithHelp("admin.server.config.smtpServerName",
"outgoingEmail.serverName"),CWHF.getRadioGroupWithHelp("outgoingEmail.securityConnection","admin.server.config.smtpSecurityConnection",a.textFieldWidth,null,null,{change:function(b,c,g,h){a.controller.changeSecurityMode.call(a.controller,b,c,g,h)}})]},{xtype:"fieldset",itemId:"fsSmtpAuth",width:a.FieldSetWidth,title:getText("admin.server.config.smtpAuthentication"),collapsible:!1,defaultType:"textfield",layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.server.config.smtpReqAuth","outgoingEmail.reqAuth",
{height:40},{change:function(){a.controller.changeRequireAuthentication.call(a.controller)}}),CWHF.getRadioGroupWithHelp("outgoingEmail.authMode","admin.server.config.smtpAuthMode",a.textFieldWidth,null,{layout:"vbox"},{change:function(b,c,g,h){a.controller.changeAuthenticationMode.call(a.controller,b,c,g,h)}}),CWHF.createTextField("admin.server.config.smtpUser","outgoingEmail.user"),b]},{xtype:"fieldset",itemId:"fsSmtpMore",width:a.FieldSetWidth,title:getText("admin.server.config.smtpMoreOptions"),
collapsible:!0,collapsed:!0,defaultType:"textfield",layout:"anchor",items:[CWHF.getRadioGroupWithHelp("outgoingEmail.sendFromMode","admin.server.config.sendFromMode",a.textFieldWidth,null,{layout:"vbox"}),CWHF.createComboWithHelp("admin.server.config.mailEncoding","outgoingEmail.mailEncoding",{data:[{id:"UTF-8",label:"Unicode UTF-8"},{id:"ISO-8859-1",label:"Western (ISO-8859-1)"},{id:"ISO-8859-2",label:"Central Europe (ISO-8859-2)"},{id:"ISO-8859-3",label:"Southern Europe (ISO-8859-3)"},{id:"ISO-8859-4",
label:"Northern Europe (ISO-8859-4)"},{id:"ISO-8859-6",label:"Arabic (ISO-8859-6)"},{id:"ISO-8859-7",label:"Greek (ISO-8859-7)"},{id:"ISO-8859-8",label:"Hebrew (ISO-8859-8)"},{id:"ISO-8859-9",label:"Turkish (ISO-8859-9)"},{id:"ISO-8859-10",label:"Nordic (ISO-8859-10)"},{id:"ISO-8859-11",label:"Thai (ISO-8859-11)"},{id:"ISO-8859-13",label:"Baltic (ISO-8859-13)"},{id:"ISO-8859-14",label:"Celtic (ISO-8859-14)"},{id:"ISO-8859-16",label:"S.E. Europe (ISO-8859-16)"},{id:"KOI8-R",label:"Russian (KOI8-R)"},
{id:"KOI8-U",label:"Ukraine (KOI8-U)"},{id:"Shift-JIS",label:"Japanese (Shift-JIS)"},{id:"ISO-2022-JP",label:"Japanese (ISO-2022-JP)"},{id:"GB18030",label:"Chinese (simplified)"},{id:"Big5",label:"Chinese (traditional)"},{id:"UTF-16",label:"Unicode UTF-16"}],idType:"string"}),CWHF.createNumberFieldWithHelp("admin.server.config.smtpPort","outgoingEmail.port",0,1,9999,{width:a.textFieldWidth,hideTrigger:!0})]},a.createTestPanel()]},createTestPanel:function(){var a=this;a.checkEmailTest=CWHF.createCheckbox("admin.server.config.trackEmailTest",
"outgoingEmail.emailTest",null,{change:function(){a.controller.changeEmailTest.call(a.controller)}});a.txtEmailTestTo=CWHF.createTextField("admin.server.config.trackEmailTestTo","emailTestTo",{disabled:!0,allowBlank:!1,vtype:"email"});a.txtEmailTestTo.addListener("specialkey",a.controller.onTxtEmailTestInputKeyPressed,a.controller);a.btnEmailTest=Ext.create("Ext.button.Button",{style:{marginTop:"10px",marginBottom:"5px",marginLeft:a.labelWidth+5+"px"},disabled:!0,iconCls:"check16",text:getText("admin.server.config.trackEmailTestButton"),
handler:function(){a.controller.testOutgoingEmail.call(a.controller)}});return{xtype:"fieldset",itemId:"fsSmtpTest",title:"",margin:"8 0 0 6",style:{paddingLeft:"13px",paddingTop:"18px"},width:a.FieldSetWidth,layout:"anchor",items:[a.checkEmailTest,a.txtEmailTestTo,a.btnEmailTest]}}});
Ext.define("com.trackplus.admin.server.LdapController",{extend:"Ext.Base",config:{labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:600,siteCfgController:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},view:null,createView:function(){return this.view=Ext.create("com.trackplus.admin.server.LdapView",{labelWidth:this.labelWidth,textFieldWidth:this.textFieldWidth,textFieldWidthShort:this.textFieldWidthShort,alignR:this.alignR,FieldSetWidth:this.FieldSetWidth,
controller:this})},postDataProcess:function(a){this.changeLDAPon()},changeLDAPon:function(){var a=CWHF.getWrappedControl.call(this.view,"fsLdap","ldap.enabled").getValue();CWHF.getHelpWrapper.call(this.view,"fsLdap","ldap.serverURL").setDisabled(!a);CWHF.getHelpWrapper.call(this.view,"fsLdap","ldap.attributeLoginName").setDisabled(!a);CWHF.getHelpWrapper.call(this.view,"fsLdap","ldap.bindDN").setDisabled(!a);CWHF.getControl.call(this.view,"fsLdap","ldap.password").setDisabled(!a);CWHF.getHelpWrapper.call(this.view,
"fsLdap","ldap.force").setDisabled(!a);var b=CWHF.getControl.call(this.view,"fsLdapTest","ldap.testConnection"),c=CWHF.getControl.call(this.view,"fsLdapTest","ldap.loginNameTest"),e=CWHF.getControl.call(this.view,"fsLdapTest","ldap.passwordTest");b.setDisabled(!a);c.setDisabled(!a);e.setDisabled(!a)},testLdap:function(){null!=this.siteCfgController&&this.siteCfgController.testLdap.call(this.siteCfgController)},clearErrorTabs:function(){this.view.errorBox.setVisible(!1)},failureHandler:function(a,
b){if(null!=b.result&&null!=b.result.errors)for(var c=0;c<b.result.errors.length;c++)if(null==b.result.errors[c].controlPath||0==b.result.errors[c].controlPath.length){this.view.errorBox.update(b.result.errors[c].errorMessage);this.view.errorBox.setVisible(!0);break}}});
Ext.define("com.trackplus.admin.server.LdapView",{extend:"Ext.form.Panel",config:{labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:600,controller:null},itemId:"tab.ldap",title:getText("admin.server.config.tabLDAP"),checkEmailTest:null,txtEmailTestTo:null,layout:{type:"anchor"},initComponent:function(){this.items=this.createChildren();this.callParent()},createChildren:function(){var a=this,b={xtype:"button",style:{marginTop:"10px",marginBottom:"5px",marginLeft:a.labelWidth+
5+"px"},iconCls:"check16",itemId:"ldap.testConnection",text:getText("admin.server.config.ldapTest"),handler:function(){a.controller.testLdap.call(a.controller)}},c=CWHF.createTextField("admin.server.config.ldapLoginNameTest","ldap.loginNameTest",{disabled:!0}),e=CWHF.createTextField("admin.server.config.ldapPasswordTest","ldap.passwordTest",{inputType:"password"});a.errorBox=Ext.create("Ext.Component",{html:"",margin:"5 5 5 5",border:!0,anchor:"100%",hidden:!0,cls:"errBox2"});b={xtype:"fieldset",
itemId:"fsLdapTest",title:"",margin:"8 0 0 6",style:{paddingLeft:"13px",paddingTop:"18px"},width:a.FieldSetWidth,layout:"anchor",items:[c,e,b,a.errorBox]};return[{xtype:"fieldset",itemId:"fsLdap",width:a.FieldSetWidth,title:"",margin:"8 0 0 6",style:{paddingLeft:"13px",paddingTop:"18px"},collapsible:!1,layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.server.config.isCbaAllowed","otherSiteConfig.cbaAllowed"),CWHF.createCheckboxWithHelp("admin.server.config.automaticGuestLogin","otherSiteConfig.automaticGuestLogin"),
CWHF.createCheckboxWithHelp("admin.server.config.isLDAPOn","ldap.enabled",{},{change:function(){a.controller.changeLDAPon.call(a.controller)}}),CWHF.createTextFieldWithHelp("admin.server.config.ldapServerURL","ldap.serverURL"),CWHF.createTextFieldWithHelp("admin.server.config.ldapLoginName","ldap.attributeLoginName"),CWHF.createTextFieldWithHelp("admin.server.config.ldapBindDn","ldap.bindDN"),CWHF.createTextField("admin.server.config.ldapBindPass","ldap.password",{inputType:"password"}),CWHF.createCheckboxWithHelp("admin.server.config.isForceLdap",
"ldap.force")]},b]}});
Ext.define("com.trackplus.admin.server.ServerStatus",{extend:"Ext.Base",constructor:function(a){},btnSave:null,formPanel:null,jsonData:null,labelWidth:290,alignR:"right",createToolbar:function(){var a=this;null==a.btnSave&&(a.btnSave=new Ext.Button({overflowText:getText("common.btn.save"),tooltip:getText("common.btn.save"),text:getText("common.btn.save"),iconCls:"save",disabled:!0,handler:function(){a.save.call(a)}}));return[a.btnSave]},reloadAndReplaceComp:function(){var a=this;borderLayout.setLoading(!0);
Ext.Ajax.request({url:"editAdminSiteStatus!load.action",success:function(b){b=Ext.decode(b.responseText);borderLayout.setLoading(!1);!0==b.success?(b=a.createComp.call(a,b.data),borderLayout.setCenterContent(b),a.btnSave.setDisabled(!1)):alert("failed:"+b.errorMessage)},failure:function(a){borderLayout.setLoading(!1)}})},createCountActiveInactiveLabel:function(a){return CWHF.createLabelComponent(a.label,null,{labelIsLocalized:!0,labelWidth:this.labelWidth,value:a.total+" ("+a.active+"/"+a.inactive+
")"})},createLabelComponent:function(a,b){var c="";null!=a&&""!=a&&(c=getText(a));return{xtype:"displayfield",fieldLabel:c,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,value:b,htmlEncode:!1,fieldStyle:{height:"auto"},anchor:"100%"}},createLabelPercentComponent:function(a,b,c){var e="";null!=a&&""!=a&&(e=getText(a));null==c&&(c=0);a=80*c/100;return{xtype:"container",layout:{type:"hbox"},id:"MYIMAGE",items:[{xtype:"displayfield",fieldLabel:e,labelStyle:{overflow:"hidden"},
labelWidth:this.labelWidth,labelAlign:this.alignR,value:b,width:this.labelWidth+100,htmlEncode:!1},{xtype:"component",cls:"barWrapper",style:{right:"40px",marginLeft:"10px",marginTop:"7px"},html:'\x3cimg width\x3d"'+a+'" height\x3d"10" alt\x3d"RedBar" src\x3d"'+com.trackplus.TrackplusConfig.iconsPath+'RedBar.gif"/\x3e\x3cimg width\x3d"'+(80-a)+'" height\x3d"10" alt\x3d"GreenBar" src\x3d"'+com.trackplus.TrackplusConfig.iconsPath+'GreenBar.gif"/\x3e'}]}},createComp:function(a){var b=this;b.jsonData=
a;for(var c=a.serverIPAddress,e=c.indexOf(",");-1!=e;)c=c.replace(",","\x3cbr\x3e"),e=c.indexOf(",");var c=Ext.create("Ext.form.FieldSet",{title:getText("admin.server.status.generalInfo"),layout:{type:"anchor"},items:[b.createLabelComponent("common.version",a.version),b.createLabelComponent("admin.server.status.ipNumber",c)],margin:"0 0 5 0"}),e=Ext.create("Ext.data.Store",{data:a.usersLoggedIn,fields:[{name:"value",type:"string"},{name:"label",type:"string"}],autoLoad:!0}),e=Ext.create("Ext.ux.form.MultiSelect",
{fieldLabel:" ",labelSeparator:"",hideLabel:!1,labelWidth:b.labelWidth,labelAlign:b.alignR,width:b.labelWidth+230,height:140,margin:"0 5 5 0",store:e,displayField:"label",valueField:"value",value:""}),f=Ext.create("Ext.data.Store",{data:a.clusterNodes,fields:[{name:"value",type:"string"},{name:"label",type:"string"}],autoLoad:!0}),f=Ext.create("Ext.ux.form.MultiSelect",{fieldLabel:getText("admin.server.status.nodes"),labelWidth:b.labelWidth,labelAlign:b.alignR,width:b.labelWidth+230,height:50,margin:"0 5 5 0",
store:f,displayField:"label",valueField:"value",value:""}),g=[b.createLabelComponent("admin.server.status.numberOfProjects",a.numberOfProjects),b.createLabelComponent("admin.server.status.numberOfIssues",a.numberOfIssues)],h=a.userCountList;null!=h&&Ext.Array.forEach(h,function(a){g.push(b.createCountActiveInactiveLabel(a))},this);g.push(e);g.push(f);var e=Ext.create("Ext.form.FieldSet",{title:getText("admin.server.status.statistics"),layout:{type:"anchor"},items:g,margin:"0 0 5 0"}),f=Ext.create("Ext.form.FieldSet",
{title:getText("admin.server.status.jvmmem"),layout:{type:"anchor"},anchor:"50%",items:[b.createLabelComponent("admin.server.status.maxMemory",a.javaVMmaxMemory+" Mbyte"),b.createLabelComponent("admin.server.status.totalMemory",a.javaVMtotalMemory+" Mbyte"),b.createLabelPercentComponent("admin.server.status.usedMemory",a.javaVMusedMemory+" Mbyte",100*a.javaVMusedMemory/a.javaVMtotalMemory),b.createLabelComponent("admin.server.status.freeMemory",a.javaVMfreeMemory+" Mbyte")],margin:"0 0 5 0"}),h=Ext.create("Ext.form.FieldSet",
{frame:!0,title:getText("admin.server.status.javaInfo"),layout:{type:"anchor"},items:[b.createLabelComponent("admin.server.status.javaVersion",a.javaVersion),b.createLabelComponent("admin.server.status.javaVendor",a.javaVendor),b.createLabelComponent("admin.server.status.javaHome",a.javaHome),b.createLabelComponent("admin.server.status.javaVmVersion",a.javaVMVersion),b.createLabelComponent("admin.server.status.javaVmVendor",a.javaVMVendor),b.createLabelComponent("admin.server.status.javaVmName",a.javaVMName)],
margin:"0 0 5 0"}),k=Ext.create("Ext.form.FieldSet",{frame:!0,title:getText("admin.server.status.sysinfo"),layout:{type:"anchor"},items:[b.createLabelComponent("admin.server.status.osName",a.operatingSystem),b.createLabelComponent("admin.server.status.userName",a.userName),b.createLabelComponent("admin.server.status.userDir",a.currentUserDir),b.createLabelComponent("admin.server.status.systemLocale",a.systemLocale),b.createLabelComponent("admin.server.status.userTz",a.userTimezone),b.createLabelComponent("admin.server.status.jasperVersion",
a.jasperVersion)],margin:"0 0 5 0"}),l={xtype:"radiogroup",fieldLabel:getText("admin.server.status.opstate"),labelStyle:{overflow:"hidden"},labelWidth:b.labelWidth,labelAlign:b.alignR,anchor:"100%",layout:"hbox",defaults:{margin:"0 5 0 0"},items:[{name:"opState",inputValue:"Running",boxLabel:getText("admin.server.status.opstate.running"),checked:null==a.operationalStatus||"Running"==a.operationalStatus},{name:"opState",inputValue:"Maintenance",boxLabel:getText("admin.server.status.opstate.maintenance"),
checked:"Maintenance"==a.operationalStatus}]},m={xtype:"checkboxfield",fieldLabel:getText("admin.server.status.userMsg"),labelWidth:b.labelWidth,labelAlign:b.alignR,inputValue:"true",name:"hasUserMsg",checked:!0==a.isUserInfo},n={xtype:"textarea",fieldLabel:" ",labelSeparator:"",labelWidth:b.labelWidth,labelAlign:b.alignR,name:"userMsg",width:b.labelWidth+200,value:a.userInfo,height:120},l=Ext.create("Ext.form.FieldSet",{title:getText("admin.server.status.opstateInfo"),layout:{type:"anchor"},items:[l,
m,n],margin:"0 0 5 0"}),m=Ext.create("Ext.form.FieldSet",{title:getText("admin.server.status.dbInfo"),layout:{type:"anchor"},items:[b.createLabelComponent("admin.server.status.dbInfo",a.database),b.createLabelComponent("admin.server.status.jdbcDriverInfo",a.jdbcDriver),b.createLabelComponent("admin.server.status.jdbcUrl",a.jdbcUrl),b.createLabelComponent("admin.server.status.pingTime",a.pingTime)],margin:"0 0 5 0"});b.formPanel=Ext.create("Ext.form.Panel",{title:getText("admin.server.status.status"),
url:"editAdminSiteStatus!save.action",border:!1,bodyBorder:!1,autoScroll:!0,margins:"0 0 0 0",width:"100%",layout:{type:"table",columns:2,tableAttrs:{style:{width:"100%"}},tdAttrs:{width:"50%",style:{"vertical-align":"top"}}},defaults:{frame:!1,border:!1},items:[{margin:"5 5 5 5",items:[c,e,m]},{margin:"5 5 5 5",items:[f,h,k,l]}]});a=a.logMessages;c="";if(null!=a&&0<a.length)for(i=0;i<a.length;++i)pre='\x3cdiv class\x3d"logMessage"\x3e',post="\x3c/div\x3e",-1!=a[i].indexOf(" ERROR ")&&(pre='\x3cdiv class\x3d"logMessageError"\x3e'),
-1!=a[i].indexOf(" WARN ")&&(pre='\x3cdiv class\x3d"logMessageWarn"\x3e'),c=c+pre+a[i]+post;a=Ext.create("Ext.form.Panel",{title:getText("admin.server.status.logMessages"),layout:{type:"anchor"},html:c,bodyPadding:10});b.tabPanel=new Ext.TabPanel({plain:!0,border:!1,bodyBorder:!1,padding:"3 0 0 0",defaults:{border:!1,autoScroll:!0,bodyStyle:{border:"none",padding:"0px"}},items:[b.formPanel,a],activeTab:0});return b.tabPanel},save:function(){var a=this;a.formPanel.setLoading(!0);a.formPanel.getForm().submit({success:function(b,
c){a.formPanel.setLoading(!1)},failure:function(b,c){a.formPanel.setLoading(!1);alert(c.result.errorMessage)}})}});
Ext.define("com.trackplus.admin.server.LoggingConfig",{extend:"Ext.Base",constructor:function(a){},grid:null,storeLevel:null,cmbLevel:null,filter:null,jsonData:null,levelsMap:null,createMainComponent:function(){var a=this,b=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[{name:"className",type:"string"},{name:"level",type:"string"},{name:"value",type:"int"}],groupField:"level",data:[]});a.storeLevel=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[{name:"id",type:"int"},{name:"label",type:"string"}],
data:[]});a.cmbValue=Ext.create("Ext.form.ComboBox",{store:a.storeLevel,name:name,queryMode:"local",displayField:"label",valueField:"id",editable:!1});var c=Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1}),e=Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} {[values.rows.length \x3e 1 ? getText("admin.server.logging.items") : getText("admin.server.logging.item")]})',startCollapsed:!1});Ext.create("Ext.form.field.Text",{name:"filterBox",fieldLabel:getText("admin.server.logging.filter"),
width:515});var f=Ext.create("Ext.form.field.Text",{fieldLabel:getText("admin.server.logging.filter"),width:300,labelWidth:80,labelAlign:"right",enableKeyEvents:!0,listeners:{keyup:{element:"el",fn:function(){var b=!1;3<f.getRawValue().length&&(b=!0);f.getRawValue().length<a.filter.length&&(b=!0);3>=f.getRawValue().length?a.filter="":a.filter=f.getRawValue();b&&a.reload.call(a)}}}}),g=Ext.create("Ext.panel.Panel",{bodyPadding:5,margin:"0 0 0 0",border:!1,bodyBorder:!1,width:"100%",region:"north",
id:"topLogPanel",layout:"hbox",items:[f,{xtype:"button",style:{marginBottom:"5px",marginLeft:"5px"},enableToggle:!1,id:"ClearBtn",text:com.trackplus.TrackplusConfig.getText("common.btn.clear"),handler:function(){f.setRawValue("");a.filter=f.getRawValue();a.reload.call(a)}}]});a.filter="aurel";a.grid=Ext.create("Ext.grid.Panel",{store:b,id:"logGrid",region:"center",style:{borderTop:"1px solid #D0D0D0"},bodyBorder:!1,cls:"gridNoBorder",columns:[{text:getText("admin.server.logging.className"),width:400,
dataIndex:"className",sortable:!0,hideable:!1,groupable:!1},{text:getText("admin.server.logging.level"),width:100,dataIndex:"value",sortable:!0,hideable:!1,editor:a.cmbValue,renderer:function(b){return null!=a.levelsMap?a.levelsMap[""+b]:b}}],margin:"0 0 0 0",border:!1,scroll:!1,viewConfig:{style:{overflow:"auto",overflowX:"hidden"}},region:"center",width:"100%",autoheight:!0,plugins:[c],features:[e]});a.grid.on("edit",function(b,c){c.record.commit();var e=c.record.data.className,f=c.value;f!=c.originalValue&&
a.changeLevel.call(a,e,f)});return Ext.create("Ext.panel.Panel",{bodyPadding:0,id:"mainPanel",margin:"0 0 0 0",border:!1,width:"100%",layout:"border",items:[g,a.grid]})},changeLevel:function(a,b){var c=this;c.grid.setLoading(!0);Ext.Ajax.request({url:"editAdminLoggingConfig!save.action",params:{className:a,level:b},disableCaching:!0,scope:c,success:function(a){c.grid.setLoading(!1);!1==Ext.decode(a.responseText).success&&Ext.MessageBox.alert(getText("common.err.failure"),a.responseText)},failure:function(a){c.grid.setLoading(!1);
Ext.MessageBox.alert(getText("common.err.failure"),a.responseText)},method:"POST"})},reload:function(){var a=this;Ext.Ajax.request({url:"editAdminLoggingConfig!load.action",params:{filter:a.filter},disableCaching:!0,scope:a,success:function(b){b=Ext.decode(b.responseText);if(!0==b.success){a.jsonData=b.data;a.levelsMap={};for(var c=b.data.levels,e=0;e<c.length;e++)a.levelsMap[""+c[e].id]=c[e].label;a.grid.store.loadData(b.data.loggers);a.storeLevel.loadData(b.data.levels)}},failure:function(a){Ext.MessageBox.alert(getText("common.err.failure"),
a.responseText)},method:"POST"})}});
Ext.define("com.trackplus.admin.server.LogonPageText",{extend:"Ext.Base",constructor:function(a){},btnSave:null,panelForm:null,cmbLocale:null,createSaveButton:function(){var a=this;null==a.btnSave&&(a.btnSave=new Ext.Button({text:getText("common.btn.save"),tooltip:getText("common.btn.save"),iconCls:"save",disabled:!1,handler:function(){a.save.call(a)}}));return a.btnSave},save:function(){var a=this;a.panelForm.setLoading(!0);a.panelForm.getForm().submit({method:"POST",scope:a,success:function(b,c){a.panelForm.setLoading(!1)},
failure:function(b,c){a.panelForm.setLoading(!1);Ext.Msg.alert("Failure",c.result.errorMessage)}})},createMainComponent:function(){var a=this;a.cmbLocale=CWHF.createCombo("admin.server.motd.locale","theLocale",{idType:"string",labelWidth:120,allowBlank:!1},{select:function(b,c){var g=b.getValue();a.reload(g)}});var b=CWHF.createTextField("admin.server.motd.teaserText","teaserText",{anchor:"100%",labelWidth:120}),c=CWHF.createHtmlEditorField("admin.server.motd.message","theMessage",{padding:"20 0 0 0",
anchor:"100% 80%",labelWidth:120});a.panelForm=new Ext.form.FormPanel({url:"logonPageText!save.action",fieldDefaults:{},region:"center",border:!1,autoScroll:!0,bodyStyle:"padding:10px",defaultType:"textfield",items:[a.cmbLocale,b,c]});return a.panelForm},reload:function(a){var b=this;b.panelForm.setLoading(!0);b.panelForm.getForm().load({url:"logonPageText.action",params:{theLocale:a},success:function(a,e){try{b.afterLoadForm.call(b,e.result.data),b.panelForm.setLoading(!1)}catch(f){}}})},afterLoadForm:function(a){this.cmbLocale.store.loadData(a.localeList,
!1);this.cmbLocale.setValue(a.theLocale)}});
Ext.define("com.trackplus.admin.server.SendEmail",{extend:"Ext.Base",constructor:function(a){},ERROR_NEED_PERSON:3,ERROR_NEED_SUBJECT:6,ERROR_NEED_BODY:7,ERROR_EMAIL_NOT_SEND:4,ERROR_NEED_MORE_TIME:5,instance:null,btnCC:null,btnBCC:null,btnSend:null,win:null,formPanel:null,txtSubject:null,txtBody:null,txtTo:null,txtCC:null,txtBCC:null,visibleCC:!1,visibleBCC:!1,containerCC:null,containerBCC:null,getToolbar:function(){null==this.btnSend&&this.initButtons();return[this.btnCC,this.btnBCC,this.btnSend]},
initButtons:function(){var a=this;a.btnCC=a.createToolbarBtn(getText("item.action.sendItemEmail.lbl.cc"),a.showHideCC,"user16",!0);a.btnBCC=a.createToolbarBtn(getText("item.action.sendItemEmail.lbl.bcc"),a.showHideBCC,"user16",!0);a.btnSend=new Ext.Button({text:getText("item.action.sendItemEmail.lbl.send"),tooltip:getText("item.action.sendItemEmail.lbl.send"),iconCls:"buttonEmailSend",disabled:!1,handler:function(){a.sendEmail.call(a)}})},createToolbarBtn:function(a,b,c,e){return new Ext.Button({overflowText:a,
tooltip:a,iconCls:c,text:a,handler:b,enableToggle:null!=e?!0==e:!1,scope:this})},showHideCC:function(){this.visibleCC=!this.visibleCC;this.containerCC.setVisible(this.visibleCC)},showHideBCC:function(){this.visibleBCC=!this.visibleBCC;this.containerBCC.setVisible(this.visibleBCC)},createMainComponent:function(){this.initView();return this.formPanel},initView:function(){this.linkTo=Ext.create("Ext.ux.LinkComponent",{clsLink:"link_blue",style:{textAlign:"right",paddingTop:"4px"},suffix:":",label:getText("item.action.sendItemEmail.lbl.to"),
width:55,handler:this.openLinkTo,scope:this});this.txtTo=Ext.create("Ext.form.field.Text",{name:"toCustom",margin:"0 0 0 5",flex:1});this.btnChooseTo=Ext.create("Ext.button.Button",{tooltip:getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.to")),iconCls:"addressBook",handler:this.openLinkTo,margin:"0 0 0 5",scope:this});var a={xtype:"container",layout:{type:"hbox",pack:"start",align:"stretch"},anchor:"100%",margin:"5 5 5 5",items:[this.linkTo,this.txtTo,
this.btnChooseTo]};this.linkCC=Ext.create("Ext.ux.LinkComponent",{clsLink:"link_blue",style:{textAlign:"right",paddingTop:"4px"},suffix:":",label:getText("item.action.sendItemEmail.lbl.cc"),width:55,handler:this.openLinkCC,scope:this});this.txtCC=Ext.create("Ext.form.field.Text",{name:"ccCustom",margin:"0 0 0 5",flex:1});this.btnChooseCC=Ext.create("Ext.button.Button",{tooltip:getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.cc")),iconCls:"addressBook",
handler:this.openLinkCC,margin:"0 0 0 5",scope:this});this.containerCC=Ext.create("Ext.container.Container",{xtype:"container",layout:{type:"hbox",pack:"start",align:"stretch"},anchor:"100%",margin:"5 5 5 5",hidden:!0,items:[this.linkCC,this.txtCC,this.btnChooseCC]});this.linkBCC=Ext.create("Ext.ux.LinkComponent",{clsLink:"link_blue",style:{textAlign:"right",paddingTop:"4px"},suffix:":",label:getText("item.action.sendItemEmail.lbl.bcc"),width:55,handler:this.openLinkBCC,scope:this});this.txtBCC=Ext.create("Ext.form.field.Text",
{margin:"0 0 0 5",flex:1,name:"bccCustom",anchor:"100%"});this.btnChooseBCC=Ext.create("Ext.button.Button",{tooltip:getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.bcc")),iconCls:"addressBook",handler:this.openLinkBCC,margin:"0 0 0 5",scope:this});this.containerBCC=Ext.create("Ext.container.Container",{xtype:"container",layout:{type:"hbox",pack:"start",align:"stretch"},anchor:"100%",margin:"5 5 5 5",hidden:!0,items:[this.linkBCC,this.txtBCC,this.btnChooseBCC]});
this.txtSubject=Ext.create("Ext.form.field.Text",{name:"subject",fieldLabel:getText("admin.server.sendEmail.lbl.subject"),labelWidth:60,labelStyle:"overflow:hidden;",labelAlign:"right",anchor:"100%"});a=Ext.create("Ext.panel.Panel",{layout:"anchor",border:!1,bodyBorder:!1,region:"north",padding:"0 0 0 0",items:[a,this.containerCC,this.containerBCC,this.txtSubject]});this.txtBody=CWHF.createRichTextEditorField("mailBody",{region:"center",margin:"0 0 0 0",border:!1},!1,!0);this.formPanel=Ext.create("Ext.form.Panel",
{layout:"border",border:!1,margins:"0 0 0 0",bodyStyle:"padding: 5px;",items:[a,this.txtBody]})},init:function(){this.initView()},clear:function(){this.txtBody.setValue("");this.txtSubject.setValue(null);this.txtTo.setValue(null);this.txtCC.setValue(null);this.txtBCC.setValue(null)},validate:function(){return!0},sendEmail:function(){var a=this;CWHF.submitRTEditor(a.txtBody);if(!a.validate)return!1;a.formPanel.setLoading(com.trackplus.TrackplusConfig.getText("common.lbl.loading"));a.formPanel.getForm().submit({url:"sendEmail!sendEmail.action",
success:function(b,c){a.formPanel.setLoading(!1);CWHF.showMsgInfo(getText("admin.server.sendEmail.lbl.sentSuccessful"))},failure:function(b,c){a.formPanel.setLoading(!1);var e=c.result.errorMessage;switch(c.result.errorCode){case a.ERROR_NEED_PERSON:a.txtTo.focus();break;case a.ERROR_NEED_SUBJECT:a.txtSubject.focus()}null!=e&&CWHF.showMsgError(e)}})},openLinkTo:function(){var a=getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.to"));this.openPersonDialog(this.txtTo,
a)},openLinkCC:function(){var a=getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.cc"));this.openPersonDialog(this.txtCC,a)},openLinkBCC:function(){var a=getText("item.action.sendItemEmail.choosePerson.title",getText("item.action.sendItemEmail.lbl.bcc"));this.openPersonDialog(this.txtBCC,a)},openPersonDialog:function(a,b){this.currentTxtTo=a;Ext.create("com.trackplus.util.PersonPickerDialog",{title:b,data:null,includeEmail:!0,includeGroups:!0,handler:this.addPersonHandler,
scope:this}).showDialog()},addPersonHandler:function(a,b){if(null!=b){var c=this.currentTxtTo.getValue(),e="";null!=c&&""!=c&&(e=c+";");e+=b.join("; ");this.currentTxtTo.setValue(e)}}});
Ext.define("com.trackplus.admin.server.DatabaseBackup",{extend:"Ext.Base",constructor:function(a){},ERROR_NEED_FILE_NAME:1,labelWidth:250,textFieldWidth:550,textFieldWidthShort:320,alignR:"right",FieldSetWidth:700,btnStart:null,formPanel:null,backupDir:null,backupFieldSet:null,backupFieldSetConf:null,gridAvailableBackups:null,createToolbar:function(){var a=this;null==a.btnStart&&(a.btnStart=new Ext.Button({text:getText("admin.server.databaseBackup.button.Execute"),overflowText:getText("admin.server.databaseBackup.button.Execute"),
tooltip:getText("admin.server.databaseBackup.button.Execute"),iconCls:"backup",disabled:!1,handler:function(){a.startBackup.call(a)}}));return[a.btnStart]},getControl:function(){return CWHF.getControl.apply(this.formPanel,arguments)},getHelpWrapper:function(){return CWHF.getHelpWrapper.apply(this.formPanel,arguments)},getWrappedControl:function(){return CWHF.getWrappedControl.apply(this.formPanel,arguments)},createGridAvailableBackups:function(){var a=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[{name:"name",
type:"string"},{name:"systemVersion",type:"string"},{name:"dbVersion",type:"string"},{name:"dbType",type:"string"},{name:"valid",type:"bool"},{name:"length",type:"int"},{name:"lastModified",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateTimeFormat}],proxy:{type:"ajax",url:"databaseBackup!getAvailableBackups.action",reader:{type:"json"}}});return Ext.create("Ext.grid.Panel",{store:a,bodyBorder:!1,cls:"gridNoBorder",title:getText("admin.server.databaseBackup.lbl.availableBackups"),columns:[{text:getText("admin.server.databaseBackup.lbl.backupName"),
width:250,dataIndex:"name",sortable:!0},{text:getText("common.lbl.size"),width:100,dataIndex:"length",sortable:!0,renderer:function(a){return Ext.util.Format.fileSize(a)}},{text:getText("common.lbl.date"),width:125,dataIndex:"lastModified",sortable:!0,renderer:Ext.util.Format.dateRenderer(com.trackplus.TrackplusConfig.DateTimeFormat)},{text:getText("admin.server.config.systemVersion"),width:115,dataIndex:"systemVersion",sortable:!0},{text:getText("admin.server.config.dbVersion"),width:115,dataIndex:"dbVersion",
sortable:!0},{text:getText("admin.server.databaseBackup.dbType"),width:100,dataIndex:"dbType",sortable:!0}],margin:"0 0 0 0",region:"center",border:!1,viewConfig:{stripeRows:!0,getRowClass:function(a){var c="";!1==a.data.valid&&(c="invalidBackupRow");return c}}})},createErrorBox:function(){return Ext.create("Ext.form.Panel",{itemId:"errorBox",bodyPadding:10,margin:"0 0 15 0",cls:"errBox",bodyCls:"errBox",hidden:!0})},createBackupFieldSet:function(){var a=CWHF.createTextField("admin.server.databaseBackup.lbl.backupName",
"backupName",{labelWidth:this.labelWidth}),b=CWHF.createCheckbox("admin.server.databaseBackup.lbl.sendNotifyEmail","sendNotifyEmail",{labelWidth:this.labelWidth}),c=CWHF.createCheckbox("admin.server.databaseBackup.lbl.includeAttachments","includeAttachments",{labelWidth:this.labelWidth});return{xtype:"fieldset",width:this.FieldSetWidth,title:getText("admin.server.databaseBackup.lbl.saveNow"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[b,c,a]}},createBackupFieldSetConf:function(){var a=
this,b=CWHF.createCheckboxWithHelp("admin.server.config.isDatabaseBackupJobOn","autoBackup",{listeners:{change:function(){a.enableAutoBackup.call(a)}}}),c=CWHF.createTextField("admin.server.config.backupDir","backupDir",{labelWidth:a.labelWidth,width:515}),e=CWHF.createComboWithHelp("admin.server.databaseBackup.lbl.backupDays","backupOnDays",{multiSelect:!0},null,"backupOnDays"),f=CWHF.createNumberFieldWithHelp("admin.server.databaseBackup.lbl.noOfBackups","noOfBackups",0,1,99999,{width:a.labelWidth+
30,hideTrigger:!0}),g=CWHF.createTimeFieldWithHelp("admin.server.databaseBackup.lbl.backupTime","backupTime",{altFormats:"H:i",allowBlank:!1,increment:5}),h=CWHF.createCheckbox("admin.server.databaseBackup.lbl.includeAttachments","includeAttachmentsConf",{labelWidth:a.labelWidth}),k={xtype:"button",style:{marginBottom:"5px",marginLeft:"5px"},enableToggle:!1,id:"SaveBtn",width:null,text:getText("admin.server.databaseBackup.button.saveConfig"),handler:function(){a.saveConfiguration.call(a)}},k={xtype:"panel",
border:!1,bodyBorder:!1,margin:"15 0 10 0",layout:"hbox",items:[{xtype:"label",width:a.labelWidth,text:""},k]};return{xtype:"fieldset",itemId:"fsauto",width:a.FieldSetWidth,title:getText("admin.server.databaseBackup.lbl.automatedBackupConf"),collapsible:!0,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",collapsed:"true",items:[b,c,h,e,g,f,k]}},enableAutoBackup:function(){this.formPanel.getComponent("fsauto");autoBackup=this.getWrappedControl("fsauto","autoBackup");var a=autoBackup.getValue();
this.getControl("fsauto","backupDir").setDisabled(!a);this.getControl("fsauto","includeAttachmentsConf").setDisabled(!a);this.getHelpWrapper("fsauto","backupOnDays").setDisabled(!a);this.getHelpWrapper("fsauto","backupTime").setDisabled(!a);this.getHelpWrapper("fsauto","noOfBackups").setDisabled(!a)},createMainComponent:function(){this.gridAvailableBackups=this.createGridAvailableBackups();this.formPanel=Ext.create("Ext.form.Panel",{region:"north",layout:"anchor",url:"databaseBackup!backup.action",
border:!1,margins:"0 0 0 0",bodyStyle:"padding: 5px 5px 10px 5px;",fieldDefaults:{labelWidth:270,labelAlign:this.alignR}});this.formPanel.add(this.createErrorBox());this.formPanel.add(this.createBackupFieldSet());this.formPanel.add(this.createBackupFieldSetConf());var a=Ext.create("Ext.panel.Panel",{layout:"border",border:!1,bodyBorder:!1,margins:"0 0 0 0",items:[this.formPanel,this.gridAvailableBackups]});this.mainPanel=a;this.load();return a},load:function(){var a=this;a.formPanel.getForm().load({url:"databaseBackup.action",
success:function(b,c){try{a.afterLoad.call(a,c.result.data),a.formPanel.getComponent("errorBox").setVisible(!1)}catch(e){}},failure:function(b,c){a.afterLoad.call(a,c.result.data);var e=a.formPanel.getComponent("errorBox");e.update(c.result.msg);e.setVisible(!0);Ext.MessageBox.show({title:"",msg:getText("admin.server.databaseBackup.err.problemStarting"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}})},afterLoad:function(a){this.formPanel.setLoading(!1);this.gridAvailableBackups.setTitle(getText("admin.server.databaseBackup.lbl.availableBackups")+
" "+a.backupDir);this.enableAutoBackup();var b=this.getWrappedControl("fsauto","backupOnDays");b.store.loadData(a.backupOnDaysList);b.setValue(a.backupOnDays);this.gridAvailableBackups.store.loadData(a.availableBackups)},saveConfiguration:function(a){var b=this;if(!b.formPanel.getForm().isValid())return!1;b.formPanel.setLoading(getText("common.lbl.loading"));b.formPanel.getForm().url="databaseBackup!saveConfig.action";b.formPanel.getForm().submit({scope:b,success:function(a,e){b.afterLoad.call(b,
e.result.data);b.formPanel.getComponent("errorBox").setVisible(!1);Ext.MessageBox.show({title:"",msg:getText("admin.server.databaseBackup.lbl.confSaved"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},failure:function(a,e){b.afterLoad.call(b,e.result.data);var f=b.formPanel.getComponent("errorBox");f.update(e.result.msg);f.setVisible(!0);Ext.MessageBox.show({title:"",msg:getText("admin.server.databaseBackup.err.problemWithConf"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}})},startBackup:function(){var a=
this;a.formPanel.setLoading(getText("common.lbl.loading"));a.formPanel.getForm().submit({url:"databaseBackup!backup.action",clientValidation:!1,success:function(b,c){a.afterLoad.call(a,c.result.data);var e=a.formPanel.getComponent("errorBox");e.update(c.result.msg);e.setVisible(!1);CWHF.showMsgInfo(getText("admin.server.databaseBackup.lbl.backupStarted"))},failure:function(b,c){a.afterLoad.call(a,c.result.data);var e=a.formPanel.getComponent("errorBox");e.update(c.result.msg);e.setVisible(!0);CWHF.showMsgInfo(getText("admin.server.databaseBackup.err.problemStarting"))}})}});
Ext.define("com.trackplus.admin.server.DatabaseRestore",{extend:"Ext.Base",constructor:function(a){},ERROR_NEED_FILE_NAME:1,btnStart:null,btnDelete:null,formPanel:null,chkIncludeAttachments:null,txtAttachmentDir:null,turl:null,backupFile:null,backupDir:null,alignR:"right",gridAvailableBackups:null,createToolbar:function(){var a=this;null==a.btnStart&&(a.btnStart=new Ext.Button({text:getText("admin.server.databaseRestore.button.restoreExecute"),overflowText:getText("admin.server.databaseRestore.button.restoreExecute"),
tooltip:getText("admin.server.databaseRestore.button.restoreExecute"),iconCls:"restore",disabled:!0,handler:function(){a.execute.call(a)}}));null==a.btnDelete&&(a.btnDelete=new Ext.Button({text:getText("admin.server.databaseRestore.button.delete"),overflowText:getText("admin.server.databaseRestore.button.delete"),tooltip:getText("admin.server.databaseRestore.button.delete"),iconCls:"delete",disabled:!0,handler:function(){a.exeDelete.call(a)}}));return[a.btnStart,a.btnDelete]},createMainComponent:function(){var a=
this,b=Ext.create("Ext.data.Store",{autoLoad:!1,fields:[{name:"name",type:"string"},{name:"systemVersion",type:"string"},{name:"dbVersion",type:"string"},{name:"dbType",type:"string"},{name:"valid",type:"bool"},{name:"length",type:"int"},{name:"lastModified",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateTimeFormat}],proxy:{type:"ajax",url:"databaseBackup!getAvailableBackups.action",reader:{type:"json"}}}),c=Ext.create("Ext.selection.CheckboxModel",{checkOnly:!1,mode:"SINGLE",listeners:{beforeselect:function(a,
b,c){return!0==b.get("valid")},beforedeselect:function(a,b,c){return!0==b.get("valid")}}});a.gridAvailableBackups=Ext.create("Ext.grid.Panel",{store:b,bodyBorder:!1,cls:"gridNoBorder",selModel:c,title:getText("admin.server.databaseBackup.lbl.availableBackups"),columns:[{text:getText("common.lbl.name"),width:250,dataIndex:"name",sortable:!0},{text:getText("common.lbl.size"),width:100,dataIndex:"length",sortable:!0,renderer:function(a){return Ext.util.Format.fileSize(a)}},{text:getText("common.lbl.date"),
width:125,dataIndex:"lastModified",sortable:!0,renderer:Ext.util.Format.dateRenderer(com.trackplus.TrackplusConfig.DateTimeFormat)},{text:getText("admin.server.config.systemVersion"),width:115,dataIndex:"systemVersion",sortable:!0},{text:getText("admin.server.config.dbVersion"),width:115,dataIndex:"dbVersion",sortable:!0},{text:getText("admin.server.databaseBackup.dbType"),width:100,dataIndex:"dbType",sortable:!0}],margin:"0 0 0 0",region:"center",border:!1,viewConfig:{stripeRows:!0,getRowClass:function(a){var b=
"";!1==a.data.valid&&(b="invalidBackupRow");return b}},listeners:{selectionChange:function(){a.selectedChanged.call(a)}}});var b=CWHF.createTextField("admin.server.databaseRestore.lbl.driverClassName","driverClassName",{width:675,allowBlank:!1}),c=Ext.create("Ext.Component",{cls:"infoBox_bottomBorder",border:!0,html:getText("admin.server.databaseRestore.lbl.mainHint"),margin:"0 0 5 0"}),e=CWHF.createTextField("admin.server.databaseRestore.lbl.url","turl",{width:675,allowBlank:!1}),f=CWHF.createTextField("admin.server.databaseRestore.lbl.user",
"user",{width:415,allowBlank:!1}),g=CWHF.createTextField("admin.server.databaseRestore.lbl.password","password",{inputType:"password",width:415,allowBlank:!1}),h=CWHF.createCheckbox("admin.server.databaseRestore.lbl.sendNotifyEmail","sendNotifyEmail",{checked:!0});a.chkIncludeAttachments=CWHF.createCheckbox("admin.server.databaseRestore.lbl.includeAttachments","includeAttachments",{checked:!1},{change:function(b,c,e,f){a.chkIncludeAttachmentsChange.call(a)}});var k={xtype:"button",style:{marginTop:"3px",
marginBottom:"15px",marginLeft:"255px"},enableToggle:!1,iconCls:"check16",text:getText("admin.server.databaseRestore.button.testConnection"),handler:function(){a.testConnection.call(a)}};a.backupFile=Ext.create("Ext.form.field.Text",{name:"backupFile",hidden:!0});a.backupDir=Ext.create("Ext.form.field.Text",{name:"backupDir",hidden:!0});a.jaction=Ext.create("Ext.form.field.Text",{name:"action",hidden:!0});a.txtAttachmentDir=CWHF.createTextField("admin.server.databaseRestore.lbl.attachmentRestoreDir",
"attachmentDir",{width:675});a.formPanel=Ext.create("Ext.form.Panel",{layout:"anchor",region:"north",url:"databaseRestore!restore.action",border:!1,margins:"0 0 5 0",fieldDefaults:{labelWidth:270,labelAlign:a.alignR},items:[c,b,e,f,g,k,h,a.chkIncludeAttachments,a.txtAttachmentDir,a.backupFile]});return Ext.create("Ext.panel.Panel",{layout:"border",border:!1,bodyBorder:!1,margins:"0 0 0 0",items:[a.formPanel,a.gridAvailableBackups]})},reload:function(){var a=this;a.formPanel.getForm().load({url:"databaseRestore.action",
success:function(b,c){try{var e=Ext.decode(c.response.responseText).data;a.gridAvailableBackups.setTitle(getText("admin.server.databaseBackup.lbl.availableBackups")+" "+e.backupDir);a.afterLoad.call(a,c.result.data)}catch(f){}},failure:function(a,c){Ext.MessageBox.alert(this.failureTitle,c.response.responseText)}})},afterLoad:function(a){this.gridAvailableBackups.store.loadData(a.availableBackups)},execute:function(){var a=this;if(!a.formPanel.getForm().isValid())return!1;a.formPanel.setLoading(getText("common.lbl.loading"));
a.formPanel.getForm().submit({success:function(b,c){a.formPanel.setLoading(!1);CWHF.showMsgInfo(getText("admin.server.databaseRestore.lbl.started"))},failure:function(b,c){a.formPanel.setLoading(!1);var e=c.result.errorMessage;if(null==e||""==e)if(e="",null!=c.result.errors)for(var f in c.result.errors)e+=c.result.errors[f]+"\x3c/br\x3e";CWHF.showMsgError(e)}})},exeDelete:function(){var a=this;if(!a.formPanel.getForm().isValid())return!1;a.formPanel.setLoading(getText("common.lbl.loading"));a.formPanel.getForm().submit({url:"databaseRestore!delete.action",
success:function(b,c){a.formPanel.setLoading(!1);var e=Ext.decode(c.response.responseText).data;a.gridAvailableBackups.store.loadData(e)},failure:function(b,c){a.formPanel.setLoading(!1);var e="";if(null!=c.result.errors)for(var f=0;f<c.result.errors.length;f++)e+=c.result.errors[f].label+"\x3c/br\x3e";CWHF.showMsgError(e)}})},chkIncludeAttachmentsChange:function(){var a=this.chkIncludeAttachments.getRawValue();this.txtAttachmentDir.allowBlank=!a;this.txtAttachmentDir.validate()},selectedChanged:function(){var a=
this.gridAvailableBackups.selModel.getLastSelected();1>this.gridAvailableBackups.selModel.getCount()?(this.btnStart.setDisabled(!0),this.btnDelete.setDisabled(!0)):(this.backupFile.setValue(a.get("name")),this.btnStart.setDisabled(!1),this.btnDelete.setDisabled(!1))},testConnection:function(){var a=this;a.formPanel.setLoading(getText("common.lbl.loading"));a.formPanel.getForm().submit({url:"databaseRestore!testConnection.action",success:function(b,c){a.formPanel.setLoading(!1);CWHF.showMsgInfo(getText("admin.server.databaseRestore.lbl.connectSucceeded"))},
failure:function(b,c){a.formPanel.setLoading(!1);CWHF.showMsgError(getText("admin.server.databaseRestore.err.connectFailed"))}})}});
Ext.define("com.trackplus.admin.ICalendarURL",{extend:"Ext.Base",config:{data:{}},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},view:null,btnGenerate:null,btnDownload:null,tree:null,createView:function(){var a=Ext.create("Ext.data.TreeStore",{proxy:{type:"ajax",url:"projectPicker.action",extraParams:{useChecked:!0}}});this.tree=Ext.create("Ext.tree.Panel",{store:a,rootVisible:!1,useArrows:!0,margin:"10 10 10 10",frame:!0,title:getText("admin.project.lbl.project"),width:300,
height:200});a={xtype:"component",cls:"infoBox_bottomBorder",border:!0,html:getText("admin.myprefs.iCalendar.defaultUrlMessage")};this.boxURL=Ext.create("Ext.Component",{border:!0,html:"...",margin:"10 0 0 10",anchor:"100%",hidden:!0});return this.view=Ext.create("Ext.panel.Panel",{layout:"anchor",margin:"0 0 0 0",border:!1,bodyBorder:!1,items:[a,this.tree,this.boxURL]})},getToolbarButtons:function(){var a=this;null==a.btnGenerate&&(a.btnGenerate=Ext.create("Ext.button.Button",{overflowText:getText("common.btn.generateUrl"),
tooltip:getText("common.btn.generateUrl"),text:getText("common.btn.generateUrl"),iconCls:"save",disabled:!1,handler:function(){a.generateURL.call(a)}}),a.btnDownload=Ext.create("Ext.button.Button",{overflowText:getText("common.btn.download"),tooltip:getText("common.btn.download"),text:getText("common.btn.download"),iconCls:"download",disabled:!1,handler:function(){a.download()}}));return[a.btnGenerate]},generateURL:function(){var a=this;if(null==a.tree)return!1;var b=a.tree.getView().getChecked();
if(null==b||0==b.length)return Ext.MessageBox.show({title:getText("admin.myprefs.iCalendar.title"),msg:getText("common.err.required",getText("admin.project.lbl.projectForOp")),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR}),!1;for(var c="",e=0;e<b.length;e++)c+=b[e].data.id,e<b.length-1&&(c+="-");a.view.setLoading(!0);Ext.Ajax.request({url:"iCalendar!generateURL.action",params:{selectedProjects:c,allProjects:!1},success:function(b){b=Ext.decode(b.responseText);a.boxURL.update(b.data);a.boxURL.setVisible(!0);
a.view.setLoading(!1)},failure:function(b){alert("failure");a.view.setLoading(!1)}})},download:function(){alert("download")}});
Ext.define("com.trackplus.admin.NotifyConfig",{extend:"com.trackplus.admin.TreeBase",config:{defaultSettings:!1,exclusiveProjectID:null},defaultSettings:!1,exclusiveProjectID:null,baseAction:"notify",entityID:"node",actionSave:null,actionDelete:null,notifySettings:null,notifyTriggers:null,notifyFilters:null,AUTOMAIL_ASSIGNMENT:"1",AUTOMAIL_TRIGGER:"2",AUTOMAIL_FILTER:"3",constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},
{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"}]},loadDetailPanel:function(a,b,c){a=a.data.id;if("10"==a)return this.createCenterPanel();switch(a){case this.AUTOMAIL_ASSIGNMENT:null==this.notifySettings&&(this.notifySettings=Ext.create("com.trackplus.admin.NotifySettingsList",{defaultSettings:this.defaultSettings,exclusiveProjectID:this.exclusiveProjectID}));this.loadGrid(this.notifySettings);break;case this.AUTOMAIL_TRIGGER:null==
this.notifyTriggers&&(this.notifyTriggers=Ext.create("com.trackplus.admin.NotifyTriggerList",{defaultSettings:this.defaultSettings}));this.loadGrid(this.notifyTriggers);break;case this.AUTOMAIL_FILTER:null==this.notifyFilters&&(this.notifyFilters=Ext.create("com.trackplus.admin.customize.category.CategoryConfig",{rootID:"notifyFilter",projectID:this.exclusiveProjectID,excludePrivate:this.defaultSettings})),this.loadTreeWithGrid(this.notifyFilters)}},loadGrid:function(a){a.initGrid();var b=a.getGrid();
a.reload();null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);this.centerPanel=b;this.mainPanel.add(this.centerPanel);borderLayout.setActiveToolbarActionList(a.getToolbarActions())},loadTreeWithGrid:function(a){null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);this.centerPanel=a.createCenterPanel();this.mainPanel.add(this.centerPanel);borderLayout.setActiveToolbarActionList(a.getToolbarActions())},onTreeNodeLoad:function(a,b){b.isRoot()&&this.tree.getSelectionModel().select(b.firstChild)}});
Ext.define("com.trackplus.admin.NotifySettingsList",{extend:"com.trackplus.admin.GridConfig",config:{defaultSettings:!1,exclusiveProjectID:null},urlStore:"notifySettings!loadList.action",autoLoadGrid:!1,fields:[{name:"id",type:"int"},{name:"project",type:"int"},{name:"projectLabel",type:"string"},{name:"triggerLabel",type:"string"},{name:"filterLabel",type:"String"},{name:"inherited",type:"boolean"}],getEntityLabel:function(){return getText("admin.customize.automail.assignments.lbl.assignment")},
confirmDeleteEntity:!0,baseAction:"notifySettings",entityID:"notifySettingsID",editWidth:500,editHeight:210,labelWidth:200,actionOverwrite:null,getOverwriteIconCls:function(){return"copy"},getOverwriteButtonKey:function(){return"common.btn.overwrite"},getOverwriteTitleKey:function(){return"common.lbl.overwrite"},getColumnModel:function(){return[{text:getText("common.lbl.name"),flex:1,dataIndex:"projectLabel",sortable:!0,renderer:this.renderer},{text:getText("admin.customize.automail.trigger.lblAlone"),
flex:1,dataIndex:"triggerLabel",sortable:!0,renderer:this.renderer},{text:getText("admin.customize.automail.filter.lblAlone"),flex:1,dataIndex:"filterLabel",sortable:!0,renderer:this.renderer}]},getLoadGridParams:function(){return{defaultSettings:this.defaultSettings,exclusiveProjectID:this.exclusiveProjectID}},getAddParams:function(){return{defaultSettings:this.defaultSettings,exclusiveProjectID:this.exclusiveProjectID}},getEditParams:function(a){var b={defaultSettings:this.defaultSettings,exclusiveProjectID:this.exclusiveProjectID};
b[""+this.entityID]=a.id;return b},getDeleteParams:function(a){var b={};b[""+this.entityID]=a.data.id;b.defaultSettings=this.defaultSettings;return b},initActions:function(){this.actionAdd=this.createAction(this.getAddButtonKey(),this.getAddIconCls(),this.onAdd,!1,this.getAddTitleKey());this.actionEdit=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEdit,!0,this.getEditTitleKey());this.actionDelete=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDelete,
!0,this.getDeleteTitleKey());!1==this.defaultSettings?(this.actionOverwrite=this.createAction(this.getOverwriteButtonKey(),this.getOverwriteIconCls(),this.onOverwrite,!0,this.getOverwriteTitleKey()),this.actions=[this.actionAdd,this.actionEdit,this.actionOverwrite,this.actionDelete]):this.actions=[this.actionAdd,this.actionEdit,this.actionDelete]},onGridStoreLoad:function(a,b){null!=this.exclusiveProjectID&&null!=b&&0<b.length?this.actionAdd.setDisabled(!0):this.actionAdd.setDisabled(!1)},onOverwrite:function(){var a=
this.getSingleSelectedRecordData();null!=a&&this.openEditEntity(this.getOverwriteTitleKey(),a,"overwrite")},getSaveParams:function(a,b){var c=null;"add"==b?c=this.getAddParams():"edit"==b?c=this.getEditParams(a):"overwrite"==b&&(c={},c.project=a.project);null==c&&(c={});return c},preSubmitProcess:function(a,b,c){"overwrite"==c&&(b=b.getComponent("projectsList"),null!=b&&(a.project=b.getValue()));return a},renderer:function(a,b,c){c.data.inherited&&(b.style="color:#909090");return a},onGridSelectionChange:function(a,
b){if(null==b||0==b.length)this.actionDelete.setDisabled(!0),this.actionEdit.setDisabled(!0),null!=this.actionOverwrite&&this.actionOverwrite.setDisabled(!0);else{var c=b[0].data.inherited;this.actionDelete.setDisabled(c);this.actionEdit.setDisabled(c);null!=this.actionOverwrite&&this.actionOverwrite.setDisabled(!c)}},getGridContextMenuActions:function(a,b){var c=[];b&&(a.data.inherited?c.push(this.actionOverwrite):(c.push(this.actionEdit),c.push(this.actionDelete)));return c},onItemDblClick:function(a,
b){b.data.inherited?this.onOverwrite.call(this):this.onEdit.call(this)},contextMenuActions:function(a){return a.data.inherited?[this.actionOverwrite]:[this.actionEdit,this.actionDelete]},afterLoadForm:function(a,b){var c=b.getComponent("filter");c.updateData(a.filterTree);c.setValue(a.filter);c=b.getComponent("project");c.updateData(a.projectTree);c.setValue(a.project);c=b.getComponent("trigger");c.store.loadData(a.triggersList);c.setValue(a.trigger)},createEditForm:function(a,b){return new Ext.form.Panel({border:!1,
autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"10px"},defaults:{labelStyle:"overflow: hidden;",msgTarget:"side",anchor:"100%"},items:this.getFormItems(a,b)})},getFormItems:function(a,b){var c=CWHF.createSingleTreePicker("admin.customize.automail.filter.lblAlone","filter",[],null,{allowBlank:!1,labelWidth:this.labelWidth,margin:"0 0 5 0"});return[CWHF.createSingleTreePicker("admin.project.lbl.project","project",[],null,{allowBlank:!1,labelWidth:this.labelWidth,margin:"0 0 5 0"},{select:{fn:this.onProjectSelect,
scope:this,filterPicker:c}}),CWHF.createCombo("admin.customize.automail.trigger.lblAlone","trigger",{labelWidth:this.labelWidth}),c]},onProjectSelect:function(a,b,c){var e=c.filterPicker;Ext.Ajax.request({url:"notifySettings!projectChange.action",params:{defaultSettings:this.defaultSettings,project:a.getValue(),filter:e.getValue()},scope:this,success:function(a){a=Ext.decode(a.responseText);e.updateData(a.filterTree);e.setValue(a.filter)},failure:function(a){com.trackplus.util.requestFailureHandler(a)}})},
getAddIconCls:function(){return"automailAdd"},getEditIconCls:function(){return"automailEdit"}});
Ext.define("com.trackplus.admin.NotifyTriggerList",{extend:"com.trackplus.admin.GridConfig",config:{defaultSettings:!1},urlStore:"notifyTrigger!loadList.action",autoLoadGrid:!1,fields:[{name:"id",type:"int"},{name:"label",type:"string"},{name:"typeLabel",type:"string"},{name:"own",type:"boolean"}],columnModel:[{header:getText("common.lbl.name"),flex:1,dataIndex:"label",sortable:!0},{header:getText("admin.customize.automail.trigger.lbl.type"),width:150,dataIndex:"typeLabel",sortable:!0}],confirmDeleteEntity:!0,
baseAction:"notifyTrigger",entityID:"notifyTriggerID",peviousSelectedRows:[],editWidth:1E3,editHeight:600,useCopy:!0,getEntityLabel:function(){return getText("admin.customize.automail.trigger.lblOperation")},getLoadGridParams:function(){return{defaultSettings:this.defaultSettings}},getAddParams:function(){return{defaultSettings:this.defaultSettings}},getEditParams:function(a){var b={};b[""+this.entityID]=a.id;b.defaultSettings=this.defaultSettings;return b},getDeleteParams:function(a){var b={};b[""+
this.entityID]=a.data.id;b.defaultSettings=this.defaultSettings;return b},headerChkHandler:function(a,b,c){a=b.checked;b=this.formStore.getTotalCount();c=c.column;for(i=0;i<b;i++)this.formStore.getAt(i).set(c,a)},getColumnByIndex:function(a){switch(a){case 1:return"originator";case 2:return"manager";case 3:return"responsible";case 4:return"consulted";case 5:return"informed";case 6:return"observer"}},createEditForm:function(a,b){var c=CWHF.createTextField("common.lbl.name","label",{itenmId:"label",
allowBlank:!1,labelWidth:100,width:500,anchor:"100%",margin:"10 10 10 10",region:"north"}),e=[{text:getText("admin.customize.automail.trigger.lbl.actionType"),menuDisabled:!0,dataIndex:"actionTypeLabel",flex:1},{text:getText("admin.customize.automail.trigger.lbl.fieldType"),menuDisabled:!0,dataIndex:"fieldTypeLabel",flex:1},{text:getText("common.lbl.field"),menuDisabled:!0,dataIndex:"fieldLabel",flex:1},{text:getText("admin.customize.automail.trigger.lbl.originator")+'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"originator"\x3e',
menuDisabled:!0,dataIndex:"originator",flex:1,xtype:"checkcolumn"},{text:getText("admin.customize.automail.trigger.lbl.manager")+'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"manager"\x3e',menuDisabled:!0,dataIndex:"manager",flex:1,xtype:"checkcolumn"},{text:getText("admin.customize.automail.trigger.lbl.responsible")+'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"responsible"\x3e',menuDisabled:!0,dataIndex:"responsible",flex:1,xtype:"checkcolumn"},{text:getText("admin.customize.automail.trigger.lbl.consultant")+
'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"consulted"\x3e',menuDisabled:!0,dataIndex:"consulted",flex:1,xtype:"checkcolumn"},{text:getText("admin.customize.automail.trigger.lbl.informant")+'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"informed"\x3e',menuDisabled:!0,dataIndex:"informed",flex:1,xtype:"checkcolumn"},{text:getText("admin.customize.automail.trigger.lbl.observer")+'\x26nbsp;\x3cinput type\x3d"checkbox" id\x3d"observer"\x3e',menuDisabled:!0,dataIndex:"observer",flex:1,xtype:"checkcolumn"}],
f="copy"==b,g=a.id;this.formStore=new Ext.data.Store({proxy:{type:"ajax",api:{read:"notifyTrigger!edit.action",update:"notifyTrigger!save.action"},extraParams:{notifyTriggerID:g,copy:f},reader:{type:"json",root:"records"},writer:{type:"json",allowSingle:!1,writeAllFields:!0,root:"records",encode:!0}},fields:[{name:"id",mapping:"id",type:"string"},{name:"objectID",mapping:"objectID",type:"int"},{name:"actionTypeLabel",mapping:"actionTypeLabel",type:"string",persist:!1},{name:"fieldTypeLabel",mapping:"fieldTypeLabel",
type:"string",persist:!1},{name:"fieldLabel",mapping:"fieldLabel",type:"string",persist:!1},{name:"originator",mapping:"originator",type:"boolean"},{name:"manager",mapping:"manager",type:"boolean"},{name:"responsible",mapping:"responsible",type:"boolean"},{name:"consulted",mapping:"consulted",type:"boolean"},{name:"informed",mapping:"informed",type:"boolean"},{name:"observer",mapping:"observer",type:"boolean"}],remoteSort:!0,idProperty:"id",successProperty:"success",autoSync:!1,listeners:{load:{scope:this,
fn:function(a,b){var e=a.getProxy().getReader().rawData;c.setValue(e.label);c.setDisabled(e.disabled);this.win.getDockedItems('toolbar[dock\x3d"bottom"]')[0].getComponent(0).setDisabled(e.disabled);for(i=1;6>=i;i++){var f=this.getColumnByIndex(i);document.getElementById(f).checked=e[f]}}},beforesync:{scope:this,fn:function(){this.formStore.getProxy().extraParams={notifyTriggerID:g,copy:f,label:c.getValue(),defaultSettings:this.defaultSettings}}},datachanged:{scope:this,fn:function(a,b){this.reload.call(this)}}}});
e={xtype:"grid",itemId:"detailGrid",columns:e,sortableColumns:!1,draggable:!1,store:this.formStore,border:!1,bodyBorder:!1,loadMask:!0,stripeRows:!0,region:"center",selModel:this.createSelModel(),style:{borderTop:"1px solid #D0D0D0"},viewConfig:{forceFit:!0},listeners:{afterrender:{fn:function(){for(i=1;6>=i;i++){var a=this.getColumnByIndex(i);Ext.get(a).addListener("click",this.headerChkHandler,this,{column:a})}},scope:this},selectionchange:{fn:function(a,b,c){this.changeEntireRowSelection(this.peviousSelectedRows,
!1);this.changeEntireRowSelection(b,!0);this.peviousSelectedRows=b},scope:this}},plugins:[Ext.create("Ext.grid.plugin.CellEditing",{clicksToEdit:1})]};return new Ext.panel.Panel({border:!1,layout:"border",autoScroll:!0,margin:"0 0 0 0",bodyStyle:{padding:"0px"},items:[c,e]})},changeEntireRowSelection:function(a,b){for(i=0;i<a.length;i++)for(var c=a[i],e=1;7>e;e++)if(b)c.set(this.getColumnByIndex(e),b);else{var f=this.getColumnByIndex(e);document.getElementById(f).checked||c.set(this.getColumnByIndex(e),
b)}},loadHandler:function(){this.formStore.load()},submitHandler:function(a,b,c){a=this.formEdit.getComponent("label");a.validate()&&(b=this.formStore.getUpdatedRecords(),null!=b&&0<b.length?this.formStore.sync():a.isDirty()&&(c.label=a.getValue(),c.defaultSettings=this.defaultSettings,Ext.Ajax.request({url:"notifyTrigger!save.action",params:c,scope:this,success:function(a){a=Ext.decode(a.responseText);this.reload.call(this,{rowToSelect:a.id})},failure:function(a){Ext.MessageBox.alert(this.failureTitle,
a.responseText)}})),this.win.close())},createSelModel:function(){return selModel=Ext.create("com.trackplus.itemNavigator.CheckboxModel",{allowDeselect:!0,checkOnly:!1,mode:"MULTI"})},onGridSelectionChange:function(a,b){if(null==b||0==b.length)this.actionDelete.setDisabled(!0),this.actionEdit.setDisabled(!0),this.actionCopy.setDisabled(!0);else{var c=b[0].data.own;this.actionDelete.setDisabled(!c);this.actionEdit.setDisabled(!c);this.actionCopy.setDisabled(!c)}},contextMenuActions:function(a){return a.data.own?
this.getActions():[this.actionCopy]}});
Ext.define("com.trackplus.admin.customize.treeConfig.TreeConfig",{extend:"com.trackplus.admin.TreeBase",config:{rootID:"",fromProjectConfig:!1,projectOrProjectTypeID:null},folderAction:"treeConfig",leafDetailByFormLoad:!0,leafDetailUrl:null,entityID:"node",actionOverwrite:null,actionReset:null,actionReload:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},loadDetailPanel:function(a,b){b?this.loadDetailPanelWithFormLoad(a,!1):this.loadSimpleDetailPanel(a,!1)},getLeafDetailUrl:function(){return this.baseAction+
"!load.action"},initActions:function(){this.actionOverwrite=this.createLocalizedAction(getText("common.btn.derive"),"copy",this.onOverwrite,this.getTitle("common.lbl.derive"),!0);this.actionReset=this.createLocalizedAction(getText("common.btn.reset"),"reset",this.onReset,this.getTitle("common.lbl.reset"),!0);this.actionReload=this.createLocalizedAction(getText("common.btn.reload"),"reload",this.onReload)},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",
type:"string"},{name:"inheritedConfig",mapping:"inheritedConfig",type:"boolean"},{name:"defaultConfig",mapping:"defaultConfig",type:"boolean"},{name:"childrenAreLeaf",mapping:"childrenAreLeaf",type:"boolean"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"icon",mapping:"icon",type:"string"},{name:"iconCls",mapping:"iconCls",type:"string"},{name:"assignedID",mapping:"assignedID",type:"int"}]},getTreeExpandExtraParams:function(){return{fromProjectConfig:this.fromProjectConfig,projectOrProjectTypeID:this.projectOrProjectTypeID}},
refreshAfterSaveSuccess:function(a){},prepareValidate:function(a,b){},getNodeParam:function(a){a={};var b=this.getSingleSelectedRecordData(!0);null!=b&&(b=this.getRecordID(b,{fromTree:!0}),null!=b&&(a.node=b));return a},onOverwrite:function(){Ext.Ajax.request({url:this.folderAction+"!overwrite.action",params:this.getNodeParam(),scope:this,success:function(a){var b=Ext.decode(a.responseText),c=this.tree.getStore();a=this.tree.getView();c=c.getNodeById(b.node);null!=c&&(c.data.inheritedConfig=b.inheritedConfig,
c.set("text",b.text),c.commit(),b=a.indexOf(c),a.refreshNode(b),this.treeNodeSelect(null,c))},failure:function(a){com.trackplus.util.requestFailureHandler(a,options)}})},onReset:function(){Ext.Ajax.request({url:this.folderAction+"!reset.action",params:this.getNodeParam(),scope:this,success:function(a){a=Ext.decode(a.responseText);var b=this.tree.getView(),c=this.tree.getStore().getNodeById(a.node);if(null!=c){var e=a.refreshTree,f=a.branchReset;e||f?(f=b=!1,e?c=this.tree.getRootNode():f=b=!0,b=b||
"workflow_workflow"==a.node,this.refreshTreeOpenBranches(c,b,f,null,a.node,a.issueType,a.projectType,a.project)):(c.data.inheritedConfig=!0,c.set("text",a.text),c.commit(),a=b.indexOf(c),b.refreshNode(a),this.treeNodeSelect(null,c))}},failure:function(a,b){com.trackplus.util.requestFailureHandler(a,b)}})},onReload:function(){var a=this.getLastSelectedTreeNode();this.tree.getStore().load({node:a})},refreshTreeOpenBranches:function(a,b,c,e,f,g,h,k){var l=this.tree.getStore();Ext.each(b?[a]:a.childNodes,
function(b,n){var p=b.data.id;if(b.hasChildNodes()){var q=b.data.childrenAreLeaf;b==l.getRootNode()&&(q=!0);if(0==p.indexOf("workflow_projectType_")||0==p.indexOf("workflow_project_"))q=!0;if(q&&b.isLoaded()&&this.branchReloadNeeded(b,g,h,k)){p={node:b};if(c||null!=e&&b.data.id==e.data.id)c&&null==f&&(f=a),p.callback=this.selectNode,p.scope={tree:this.tree,nodeIDToSelect:f};l.load(p)}else this.refreshTreeOpenBranches.call(this,b,!1,!1,e,f,g,h,k)}},this)},branchReloadNeeded:function(a,b,c,e){var f=
a.raw.issueType,g=a.raw.projectType;a=a.raw.project;return null!=b&&null!=f&&b!=f||null!=c&&null!=g&&c!=g||null!=e&&null!=a&&e!=a?!1:!0}});
Ext.define("com.trackplus.admin.customize.treeConfig.FieldConfig",{extend:"com.trackplus.admin.customize.treeConfig.TreeConfig",config:{rootID:""},baseAction:"fieldConfigItemDetail",confirmDeleteEntity:!0,confirmDeleteNotEmpty:!0,fieldSetWidth:500,textFieldWidth:350,labelWidth:120,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},getRootMessage:function(a){return getText("admin.customize.field.config.lbl.description")},getEntityLabel:function(){return getText("admin.customize.field.lbl.fieldConfig")},
getAddLabel:function(){return getText(this.getAddTitleKey(),getText("admin.customize.field.lbl.field"))},getDeleteLabel:function(){return getText(this.getDeleteTitleKey(),getText("admin.customize.field.lbl.field"))},initActions:function(){this.callParent();this.actionSave=this.createLocalizedAction(getText("common.btn.save"),"save",this.onSave,this.getTitle("common.lbl.save"),!0)},getToolbarActions:function(){return[this.actionSave,this.actionOverwrite,this.actionReset]},getToolbarActionChangesForTreeNodeSelect:function(a){if(null!=
a){var b=a.isLeaf(),c=a.data.inheritedConfig;a=a.data.defaultConfig;this.actionSave.setDisabled(!b||c);this.actionOverwrite.setDisabled(!b||!c);this.actionReset.setDisabled(c||a)}else this.actionSave.setDisabled(!1),this.actionOverwrite.setDisabled(!0),this.actionReset.setDisabled(!0)},getTreeContextMenuActions:function(a,b){var c=[];if(b){var e=a.data.inheritedConfig,f=a.raw.defaultConfig,g=a.isLeaf();e&&!f&&g&&c.push(this.actionOverwrite);e||f||c.push(this.actionReset);g||c.push(this.actionReload)}return c},
getFolderDetailItems:function(a,b,c){return this.getInfoBoxItems(c.info)},getLeafDetailItems:function(a,b){return[{xtype:"hidden",name:"add",value:b},{xtype:"fieldset",title:getText("admin.customize.field.config.detail.lbl.fieldConfig"),itemId:"fieldFieldset",defaultType:"textfield",style:{marginTop:"6px"},defaults:{labelStyle:"overflow: hidden;",msgTarget:"side",anchor:"-20",width:this.textFieldWidth},width:this.fieldSetWidth,items:this.getFieldItems()},{xtype:"fieldset",title:getText("admin.customize.field.config.detail.lbl.generalConfig"),
itemId:"fieldConfigFieldset",defaultType:"textfield",defaults:{labelStyle:"overflow: hidden;",msgTarget:"side",anchor:"-20",width:this.textFieldWidth},width:this.fieldSetWidth,items:this.getFieldConfigItems()}]},getFieldItems:function(){return[CWHF.createTextField("common.lbl.name","name",{itemId:"name",labelWidth:this.labelWidth,width:this.textFieldWidth,allowBlank:!1,stripCharsRe:/\s|:|\<|\>|\/|\.|\(|\)|\'|\"|\,/}),CWHF.createCombo("admin.customize.field.lbl.fieldType","fieldType",{itemId:"fieldType",
labelWidth:this.labelWidth,hidden:!0,idType:"string"},{select:{fn:this.selectFieldType,scope:this}},"fieldType"),CWHF.createCheckbox("admin.customize.field.lbl.filterField","filterField",{itemId:"filterField",labelWidth:this.labelWidth,hidden:!0}),CWHF.createCheckbox("admin.customize.field.lbl.deprecated","deprecated",{itemId:"deprecated",labelWidth:this.labelWidth,hidden:!0}),CWHF.createTextAreaField("common.lbl.description","description",{itemId:"description",labelWidth:this.labelWidth,width:450})]},
getFieldConfigItems:function(){return[CWHF.createTextField("common.lbl.label","label",{itemId:"label",labelWidth:this.labelWidth,width:this.textFieldWidth,allowBlank:!1}),CWHF.createTextField("common.lbl.tooltip","tooltip",{itemId:"tooltip",labelWidth:this.labelWidth,width:this.textFieldWidth}),CWHF.createCheckbox("admin.customize.field.config.detail.lbl.required","required",{itemId:"required",labelWidth:this.labelWidth}),CWHF.createCheckbox("admin.customize.field.config.detail.lbl.history","history",
{itemId:"history",labelWidth:this.labelWidth})]},getEditLeafPostDataProcess:function(a,b){return this.fieldPostDataProcess},getEditFolderPostDataProcess:function(a,b){return b?this.fieldPostDataProcess:null},fieldPostDataProcess:function(a,b){var c=b.getComponent("fieldFieldset"),e=b.getComponent("fieldConfigFieldset"),f=a.fieldAttributesDisabled;c.getComponent("name").setDisabled(f);var g=a.inheritedConfig,h=a.customField,k=c.getComponent("fieldType");h&&(k.setVisible(!0),k.store.loadData(a.fieldTypesList),
k.setValue(a.fieldType),k.setDisabled(a.fieldTypeDisabled||f));c.getComponent("deprecated").setVisible(a.renderDeprecated);c.getComponent("deprecated").setDisabled(f);c.getComponent("filterField").setVisible(a.renderFilterField);c.getComponent("filterField").setDisabled(f);c.getComponent("description").setDisabled(f);e.getComponent("label").setDisabled(g);e.getComponent("tooltip").setDisabled(g);e.getComponent("required").setDisabled(g||!a.renderRequired);e.getComponent("history").setDisabled(g||
!a.renderHistory);c=b.getComponent("specificItem");null!=c&&(c.setDisabled(!0),b.remove(c));c=a.specificFieldConfigClass;null!=c&&""!=c&&(this.addSpecificConfig(b,c,this.fieldSetWidth),c=b.getComponent("specificItem"),null!=c&&(a.node=this.selectedNodeID,a.labelWidth=this.labelWidth,c.onDataReady(a)))},addSpecificConfig:function(a,b,c){null!=b&&(b=Ext.create(b,{width:c}),b.setTitle(getText("admin.customize.field.config.detail.lbl.specificConfig")),null!=b&&(a.add(b),a.doLayout()))},onAddLeaf:function(){var a=
this.getSingleSelectedRecord(!0);this.loadDetailPanelWithFormLoad(a,!0);this.actionSave.setDisabled(!1)},onSave:function(a){this.prepareValidate(this.centerPanel,!0);this.centerPanel.getForm().submit({url:this.baseAction+"!save.action",params:this.getNodeParam(a),scope:this,success:function(a,c){var e=c.result;e.success?this.refreshAfterSaveSuccess(e):com.trackplus.util.showError(e)},failure:function(a,c){com.trackplus.util.submitFailureHandler(a,c)}})},prepareValidate:function(a,b){a.getComponent("fieldFieldset").getComponent("name").allowBlank=
!b;a.getComponent("fieldConfigFieldset").getComponent("label").allowBlank=!b},selectFieldType:function(a,b,c){this.prepareValidate(this.centerPanel,!1);this.centerPanel.getForm().submit({fromCenterPanel:!0,url:this.baseAction+"!load.action",scope:this,params:this.getNodeParam(),success:function(a,b){var c=b.result;c.success?this.fieldPostDataProcess(b.result.data,this.centerPanel):com.trackplus.util.showError(c)},failure:function(a,b){com.trackplus.util.submitFailureHandler(a,b)}})},getNodeParam:function(a){var b=
this.callParent(arguments),c=!1;null!=a&&(c=a.renameConfirmed)&&(b.renameConfirmed=c);return b},renameField:function(a){"yes"==a&&this.onSave.call(this,{renameConfirmed:!0})},refreshAfterSaveSuccess:function(a){errorMessage=a.errorMessage;null!=errorMessage?Ext.MessageBox.show({title:getText("admin.customize.field.config.detail.lbl.rename"),msg:errorMessage,buttons:Ext.Msg.YESNO,icon:Ext.Msg.WARNING,fn:this.renameField,scope:this}):a.refreshTree?this.expandAscendentPath.call(this,a.pathToExpand,a.node):
(a=this.tree.getStore().getNodeById(a.node),null!=a&&this.treeNodeSelect(null,a))},expandAscendentPath:function(a,b,c){null!=c&&c.expand(!1);null!=a&&0<a.length?(c=a.shift(),parentNode=this.tree.getStore().getNodeById(c),this.tree.getStore().load({node:parentNode,callback:function(){this.expandAscendentPath(a,b,parentNode)},scope:this})):this.refreshTreeOpenBranches(this.tree.getRootNode(),!1,!1,c,b)},getDeleteEntityLabel:function(){return getText("admin.customize.field.lbl.field")},onDelete:function(){var a=
this.getSelectedRecords(!0);if(null!=a){var b=this.selectedIsLeaf(!0);b&&this.deleteHandler(a,{fromTree:!0,isLeaf:b})}},reload:function(a){this.refreshTreeOpenBranches(a.root,!1,!1,a.parentNode,a.nodeIdToSelect)},getReloadParamsAfterDelete:function(a,b,c){a=a.parentNode;return{root:this.tree.getRootNode(),parentNode:a,nodeIdToSelect:a.data.id}}});
Ext.define("com.trackplus.admin.customize.treeConfig.AssignmentConfig",{extend:"com.trackplus.admin.customize.treeConfig.TreeConfig",config:{rootID:""},allowMultipleSelections:!0,textFieldWidth:350,labelWidth:120,actionApply:null,actionAdd:null,actionEdit:null,actionCopy:null,actionDelete:null,actionDesign:null,actionImport:null,actionExport:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},initCenterPanel:function(a){this.initTree();this.showGrid()},getEntityConfigLabelSingular:function(){return""},
getEntityConfigLabelPlural:function(){return""},getAddLabel:function(){return getText(this.getAddTitleKey(),this.getEntityConfigLabelSingular())},getEditLabel:function(){return getText(this.getEditTitleKey(),this.getEntityConfigLabelSingular())},getCopyLabel:function(){return getText(this.getCopyTitleKey(),this.getEntityConfigLabelSingular())},getDeleteLabel:function(){return getText(this.getDeleteTitleKey(),this.getEntityConfigLabelSingular())},getDeleteEntityMessage:function(a,b){return getText(a,
this.getEntityConfigLabelSingular())},getDesignLabel:function(){return getText("common.lbl.configure",this.getEntityConfigLabelSingular())},getImportLabel:function(){return getText("common.lbl.import",this.getEntityConfigLabelPlural())},getExportLabel:function(){return getText("common.lbl.export",this.getEntityConfigLabelPlural())},isDisabledAddAction:function(){return!1},isDisabledImportAction:function(){return!1},initActions:function(){this.callParent();this.actionApply=this.createLocalizedAction(getText("common.btn.apply"),
"apply",this.onApply,this.getTitle("common.lbl.apply"),!0);this.actionAdd=this.createLocalizedAction(this.getAddLabel(),this.getAddIconCls(),this.onAdd,this.getAddLabel(),this.isDisabledAddAction());this.actionEdit=this.createLocalizedAction(getText(this.getEditButtonKey()),this.getEditIconCls(),this.onEdit,this.getEditLabel(),!0);this.actionCopy=this.createLocalizedAction(getText(this.getCopyButtonKey()),this.getCopyIconCls(),this.onCopy,this.getCopyLabel(),!0);this.actionDelete=this.createLocalizedAction(getText(this.getDeleteButtonKey()),
this.getDeleteIconCls(),this.onDelete,this.getDeleteLabel(),!0);this.actionDesign=this.createLocalizedAction(getText("common.btn.config"),"btnConfig",this.onConfig,this.getDesignLabel(),!0);this.actionImport=this.createLocalizedAction(getText("common.btn.import"),"import",this.onImport,this.getImportLabel(),this.isDisabledImportAction());this.actionExport=this.createLocalizedAction(getText("common.btn.export"),"export",this.onExport,this.getExportLabel(),!0)},getToolbarActions:function(){return[this.actionApply,
this.actionReset,{xtype:"tbspacer",width:45,disabled:!0},this.actionAdd,this.actionEdit,this.actionCopy,this.actionDelete,this.actionDesign,this.actionImport,this.actionExport]},getContextMenuActions:function(a,b,c){return c?this.getTreeContextMenuActions(a,b):this.getGridContextMenuActions(a,b)},getGridContextMenuActions:function(a,b){if(b){var c=this.getSingleSelectedRecord(!0);return null!=c&&c.isLeaf()?[this.actionApply,this.actionEdit,this.actionCopy,this.actionDelete,this.actionDesign]:[this.actionEdit,
this.actionCopy,this.actionDelete,this.actionDesign]}return[this.actionDelete]},saveAssignment:function(a,b){Ext.Ajax.request({url:this.baseAction+"!save.action",params:{assignedID:a,node:b},scope:this,disableCaching:!0,success:function(a){a=Ext.decode(a.responseText);!0==a.success?this.refreshAfterSaveSuccess(a):com.trackplus.util.showError(a)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)},method:"POST"})},treeNodeSelect:function(a,b,c){a=this.grid.getStore().getById(b.data.assignedID);
null!=a&&this.selectGridRow(a);this.getToolbarActionChangesForTreeNodeSelect(b)},isAssignable:function(a){return!1},dragAndDropOnTree:!1,initTree:function(){this.callParent(arguments);this.initMyListeners()},initMyListeners:function(){var a=this;a.tree.view.addListener("afterrender",a.onTreeViewAfterRenderer,a);a.tree.view.addListener("beforedrop",function(a,c,e,f,g){return this.isAssignable(e)},a);a.tree.getView().addListener("drop",function(b,c,e,f,g){a.onDropTreeNode.call(a,b,c,e,f,g);return!0})},
onTreeViewAfterRenderer:function(){this.dropZone=Ext.create("com.trackplus.util.TreeDropZone",{view:this.tree.view,ddGroup:this.baseAction,isValidNode:function(a){return this.isAssignable(a)},isValidNodeScope:this})},onDropTreeNode:function(a,b,c){a=b.records[0].data.id;c=c.data.id;null!=a&&null!=c&&this.saveAssignment(a,c);return!0},getGridFields:function(){return[{name:"id",type:"int"},{name:"name",type:"string"},{name:"tagLabel",type:"string"},{name:"description",type:"string"},{name:"owner",type:"string"}]},
getGridColumns:function(){return[{header:getText("common.lbl.name"),flex:1,dataIndex:"name",id:"name",sortable:!0,filterable:!0},{header:getText("common.lbl.tagLabel"),flex:1,dataIndex:"tagLabel",id:"tagLabel",sortable:!0,filter:{}},{header:getText("common.lbl.description"),flex:1,dataIndex:"description",id:"description",sortable:!0,filterable:!1},{header:getText("admin.customize.form.config.owner"),flex:1,dataIndex:"owner",id:"owner",sortable:!0,filterable:!1}]},getSelectedObjectIDs:function(){var a=
[],b=this.getSelection();null!=b&&Ext.Array.forEach(b,function(b,e,f){a.push(b.data.id)},this);return a.join(",")},getGridListURL:function(){return""},getGridRowEditURL:function(){return""},getGridRowSaveURL:function(){return""},getConfigGridRowURL:function(){return""},getImportURL:function(){return""},getExportURL:function(a){return""},showGrid:function(){var a=this.baseAction+"GridModel";Ext.define(a,{extend:"Ext.data.Model",fields:this.getGridFields(),idProperty:"id"});a={xtype:"grid",store:Ext.create("Ext.data.Store",
{proxy:{type:"ajax",url:this.getGridListURL(),reader:{type:"json"}},model:a,autoLoad:!0}),selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"MULTI"}),columns:this.getGridColumns(),autoWidth:!0,border:!1,bodyBorder:!1,cls:"gridNoBorder",stripeRows:!0,features:[{ftype:"filters",encode:!1,local:!0,filters:[{type:"string",dataIndex:"tagLabel",disabled:!1},{type:"string",dataIndex:"name",disabled:!1}]}]};a.viewConfig={plugins:{ptype:"gridviewdragdrop",ddGroup:this.baseAction,enableDrag:!0,enableDrop:!1}};
var b={selectionchange:{fn:this.onGridSelectionChange,scope:this}};b.itemcontextmenu={fn:this.onGridRowCtxMenu,scope:this};b.itemdblclick={fn:this.onEdit,scope:this};a.listeners=b;this.grid=Ext.create("Ext.grid.Panel",a);this.centerPanel.add(this.grid)},onGridSelectionChange:function(a,b){this.enableDisableToolbarButtons(a,b);var c=null;null!=b&&0<b.length&&(c=b[0]);this.adjustToolbarButtonsTooltip(c,!1)},onGridRowCtxMenu:function(a,b,c,e,f){this.onCtxMenu(!1,b,f);return!1},enableDisableToolbarButtons:function(a,
b){if(null==b||0==b.length)this.actionEdit.setDisabled(!0),this.actionApply.setDisabled(!0),this.actionCopy.setDisabled(!0),this.actionDelete.setDisabled(!0),this.actionDesign.setDisabled(!0),this.actionExport.setDisabled(!0);else if(this.actionDelete.setDisabled(!1),this.actionExport.setDisabled(!1),1==b.length){var c=this.getSingleSelectedRecord(!0);null!=c&&this.isAssignable(c)&&this.actionApply.setDisabled(!1);this.actionEdit.setDisabled(!1);this.actionCopy.setDisabled(!1);this.actionDesign.setDisabled(!1)}else this.actionApply.setDisabled(!0),
this.actionEdit.setDisabled(!0),this.actionCopy.setDisabled(!0),this.actionDesign.setDisabled(!0)},getReloadParamsFromResult:function(){return[{parameterName:"rowToSelect",fieldNameFromResult:"id"}]},onApply:function(){var a=this.getSingleSelectedRecord(!0),b=this.getSingleSelectedRecord(!1);null!=a&&null!=b&&this.saveAssignment(b.data.id,a.data.id)},onAdd:function(){var a=this.getAddLabel(),b=this.getReloadParamsFromResult();return this.onAddEdit(a,!0,null,null,b)},onEdit:function(){var a=this.getEditLabel(),
b=this.getEditParams(!1),c=this.getEditParams(!1),e=this.getReloadParamsFromResult();return this.onAddEdit(a,!1,b,c,e)},onCopy:function(){var a=this.getCopyLabel(),b=this.getEditParams(!0),c=this.getEditParams(!0),e=this.getReloadParamsFromResult();return this.onAddEdit(a,!1,b,c,e)},getObjectIDName:function(){return"objectID"},getEditParams:function(a){a={copy:a};var b=this.getSingleSelectedRecordData(!1);null!=b&&(b=b.id,null!=b&&(a[this.getObjectIDName()]=b));return a},onAddEdit:function(a,b,c,
e,f){b={loadUrl:this.getGridRowEditURL(),loadUrlParams:c};e={submitUrl:this.getGridRowSaveURL(),submitUrlParams:e,submitButtonText:getText("common.btn.save"),refreshAfterSubmitHandler:com.trackplus.util.RefreshAfterSubmit.refreshGridAfterSubmit,refreshParametersAfterSubmit:f};f=this.getPanelItems();Ext.create("com.trackplus.util.WindowConfig",{title:a,width:this.editWidth,height:this.editHeight,load:b,submit:e,items:f}).showWindowByConfig(this)},reload:com.trackplus.util.RefreshAfterSubmit.refreshGridAfterSubmit,
getRecordID:function(a,b){return a.id},onDelete:function(){var a=this.getSelectedRecords(!1);null!=a&&this.deleteHandler(a)},onConfig:function(){var a=this.getSingleSelectedRecordData();if(null==a)return!1;window.location.href=this.getConfigGridRowURL(a.id)},getPanelItems:function(){return[CWHF.createTextField("common.lbl.name","name",{anchor:"100%",allowBlank:!1}),CWHF.createTextField("common.lbl.tagLabel","tagLabel",{anchor:"100%"}),CWHF.createTextAreaField("common.lbl.description","description",
{anchor:"100%"})]},getUploadFileLabel:function(){return null},getImportPanel:function(){return this.formPanel=new Ext.form.FormPanel({region:"center",border:!1,bodyStyle:"padding:5px",defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"side",anchor:"-20"},method:"POST",fileUpload:!0,items:[CWHF.createCheckbox("common.lbl.overwriteExisting","overwriteExisting",{labelWidth:200}),CWHF.createFileField(this.getUploadFileLabel(),"uploadFile",{allowBlank:!1,labelWidth:200})]})},onImport:function(){var a=
[{submitUrl:this.getImportURL(),submitButtonText:getText("common.btn.upload"),validateHandler:Upload.validateUpload,expectedFileType:/^.*\.(xml)$/,refreshAfterSubmitHandler:this.reload}],a={title:getText("common.lbl.upload",this.getEntityConfigLabelPlural()),width:550,height:150,submit:a,formPanel:this.getImportPanel(),cancelButtonText:getText("common.btn.done")};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},onExport:function(){var a=this.getSelectedObjectIDs();attachmentURI=
this.getExportURL(a);window.open(attachmentURI)},refreshAfterSaveSuccess:function(a){var b=a.refreshTree;a=a.node;var c=this.tree.getStore().getNodeById(a),e=null;null!=c&&(e=c.parentNode);b&&this.refreshTreeOpenBranches(this.tree.getRootNode(),!1,!1,e,a)}});
Ext.define("com.trackplus.admin.customize.treeConfig.ScreenConfig",{extend:"com.trackplus.admin.customize.treeConfig.AssignmentConfig",config:{rootID:""},baseAction:"screenConfigItemDetail",editWidth:500,editHeight:350,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},getToolbarActions:function(){this.actionImport.setDisabled(!com.trackplus.TrackplusConfig.user.sys);return[this.actionApply,this.actionReset,{xtype:"tbspacer",width:45,disabled:!0},this.actionEdit,this.actionDesign,
this.actionImport,this.actionExport]},enableDisableToolbarButtons:function(a,b){var c=com.trackplus.TrackplusConfig.user.sys;if(null==b||0==b.length)this.actionEdit.setDisabled(!0),this.actionApply.setDisabled(!0),this.actionDesign.setDisabled(!0),this.actionExport.setDisabled(!0);else if(this.actionExport.setDisabled(!c),1==b.length){var e=this.getSingleSelectedRecord(!0);null!=e&&this.isAssignable(e)&&this.actionApply.setDisabled(!1);this.actionEdit.setDisabled(!c);this.actionDesign.setDisabled(!c)}else this.actionApply.setDisabled(!0),
this.actionEdit.setDisabled(!0),this.actionDesign.setDisabled(!0)},getGridContextMenuActions:function(a,b){var c=com.trackplus.TrackplusConfig.user.sys;if(b){var e=this.getSingleSelectedRecord(!0);return null!=e&&e.isLeaf()?c?c=[this.actionApply,this.actionEdit,this.actionDesign]:[this.actionApply]:c?c=[this.actionEdit,this.actionDesign]:[]}return c?c=[]:[]},getRootMessage:function(a){return getText("admin.customize.form.config.lbl.description")},getEntityLabel:function(){return getText("admin.customize.form.config.lbl.formAssignment")},
getEntityConfigLabelSingular:function(){return getText("admin.customize.form.config.lbl.form")},getEntityConfigLabelPlural:function(){return getText("admin.customize.form.config.lbl.forms")},getToolbarActionChangesForTreeNodeSelect:function(a){if(null!=a){var b=a.data.defaultConfig;this.actionReset.setDisabled(a.data.inheritedConfig||b);this.actionApply.setDisabled(!this.isAssignable(a))}},isAssignable:function(a){return a.isLeaf()},getTreeContextMenuActions:function(a,b){var c=[];if(b){var e=a.data.inheritedConfig,
f=a.data.defaultConfig,g=a.isLeaf(),h=this.getSingleSelectedRecord(!0);e||f||null==h||!this.isAssignable(h)||c.push(this.actionReset);g||c.push(this.actionReload)}return c},getGridListURL:function(){return"indexScreens.action"},getGridRowEditURL:function(){return"indexScreens!edit.action"},getGridRowSaveURL:function(){return"indexScreens!save.action"},getObjectIDName:function(){return"screenID"},getImportURL:function(){return this.baseAction+"!importScreens.action"},getExportURL:function(a){return this.baseAction+
"!export.action?selectedObjectIDs\x3d"+a},getDeleteUrlBase:function(a){return"indexScreens"},getConfigGridRowURL:function(a){return"screenEdit.action?componentID\x3d"+a},getDeleteParamName:function(){return"selectedScreenIDs"},getPanelItems:function(){return[CWHF.createTextField("common.lbl.name","name",{anchor:"100%",allowBlank:!1,labelWidth:this.labelWidth,width:this.textFieldWidth}),CWHF.createTextField("common.lbl.tagLabel","tagLabel",{anchor:"100%",labelWidth:this.labelWidth,width:this.textFieldWidth}),
CWHF.createTextAreaField("common.lbl.description","description",{anchor:"100%",labelWidth:this.labelWidth,width:this.textFieldWidth})]},getUploadFileLabel:function(){return"admin.customize.form.import.lbl.uploadFile"},onImport:function(){var a=[{submitUrl:this.baseAction+"!importScreens.action",submitButtonText:getText("common.btn.upload"),validateHandler:Upload.validateUpload,expectedFileType:/^.*\.(xml)$/,refreshAfterSubmitHandler:this.reload}],a={title:getText("common.lbl.upload",this.getEntityConfigLabelPlural()),
width:550,height:150,submit:a,formPanel:this.getImportPanel(),cancelButtonText:getText("common.btn.done")};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},onExport:function(){attachmentURI=this.baseAction+"!export.action?selectedScreenIDs\x3d"+this.getSelectedScreenIDs();window.open(attachmentURI)},getSelectedScreenIDs:function(){var a=[],b=this.getSelection();null!=b&&Ext.Array.forEach(b,function(b,e,f){a.push(b.data.id)},this);return a.join(",")}});
Ext.define("com.trackplus.admin.customize.userLevel.userLevelConfig",{extend:"com.trackplus.admin.TreeWithGrid",config:{rootID:""},confirmDeleteEntity:!0,gridHasItemdblclick:!1,baseAction:"userLevel",entityID:"node",editWidth:400,editHeight:200,getRootMessage:function(){return getText("admin.customize.userLevel.lbl.description")},getEntityLabel:function(a){return getText("admin.customize.userLevel.lbl.userLevel")},initActions:function(){this.actionAdd=this.createAction(this.getAddButtonKey(),this.getAddIconCls(),
this.onAddLeaf,!1,this.getAddTitleKey());this.actionEdit=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEditTreeNode,!0,this.getEditTitleKey());this.actionDelete=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromTree,!0,this.getDeleteTitleKey());this.actions=[this.actionAdd,this.actionEdit,this.actionDelete]},getToolbarActions:function(){return com.trackplus.TrackplusConfig.user.sys?[this.actionAdd,this.actionEdit,this.actionDelete]:[]},onTreeNodeDblClick:function(a,
b){return com.trackplus.TrackplusConfig.user.sys?this.callParent(arguments):[]},getTreeFields:function(){return[{name:"id",type:"string"},{name:"text",type:"string"},{name:"iconCls",type:"string"},{name:"leaf",type:"boolean"}]},getGridFields:function(a){return[{name:"id",type:"string"},{name:"path",type:"string"},{name:"name",type:"string"},{name:"selected",type:"boolean"}]},getGridColumns:function(a){return[{header:getText("admin.customize.userLevel.lbl.path"),flex:1,dataIndex:"path",sortable:!0},
{header:getText("common.lbl.name"),flex:1,dataIndex:"name",sortable:!0},{header:getText("admin.customize.userLevel.lbl.selected"),flex:1,dataIndex:"selected",sortable:!0,xtype:"checkcolumn",listeners:{checkchange:{fn:this.onCheckChange,scope:this},beforecheckchange:{fn:this.onBeforeCheckChange,scope:this}}}]},onCheckChange:function(a,b,c,e){a=this.grid.getStore().getAt(b);null!=a&&Ext.Ajax.request({url:this.baseAction+"!changeAction.action",params:{actionID:a.data.id,node:this.selectedNodeID,checked:c},
scope:this,success:function(a){a=Ext.decode(a.responseText);a.success||com.trackplus.util.showError(a)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},onBeforeCheckChange:function(a,b,c,e){return com.trackplus.TrackplusConfig.user.sys?!0:!1},getGridViewConfig:function(){return{forceFit:!0,markDirty:!1}},getEditLeafPanelItems:function(){return[CWHF.createTextField("common.lbl.name","name",{labelWidth:100}),CWHF.createTextAreaField("common.lbl.description","description",
{labelWidth:100})]},getToolbarActionChangesForTreeNodeSelect:function(a){this.actionEdit.setDisabled(!1);this.actionDelete.setDisabled(!1)},getAddReloadParamsAfterSave:function(a){return{nodeIDToReload:this.rootID}},reload:com.trackplus.util.RefreshAfterSubmit.refreshSimpleTree,getReloadParamsAfterDelete:function(a,b,c){return{reloadTree:!0}},getAddSelectionAfterSaveFromResult:function(){return[{parameterName:"node",fieldNameFromResult:"node"},{parameterName:"reloadTree",fieldNameFromResult:"reloadTree"}]},
getEditReloadParamsAfterSaveFromResult:function(a){return[{parameterName:"node",fieldNameFromResult:"node"},{parameterName:"reloadTree",fieldNameFromResult:"reloadTree"}]}});
Ext.define("com.trackplus.admin.customize.list.ListConfig",{extend:"com.trackplus.admin.TreeWithGrid",config:{rootID:"",fromProjectConfig:!1},confirmDeleteEntity:!0,baseAction:"listOptions",entityID:"node",dragAndDropOnTree:!0,customListWindowWidth:500,customListWindowHeight:300,labelWidth:180,listOptionWindowWidth:450,listOptionWindowHeight:390,replaceToolbarOnTreeNodeSelect:!0,actionChildIssueTypeAssignmentFromGrid:null,actionChildIssueTypeAssignmentFromTree:null,actionUploadFromGrid:null,actionUploadFromTree:null,
actionDownloadFromGrid:null,actionDownloadFromTree:null,actionMoveUp:null,actionMoveDown:null,actionImport:null,actionExportFromGrid:null,actionExportFromTree:null,localizedLabels:null,uploadWindowWidth:550,uploadWindowHeight:180,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},isProjectSpecificRoot:function(a){return this.fromProjectConfig&&a.id==this.rootID},init:function(){this.initLocalizedLabels()},initLocalizedLabels:function(){Ext.Ajax.request({fromCenterPanel:!0,
url:"listOptionsLocalize.action",scope:this,success:function(a){a=Ext.decode(a.responseText);this.localizedLabels={};Ext.each(a.records,function(a){this.localizedLabels[a.id]=a.label},this);this.initActions()},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},getEditWidth:function(a,b,c,e,f){return this.isListOperation(a,b,c,e,f)?this.customListWindowWidth:this.listOptionWindowWidth},getEditHeight:function(a,b,c,e,f){return this.isListOperation(a,b,c,e,f)?this.customListWindowHeight:
this.listOptionWindowHeight},isListOperation:function(a,b,c,e,f){return!this.isProjectSpecificRoot(a)&&(-20!=this.selectedNode.data.nodeChildrenListForLabel&&-21!=this.selectedNode.data.nodeChildrenListForLabel||"add"!=f&&("edit"!=f&&"copy"!=f||e))&&("edit"!=f&&"copy"!=f||!e||null!=a.optionID&&0!=a.optionID)?!1:!0},getRootMessage:function(a){return getText("admin.customize.list.lbl.description")},getEntityLabel:function(a){var b=a.tooltipKey;if(null==b||"common.lbl.upload"!=b&&"common.lbl.download"!=
b){var c=null,c=!1;null!=a&&(c=a.fromTree);a=this.getLastSelected(c);c=null!=a?c?null==b||b!=this.actionAdd.initialConfig.tooltipKey&&b!=this.actionImport.initialConfig.tooltipKey?a.data.nodeListForLabel:a.data.nodeChildrenListForLabel:a.data.rowListForLabel:-21;if(null!=c)return this.localizedLabels[c]}else return getText("admin.customize.list.lbl.iconOp");return""},initActions:function(){this.actionAdd=this.createAction(this.getAddButtonKey(),this.getAddFolderIconCls(),this.onAdd,!0,this.getAddTitleKey(),
"add");this.actionEditGridRow=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEditGridRow,!0,this.getEditTitleKey(),"editGridRow");this.actionEditTreeNode=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEditTreeNode,!1,this.getEditTitleKey(),"editTreeNode");this.actionCopyGridRow=this.createAction(this.getCopyButtonKey(),this.getCopyIconCls(),this.onCopyGridRow,!0,this.getCopyTitleKey(),"copyGridRow");this.actionCopyTreeNode=this.createAction(this.getCopyButtonKey(),
this.getCopyIconCls(),this.onCopyTreeNode,!1,this.getCopyTitleKey(),"copyTreeNode");this.actionDeleteGridRow=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromGrid,!0,this.getDeleteTitleKey(),"deleteGridRow");this.actionDeleteTreeNode=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromTree,!1,this.getDeleteTitleKey(),"deleteTreeNode");this.actionChildIssueTypeAssignmentFromGrid=this.createAction("admin.customize.list.button.filterByChildIssueType",
"itemAction_addChild",this.onChildIssueTypeAssignmentGrid,!0,"admin.customize.list.button.filterByChildIssueType.tt");this.actionChildIssueTypeAssignmentFromTree=this.createAction("admin.customize.list.button.filterByChildIssueType","itemAction_addChild",this.onChildIssueTypeAssignmentTree,!1,"admin.customize.list.button.filterByChildIssueType.tt");this.actionUploadFromGrid=this.createAction("common.btn.upload","upload",this.createUploadFormFromGrid,!1,"common.lbl.upload","uploadIconGridRow");this.actionUploadFromTree=
this.createAction("common.btn.upload","upload",this.createUploadFormFromTree,!0,"common.lbl.upload","uploadIconTreeNode");this.actionDownloadFromGrid=this.createAction("common.btn.download","download",this.downloadIconFromGrid,!1,"common.lbl.download","downloadIconGridRow");this.actionDownloadFromTree=this.createAction("common.btn.download","download",this.downloadIconFromTree,!0,"common.lbl.download","downloadIconTreeNode");this.actionMoveUp=this.createAction("common.btn.up","moveUp",this.onMoveUpGridRow,
!1,"common.lbl.up","moveUp");this.actionMoveDown=this.createAction("common.btn.down","moveDown",this.onMoveDownGridRow,!1,"common.lbl.down","moveDown");this.actionImport=this.createAction("common.btn.import","import",this.onImport,!1,"common.lbl.import","importList");this.actionExportGridRow=this.createAction("common.btn.export","export",this.onExportGridRow,!0,"common.lbl.export","exportGridRow");this.actionExportTreeNode=this.createAction("common.btn.export","export",this.onExportTreeNode,!1,"common.lbl.export",
"exportTreeNode")},getToolbarActions:function(){return[]},getToolbarActionsForTreeNodeSelect:function(a){if(null==a)return[];var b=[],c=a.isLeaf(),e=!1,f=!1,g=!1,h=!1;this.isProjectSpecificRoot(a.data)?h=f=e=g=!0:(g=a.data.canAddChild,e=a.data.mightEditChild||c&&a.parentNode.data.mightEditChild,f=a.data.mightDeleteChild||c&&a.parentNode.data.mightDeleteChild,h=a.data.mightCopyChild);var c=a.data.hasChildFilter,k=a.data.childrenHaveIcon;g&&(b.push(this.actionAdd),this.actionAdd.setDisabled(!1));h&&
(b.push(this.actionCopyGridRow),this.actionCopyGridRow.setDisabled(!0));e&&(b.push(this.actionEditGridRow),this.actionEditGridRow.setDisabled(!0));f&&(b.push(this.actionDeleteGridRow),this.actionDeleteGridRow.setDisabled(!0));f=null;g&&(f=a.data.childListID,null!=f&&0!=f||b.push(this.actionImport));h&&(b.push(this.actionExportGridRow),this.actionExportGridRow.setDisabled(!0));c&&(b.push(this.actionChildIssueTypeAssignmentFromGrid),this.actionChildIssueTypeAssignmentFromGrid.setDisabled(!0));k&&(e&&
b.push(this.actionUploadFromGrid),b.push(this.actionDownloadFromGrid),this.actionUploadFromGrid.setDisabled(!0),this.actionDownloadFromGrid.setDisabled(!0));null!=f&&0!=f&&e&&(b.push(this.actionMoveUp),b.push(this.actionMoveDown),this.actionMoveUp.setDisabled(!0),this.actionMoveDown.setDisabled(!0));return b},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"topParentList",mapping:"topParentList",type:"int"},{name:"type",mapping:"type",
type:"int"},{name:"childListID",mapping:"childListID",type:"int"},{name:"optionID",mapping:"optionID",type:"int"},{name:"canEdit",mapping:"canEdit",type:"boolean"},{name:"mightEditChild",mapping:"mightEditChild",type:"boolean"},{name:"canDelete",mapping:"canDelete",type:"boolean"},{name:"mightDeleteChild",mapping:"mightDeleteChild",type:"boolean"},{name:"nodeListForLabel",mapping:"nodeListForLabel",type:"int"},{name:"canAddChild",mapping:"canAddChild",type:"boolean"},{name:"canCopy",mapping:"canCopy",
type:"boolean"},{name:"mightCopyChild",mapping:"mightCopyChild",type:"boolean"},{name:"nodeChildrenListForLabel",mapping:"nodeChildrenListForLabel",type:"int"},{name:"icon",mapping:"icon",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"hasTypeflag",mapping:"hasTypeflag",type:"boolean"},{name:"childrenHaveTypeflag",mapping:"childrenHaveTypeflag",type:"boolean"},{name:"disableTypeflag",mapping:"disableTypeflag",type:"boolean"},{name:"hasIcon",mapping:"hasIcon",type:"boolean"},{name:"childrenHaveIcon",
mapping:"childrenHaveIcon",type:"boolean"},{name:"hasCssStyle",mapping:"hasCssStyle",type:"boolean"},{name:"childrenHaveCssStyle",mapping:"childrenHaveCssStyle",type:"boolean"},{name:"hasChildFilter",mapping:"hasChildFilter",type:"boolean"},{name:"hasPercentComplete",mapping:"hasPercentComplete",type:"boolean"},{name:"childrenHavePercentComplete",mapping:"childrenHavePercentComplete",type:"boolean"},{name:"hasDefaultOption",mapping:"hasDefaultOption",type:"boolean"},{name:"childrenHaveDefaultOption",
mapping:"childrenHaveDefaultOption",type:"boolean"}]},getTreeExpandExtraParams:function(){return{fromProjectConfig:this.fromProjectConfig}},onChildIssueTypeAssignmentGrid:function(){var a=this.getSingleSelectedRecordData(!1);if(null!=a)this.onChildIssueTypeAssignment(a.node,a)},onChildIssueTypeAssignmentTree:function(){this.onChildIssueTypeAssignment(this.selectedNodeID,this.selectedNode)},onChildIssueTypeAssignment:function(a,b){this.childIssueTypeAssignment=Ext.create("com.trackplus.admin.SimpleAssignment",
{baseAction:"childIssueTypeAssignments",objectID:a,objectIDParamName:"parentIssueTypeNodeID",dynamicIcons:!0});var c=Ext.create("Ext.window.Window",{height:450,width:500,title:getText("admin.customize.list.button.filterByChildIssueType"),autoScroll:!0,border:!1,buttons:[{text:getText("common.btn.done"),handler:function(){c.close()}}],layout:"fit",items:[this.childIssueTypeAssignment.getDetailPanel(b)]}).show()},downloadIconFromGrid:function(){var a=this.getSingleSelectedRecordData(!1);null!=a&&this.downloadIcon(a.node)},
downloadIconFromTree:function(){this.downloadIcon(this.selectedNodeID)},downloadIcon:function(a){attachmentURI="listOptionIcon!download.action?node\x3d"+a;window.open(attachmentURI)},createUploadFormFromGrid:function(){var a=this.getSingleSelectedRecord(!1);null!=a&&this.createUploadForm(!1,a)},createUploadFormFromTree:function(){this.createUploadForm(!0,this.selectedNode)},createUploadForm:function(a,b){var c=this.uploadWindowWidth,e=this.uploadWindowHeight,f={loadUrl:"listOptionIcon.action",loadUrlParams:this.getEditParams(a)},
g=this.getEditParams(a),g=[{submitUrl:"listOptionIcon!upload.action",submitUrlParams:g,disabled:!0,submitButtonText:getText("common.btn.upload"),submitHandler:this.uploadFileHandler},{submitUrl:"listOptionIcon!delete.action",submitUrlParams:g,submitButtonText:getText("common.btn.delete"),submitHandler:this.deleteUploadedFileHandler}],h=this.renderUploadPostDataProcess,c={title:getText("common.lbl.upload",getText("admin.customize.list.lbl.icon")),width:c,height:e,load:f,submit:g,formPanel:this.getFormPanel(),
postDataProcess:h,cancelButtonText:getText("common.btn.done"),refreshAfterCancel:!0,extraConfig:{fromTree:a}};Ext.create("com.trackplus.util.WindowConfig",c).showWindowByConfig(this)},getReloadParamsAfterUpload:function(a){if(null!=this.selectedNode)if(a){var b=this.selectedNode.parentNode;if(null!=b)return{nodeIDToReload:b.data.id,nodeIDToSelect:this.selectedNode.data.id,rowToSelect:this.selectedNode.data.id}}else if(a=this.getLastSelected(a),this.getShowGridForLeaf()&&this.selectedNode.isLeaf()){if(b=
this.selectedNode.parentNode,null!=b)return b={nodeIDToReload:b.data.id,nodeIDToSelect:this.selectedNode.data.id},null!=a&&(b.rowToSelect=a.data.node),b}else return b={nodeIDToReload:this.selectedNode.data.id},null!=a&&(b.rowToSelect=a.data.node),b;return null},validateFileExtension:function(a){return/^.*\.(jpg|JPG|png|PNG|gif|GIF)$/.test(a)},getFormPanel:function(a,b){var c=Ext.create("Ext.Img",{src:Ext.BLANK_IMAGE_URL,width:16,height:16,itemId:"actualIcon"}),c=[Ext.create("Ext.form.FieldContainer",
{combineErrors:!0,itemId:"iconPanel",fieldLabel:getText("admin.customize.list.lbl.icon"),labelWidth:this.labelWidth,labelAlign:"right",labelStyle:{overflow:"hidden"},layout:"hbox",items:[c]}),CWHF.createLabelComponent("admin.customize.list.lbl.iconName","actualIconName",{labelWidth:this.labelWidth}),CWHF.createFileField("admin.customize.list.lbl.newIcon","iconFile",{allowBlank:!1,labelWidth:this.labelWidth},{change:{fn:this.newIconFileChanged,scope:this}})];return Ext.create("Ext.form.Panel",{bodyStyle:"padding:5px",
url:"listOptionIcon!upload.action",defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"side",anchor:"-20"},method:"POST",fileUpload:!0,items:c})},newIconFileChanged:function(){var a=this.win.getDockedItems("toolbar[dock\x3d'bottom']");null!=a&&a[0].getComponent(0).setDisabled(!1)},renderUploadPostDataProcess:function(a,b,c){c=b.getComponent("iconPanel").getComponent("actualIcon");null!=c&&c.setSrc(a.icon);actualIconName=b.getComponent("actualIconName");null!=actualIconName&&actualIconName.setValue(a.iconName);
b.getComponent("iconFile").setValue("");b=this.win.getDockedItems("toolbar[dock\x3d'bottom']");null!=b&&(b[0].getComponent(0).setDisabled(!0),b[0].getComponent(1).setDisabled(null==a.iconName||""==a.iconName))},uploadFileHandler:function(a,b,c,e){a=this.formEdit.getForm();if(a.isValid())if(b=this.formEdit.getComponent("iconFile"),this.validateFileExtension(b.getRawValue())){var f=!1;null!=e&&(f=e.fromTree);a.submit({scope:this,params:c,success:function(a,b){this.renderUploadPostDataProcess(b.result.data,
this.formEdit,f);this.reload.call(this,this.getReloadParamsAfterUpload(f))},failure:function(a,b){com.trackplus.util.submitFailureHandler(a,b)}})}else Ext.MessageBox.alert(getText("admin.customize.list.title.upload",this.getEntityLabel({fromTree:!1})),getText("admin.customize.list.lbl.iconFileWrongType"));else Ext.MessageBox.alert(getText("admin.customize.list.title.upload",this.getEntityLabel({fromTree:!1})),getText("admin.customize.list.lbl.iconFileNotSpecified"))},deleteUploadedFileHandler:function(a,
b,c,e){var f=this.formEdit,g=!1;null!=e&&(g=e.fromTree);Ext.Ajax.request({url:b,scope:this,params:c,success:function(a){a=Ext.decode(a.responseText);this.renderUploadPostDataProcess(a.data,f,g);this.reload.call(this,this.getReloadParamsAfterUpload(g))}})},getGridViewConfig:function(a){return this.hasDragAndDropOnGrid(a)?{plugins:{ptype:"gridviewdragdrop",dragGroup:this.baseAction+"gridDDGroup",dropGroup:this.baseAction+"gridDDGroup",enableDrag:!0,enableDrop:!0},listeners:{drop:{scope:this,fn:function(a,
c,e,f){this.onGridDrop(a,c,e,f)}}},markDirty:!1}:null},getListFields:function(){return[{name:"id",type:"int"},{name:"label",type:"string"},{name:"canEdit",type:"boolean"},{name:"canCopy",type:"boolean"},{name:"canDelete",type:"boolean"},{name:"rowListForLabel",type:"int"},{name:"iconCls",type:"string"},{name:"leaf",type:"boolean"},{name:"node",type:"string"}]},getListOptionFields:function(){return[{name:"id",type:"int"},{name:"label",type:"string"},{name:"canEdit",type:"boolean"},{name:"canDelete",
type:"boolean"},{name:"rowListForLabel",type:"int"},{name:"hasTypeflag",type:"boolean"},{name:"disableTypeflag",type:"boolean"},{name:"typeflagLabel",type:"string"},{name:"hasIcon",type:"boolean"},{name:"iconName",type:"string"},{name:"icon",type:"string"},{name:"hasCssStyle",type:"boolean"},{name:"cssStyle",type:"string"},{name:"hasChildFilter",type:"boolean"},{name:"hasPercentComplete",type:"boolean"},{name:"percentComplete",type:"int",useNull:!0},{name:"hasDefaultOption",type:"boolean"},{name:"defaultOption",
type:"boolean"},{name:"leaf",type:"boolean"},{name:"node",type:"string"}]},getListColumns:function(){return[{header:getText("admin.customize.list.lbl.icon"),width:60,dataIndex:"iconCls",sortable:!1,hidden:!1,renderer:function(a,b,c){return'\x3cdiv style\x3d"width:16px;height:16px" class\x3d"'+a+'"\x3e\x26nbsp;\x3c/div\x3e'}},{header:getText("common.lbl.name"),flex:1,dataIndex:"label",sortable:!1,hidden:!1}]},getListOptionColumns:function(a){var b=[{header:getText("common.lbl.name"),flex:1,dataIndex:"label",
sortable:!1,hidden:!1}],c,e,f,g;a.isLeaf()?(c=a.data.hasIcon,e=a.data.hasTypeflag,f=a.data.hasCssStyle,g=a.data.hasPercentComplete,a=a.data.hasDefaultOption):(c=a.data.childrenHaveIcon,e=a.data.childrenHaveTypeflag,f=a.data.childrenHaveCssStyle,g=a.data.childrenHavePercentComplete,a=a.data.childrenHaveDefaultOption);c&&(b.push({header:getText("admin.customize.list.lbl.icon"),width:60,dataIndex:"icon",sortable:!1,hidden:!1,renderer:function(a){return null!=a&&""!=a?'\x3cimg src\x3d"'+a+'"/\x3e':""}}),
b.push({header:getText("admin.customize.list.lbl.iconName"),width:100,dataIndex:"iconName",sortable:!1,hidden:!1}));f&&(c=Ext.create("Ext.grid.column.Column",{header:getText("admin.customize.list.lbl.style"),width:100,dataIndex:"cssStyle",sortable:!1,hidden:!1}),c.renderer=function(a,b){b.style=a;return"Test text"},b.push(c));g&&b.push({header:getText("admin.customize.list.lbl.percentComplete"),width:100,dataIndex:"percentComplete",sortable:!1,hidden:!1});e&&b.push({header:getText("admin.customize.list.lbl.typeflag"),
width:150,dataIndex:"typeflagLabel",sortable:!1,hidden:!1});a&&b.push({xtype:"checkcolumn",header:getText("admin.customize.list.lbl.defaultOption"),width:100,dataIndex:"defaultOption",sortable:!1,hidden:!1,listeners:{checkchange:{fn:this.changeDefault,scope:this}}});return b},changeDefault:function(a,b,c,e){a=this.grid.getStore().getAt(b);null!=a&&Ext.Ajax.request({url:this.baseAction+"!changeDefault.action",params:{node:a.data.node,defaultOption:c},scope:this,success:function(a){},failure:function(a){Ext.MessageBox.alert(this.failureTitle,
a.responseText)}})},hasDragAndDropOnGrid:function(a){a=a.data.childListID;if(null!=a&&0!=a)return!0},getGridFields:function(a){a=a.data.childListID;return null==a||0==a?this.getListFields():this.getListOptionFields()},getGridColumns:function(a){var b=a.data.childListID;return null==b||0==b?this.getListColumns():this.getListOptionColumns(a)},canDragDropNode:function(a,b,c){b=!1;var e=a.data.topParentList,f=c.data.topParentList;null!=e&&null!=f&&e==f&&(b=!0);return-20!=a.data.nodeListForLabel&&-21!=
a.data.nodeListForLabel&&!b||(!c.data.canAddChild||-20!=c.data.nodeChildrenListForLabel&&-21!=c.data.nodeChildrenListForLabel)&&!b?!1:!0},enableDisableToolbarButtons:function(a,b){var c=b[0];if(null==c)this.actionDeleteGridRow.setDisabled(!0),this.actionEditGridRow.setDisabled(!0),this.actionCopyGridRow.setDisabled(!0),this.actionChildIssueTypeAssignmentFromGrid.setDisabled(!0),this.actionExportGridRow.setDisabled(!0),this.actionUploadFromGrid.setDisabled(!0),this.actionDownloadFromGrid.setDisabled(!0),
this.actionMoveUp.setDisabled(!0),this.actionMoveDown.setDisabled(!0);else{this.actionDeleteGridRow.setDisabled(!c.data.canDelete);var e=c.data.canEdit;this.actionEditGridRow.setDisabled(!e);this.actionChildIssueTypeAssignmentFromGrid.setDisabled(!e);this.actionUploadFromGrid.setDisabled(!e);this.actionMoveDown.setDisabled(!e);this.actionMoveUp.setDisabled(!e);e&&(e=this.grid.getStore(),null!=e&&(this.actionMoveDown.setDisabled(c==e.last()),this.actionMoveUp.setDisabled(c==e.first())));e=c.data.canCopy;
this.actionCopyGridRow.setDisabled(!e);this.actionExportGridRow.setDisabled(!e);this.actionDownloadFromGrid.setDisabled(!(null!=c.data.iconName&&""!=c.data.iconName))}},getCustomListWindowItems:function(a,b,c){a=[CWHF.createTextField("common.lbl.name","label",{disabled:!c,allowBlank:!1,labelWidth:this.labelWidth})];a.push(CWHF.createTextAreaField("common.lbl.description","description",{disabled:!(b||c),labelWidth:this.labelWidth}));return a},getListOptionWindowItems:function(a,b,c,e,f,g,h){a=[CWHF.createTextField("common.lbl.name",
"label",{disabled:!h,allowBlank:!1,labelWidth:this.labelWidth})];b&&a.push(CWHF.createCombo("admin.customize.list.lbl.typeflag","typeflag",{disabled:c||!h,labelWidth:this.labelWidth}));f&&a.push(CWHF.createNumberField("admin.customize.list.lbl.percentComplete","percentComplete",0,0,100,{disabled:!h,labelWidth:this.labelWidth}));g&&a.push(CWHF.createCheckbox("admin.customize.list.lbl.defaultOption","defaultOption",{disabled:!h,labelWidth:this.labelWidth}));e&&a.push({xtype:"fieldset",itemId:"fsStyle",
title:getText("admin.customize.list.lbl.style"),collapsible:!1,defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createColorPicker("admin.customize.list.lbl.style.bgrColor","cssStyleBean.bgrColor",{disabled:!h,labelWidth:this.labelWidth}),CWHF.createColorPicker("admin.customize.list.lbl.style.color","cssStyleBean.color",{disabled:!h,labelWidth:this.labelWidth}),CWHF.createCombo("admin.customize.list.lbl.style.fontWeight","cssStyleBean.fontWeight",{disabled:!h,idType:"string",labelWidth:this.labelWidth}),
CWHF.createCombo("admin.customize.list.lbl.style.fontStyle","cssStyleBean.fontStyle",{disabled:!h,idType:"string",labelWidth:this.labelWidth}),CWHF.createCombo("admin.customize.list.lbl.style.text-decoration","cssStyleBean.textDecoration",{disabled:!h,idType:"string",labelWidth:this.labelWidth})]});return a},postDataLoadCombos:function(a,b){var c=b.getComponent("typeflag");null!=c&&(c.store.loadData(a.typeflagsList),c.setValue(a.typeflag));c=b.getComponent("fsStyle");if(null!=c){var e=c.getComponent("cssStyleBean.fontWeight");
null!=e&&e.store.loadData(a.fontWeightsList);e=c.getComponent("cssStyleBean.fontStyle");null!=e&&e.store.loadData(a.fontStylesList);e=b.getComponent("fsStyle").getComponent("cssStyleBean.textDecoration");null!=e&&e.store.loadData(a.textDecorationsList);e=c.getComponent("cssStyleBean.bgrColor");null!=e&&null!=a["cssStyleBean.bgrColor"]&&e.setFieldStyle("background-color:#"+a["cssStyleBean.bgrColor"]+"; background-image: none;");c=c.getComponent("cssStyleBean.color");null!=c&&null!=a["cssStyleBean.color"]&&
c.setFieldStyle("background-color:#"+a["cssStyleBean.color"]+"; background-image: none;")}},optionPostDataProcess:function(a,b){this.postDataLoadCombos(a,b)},getEditPostDataProcess:function(a,b,c,e,f){var g=null;null!=a&&(g=a.data);return this.isListOperation(g,b,c,e,f)?null:this.optionPostDataProcess},getPanelItems:function(a,b,c,e,f){var g=this.getRecordID(a,{fromTree:e}),h=!1;"add"==f||"copy"==f?h=!0:"edit"==f&&(h=a.canEdit);if(this.isListOperation(a,b,c,e,f))return this.getCustomListWindowItems(g,
c,h);c?(b=a.childrenHaveTypeflag,c=a.disableTypeflag,e=a.childrenHaveCssStyle,f=a.childrenHavePercentComplete,a=a.childrenHaveDefaultOption):(b=a.hasTypeflag,c=a.disableTypeflag,e=a.hasCssStyle,f=a.hasPercentComplete,a=a.hasDefaultOption);return this.getListOptionWindowItems(g,b,c,e,f,a,h)},onAdd:function(){var a=this.getTitle(this.getAddTitleKey(),{fromTree:!0}),b=this.getAddLeafParams(),c=this.getAddLeafParams(),e=this.getAddReloadParamsAfterSave(!0),f=this.getAddSelectionAfterSaveFromResult(),
g=this.getSingleSelectedRecord(!0);null==g&&(g=this.tree.getRootNode());return this.onAddEdit(a,g,"add",!0,!0,!0,b,c,e,f)},getAddLeafParams:function(){return this.getAddParams(!1)},onCopyGridRow:function(){return this.onCopy(!1)},onCopyTreeNode:function(){return this.onCopy(!0)},onCopy:function(a){var b=this.selectedIsLeaf(a),c=this.getTitle(this.getCopyTitleKey(),{fromTree:a}),e=this.getEditParams(a);e.copy=!0;var f=this.getEditParams(a);f.copy=!0;var g=this.getCopyReloadParamsAfterSave(a),h=this.getEditReloadParamsAfterSaveFromResult(a),
k=this.getSingleSelectedRecord(a);return this.onAddEdit(c,k,"copy",b,!1,a,e,f,g,h)},getCopyReloadParamsAfterSave:function(a){return a&&null!=this.selectedNode&&(a=this.selectedNode.parentNode,null!=a)?{nodeIDToReload:a.data.id}:null},getReloadParamsAfterDelete:function(a,b,c){if(null!=a&&null!=a){var e=null,f=null,g=null;if(null!=b){if(fromTree=b.fromTree)return e=a.parentNode,null!=e&&(g=e.data.id),c.lastCascadingChildDeleted&&null!=e&&(f=e.parentNode,g=c.node),a=null,a=null!=f?f.data.id:g,{nodeIDToReload:a,
nodeIDToSelect:g};if(c.lastCascadingChildDeleted&&null!=this.selectedNode){if(g=c.node,f=this.selectedNode.isLeaf()?this.selectedNode.parentNode.parentNode:this.selectedNode.parentNode,null!=f)return a=f.data.id,{nodeIDToReload:a,nodeIDToSelect:g}}else return this.getShowGridForLeaf()&&this.selectedNode.isLeaf()?{nodeIDToReload:this.selectedNode.parentNode.data.id}:{nodeIDToSelect:this.selectedNode.data.id}}}return null},getImportPanel:function(){return this.formPanel=new Ext.form.FormPanel({border:!1,
bodyStyle:"padding-left:10px",defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"side",anchor:"-20"},method:"POST",fileUpload:!0,items:[CWHF.createFileField("admin.customize.list.import.lbl.uploadFile","uploadFile",{allowBlank:!1}),CWHF.createCheckbox("common.lbl.overwriteExisting","overwriteExisting"),CWHF.createCheckbox("common.lbl.clearChildren","clearChildren")]})},onImport:function(){var a=[{submitUrl:this.baseAction+"!importList.action",submitButtonText:getText("common.btn.upload"),
submitUrlParams:{node:this.selectedNodeID},validateHandler:Upload.validateUpload,expectedFileType:/^.*\.(xml)$/,refreshAfterSubmitHandler:this.reload}],a={title:getText("common.lbl.upload",getText("admin.customize.list.import.lbl.uploadFile")),width:600,height:180,submit:a,formPanel:this.getImportPanel(),cancelButtonText:getText("common.btn.done")};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},onExportGridRow:function(){this.onExport(!1)},onExportTreeNode:function(){this.onExport(!0)},
onExport:function(a){attachmentURI=this.baseAction+"!exportList.action?node\x3d"+this.getSelectedID(a);window.open(attachmentURI)},getSelectedID:function(a){var b=this.getSingleSelectedRecordData(a);return null!=b?this.getRecordID(b,{fromTree:a}):null},getActionItemIdsWithContextDependentLabel:function(){return"add editGridRow editTreeNode copyGridRow copyTreeNode deleteGridRow deleteTreeNode uploadIconGridRow uploadIconTreeNode downloadIconGridRow downloadIconTreeNode moveUp moveDown exportGridRow exportTreeNode importList".split(" ")},
getTreeContextMenuActions:function(a,b){var c=a.data.canEdit,e=a.data.canDelete,f=a.data.canCopy,g=a.data.hasIcon,h=a.data.hasChildFilter,k=[];if(a.data.canAddChild){k.push(this.actionAdd);var l=a.data.childListID;null!=l&&0!=l||k.push(this.actionImport)}c&&k.push(this.actionEditTreeNode);h&&a.isLeaf()&&k.push(this.actionChildIssueTypeAssignmentFromTree);e&&k.push(this.actionDeleteTreeNode);f&&(k.push(this.actionCopyTreeNode),k.push(this.actionExportTreeNode));g&&(c&&k.push(this.actionUploadFromTree),
k.push(this.actionDownloadFromTree));return k},getGridContextMenuActions:function(a,b){var c=a.data.canEdit,e=a.data.canDelete,f=a.data.canCopy,g=a.data.hasIcon,h=a.data.id,k=a.data.hasChildFilter,l=[];c&&l.push(this.actionEditGridRow);k&&l.push(this.actionChildIssueTypeAssignmentFromGrid);e&&l.push(this.actionDeleteGridRow);f&&(l.push(this.actionCopyGridRow),l.push(this.actionExportGridRow));null!=g&&(c&&l.push(this.actionUploadFromGrid),null!=a.data.iconName&&""!=a.data.iconName&&l.push(this.actionDownloadFromGrid));
null!=h&&0!=h&&c&&(c=this.grid.getStore(),null!=c&&(a!=c.first()&&l.push(this.actionMoveUp),a!=c.last()&&l.push(this.actionMoveDown)));return l},onTreeNodeDblClick:function(a,b){if(b.data.canEdit)this.onEditTreeNode()},onGridRowDblClick:function(a,b){if(b.data.canEdit)this.onEditGridRow()}});
Ext.define("com.trackplus.admin.customize.objectStatus.ObjectStatusConfig",{extend:"com.trackplus.admin.TreeWithGrid",config:{rootID:"",issueFilter:""},confirmDeleteEntity:!0,baseAction:"objectStatus",entityID:"node",listOptionWindowWidth:500,listOptionWindowHeight:150,actionAdd:null,actionMoveUp:null,actionMoveDown:null,localizedLabels:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},init:function(){this.initActions();this.initLocalizedLabels()},initLocalizedLabels:function(){Ext.Ajax.request({url:this.baseAction+
"!localizedLabels.action",scope:this,success:function(a){a=Ext.decode(a.responseText);this.localizedLabels={};Ext.each(a.records,function(a){this.localizedLabels[a.id]=a.label},this)},failure:function(a){Ext.MessageBox.alert(this.failureTitle,a.responseText)}})},getEditWidth:function(a,b,c,e,f){return this.listOptionWindowWidth},getEditHeight:function(a,b,c,e,f){return this.listOptionWindowHeight},getRootMessage:function(a){return getText("menu.admin.custom.objectStatus.tt")},getEntityLabel:function(a){var b=
a.tooltipKey,c=null,e=!1;null!=a&&(e=a.fromTree);a=this.getLastSelected(e);null!=a&&(e?null!=b&&b==this.actionAdd.initialConfig.tooltipKey&&(c=a.data.listForLabel):c=a.data.listForLabel);return null!=c?this.localizedLabels[c]:""},initActions:function(){this.actionAdd=this.createAction(this.getAddButtonKey(),this.getAddFolderIconCls(),this.onAdd,!0,this.getAddTitleKey(),"add");this.actionEditGridRow=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEditGridRow,!0,this.getEditTitleKey(),
"editGridRow");this.actionDeleteGridRow=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromGrid,!0,this.getDeleteTitleKey(),"deleteGridRow");this.actionMoveUp=this.createAction("common.btn.up","moveUp",this.onMoveUpGridRow,!0,"common.lbl.up","moveUp");this.actionMoveDown=this.createAction("common.btn.down","moveDown",this.onMoveDownGridRow,!0,"common.lbl.down","moveDown")},getToolbarActions:function(){return[this.actionAdd,this.actionEditGridRow,this.actionDeleteGridRow,
this.actionMoveUp,this.actionMoveDown]},getToolbarActionChangesForTreeNodeSelect:function(a){this.actionAdd.setDisabled(!1);this.actionEditGridRow.setDisabled(!0);this.actionDeleteGridRow.setDisabled(!0);this.actionMoveUp.setDisabled(!0);this.actionMoveDown.setDisabled(!0)},onTreeNodeDblClick:function(a,b){},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"modifiable",mapping:"modifiable",type:"boolean"},{name:"listForLabel",
mapping:"listForLabel",type:"int"},{name:"iconCls",mapping:"iconCls",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"}]},hasDragAndDropOnGrid:function(a){return!0},getGridFields:function(a){return[{name:"id",type:"int"},{name:"label",type:"string"},{name:"modifiable",type:"boolean"},{name:"listForLabel",type:"int"},{name:"typeflagLabel",type:"string"},{name:"leaf",type:"boolean"},{name:"node",type:"string"}]},getGridColumns:function(a){return[{header:getText("common.lbl.name"),flex:1,dataIndex:"label",
sortable:!1,hidden:!1},{header:getText("admin.customize.list.lbl.typeflag"),width:100,dataIndex:"typeflagLabel",sortable:!1,hidden:!1}]},onGridDrop:function(a,b,c,e){a=!1;"before"==e&&(a=!0);b={node:b.records[0].get("node"),droppedToNode:c.get("node"),before:a};this.onOrderChange(this.baseAction+"!droppedNear.action",b)},enableDisableToolbarButtons:function(a,b){var c=b[0];if(null==c)this.actionDeleteGridRow.setDisabled(!0),this.actionEditGridRow.setDisabled(!0),this.actionMoveUp.setDisabled(!0),
this.actionMoveDown.setDisabled(!0);else{var e=c.data.modifiable;this.actionDeleteGridRow.setDisabled(!e);this.actionEditGridRow.setDisabled(!e);this.actionMoveDown.setDisabled(!e);this.actionMoveUp.setDisabled(!e);e&&(e=this.grid.getStore(),null!=e&&(this.actionMoveDown.setDisabled(c==e.last()),this.actionMoveUp.setDisabled(c==e.first())))}},getListOptionWindowItems:function(a,b){var c=[CWHF.createTextField("common.lbl.name","label",{disabled:!b,allowBlank:!1,labelWidth:150})];c.push(CWHF.createCombo("admin.customize.list.lbl.typeflag",
"typeflag",{disabled:!b,labelWidth:150},null,"typeflagsList"));return c},postDataLoadCombos:function(a,b){null!=b.items.items&&Ext.Array.forEach(b.items.items,function(b){"combo"==b.xtype&&(b.store.loadData(a[b.itemId]),b.setValue(a[b.itemId.substring(0,b.itemId.length-5)]))})},getEditPostDataProcess:function(a,b,c,e,f){return this.postDataLoadCombos},getPanelItems:function(a,b,c,e,f){b=this.getRecordID(a,{fromTree:e});c=!1;"add"==f||"copy"==f?c=!0:"edit"==f&&(c=a.modifiable);return this.getListOptionWindowItems(b,
c)},onAdd:function(){var a=this.getTitle(this.getAddTitleKey(),{fromTree:!0}),b=this.getAddLeafParams(),c=this.getAddLeafParams(),e=this.getAddReloadParamsAfterSave(!0),f=this.getAddSelectionAfterSaveFromResult(),g=this.getSingleSelectedRecord(!0);return this.onAddEdit(a,g,"add",!0,!0,!0,b,c,e,f)},getAddLeafParams:function(){return this.getAddParams(!1)},onMoveUpGridRow:function(){var a=this.getLastSelectedGridRow();null!=a&&(nodeID=a.data.node,this.onOrderChange(this.baseAction+"!moveUp.action",
{node:nodeID}))},onMoveDownGridRow:function(){var a=this.getLastSelectedGridRow();null!=a&&(nodeID=a.data.node,this.onOrderChange(this.baseAction+"!moveDown.action",{node:nodeID}))},onOrderChange:function(a,b){Ext.Ajax.request({url:a,disableCaching:!0,scope:this,success:function(a){a=Ext.decode(a.responseText);!0!==a.success&&Ext.MessageBox.alert(this.failureTitle,a.errorMessage);com.trackplus.util.RefreshAfterSubmit.refreshGridAndTreeAfterSubmit.call(this,{rowToSelect:a.node})},failure:function(a){Ext.MessageBox.alert(this.failureTitle,
a.responseText)},isUpload:!1,method:"POST",params:b})},reload:com.trackplus.util.RefreshAfterSubmit.refreshGridAfterSubmit,getReloadParamsAfterDelete:function(a,b,c){return null},getActionItemIdsWithContextDependentLabel:function(){return["add","editGridRow","deleteGridRow","moveUp","moveDown"]},getTreeContextMenuActions:function(a,b){var c=[];a.data.modifiable&&c.push(this.actionAdd);return c},getGridContextMenuActions:function(a,b){var c=[];if(a.data.modifiable){c.push(this.actionEditGridRow);c.push(this.actionDeleteGridRow);
var e=this.grid.getStore();null!=e&&(a!=e.first()&&c.push(this.actionMoveUp),a!=e.last()&&c.push(this.actionMoveDown))}return c},onGridRowDblClick:function(a,b){if(b.data.modifiable)this.onEditGridRow()}});
Ext.define("com.trackplus.admin.project.ProjectConfig",{extend:"com.trackplus.admin.TreeDetail",config:{projectTree:null,rootID:null,sys:!0,lastSelections:{},isTemplate:!1},hasPrivateProject:!0,templateIsActive:!1,baseAction:"project",tabPanel:null,confirmDeleteNotEmpty:!0,addAsSubproject:!1,addAsPrivateProject:!1,actionAddProject:null,actionAddSubproject:null,actionAddPrivateProject:null,actionCopyProject:null,actionCreateWorkspaceFromTemplate:null,actionCreateTemplateFromWorkspace:null,actionLockUnlock:null,
actionSave:null,actionCancel:null,actionDelete:null,replaceToolbarOnTreeNodeSelect:!0,roleAssignment:null,accountAssignment:null,phases:null,lists:null,filters:null,reportTemplates:null,screenConfig:null,fieldConfig:null,workflowConfig:null,automail:null,cockpit:null,versionControl:null,importFromMsProject:null,exportToMsProject:null,labelWidth:200,textFieldWidth:500,textFieldWidthShort:350,textFieldWidthCheck:280,FieldSetWidth:700,alignR:"right",prefillByWidth:550,protocolWidth:550,securityConnectionWidth:550,
COPY_ACTION_WP_FROM_TPL:0,COPY_ACTION_TPL_FROM_WP:1,COPY_ACTION_COPY_TPL:2,COPY_ACTION_COPY_WP:3,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.lists=Ext.create("com.trackplus.admin.customize.list.ListConfig",{fromProjectConfig:!0});this.phases=Ext.create("com.trackplus.admin.project.Release",{projectID:this.rootID});this.init(a)},GENERAL:1,ASSIGN_ROLES:2,PHASES:3,LISTS:4,FILTERS:5,REPORT_TEMPLTATES:6,SCREEN_ASSIGNMENT:7,FIELD_CONFIGURATION:8,ASSIGN_ACCOUNTS:9,AUTOMAIL:10,
COCKPIT:11,VERSION_CONTROL:12,WORKFLOW:13,EXPORT_TO_MSPROJECT:14,IMPORT_FROM_MSPROJECT:15,EMAIL_PROTOCOL:{POP3:"pop3",IMAP:"imap"},SECURITY_CONNECTIONS_MODES:{NEVER:0,TLS_IF_AVAILABLE:1,TLS:2,SSL:3},DEFAULT_EMAIL_PORTS:{POP3:110,POP3_SSL:995,IMAP:143,IMAP_SSL:993},PREFILL:{LASTWORKITEM:1,PROJECTDEFAULT:2},addOrEditProject:function(a,b,c,e,f){var g={loadUrl:this.getDetailUrl(),loadUrlParams:a};a={title:c,width:800,height:650,load:g,submit:{submitUrl:this.baseAction+"!save.action",submitUrlParams:b,
refreshParametersBeforeSubmit:{refreshScope:e,refreshMethod:f},refreshAfterSubmitHandler:function(a,b){f.call(e)}},items:this.getDetailItems(null,a.add),postDataProcess:this.postDataLoadCombos};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},treeNodeSelect:function(a,b,c,e){c=a=!1;null!=b&&(a=b.data.leaf,this.selectedNodeID=b.data.id,this.storeLastSelectedSection(this.selectedNodeID),this.selectedNode=b,c=b.data.privateProject);var f=this.getSelectedNodeClass(b);this.getSelectedNodeIsTreeBased(b)?
(b=this.loadTreeWithGrid(f,b),this.actualizeToolbarOnTreeSelect.call(f,b)):this.getSelectedNodeIsWizardBased(b)||this.getSelectedNodeIsDetailBased(b)?(null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0),this.getSelectedNodeIsWizardBased(b)?this.centerPanel=f.getWizardPanel():this.centerPanel=f.getDetailPanel(b,a,e),this.mainPanel.add(this.centerPanel),borderLayout.setActiveToolbarActionList(f.getToolbarActions())):(f.loadDetailPanel(b,a,e),borderLayout.setActiveToolbarActionList(f.getToolbarActions(!0,
c)))},loadTreeWithGrid:function(a,b){var c=null;null!=b&&(c=b.data.branchRoot);null!=this.centerPanel&&this.mainPanel.remove(this.centerPanel,!0);this.centerPanel=a.createCenterPanel();this.mainPanel.add(this.centerPanel);var e=a.tree.getRootNode();a.selectedNode=e;a.selectedNodeID=c;borderLayout.setActiveToolbarActionList(a.getToolbarActions());return e},getSelectedNodeIsTreeBased:function(a){switch(a.data.id){case this.PHASES:case this.ASSIGN_ROLES:case this.LISTS:case this.FILTERS:case this.REPORT_TEMPLTATES:case this.FIELD_CONFIGURATION:case this.SCREEN_ASSIGNMENT:case this.WORKFLOW:case this.AUTOMAIL:return!0}return!1},
getSelectedNodeIsWizardBased:function(a){return a.data.id==this.IMPORT_FROM_MSPROJECT},getSelectedNodeIsDetailBased:function(a){a=a.data.id;return a==this.EXPORT_TO_MSPROJECT||a==this.VERSION_CONTROL||a==this.COCKPIT||a==this.ASSIGN_ACCOUNTS?!0:!1},getSelectedNodeClass:function(a){var b=a.data.branchRoot,c=a.data.projectID;switch(a.data.id){case this.GENERAL:return this;case this.PHASES:return this.phases.rootID=b,this.phases;case this.ASSIGN_ROLES:return null==this.roleAssignment&&(this.roleAssignment=
Ext.create("com.trackplus.admin.project.RoleAssignment",{rootID:b,baseAction:"roleAssignments",treeWidth:200})),this.roleAssignment;case this.ASSIGN_ACCOUNTS:return null==this.accountAssignment&&(this.accountAssignment=Ext.create("com.trackplus.admin.SimpleAssignment",{baseAction:"accountAssignments",objectID:this.rootID,objectIDParamName:"projectID"})),this.accountAssignment;case this.LISTS:return this.lists.rootID=b,this.lists;case this.FILTERS:return null==this.filters&&(this.filters=Ext.create("com.trackplus.admin.customize.category.CategoryConfig",
{rootID:b,projectID:this.rootID})),this.filters;case this.REPORT_TEMPLTATES:return null==this.reportTemplates&&(b=a.data.branchRoot,this.reportTemplates=Ext.create("com.trackplus.admin.customize.category.CategoryConfig",{rootID:b,projectID:this.rootID})),this.reportTemplates;case this.FIELD_CONFIGURATION:return null==this.fieldConfig&&(b=a.data.branchRoot,this.fieldConfig=Ext.create("com.trackplus.admin.customize.treeConfig.FieldConfig",{rootID:b,fromProjectConfig:!0})),this.fieldConfig;case this.SCREEN_ASSIGNMENT:return null==
this.screenConfig&&(b=a.data.branchRoot,this.screenConfig=Ext.create("com.trackplus.admin.customize.treeConfig.ScreenConfig",{rootID:b,fromProjectConfig:!0})),this.screenConfig;case this.AUTOMAIL:return null==this.automail&&(this.automail=Ext.create("com.trackplus.admin.NotifyConfig",{defaultSettings:!0,exclusiveProjectID:this.rootID})),this.automail;case this.COCKPIT:return null==this.cockpit&&(this.cockpit=Ext.create("com.trackplus.admin.project.ProjectCockpit",{projectID:this.rootID})),this.cockpit;
case this.VERSION_CONTROL:return null==this.versionControl&&(this.versionControl=Ext.create("com.trackplus.vc.VersionControlFacade",{model:{projectID:this.rootID}})),this.versionControl;case this.WORKFLOW:return null==this.workflowConfig&&(b=a.data.branchRoot,this.workflowConfig=Ext.create("com.trackplus.admin.customize.treeConfig.WorkflowConfig",{rootID:b,fromProjectConfig:!0,projectOrProjectTypeID:c})),this.workflowConfig;case this.EXPORT_TO_MSPROJECT:return null==this.exportToMsProject&&(this.exportToMsProject=
Ext.create("com.trackplus.admin.action.ExportMsProject",{projectID:this.rootID})),this.exportToMsProject;case this.IMPORT_FROM_MSPROJECT:return null==this.importFromMsProject&&(this.importFromMsProject=Ext.create("com.trackplus.admin.action.ImportMsProject",{projectID:this.rootID})),this.importFromMsProject}},getTreeFields:function(){return[{name:"id",mapping:"id",type:"int"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"},
{name:"projectID",mapping:"projectID",type:"int"},{name:"privateProject",mapping:"privateProject",type:"boolean"},{name:"branchRoot",mapping:"branchRoot",type:"string"}]},getEntityLabel:function(a){return this.isTemplate?getText("admin.project.lbl.templateForOp"):getText("admin.project.lbl.projectForOp")},getAddIconCls:function(){return"projecttAdd"},getSaveIconCls:function(){return"projecttSave"},getAddSubprojectLabel:function(){return getText(this.getAddTitleKey(),getText("admin.project.lbl.subproject"))},
getAddPrivateProjectLabel:function(){return getText(this.getAddTitleKey(),getText("admin.project.lbl.privateProject"))},getCopyToButtonKey:function(){return"common.btn.copyTo"},init:function(a){Ext.Ajax.request({url:this.baseAction+"!getWorkspaceAndTemplateToolbarConfig.action",params:{projectID:this.rootID},fromCenterPanel:!0,scope:this,success:function(a){a=Ext.decode(a.responseText);this.hasPrivateProject=a.hasPrivateWorkspace;this.templateIsActive=a.templateIsActive;this.initActions()},failure:function(a){Ext.MessageBox.alert(this.failureTitle,
a.responseText)}})},initActions:function(){this.actionAddProject=this.createLocalizedAction(this.getTitle(this.getAddTitleKey()),this.getAddIconCls(),this.onAddProject,this.getTitle(this.getAddTitleKey()));this.actionAddSubproject=this.createLocalizedAction(this.getAddSubprojectLabel(),this.getAddIconCls(),this.onAddSubproject,this.getAddSubprojectLabel());this.actionAddPrivateProject=this.createLocalizedAction(this.getAddPrivateProjectLabel(),this.getAddIconCls(),this.onAddPrivateProject,getText("admin.project.lbl.privateProject.tt"));
this.actionCopyProject=this.createLocalizedAction(getText(this.getCopyButtonKey()),this.getCopyIconCls(),this.onCopy,this.getTitle(this.getCopyTitleKey()));this.actionCreateWorkspaceFromTemplate=this.createLocalizedAction(getText("admin.project.lbl.spaceFromTemplate"),this.getCopyIconCls(),this.onCreateFromCopy,getText("admin.project.lbl.spaceFromTemplate"));this.actionCreateTemplateFromWorkspace=this.createLocalizedAction(getText("admin.project.lbl.templateFromSpace"),this.getCopyIconCls(),this.onCreateFromCopy,
getText("admin.project.lbl.templateFromSpace"));this.actionLockUnlock=this.createLocalizedAction(this.getTemplateLockUnlockLabel(),this.getTemplateLockUnlockIcon(),this.onLockUnlock,this.getTemplateLockUnlockToolTip());this.actionSave=this.createLocalizedAction(getText("common.btn.save"),this.getSaveIconCls(),this.onSave,this.getTitle("common.lbl.save"));this.actionCancel=this.createLocalizedAction(getText("common.btn.cancel"),"cancel",this.onCancel,getText("common.btn.cancel"));this.actionDelete=
this.createLocalizedAction(getText("common.btn.delete"),this.getDeleteIconCls(),this.onDelete,this.getTitle("common.lbl.delete"))},getToolbarActions:function(a,b){var c=[];this.sys&&c.push(this.actionAddProject);com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&a&&null!=b&&!b&&c.push(this.actionAddSubproject);this.hasPrivateProject||!com.trackplus.TrackplusConfig.user.privateWorkspace||this.isTemplate||c.push(this.actionAddPrivateProject);a&&null!=b&&!b&&c.push(this.actionCopyProject);a&&(this.isTemplate?
(c.push(this.actionCreateWorkspaceFromTemplate),c.push(this.actionLockUnlock)):c.push(this.actionCreateTemplateFromWorkspace));a&&(c.push(this.actionSave),c.push(this.actionDelete));return c},onTreeNodeLoad:function(a,b){if(b.isRoot()){var c=null;null!=this.lastSelections.lastSelectedSection&&(c=a.getNodeById(this.lastSelections.lastSelectedSection));null==c&&(c=b.firstChild);this.tree.getSelectionModel().select(c)}},onAddProject:function(){this.onAdd(!1,!1)},onAddSubproject:function(){this.onAdd(!0,
!1)},onAddPrivateProject:function(){this.onAdd(!1,!0)},onAdd:function(a,b){this.addAsSubproject=a;this.addAsPrivateProject=b;this.mainPanel=Ext.create("Ext.panel.Panel",{layout:"border",region:"center",border:!1,items:[]});borderLayout.controller.setCenterContent(this.mainPanel);this.loadDetailPanelWithFormLoad(null,!0,{addAsSubproject:a,addAsPrivateProject:b});borderLayout.setActiveToolbarActionList(this.getToolbarActionsForTreeNodeSelect())},onCopy:function(){var a={projectID:this.rootID},b=this.COPY_ACTION_COPY_WP;
this.isTemplate&&(b=this.COPY_ACTION_COPY_TPL);Ext.create("com.trackplus.admin.project.ProjectCopyController",{model:a,projectConfig:this,isTemplate:this.isTemplate,applyTemplate:!1,actionTarget:b}).showDialog()},onCreateFromCopy:function(){var a={projectID:this.rootID},b=this.COPY_ACTION_TPL_FROM_WP;this.isTemplate&&(b=this.COPY_ACTION_WP_FROM_TPL);Ext.create("com.trackplus.admin.project.ProjectCopyController",{model:a,projectConfig:this,isTemplate:!1,applyTemplate:!0,actionTarget:b}).showDialog()},
onLockUnlock:function(){Ext.Ajax.request({url:this.baseAction+"!changeTemplateState.action",params:{projectID:this.rootID},scope:this,success:function(a){a=Ext.decode(a.responseText);var b=a.data;a.success?(this.templateIsActive=b.templateIsActive,this.actionLockUnlock.setText(this.getTemplateLockUnlockLabel()),this.actionLockUnlock.setIconCls(this.getTemplateLockUnlockIcon())):Ext.MessageBox.alert(this.failureTitle,getText("admin.project.lbl.changeTemplateStateError"))},failure:function(a){Ext.MessageBox.alert(this.failureTitle,
a.responseText)}})},onCancel:function(){var a=this.projectTree.getSelectionModel(),b=a.getLastSelected();null!=b?(a.select(b),com.trackplus.admin.myClick(this.projectTree,b)):(borderLayout.controller.setCenterContent(null),borderLayout.setActiveToolbarActionList(this.getToolbarActions(!1)))},onSave:function(a,b){this.saveProject(!1)},saveProject:function(a){var b=this;borderLayout.setLoading(!0);this.clearErrorTabs();var c={projectID:this.rootID,addAsSubproject:this.addAsSubproject,addAsPrivateProject:this.addAsPrivateProject,
isTemplate:this.isTemplate};null!=a&&(c.confirmSave=a);this.centerPanel.getForm().submit({url:this.baseAction+"!save.action",params:c,scope:this,success:function(a,b){borderLayout.setLoading(!1);var c=b.result;c.success?(this.reload(c),this.rootID=c.projectNodeToSelect,CWHF.showMsgInfo(getText("admin.project.successSave"))):errorHandlerSave(c)},failure:function(a,c){borderLayout.setLoading(!1);result=c.result;if(null!=result)if(null!=c.result&&null!=c.result.errors)b.handleErrors(c.result.errors);
else{var g=result.errorCode,h=result.title;null!=g&&4==g?Ext.MessageBox.confirm(h,result.errorMessage,function(a){if("no"==a)return!1;this.saveProject(!0)},this):com.trackplus.util.submitFailureHandler(a,c)}else CWHF.showMsgError(getText("admin.project.err.errorSave"))}})},onDelete:function(){var a=this.projectTree.getSelectionModel().getLastSelected();null!=a&&this.deleteHandler(a,{fromTree:!0,isLeaf:!1})},reloadProjectTree:function(a){switch(a){case this.COPY_ACTION_COPY_WP:case this.COPY_ACTION_WP_FROM_TPL:return!0;
case this.COPY_ACTION_TPL_FROM_WP:case this.COPY_ACTION_COPY_TPL:return!1;default:return!0}},reloadAfterApplyingTemplate:function(a,b){var c=Ext.getCmp("tree-projectTemplateTreePanel"),e=Ext.getCmp("tree-projectTreePanel");b==this.COPY_ACTION_WP_FROM_TPL&&(Ext.getCmp("projectTreePanel").expand(),c.getSelectionModel().deselectAll());b==this.COPY_ACTION_TPL_FROM_WP&&(Ext.getCmp("projectTemplateTreePanel").expand(),e.getSelectionModel().deselectAll());var f=a.projectNodeToSelect,g=a.projectNodeToReload,
h=a.deletedProjectID,k={};if(null!=g){var l=null,l=this.reloadProjectTree(b)?e.getStore().getNodeById(g):c.getStore().getNodeById(g);k.node=l}if(null==f&&(l=null,l=this.reloadProjectTree(b)?e.getRootNode():c.getRootNode(),null!=l&&null!=l.childNodes&&0<l.childNodes.length)){var m=l.getChildAt(0);null!=h&&m.data.id==h?1<l.childNodes.length&&(f=l.getChildAt(1).data.id):f=m.data.id}k.callback=this.selectNode;this.reloadProjectTree(b)?(k.scope={tree:e,nodeIdToReload:g,nodeIdToSelect:f,scope:this,expandWorkspaceNode:!0},
e.getStore().load(k)):(k.scope={tree:c,nodeIdToReload:g,nodeIdToSelect:f,scope:this,expandWorkspaceNode:!0},c.getStore().load(k))},reload:function(a){var b=a.reloadProjectTree,c=a.projectNodeToSelect,e=a.projectNodeToReload,f=a.reloadProjectConfigTree,g=a.projectConfigTypeNodeToSelect;a=a.deletedProjectID;!b&&f&&null!=this.tree&&(f={},null!=g&&(f.callback=this.selectNode,f.scope={tree:this.tree,nodeIdToSelect:g}),this.tree.getStore().load(f));b&&(f={},null!=e&&(b=this.projectTree.getStore().getNodeById(e),
f.node=b),null==c&&(b=this.projectTree.getRootNode(),null!=b&&null!=b.childNodes&&0<b.childNodes.length&&(g=b.getChildAt(0),null!=a&&g.data.id==a?1<b.childNodes.length&&(c=b.getChildAt(1).data.id):c=g.data.id)),f.callback=this.selectNode,f.scope={tree:this.projectTree,nodeIdToReload:e,nodeIdToSelect:c,scope:this,expandWorkspaceNode:!1},this.projectTree.getStore().load(f))},selectNode:function(){null!=this.nodeIdToReload&&(nodeReloaded=this.tree.getStore().getNodeById(this.nodeIdToReload),null==nodeReloaded||
nodeReloaded.isExpanded()||nodeReloaded.expand());if(null!=this.nodeIdToSelect){var a=this.tree.getStore().getNodeById(this.nodeIdToSelect);null!=a&&(this.tree.getSelectionModel().select(a),com.trackplus.admin.myClick(this.tree.getView(),a))}else borderLayout.controller.setCenterContent(null),borderLayout.setActiveToolbarActionList(this.scope.getToolbarActions(!1))},getDeleteParams:function(a,b){var c=this.callParent(arguments);c.projectID=this.rootID;return c},getToolbarActionsForTreeNodeSelect:function(a){return[this.actionSave,
this.actionCancel]},getDetailUrl:function(a,b){return this.baseAction+"!load.action"},getDetailParams:function(a,b,c){a=null;a=null==c?{}:c;a.projectID=this.rootID;a.add=b;return a},getEditPostDataProcess:function(a,b,c){return this.postDataLoadCombos},getControl:function(){return CWHF.getControl.apply(this.tabPanel,arguments)},getHelpWrapper:function(){return CWHF.getHelpWrapper.apply(this.tabPanel,arguments)},getWrappedControl:function(){return CWHF.getWrappedControl.apply(this.tabPanel,arguments)},
postDataLoadCombos:function(a,b){var c=this,e=this.getControl("mainTab"),f=this.getWrappedControl("mainTab","fsbasic","projectType");f.store.loadData(a.projectTypeList);f.setValue(a["projectBaseTO.projectTypeID"]);f.on("change",this.onProjectTypeOrIssueTypeChange,this);this.isTemplate||(f=this.getWrappedControl("mainTab","fsbasic","projectStatus"),f.store.loadData(a.projectStatusList),f.setValue(a["projectBaseTO.projectStatusID"]));a.hasPrefix&&e.add({xtype:"fieldset",itemId:"fsprefix",width:this.FieldSetWidth,
title:getText("admin.project.lbl.prefix"),collapsible:!1,defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createTextFieldWithHelp("admin.project.lbl.prefix","projectBaseTO.prefix",{width:this.textFieldWidthShort,value:a["projectBaseTO.prefix"],allowBlank:!1,readOnly:0>a["projectBaseTO.projectTypeID"]},{change:function(a,b,e,f){c.checkNewWorkspacePrefix(a,b,c.rootID)}})]});a.hasAccounting&&this.addAccountingFieldSet(a,e);a.hasRelease&&this.addReleaseFieldSet(a,e);e=this.getWrappedControl("defaultTab",
"fsdef","projectDefaultsTO.defaultManagerID");e.store.loadData(a.managerList);e.setValue(a["projectDefaultsTO.defaultManagerID"]);e=this.getWrappedControl("defaultTab","fsdef","projectDefaultsTO.defaultResponsibleID");e.store.loadData(a.responsibleList);e.setValue(a["projectDefaultsTO.defaultResponsibleID"]);e=this.getWrappedControl("defaultTab","fsdef","projectDefaultsTO.defaultIssueTypeID");e.store.loadData(a.issueTypeList);e.setValue(a["projectDefaultsTO.defaultIssueTypeID"]);e.on("change",this.onProjectTypeOrIssueTypeChange,
this);e=this.getWrappedControl("defaultTab","fsdef","projectDefaultsTO.defaultPriorityID");e.store.loadData(a.priorityList);e.setValue(a["projectDefaultsTO.defaultPriorityID"]);e=this.getWrappedControl("defaultTab","fsdef","projectDefaultsTO.defaultSeverityID");e.store.loadData(a.severityList);e.setValue(a["projectDefaultsTO.defaultSeverityID"]);e=this.getControl("defaultTab","fsInitSt");f=this.getWrappedControl("defaultTab","fsInitSt","projectDefaultsTO.initialStatusID");f.store.loadData(a.statusList);
f.setValue(a["projectDefaultsTO.initialStatusID"]);initStItems=[];f=a.initStatuses;null!=f&&(Ext.Array.forEach(f,function(a){var b=a.issueType,c=a.status,e=a.active,f=a.statusList,n="projectDefaultsTO.issueTypeToInitStatusMap["+b+"]";0>b&&(n="projectDefaultsTO.issueTypeNegativeToInitStatusMap["+-b+"]");a=CWHF.createCombo(a.label,n,{value:c,labelWidth:this.labelWidth-40,width:this.textFieldWidth-60,data:f,disabled:!e,labelIsLocalized:!0},null,n);b=new Ext.Panel({border:!1,defaults:{margin:"4 4 0 0"},
margin:"0 10 3 80",layout:{type:"hbox"},itemId:"issueTypePanel"+b,items:[CWHF.createCheckbox("","",{value:e,width:20},{change:{fn:this.onStatusForIssueTypeChange,scope:this,comboControl:a}}),a]});initStItems.push(b)},this),e.add(initStItems));this.markInvalidByErrors(a.errors,b);com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&(e=this.getWrappedControl("emailTab","fsout","projectEmailTO.sendFromProjectEmail").getValue(),this.enableEmailOutFields(e),e=this.getWrappedControl("emailTab","fseserv",
"projectEmailTO.enabled"),this.onChangeEmailEnabled(e,e.getValue()))},checkNewWorkspacePrefix:function(a,b,c){Ext.Ajax.request({url:"\tproject!validateProjectPrefix.action",disableCaching:!0,success:function(b){Ext.decode(b.responseText).projectPrefixExists&&a.markInvalid(getText("common.err.duplicatePrefix"))},failure:function(){},method:"POST",params:{"projectBaseTO.prefix":b,projectID:c}})},markInvalidByErrors:function(a,b){var c=!1,e=!1;if(null!=a){var f=a["projectBaseTO.defaultAccount"];null!=
f&&(this.getWrappedControl("mainTab","fsacc","projectBaseTO.defaultAccount").markInvalid(f),c=!0);Ext.Array.forEach("projectDefaultsTO.defaultManagerID projectDefaultsTO.defaultResponsiblID projectDefaultsTO.initialStatusID projectDefaultsTO.defaultIssueTypeID projectDefaultsTO.defaultPriorityID projectDefaultsTO.defaultSeverityID".split(" "),function(b){var c=a[b];null!=c&&(b=this.getWrappedControl("defaultTab","fsdef",b),null!=b&&(e||(e=!0),b.markInvalid(c)))},this);!c&&e&&b.getComponent("tabPanel").setActiveTab("defaultTab")}},
addAccountingFieldSet:function(a,b){var c=a.subproject,e=a["projectAccountingTO.accountingInherited"],f=a["projectAccountingTO.workTracking"],g=a["projectAccountingTO.costTracking"],h=[];(this.addAsSubproject||c)&&h.push(CWHF.createCheckboxWithHelp("admin.project.lbl.accountingInherited","projectAccountingTO.accountingInherited",{width:this.textFieldWidthCheck,value:e},{change:{fn:this.onAccountingInheritedChange,scope:this}}));h.push(CWHF.createCheckboxWithHelp("admin.project.lbl.work","projectAccountingTO.workTracking",
{width:this.textFieldWidthCheck,value:f},{change:{fn:this.onWorkTrackingChange,scope:this}}));h.push(CWHF.createNumberFieldWithHelp("common.lbl.hoursPerWorkday","projectAccountingTO.hoursPerWorkday",2,0,24,{width:this.textFieldWidthShort,value:a["projectAccountingTO.hoursPerWorkday"]}));h.push(CWHF.createComboWithHelp("admin.project.lbl.defaultWorkUnit","projectAccountingTO.defaultWorkUnit",{data:a.workUnitList,value:a["projectAccountingTO.defaultWorkUnit"]}));h.push(CWHF.createCheckboxWithHelp("admin.project.lbl.cost",
"projectAccountingTO.costTracking",{width:this.textFieldWidthCheck,value:g},{change:{fn:this.onCostTrackingChange,scope:this}}));h.push(CWHF.createTextFieldWithHelp("admin.project.lbl.currencyName","projectAccountingTO.currencyName",{width:this.textFieldWidthShort,value:a["projectAccountingTO.currencyName"]}));h.push(CWHF.createTextFieldWithHelp("admin.project.lbl.currencySymbol","projectAccountingTO.currencySymbol",{width:this.textFieldWidthShort,value:a["projectAccountingTO.currencySymbol"]}));
h.push(CWHF.createComboWithHelp("admin.project.lbl.defaultAccount","projectAccountingTO.defaultAccount",{data:a.accountList,value:a["projectAccountingTO.defaultAccount"]}));h={xtype:"fieldset",itemId:"fsacc",width:this.FieldSetWidth,title:getText("admin.project.lbl.fsaccount"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:h};b.add(h);this.enableAccountingFields((this.addAsSubproject||c)&&e,f,g)},addReleaseFieldSet:function(a,b){b.add({xtype:"fieldset",itemId:"fsrel",
width:this.FieldSetWidth,title:getText("admin.project.lbl.release"),collapsible:!1,defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.project.lbl.useRelease","projectBaseTO.useRelease",{width:this.textFieldWidthCheck,value:a["projectBaseTO.useRelease"]})]})},onStatusForIssueTypeChange:function(a,b,c,e){e.comboControl.setDisabled(!b)},enableAccountingFields:function(a,b,c){this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.workTracking").setDisabled(a);this.getHelpWrapper("mainTab",
"fsacc","projectAccountingTO.hoursPerWorkday").setDisabled(a||!b);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.defaultWorkUnit").setDisabled(a||!b);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.costTracking").setDisabled(a);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.currencyName").setDisabled(a||!c);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.currencySymbol").setDisabled(a||!c);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.defaultAccount").setDisabled(a||
!b&&!c)},onAccountingInheritedChange:function(a,b,c,e){a=a.getValue();b=this.getWrappedControl("mainTab","fsacc","projectAccountingTO.workTracking").getValue();c=this.getWrappedControl("mainTab","fsacc","projectAccountingTO.costTracking").getValue();this.enableAccountingFields(a,b,c)},onWorkTrackingChange:function(a,b,c,e){a=a.getValue();this.enableWorkTrackingFields(a)},enableWorkTrackingFields:function(a){var b=this.getWrappedControl("mainTab","fsacc","projectAccountingTO.costTracking").getValue();
this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.hoursPerWorkday").setDisabled(!a);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.defaultWorkUnit").setDisabled(!a);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.defaultAccount").setDisabled(!a&&!b)},onCostTrackingChange:function(a,b,c,e){a=a.getValue();this.enableCostTrackingFields(a)},enableCostTrackingFields:function(a){var b=this.getWrappedControl("mainTab","fsacc","projectAccountingTO.workTracking").getValue();
this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.currencyName").setDisabled(!a);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.currencySymbol").setDisabled(!a);this.getHelpWrapper("mainTab","fsacc","projectAccountingTO.defaultAccount").setDisabled(!a&&!b)},getDetailPanelConfigOptions:function(){return{autoScroll:!1,layout:"fit"}},getDetailItems:function(a,b){var c=null;null!=this.lastSelections&&(c=this.lastSelections.lastSelectedTab);null==c&&(c=0);var e=[this.createTabMain(b),
this.createTabDefault()];com.trackplus.TrackplusConfig.appType!=APPTYPE_BUGS&&e.push(this.createTabEmail());return this.tabPanel=Ext.create("Ext.tab.Panel",{itemId:"tabPanel",plain:!0,border:!1,bodyBorder:!1,cls:"projectConfig",defaults:{border:!1,autoScroll:!0,bodyStyle:{border:"none",padding:"0px"}},items:e,activeTab:c})},tabActivate:function(a){a=this.tabPanel.items.indexOf(a);this.lastSelections.lastSelectedTab=a;Ext.Ajax.request({fromCenterPanel:!0,url:"project!storeLastSelectedTab.action",disableCaching:!0,
method:"POST",params:{tabIndex:a}})},storeLastSelectedSection:function(a){Ext.Ajax.request({fromCenterPanel:!0,url:"project!storeLastSelectedSection.action",disableCaching:!0,method:"POST",params:{sectionID:a}})},createTabMain:function(a){var b=[];b.push(CWHF.createTextField("common.lbl.name","projectBaseTO.label",{allowBlank:!1,maxLength:255}));b.push(CWHF.createTextAreaField("common.lbl.description","projectBaseTO.description",{height:150,maxLength:255}));b.push(CWHF.createComboWithHelp("common.lbl.projectType",
"projectBaseTO.projectTypeID",null,null,"projectType"));this.isTemplate||b.push(CWHF.createComboWithHelp("admin.customize.localeEditor.type.projectStatus","projectBaseTO.projectStatusID",null,null,"projectStatus"));a=Ext.create("Ext.panel.Panel",{title:getText("admin.project.lbl.mainTab"),itemId:"mainTab",items:[{xtype:"fieldset",itemId:"fsbasic",width:this.FieldSetWidth,title:getText("admin.project.lbl.fsbasic"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:b},
{xtype:"fieldset",itemId:"fslnk",width:this.FieldSetWidth,title:getText("admin.project.lbl.linking"),collapsible:!1,defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.project.lbl.linking","projectBaseTO.linking",{width:this.textFieldWidthCheck})]},{xtype:"hidden",name:"add",value:a}]});a.addListener("activate",this.tabActivate,this);return a},onProjectTypeOrIssueTypeChange:function(a,b,c,e){this.tabPanel.ownerCt.getForm().submit({clientValidation:!1,url:this.baseAction+
"!projectTypeChange.action",params:{projectID:this.rootID,addAsSubproject:this.addAsSubproject},scope:this,success:function(a,b){var c=b.result;c.success?this.refreshSystemFieldCombos(c.data,this.tabPanel.ownerCt):errorHandlerSave(c)},failure:function(a,b){com.trackplus.util.submitFailureHandler(a,b)}})},refreshSystemFieldCombos:function(a,b){var c=this.getControl("mainTab"),e=this.getControl("mainTab","fsacc"),f=null!=e,g=a.hasAccounting;f!=g?f&&!g?c.remove(e):this.addAccountingFieldSet(a,c):g&&
this.actualizeAccountingByProjectType(a);e=this.getControl("mainTab","fsrel");f=null!=e;g=a.hasRelease;f!=g&&(f&&!g?c.remove(e):this.addReleaseFieldSet(a,c));c=this.getWrappedControl("defaultTab","fsInitSt","projectDefaultsTO.initialStatusID");c.store.loadData(a.statusList);c.setValue(a["projectDefaultsTO.initialStatusID"]);e=this.getWrappedControl("defaultTab","fsdef","projectDefaultsTO.defaultIssueTypeID");e.store.loadData(a.issueTypeList);e.setValue(a["projectDefaultsTO.defaultIssueTypeID"]);f=
this.getWrappedControl("defaultTab","fsdef","projectDefaultsTO.defaultPriorityID");f.store.loadData(a.priorityList);f.setValue(a["projectDefaultsTO.defaultPriorityID"]);g=this.getWrappedControl("defaultTab","fsdef","projectDefaultsTO.defaultSeverityID");g.store.loadData(a.severityList);g.setValue(a["projectDefaultsTO.defaultSeverityID"]);c.validate();e.validate();f.validate();g.validate()},actualizeAccountingByProjectType:function(a){Ext.Array.forEach(["projectAccountingTO.defaultWorkUnit","projectAccountingTO.hoursPerWorkday",
"projectAccountingTO.currencyName","projectAccountingTO.currencySymbol"],function(b){var c=this.getWrappedControl("mainTab","fsacc",b);null!=c&&c.setValue(a[b])},this)},createTabDefault:function(){var a=Ext.create("Ext.panel.Panel",{title:getText("admin.project.lbl.defaultTab"),itemId:"defaultTab",items:[{xtype:"fieldset",itemId:"fsdef",width:this.FieldSetWidth,title:getText("admin.project.lbl.defaultFields"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createComboWithHelp("admin.project.lbl.defaultManager",
"projectDefaultsTO.defaultManagerID"),CWHF.createComboWithHelp("admin.project.lbl.defaultResponsible","projectDefaultsTO.defaultResponsibleID"),CWHF.createComboWithHelp("admin.project.lbl.defaultIssueType","projectDefaultsTO.defaultIssueTypeID"),CWHF.createComboWithHelp("admin.project.lbl.defaultPriority","projectDefaultsTO.defaultPriorityID"),CWHF.createComboWithHelp("admin.project.lbl.defaultSeverity","projectDefaultsTO.defaultSeverityID"),CWHF.getRadioGroupWithHelp("prefillBy","admin.project.lbl.prefill",
this.prefillByWidth,[{boxLabel:getText("admin.project.lbl.prefill.lastItem"),name:"projectDefaultsTO.prefillBy",inputValue:this.PREFILL.LASTWORKITEM,checked:!0},{boxLabel:getText("admin.project.lbl.prefill.projectDefault"),name:"projectDefaultsTO.prefillBy",inputValue:this.PREFILL.PROJECTDEFAULT}],{layout:"checkboxgroup",columns:2})]},{xtype:"fieldset",itemId:"fsInitSt",width:this.FieldSetWidth,title:getText("admin.project.lbl.initialState"),collapsible:!1,defaults:{anchor:"100%"},layout:"anchor",
items:[CWHF.createComboWithHelp("admin.project.lbl.defaultInitialState","projectDefaultsTO.initialStatusID"),Ext.create("Ext.Component",{html:getText("admin.project.lbl.defaultIssueTypeInitialState"),margin:"0 5 5 5",border:!0,cls:"infoBox3"})]}]});a.addListener("activate",this.tabActivate,this);return a},onEmailOutChange:function(a,b,c,e){a=a.getValue();this.enableEmailOutFields(a)},enableEmailOutFields:function(a){this.getHelpWrapper("emailTab","fsout","projectEmailTO.projectFromEmail").setDisabled(!a);
this.getHelpWrapper("emailTab","fsout","projectEmailTO.projectFromEmailName").setDisabled(!a);this.getHelpWrapper("emailTab","fsout","projectEmailTO.sendFromProjectAsReplayTo").setDisabled(!a)},onChangeEmailEnabled:function(a,b,c,e){disabled=!b;this.getHelpWrapper("emailTab","fseserv","projectEmailTO.protocol").setDisabled(disabled);this.getHelpWrapper("emailTab","fseserv","projectEmailTO.serverName").setDisabled(disabled);this.getHelpWrapper("emailTab","fseserv","projectEmailTO.port").setDisabled(disabled);
this.getHelpWrapper("emailTab","fsauth","projectEmailTO.user").setDisabled(disabled);this.getHelpWrapper("emailTab","fsauth","projectEmailTO.password").setDisabled(disabled);this.getHelpWrapper("emailTab","fsauth","securityConnection").setDisabled(disabled);this.getHelpWrapper("emailTab","fsother","keep").setDisabled(disabled);this.testBtn.setDisabled(disabled)},createTabEmail:function(){var a=this;a.testBtn=Ext.create("Ext.button.Button",{xtype:"button",style:{marginTop:"10px",marginBottom:"5px",
marginLeft:a.labelWidth+20+"px"},itemId:"emailTab.testConnection",enableToggle:!1,iconCls:"check16",text:getText("admin.server.config.testConnection"),handler:function(){a.testEmailIncoming.call(a)}});var b=Ext.create("Ext.panel.Panel",{title:getText("admin.project.lbl.emailTab"),itemId:"emailTab",layout:{type:"anchor"},items:[{xtype:"fieldset",itemId:"fseserv",width:this.FieldSetWidth,title:getText("admin.server.config.incomingServer"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},
layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.server.config.emailSubmission","projectEmailTO.enabled",{},{change:{fn:this.onChangeEmailEnabled,scope:this}}),CWHF.getRadioGroupWithHelp("projectEmailTO.protocol","admin.server.config.mailReceivingProtocol",this.protocolWidth,[{boxLabel:"POP3",name:"projectEmailTO.protocol",inputValue:"pop3",checked:!0},{boxLabel:"IMAP",name:"projectEmailTO.protocol",inputValue:"imap"}],null,{change:{fn:this.changePort,scope:this}}),CWHF.createTextFieldWithHelp("admin.server.config.mailReceivingServerName",
"projectEmailTO.serverName"),CWHF.createTextFieldWithHelp("admin.server.config.mailReceivingPort","projectEmailTO.port",{width:this.textFieldWidthShort})]},{xtype:"fieldset",itemId:"fsauth",width:this.FieldSetWidth,title:getText("admin.server.config.incomingAuth"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createTextFieldWithHelp("admin.server.config.mailReceivingUser","projectEmailTO.user"),CWHF.createTextFieldWithHelp("admin.server.config.mailReceivingPassWord",
"projectEmailTO.password",{inputType:"password"}),CWHF.getRadioGroupWithHelp("securityConnection","admin.server.config.mailReceivingSecurityConnection",this.securityConnectionWidth,[{boxLabel:getText("admin.server.config.securityConnections.never"),name:"projectEmailTO.securityConnection",inputValue:this.SECURITY_CONNECTIONS_MODES.NEVER},{boxLabel:getText("admin.server.config.securityConnections.tlsIsAvailable"),name:"projectEmailTO.securityConnection",inputValue:this.SECURITY_CONNECTIONS_MODES.TLS_IF_AVAILABLE},
{boxLabel:getText("admin.server.config.securityConnections.tls"),name:"projectEmailTO.securityConnection",inputValue:this.SECURITY_CONNECTIONS_MODES.TLS},{boxLabel:getText("admin.server.config.securityConnections.ssl"),name:"projectEmailTO.securityConnection",inputValue:this.SECURITY_CONNECTIONS_MODES.SSL}],null,{change:{fn:this.changePort,scope:this}})]},{xtype:"fieldset",itemId:"fsout",width:this.FieldSetWidth,title:getText("admin.project.lbl.fsoutgoing"),collapsible:!1,defaultType:"textfield",
defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.project.lbl.useProjectFromAddress","projectEmailTO.sendFromProjectEmail",{width:this.textFieldWidthCheck},{change:{fn:this.onEmailOutChange,scope:this}}),CWHF.createTextFieldWithHelp("admin.project.lbl.projectEmail","projectEmailTO.projectFromEmail"),CWHF.createTextFieldWithHelp("admin.project.lbl.projectEmailPersonalName","projectEmailTO.projectFromEmailName"),CWHF.createCheckboxWithHelp("admin.project.lbl.useProjectFromAsReplyTo",
"projectEmailTO.sendFromProjectAsReplayTo",{width:this.textFieldWidthCheck})]},{xtype:"fieldset",itemId:"fsother",width:this.FieldSetWidth,title:getText("admin.server.config.incomingOther"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[CWHF.createCheckboxWithHelp("admin.server.config.keepMessagesOnServer","projectEmailTO.keepMessagesOnServer",{itemId:"keep",width:this.textFieldWidthCheck})]},a.testBtn]});b.addListener("activate",a.tabActivate,a);return b},
handleErrors:function(a,b){var c="",e=[];null==b&&(b=getText("admin.project.err.errorSave"));if(null!=a&&0<a.length){for(var f=0;f<a.length;f++){var g=a[f],h=g.controlPath,k=null;null!=h&&0<h.length&&(k=h[0],Ext.Array.contains(e,k)||e.push(k),k=this.getControl.apply(this,h),null==k&&(k=this.getWrappedControl.apply(this,h)));null!=k?k.markInvalid(g.errorMessage):c+=g.errorMessage+"\x3c/br\x3e"}this.markErrorTabs(e)}""!=c&&(b=c);CWHF.showMsgError(b)},markErrorTabs:function(a){var b=[];if(0<a.length){for(var c=
0;c<a.length;c++){var e=this.getControl(a[c]);null!=e&&b.push(e)}if(0<b.length)for(c=this.tabPanel.getActiveTab(),Ext.Array.contains(b,c)||this.tabPanel.setActiveTab(b[0]),a=this.tabPanel.getTabBar(),c=0;c<b.length;c++)e=this.tabPanel.items.findIndex("itemId",b[c].getItemId()),a.getComponent(e).addCls("errorTab")}},clearErrorTabs:function(){for(var a=this.tabPanel.getTabBar(),b=0;b<a.items.length;b++)a.getComponent(b).removeCls("errorTab");null!=this.ldapController&&this.ldapController.clearErrorTabs.call(this.ldapController)},
testEmailIncoming:function(){var a=this;borderLayout.setLoading(!0);a.clearErrorTabs();var b=a.tabPanel.ownerCt.getForm();if(!b.isValid())return CWHF.showMsgError(getText("admin.project.err.invalidEmail")),!1;borderLayout.setLoading(!0);b.submit({url:"project!testIncomingEmail.action",params:{projectID:this.rootID},success:function(a,b){borderLayout.setLoading(!1);CWHF.showMsgInfo(getText("admin.project.msg.validEmail"))},failure:function(b,e){borderLayout.setLoading(!1);null!=e.result&&null!=e.result.errors?
a.handleErrors(e.result.errors,getText("admin.project.err.invalidEmail")):CWHF.showMsgError(getText("admin.project.err.invalidEmail"))}})},changePort:function(a,b,c){a=this.getWrappedControl("emailTab","fseserv","projectEmailTO.protocol");b=this.getWrappedControl("emailTab","fsauth","securityConnection");c=this.getWrappedControl("emailTab","fseserv","projectEmailTO.port");a=CWHF.getSelectedRadioButtonValue(a);b=CWHF.getSelectedRadioButtonValue(b);c.setValue(a==this.EMAIL_PROTOCOL.POP3?b==this.SECURITY_CONNECTIONS_MODES.SSL?
this.DEFAULT_EMAIL_PORTS.POP3_SSL:this.DEFAULT_EMAIL_PORTS.POP3:b==this.SECURITY_CONNECTIONS_MODES.SSL?this.DEFAULT_EMAIL_PORTS.IMAP_SSL:this.DEFAULT_EMAIL_PORTS.IMAP)},getTemplateLockUnlockLabel:function(){var a=getText("admin.project.lbl.templateStateEdit");this.templateIsActive&&(a=getText("admin.project.lbl.templateStateLock"));return a},getTemplateLockUnlockToolTip:function(){var a=getText("admin.project.lbl.templateStateEdit.tt");this.templateIsActive&&(a=getText("admin.project.lbl.templateStateLock.tt"));
return a},getTemplateLockUnlockIcon:function(){var a="edit16";this.templateIsActive&&(a="lock");return a}});
Ext.define("com.trackplus.admin.project.ProjectCockpit",{extend:"Ext.Base",config:{projectID:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},configButton:null,getToolbarActions:function(){var a=this;null==this.configButton&&(this.configButton=new Ext.Button({overflowText:getText("admin.project.cockpit.lbl.configProject"),tooltip:getText("admin.project.cockpit.lbl.configProject"),text:getText("admin.project.cockpit.lbl.configProject"),iconCls:"projectEdit",disabled:!1,handler:function(){window.location.href=
"dashboardEdit.action?backAction\x3dadmin.action\x26projectID\x3d"+a.projectID+"\x26entityType\x3d1"}}),this.configReleaseButton=new Ext.Button({overflowText:getText("admin.project.cockpit.lbl.configRelease"),tooltip:getText("admin.project.cockpit.lbl.configRelease"),text:getText("admin.project.cockpit.lbl.configRelease"),iconCls:"releaseEdit",disabled:!1,handler:function(){window.location.href="dashboardEdit.action?backAction\x3dadmin.action\x26projectID\x3d"+a.projectID+"\x26entityType\x3d9"}}),
this.actionAssignProjectCockpit=new Ext.Button({overflowText:getText("admin.project.lbl.resetProjectCockpit"),tooltip:getText("admin.project.lbl.resetProjectCockpit"),text:getText("admin.project.lbl.resetProjectCockpit"),iconCls:"cockpitReset",disabled:!1,handler:a.onAssignProjectCockpit,scope:a}),this.actionAssignReleaseCockpit=new Ext.Button({overflowText:getText("admin.project.lbl.resetReleaseCockpit"),tooltip:getText("admin.project.lbl.resetReleaseCockpit"),text:getText("admin.project.lbl.resetReleaseCockpit"),
iconCls:"cockpitReset",disabled:!1,handler:a.onAssignReleaseCockpit,scope:a}));return[this.configButton,this.actionAssignProjectCockpit,this.configReleaseButton,this.actionAssignReleaseCockpit]},onAssignProjectCockpit:function(){com.trackplus.dashboard.resetDashboard("project!cokpitAssignment.action",{projectID:this.projectID,entityType:1},this.projectCokpitAssignmentSuccess,this)},projectCokpitAssignmentSuccess:function(){CWHF.showMsgInfo(getText("admin.project.msg.resetProjectCockpit"))},onAssignReleaseCockpit:function(){com.trackplus.dashboard.resetDashboard("project!cokpitAssignment.action",
{projectID:this.projectID,entityType:9},this.releaseCokpitAssignmentSuccess,this)},releaseCokpitAssignmentSuccess:function(){CWHF.showMsgInfo(getText("admin.project.msg.resetReleaseCockpit"))},getDetailPanel:function(){return this.panel=Ext.create("Ext.panel.Panel",{region:"center",border:!1,autoScroll:!1,bodyStyle:"padding:0px",layout:"anchor",items:[Ext.create("Ext.Component",{html:getText("admin.project.cockpit.help"),border:!0,anchor:"100%",minWidth:650,cls:"infoBox_bottomBorder"})]})},loadDetailPanel:function(){},
panelLoad:function(a){},postLoadProcess:function(a,b){}});
Ext.define("com.trackplus.admin.project.ProjectCopyController",{extend:"Ext.Base",config:{model:null,projectConfig:null,actionTarget:null},view:null,copy:!1,projectID:null,COPY_ACTION_WP_FROM_TPL:0,COPY_ACTION_TPL_FROM_WP:1,COPY_ACTION_COPY_TPL:2,COPY_ACTION_COPY_WP:3,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.projectID=this.model.projectID},getTitle:function(){switch(this.actionTarget){case this.COPY_ACTION_COPY_WP:return getText("admin.project.copy.title");case this.COPY_ACTION_TPL_FROM_WP:return getText("admin.project.copy.titleCreateTplFromWp");
case this.COPY_ACTION_COPY_TPL:return getText("admin.project.copy.titleCopyTpl");case this.COPY_ACTION_WP_FROM_TPL:return getText("common.btn.copyTo");default:return getText("admin.project.copy.title")}},getSaveLabel:function(){switch(this.actionTarget){case this.COPY_ACTION_COPY_WP:case this.COPY_ACTION_COPY_TPL:return getText("common.btn.copy");case this.COPY_ACTION_WP_FROM_TPL:return getText("admin.project.lbl.createSpace");case this.COPY_ACTION_TPL_FROM_WP:return getText("admin.project.lbl.createTemplate");
default:return getText("common.btn.copy")}},showDialog:function(){var a={loadUrl:"projectCopy.action",loadUrlParams:{projectID:this.projectID,actionTarget:this.actionTarget}},b={submitUrl:"projectCopy!copy.action",submitUrlParams:{projectID:this.projectID,actionTarget:this.actionTarget},submitButtonText:this.getSaveLabel(),refreshAfterSubmitHandler:this.reload},c=this.postDataProcess,e=this.getWindowTopHelpText(),a={title:this.getTitle(),width:500,height:600,load:a,submit:b,panelConfig:{bodyStyle:{padding:"5 5 5 0"}},
items:[{xtype:"component",cls:"infoBox_bottomBorder",border:!0,html:e},CWHF.createTextField("admin.project.copy.lbl.projectName","projectName",{allowBlank:!1,maxLength:255,padding:"5 5 5 5"})],postDataProcess:c};Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)},postDataProcess:function(a,b){this.populateProjectCopyControls(this,b,a)},reload:function(a,b){this.projectConfig.reloadAfterApplyingTemplate(b,this.actionTarget)},populateProjectCopyControls:function(a,b,c){var e=c.customLists,
f=[];null!=b&&(c.showAsSibling&&f.push(CWHF.createCheckbox("admin.project.copy.lbl.copyAsSiblingProject","copyAsSibling")),c.showCopySubprojects&&f.push(CWHF.createCheckbox("admin.project.copy.lbl.copySubprojects","copySubprojects")),c.showCopyItems&&f.push({xtype:"fieldset",itemId:"fsItems",title:getText("admin.project.copy.lbl.copyItems"),items:[CWHF.createCheckbox("admin.project.copy.lbl.copyOpenItems","copyOpenItems",null,{change:{fn:this.changeCopyItems,scope:this,panel:b,customLists:e}}),CWHF.createCheckbox("admin.project.copy.lbl.copyAttachments",
"copyAttachments",{disabled:!0})]}));var g=c.showCopyReleases;if(g||null!=e&&0<e.length){var h=[];g&&h.push(CWHF.createCheckbox("admin.project.copy.lbl.releases","copyReleases"));null!=e&&0<e.length&&Ext.Array.forEach(e,function(a){a=CWHF.createCheckbox(a.entityLabel,a.entityName,{labelIsLocalized:!0});h.push(a)},a);f.push({xtype:"fieldset",itemId:"fsLists",title:getText("admin.project.copy.lbl.customLists"),items:h})}c=c.associatedEntities;null!=c&&(h=[],Ext.Array.forEach(c,function(a){a=CWHF.createCheckbox(a.entityLabel,
a.entityName,{labelIsLocalized:!0});h.push(a)},a),f.push({xtype:"fieldset",itemId:"fsAssociated",title:getText("admin.project.copy.lbl.copyAssignments"),items:h}));b.add(f)},changeCopyItems:function(a,b,c,e){var f=e.panel;a=CWHF.getControl.apply(f,["fsItems","copyAttachments"]);null!=a&&(a.setDisabled(!b),b||a.setValue(!1));a=CWHF.getControl.apply(f,["fsLists","copyReleases"]);null!=a&&(a.setDisabled(b),b&&a.setValue(!0));e=e.customLists;null!=e&&0<e.length&&Ext.Array.forEach(e,function(a){a=CWHF.getControl.apply(f,
["fsLists",a.entityName]);null!=a&&(a.setDisabled(b),b&&a.setValue(b))},this);e=CWHF.getControl.apply(f,["fsAssociated","associatedEntitiyMap[5]"]);null!=e&&(e.setDisabled(b),b&&e.setValue(!0))},getWindowTopHelpText:function(){switch(this.actionTarget){case this.COPY_ACTION_COPY_WP:return getText("admin.project.copy.lbl.message");case this.COPY_ACTION_TPL_FROM_WP:return getText("admin.projectTemplate.copy.lbl.messageCreateTplFromWp");case this.COPY_ACTION_COPY_TPL:return getText("admin.projectTemplate.copy.lbl.messageCopyTemplate");
case this.COPY_ACTION_WP_FROM_TPL:return getText("admin.projectTemplate.copy.lbl.messageCreateWpFromTpl");default:return getText("admin.project.copy.lbl.message")}}});
com.trackplus.admin.project.Release=Ext.define("com.trackplus.admin.project.Release",{extend:"com.trackplus.admin.TreeWithGrid",config:{projectID:null},statics:{createEditPanelItems:function(a){return[CWHF.createTextField("common.lbl.name","releaseDetailTO.label",{allowBlank:!1,labelWidth:a,maxLength:255}),CWHF.createCombo("admin.customize.localeEditor.type.releaseStatus","releaseDetailTO.releaseStatusID",{labelWidth:a},null,"statusID"),CWHF.createDateField("admin.project.release.lbl.dueDate","releaseDetailTO.dueDate",
{labelWidth:a}),CWHF.createCheckboxWithHelp("admin.project.release.lbl.defaultReleaseNoticed","releaseDetailTO.defaultNoticed",{labelWidth:a,width:a+50}),CWHF.createCheckboxWithHelp("admin.project.release.lbl.defaultReleaseScheduled","releaseDetailTO.defaultScheduled",{labelWidth:a,width:a+50}),CWHF.createTextAreaField("common.lbl.description","releaseDetailTO.description",{maxLength:255,labelWidth:a})]},postDataLoadCombo:function(a,b){var c=b.getComponent("statusID");null!=c&&(c.store.loadData(a.statusList),
c.setValue(a["releaseDetailTO.statusID"]))}},baseAction:"release",dragAndDropOnGrid:!0,dragAndDropOnTree:!0,tree:null,folderEditWidth:500,folderEditHeight:400,labelWidth:120,localizedMain:null,localizedChild:null,showClosedReleases:!0,addAsChild:!1,actionAddMainRelease:null,actionAddChildRelease:null,actionEditGridRow:null,actionEditTreeNode:null,actionDeleteGridRow:null,actionDeleteTreeNode:null,actionDetachFromParentRelease:null,actionMoveUp:null,actionMoveDown:null,actionShowClosed:null,actionReload:null,
constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init(a)},init:function(a){this.initLocalizedLabels(a.projectID)},initLocalizedLabels:function(a){Ext.Ajax.request({fromCenterPanel:!0,url:this.baseAction+"!localizedLabels.action",scope:this,params:{node:a},success:function(a){a=Ext.decode(a.responseText);this.localizedMain=a.localizedMain;this.localizedChild=a.localizedChild;this.showClosedReleases=a.showClosedReleases;this.initActions()},failure:function(a){Ext.MessageBox.alert(this.failureTitle,
a.responseText)}})},postInitCenterPanel:function(a){this.getGridPanel(a)},getEntityLabel:function(a){return null!=a&&(a=a.selectedRecord,null!=a&&a.data.isChild)?this.localizedChild:this.localizedMain},getAddIconCls:function(){return"releaseAdd"},getEditIconCls:function(){return"releaseEdit"},getAddMainLabel:function(){return getText(this.getAddTitleKey(),this.localizedMain)},getAddChildLabel:function(){return getText(this.getAddTitleKey(),this.localizedChild)},initActions:function(){this.actionAddMainRelease=
this.createLocalizedAction(this.getAddMainLabel(),this.getAddIconCls(),this.onAddMainRelease,this.getAddMainLabel());this.actionAddChildRelease=this.createLocalizedAction(this.getAddChildLabel(),this.getAddIconCls(),this.onAddChildRelease,this.getAddChildLabel(),!0);this.actionEditGridRow=this.createAction(this.getEditButtonKey(),this.getEditIconCls(),this.onEditGridRow,!0,this.getEditTitleKey(),"editGridRow");this.actionEditTreeNode=this.createAction(this.getEditTitleKey(),this.getEditIconCls(),
this.onEditTreeNode,!1,this.getEditTitleKey(),"editTreeNode");this.actionDeleteGridRow=this.createAction(this.getDeleteButtonKey(),this.getDeleteIconCls(),this.onDeleteFromGrid,!0,this.getDeleteTitleKey(),"deleteGridRow");this.actionDeleteTreeNode=this.createAction(this.getDeleteTitleKey(),this.getDeleteIconCls(),this.onDeleteFromTree,!1,this.getDeleteTitleKey(),"deleteTreeNode");this.actionDetachFromParentRelease=this.createLocalizedAction(getText("common.lbl.detachFromParent"),"clear",this.onDetachFromParentRelease,
getText("common.lbl.detachFromParent"));this.actionMoveUp=this.createAction("common.btn.up","moveUp",this.onMoveUpGridRow,!0,"common.lbl.up","moveUp");this.actionMoveDown=this.createAction("common.btn.down","moveDown",this.onMoveDownGridRow,!0,"common.lbl.down","moveDown");var a=this.getShowHideLabelKey();this.actionShowClosed=this.createAction(a,"showHide",this.onShowHide,!1,a,"showHide",{enableToggle:!0,pressed:!this.showClosedReleases});this.actionReload=this.createLocalizedAction(getText("common.btn.reload"),
"reload",this.onReload)},getShowHideLabelKey:function(){return this.showClosedReleases?"common.btn.hide":"common.btn.show"},onShowHide:function(){var a=borderLayout.getActiveToolbarList().getComponent("showHide");this.showClosedReleases=!a.pressed;var b=getText(this.getShowHideLabelKey());a.setText(b);a.setTooltip(b);this.treeNodeSelect(null,null,null,{showClosedReleases:this.showClosedReleases})},onReload:function(){var a=this.getLastSelectedTreeNode();this.tree.getStore().load({node:a})},getGridExtraParams:function(a,
b){null==a&&(a=this.selectedNode);var c={node:a.data.id};null!=b&&null!=b.showClosedReleases&&(c.showClosedReleases=b.showClosedReleases);return c},getToolbarActions:function(){return[this.actionAddMainRelease,this.actionAddChildRelease,this.actionEditGridRow,this.actionDeleteGridRow,this.actionMoveUp,this.actionMoveDown,this.actionShowClosed]},onAddMainRelease:function(){this.onAdd(!1)},onAddChildRelease:function(){this.onAdd(!0)},onAdd:function(a){var b=this.getTitle(this.getAddTitleKey()),c=this.getAddParams(a);
a=this.getAddParams(a);var e=this.getAddSelectionAfterSaveFromResult(),f=this.getSingleSelectedRecord(!0);return this.onAddEdit(b,f,null,!1,!0,!0,c,a,null,e)},getAddParams:function(a){a={add:!0,addAsChild:a};null!=this.selectedNode&&(a.node=this.selectedNode.data.id);return a},getAddSelectionAfterSaveFromResult:function(){return[{parameterName:"nodeIDToSelect",fieldNameFromResult:"node"},{parameterName:"rowToSelect",fieldNameFromResult:"node"},{parameterName:"nodeIDToReload",fieldNameFromResult:"nodeIDToReload"},
{parameterName:"reloadTree",fieldNameFromResult:"reloadTree"}]},getTreeContextMenuActions:function(a,b){if(null!=a){var c=[this.actionAddChildRelease,this.actionEditTreeNode,this.actionDeleteTreeNode,this.actionReload];null==a.parentNode||a.parentNode.isRoot()||c.push(this.actionDetachFromParentRelease);return c}return[]},getTreeFields:function(a){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"isChild",type:"boolean"},
{name:"iconCls",mapping:"iconCls",type:"string"}]},getGridFields:function(a){return[{name:"node",type:"string"},{name:"label",type:"string"},{name:"statusFlag",type:"int"},{name:"statusLabel",type:"string"},{name:"dueDate",type:"date",dateFormat:com.trackplus.TrackplusConfig.ISODateFormat},{name:"defaultNoticed",type:"boolean"},{name:"defaultScheduled",type:"boolean"},{name:"isChild",type:"boolean"}]},getGridColumns:function(a){return[{header:getText("common.lbl.name"),flex:1,dataIndex:"label",sortable:!1,
renderer:this.renderer},{header:getText("admin.project.release.lbl.status"),flex:1,dataIndex:"statusLabel",sortable:!1,renderer:this.renderer},{header:getText("admin.project.release.lbl.dueDate"),flex:1,dataIndex:"dueDate",sortable:!1,renderer:this.dateRenderer},{xtype:"checkcolumn",header:getText("admin.project.release.lbl.defaultReleaseNoticed"),flex:1,dataIndex:"defaultNoticed",sortable:!1},{xtype:"checkcolumn",header:getText("admin.project.release.lbl.defaultReleaseScheduled"),flex:1,dataIndex:"defaultScheduled",
sortable:!1}]},dateRenderer:function(a,b,c){2==c.data.statusFlag&&(b.style="color:#909090");return Ext.util.Format.date(a,com.trackplus.TrackplusConfig.DateFormat)},renderer:function(a,b,c){2==c.data.statusFlag&&(b.style="color:#909090");return a},canDragDropNode:function(a,b,c){return null!=a&&!a.isAncestor(c)},onDetachFromParentRelease:function(){var a=this.getLastSelected(!0);if(null!=a){var b=a.data.id;Ext.Ajax.request({url:this.baseAction+"!clearParent.action",params:{node:b},disableCaching:!0,
scope:this,success:function(a){com.trackplus.util.RefreshAfterSubmit.refreshTreeAfterSubmit.call(this,{nodeIDToSelect:b,reloadTree:!0})}})}},getPanelItems:function(a,b,c,e,f){return com.trackplus.admin.project.Release.createEditPanelItems(this.labelWidth)},getEditPostDataProcess:function(a,b,c){return com.trackplus.admin.project.Release.postDataLoadCombo},recommendedReplace:function(a,b,c){var e=CWHF.createSingleTreePicker("admin.project.release.moveReleaseItems.replacementRelease","replacementID",
c.replacementTree,null,{allowBlank:!0,labelWidth:250,margin:"5 0 0 0"});c=[{xtype:"label",html:c.errorMessage},e];var f=getText("admin.project.release.moveReleaseItems.title"),g={submitButtonText:getText("common.btn.move"),submitHandler:function(c,f,g,m){b.submitUrlParams.replacementID=e.getValue();c.close();a.submitHandler(b,this,0)}};Ext.create("com.trackplus.util.WindowConfig").showWindow(this,f,this.replacementWidth,this.replacementHeight,{loadHandler:function(){}},g,c)},getReplacementItems:function(a,
b,c){return[{xtype:"label",itemId:"replacementWarning"},CWHF.createSingleTreePicker("Replacement","replacementID",[],null,{allowBlank:!1,blankText:getText("common.err.replacementRequired",this.getEntityLabel(c)),labelWidth:150,margin:"5 0 0 0"})]},loadReplacementOptionData:function(a,b){a.updateData(b.replacementTree)},getActionItemIdsWithContextDependentLabel:function(){return"editGridRow editTreeNode deleteGridRow deleteTreeNode moveUp moveDown showHide".split(" ")},getToolbarActionChangesForTreeNodeSelect:function(a){this.actionAddChildRelease.setDisabled(null==
a||this.rootID==a.data.id);this.actionEditGridRow.setDisabled(!0);this.actionDeleteGridRow.setDisabled(!0);this.actionMoveUp.setDisabled(!0);this.actionMoveDown.setDisabled(!0)},enableDisableToolbarButtons:function(a,b){null==b||0==b.length?(this.actionAddChildRelease.setDisabled(!0),this.actionDeleteGridRow.setDisabled(!0),this.actionEditGridRow.setDisabled(!0),this.actionMoveUp.setDisabled(!0),this.actionMoveDown.setDisabled(!0)):(this.actionDeleteGridRow.setDisabled(!1),1==b.length?(this.actionAddChildRelease.setDisabled(!1),
this.actionEditGridRow.setDisabled(!1),this.actionMoveUp.setDisabled(!1),this.actionMoveDown.setDisabled(!1)):(this.actionAddChildRelease.setDisabled(!0),this.actionEditGridRow.setDisabled(!0),this.actionMoveUp.setDisabled(!0),this.actionMoveDown.setDisabled(!0)))}});com.trackplus.vc={};
Ext.define("com.trackplus.vc.VersionControlFacade",{extend:"Ext.Base",config:{model:null},view:null,controller:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.controller=Ext.create("com.trackplus.vc.VersionControlController",{model:this.model})},getDetailPanel:function(){return this.controller.createView.call(this.controller)},initActions:function(){this.controller.initToolbar.call(this.controller)},getToolbarActions:function(){return this.controller.getToolbar.call(this.controller)}});
Ext.define("com.trackplus.vc.VersionControlController",{extend:"Ext.Base",config:{model:null},view:null,lastFormData:null,vcPlugin:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},createView:function(){this.view=Ext.create("com.trackplus.vc.VersionControlView",{model:this.model,controller:this});this.addMyListeners();this.loadData.call(this);return this.view},getView:function(){null==this.view&&this.createView();return this.view},addMyListeners:function(){this.view.addListener("changeUseVC",
this.changeUseVC,this);this.view.addListener("changeVC",this.changeVC,this)},getToolbar:function(){null==this.actionSave&&this.initToolbar();return[this.actionSave]},initToolbar:function(){var a=this;a.actionSave=Ext.create("Ext.Action",{overflowText:getText("common.btn.save"),tooltip:getText("common.btn.save"),text:getText("common.btn.save"),iconCls:"save",disabled:!1,handler:function(){a.save.call(a)}})},loadData:function(){var a=this;Ext.Ajax.request({url:"versionControlConfig.action",params:{projectID:+a.model.projectID},
disableCaching:!0,scope:a,success:function(b){b=Ext.decode(b.responseText).data;a.model=b;a.lastFormData=a.model;a.view.cmbVCPlugins.store.loadData(a.model.vcPluginList);a.view.cmbVCPlugins.setValue(a.model["vc.versionControlType"]);a.view.checkUseVC.setValue(""+a.model["vc.useVersionControl"])}})},save:function(){var a=this,b="versionControlConfig!save.action?projectID\x3d"+a.model.projectID;borderLayout.setLoading(!0);a.view.formPanel.getForm().submit({url:b,params:{"vc.useVersionControl":a.view.checkUseVC.getRawValue(),
"vc.versionControlType":a.view.cmbVCPlugins.getValue()},success:function(b,e){borderLayout.setLoading(!1);!1==e.result.success?a.handleErrors(e.result.errors):CWHF.showMsgInfo(getText("admin.project.versionControl.successSave"))},failure:function(b,e){borderLayout.setLoading(!1);a.handleErrors(e.result.errors)}})},testVC:function(){var a=this;if(!a.view.formPanel.getForm().isValid())return CWHF.showMsgError(getText("admin.project.versionControl.errorSave")),!1;borderLayout.setLoading(!0);var b="versionControlConfig!test.action?projectID\x3d"+
a.model.projectID;a.view.formPanel.getForm().submit({url:b,params:{"vc.useVersionControl":a.view.checkUseVC.getRawValue(),"vc.versionControlType":a.view.cmbVCPlugins.getValue()},success:function(a,b){borderLayout.setLoading(!1);CWHF.showMsgInfo("The settings are valid")},failure:function(b,e){borderLayout.setLoading(!1);null!=e.result&&null!=e.result.errors?a.handleErrors(e.result.errors):CWHF.showMsgError("Invalid settings!")}})},handleErrors:function(a){for(var b=getText("admin.project.versionControl.errorSave"),
c=0;c<a.length;c++){var e=this.vcPlugin.getControl.call(this.vcPlugin,a[c].id);null!=e?e.markInvalid(a[c].label):b=b+a[c].label+" "}CWHF.showMsgError(b)},changeVC:function(a){this.lastFormData=this.view.formPanel.getForm().getValues();this.doChangeVC(a)},doChangeVC:function(a){var b=this;b.view.clearFormPanel();for(var c=b.vcPlugin=null,e=null,f=b.model.vcPluginList,g=0;null!=f&&g<f.length;g++)if(f[g].id==a){e=f[g];c=e.jsConfigClass;break}if(null!=c)try{b.vcPlugin=Ext.create(c,{model:b.model,pluginDescriptor:e})}catch(h){alert("ex:"+
h)}null!=b.vcPlugin&&b.view.checkUseVC.getRawValue()&&(b.view.replaceFormPanel(b.vcPlugin),b.view.setLoading(!0),b.view.formPanel.getForm().load({url:"versionControlConfig!loadVCPlugin.action",params:{projectID:b.model.projectID,pluginID:a},success:function(a,c){var e=c.result.data;try{b.vcPlugin.postProcessDataLoad.call(b.vcPlugin,e)}catch(f){}b.view.setLoading(!1)}}))},changeUseVC:function(a){this.view.cmbVCPlugins.setDisabled(!a);this.view.testBtn.setDisabled(!a);a&&null==this.view.cmbVCPlugins.getValue()&&
null!=this.model.vcPluginList&&0<this.model.vcPluginList.length&&this.view.cmbVCPlugins.setValue(this.model.vcPluginList[0].id);this.doChangeVC(this.view.cmbVCPlugins.getValue())}});
Ext.define("com.trackplus.vc.VersionControlView",{extend:"Ext.panel.Panel",config:{model:null,controller:null},region:"center",layout:"border",border:!1,bodyBorder:!1,initComponent:function(){this.items=this.createChildren();this.addEvents("changeVC","changeUseVC");this.callParent()},createChildren:function(){var a=this,b=[];a.checkUseVC=Ext.create("Ext.form.field.Checkbox",{fieldLabel:getText("admin.project.versionControl.useVersionControl"),name:"vc.useVersionControl",labelAlign:"right",labelWidth:250,
style:{marginLeft:"15px"},inputValue:"true",listeners:{change:{fn:a.changeUseVC,scope:a}}});a.cmbVCPlugins=Ext.create("Ext.form.field.ComboBox",{hideLabel:!0,style:{marginLeft:"5px"},displayField:"label",valueField:"id",store:new Ext.data.Store({data:[],fields:[{name:"id",type:"string"},{name:"label",type:"string"}],autoLoad:!1}),queryMode:"local",typeAhead:!0,triggerAction:"all",name:"vc.versionControlType",listeners:{select:{fn:a.changeVC,scope:a}}});var c=Ext.create("Ext.Component",{html:getText("admin.project.versionControl.help"),
border:!0,region:"north",cls:"infoBox_bottomBorder"});b.push(c);a.northPanel=Ext.create("Ext.panel.Panel",{layout:{type:"hbox",padding:5},border:!1,bodyBorder:!1,items:[a.checkUseVC,a.cmbVCPlugins]});a.formPanel=Ext.create("Ext.form.Panel",{autoScroll:!0,border:!1,bodyBorder:!1});a.testBtn=Ext.create("Ext.button.Button",{style:{marginTop:"10px",marginBottom:"5px",marginLeft:"275px"},disabled:!0,iconCls:"check16",text:getText("admin.project.versionControl.lbl.test"),handler:function(){a.controller.testVC.call(a.controller)},
scope:a});a.centerPanel=Ext.create("Ext.panel.Panel",{region:"center",layout:"anchor",autoScroll:!0,border:!1,items:[a.northPanel,a.formPanel,a.testBtn]});b.push(a.centerPanel);return b},changeUseVC:function(){this.fireEvent.call(this,"changeUseVC",this.checkUseVC.getRawValue())},changeVC:function(){this.fireEvent.call(this,"changeVC",this.cmbVCPlugins.getValue())},replaceFormPanel:function(a){this.formPanel.removeAll(!0);this.formPanel.add(a);this.formPanel.doLayout()},clearFormPanel:function(){this.centerPanel.remove(this.formPanel,
!0);this.formPanel=Ext.create("Ext.form.Panel",{autoScroll:!0,border:!1,bodyBorder:!1});this.centerPanel.insert(1,this.formPanel);this.doLayout();this.formPanel.removeAll(!0);this.formPanel.doLayout()}});
Ext.define("com.trackplus.vc.VersionControlPlugin",{extend:"Ext.panel.Panel",config:{model:null,pluginDescriptor:null},layout:"anchor",labelWidth:250,textFieldWidth:550,alignR:"right",border:!1,bodyBorder:!1,bodyPadding:0,getControl:function(a){return null},initComponent:function(){this.items=this.createChildren();this.callParent()},createChildren:function(){var a=[];a.push(this.createBrowserFieldSet());return a},postProcessDataLoad:function(a){this.cmbBrowser.store.loadData(a.browsers);this.browserList=
a.browsers;a=a["vc.browserID"];this.cmbBrowser.setValue(a);this.setDisabledLinks(null==a||"-1"==a);"integratedwebsvn"==a&&this.setRepoBrowserTxtFieldDisabled(!0)},createBrowserFieldSet:function(){this.cmbBrowser=CWHF.createCombo("admin.project.lbl.vcBrowser","vc.browserID",{data:[],idType:"string"},{select:{fn:this.changeBrowser,scope:this}});this.cmbBrowser.setValue(this.browser);this.cmbBrowserWrapper=Ext.create("com.trackplus.util.HelpWrapperComponent",{inputComp:this.cmbBrowser,helpStr:getText("admin.project.lbl.vcBrowser.help")});
this.txtChangedLink=CWHF.createTextField("admin.project.lbl.vc.changesetLink","vc.changesetLink",{anchor:"100%"});this.txtAddedLink=CWHF.createTextField("admin.project.lbl.vc.addedLink","vc.addedLink",{anchor:"100%"});this.txtModifiedLink=CWHF.createTextField("admin.project.lbl.vc.modifiedLink","vc.modifiedLink",{anchor:"100%"});this.txtReplacedLink=CWHF.createTextField("admin.project.lbl.vc.replacedLink","vc.replacedLink",{anchor:"100%"});this.txtDeletedLink=CWHF.createTextField("admin.project.lbl.vc.deletedLink",
"vc.deletedLink",{anchor:"100%"});return{xtype:"fieldset",title:getText("admin.project.lbl.vcBrowser"),collapsible:!1,defaultType:"textfield",defaults:{anchor:"100%"},layout:"anchor",items:[this.cmbBrowserWrapper,this.txtChangedLink,this.txtAddedLink,this.txtModifiedLink,this.txtReplacedLink,this.txtDeletedLink]}},createRadioGroup:function(a,b,c,e,f,g,h){h=this.textFieldWidth;for(var k=[],l=0;l<e.length;l++)k.push({name:b,inputValue:e[l].id,boxLabel:e[l].label,checked:e[l].id==c});return Ext.create("Ext.form.RadioGroup",
{fieldLabel:null==a?"":getText(a),hideLabel:null==a,labelStyle:{overflow:"hidden"},labelWidth:this.labelWidth,labelAlign:this.alignR,width:h,anchor:"100%",layout:"hbox",columns:1,vertical:!0,defaults:{margin:"0 5 0 0"},listeners:{change:function(a,b,c,e){null!=f&&f.call(g,a,b,c,e)}},items:k})},setDisabledLinks:function(a){this.txtChangedLink.setDisabled(a);this.txtAddedLink.setDisabled(a);this.txtModifiedLink.setDisabled(a);this.txtReplacedLink.setDisabled(a);this.txtDeletedLink.setDisabled(a)},setRepoBrowserTxtFieldDisabled:function(a){this.txtChangedLink.setReadOnly(a);
this.txtAddedLink.setReadOnly(a);this.txtModifiedLink.setReadOnly(a);this.txtReplacedLink.setReadOnly(a);this.txtDeletedLink.setReadOnly(a)},changeBrowser:function(){var a=this.cmbBrowser.getValue();this.setDisabledLinks(null==a||"-1"==a);var b="",c="",e="",f="",g="";if(null!=this.browserList&&null!=a&&"-1"!=a)for(var h=0;h<this.browserList.length;h++)if(this.browserList[h].id==a){b=this.browserList[h].baseURL+this.browserList[h].changesetLink;c=this.browserList[h].baseURL+this.browserList[h].addedLink;
e=this.browserList[h].baseURL+this.browserList[h].modifiedLink;f=this.browserList[h].baseURL+this.browserList[h].replacedLink;g=this.browserList[h].baseURL+this.browserList[h].deletedLink;break}this.txtChangedLink.setValue(b);this.txtAddedLink.setValue(c);this.txtModifiedLink.setValue(e);this.txtReplacedLink.setValue(f);this.txtDeletedLink.setValue(g);"integratedwebsvn"==a?this.setRepoBrowserTxtFieldDisabled(!0):this.setRepoBrowserTxtFieldDisabled(!1)}});
Ext.define("com.trackplus.admin.project.RoleAssignment",{extend:"com.trackplus.admin.TreeDetailAssignment",config:{rootID:"",baseAction:null,dynamicIcons:!1},baseAction:"roleAssignments",actionRemovePerson:null,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a);this.init()},getEntityLabel:function(a){var b=!1;null!=a&&null!=a.selectedRecord&&(b=a.selectedRecord.data.isGroup);return b?getText("admin.user.group.lbl.group"):getText("admin.user.lbl.user")},initActions:function(){this.actionRemovePerson=
this.createLocalizedAction(getText("common.lbl.remove",getText("admin.user.lbl.user")),this.getDeleteIconCls(),this.onRemovePerson,getText("common.lbl.remove",getText("admin.user.lbl.user")));this.actionRemovePerson=this.createAction("common.lbl.remove",this.getDeleteIconCls(),this.onRemovePerson,!1,"common.lbl.remove","removePerson")},getTreeContextMenuActions:function(a,b){return a.isLeaf()?[this.actionRemovePerson]:[]},getActionItemIdsWithContextDependentLabel:function(){return["removePerson"]},
getRootMessage:function(){return getText("admin.project.roleAssignment.lbl.infoGeneral")},onRemovePerson:function(){this.reloadAssigned(this.baseAction+"!unassign.action",{})},getTreeFields:function(){return[{name:"id",mapping:"id",type:"string"},{name:"text",mapping:"text",type:"string"},{name:"leaf",mapping:"leaf",type:"boolean"},{name:"group",mapping:"group",type:"boolean"},{name:"iconCls",mapping:"iconCls",type:"string"}]},getGridFields:function(a){return[{name:"id",type:"int"},{name:"name",type:"string"},
{name:"userName",type:"string"},{name:"active",type:"boolean"},{name:"activeLabel",type:"string"},{name:"group",type:"boolean"},{name:"groupLabel",type:"string"},{name:"employeeId",type:"string"},{name:"department",type:"string"}]},getColumnModel:function(){return[{text:getText("common.lbl.name"),flex:2,dataIndex:"name",sortable:!0,groupable:!1,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.userName"),flex:1,dataIndex:"userName",sortable:!0,groupable:!1,filterable:!0,
renderer:this.renderer},{text:getText("admin.user.profile.lbl.department"),flex:2,dataIndex:"department",sortable:!0,groupable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.project.roleAssignment.lbl.group"),flex:1,dataIndex:"groupLabel",sortable:!0,groupable:!0,filterable:!0,renderer:this.renderer},{text:getText("admin.user.profile.lbl.employeeId"),flex:1,dataIndex:"employeeId",sortable:!0,groupable:!1,filterable:!0,renderer:this.renderer,hidden:!0},{text:getText("admin.user.manage.lbl.activ"),
flex:1,dataIndex:"activeLabel",sortable:!0,groupable:!0,filterable:!0,renderer:this.renderer,hidden:!0}]},renderer:function(a,b,c){c.data.active||(b.style="color:#909090");return a},hideGridHeaders:function(){return!1},enableColumnHide:function(){return!0},getGridFeatures:function(){return features=[Ext.create("Ext.grid.feature.Grouping",{groupHeaderTpl:'{name} ({rows.length} Item{[values.rows.length \x3e 1 ? "s" : ""]})'}),{ftype:"filters",encode:!1,local:!0,filters:[{type:"string",dataIndex:"name"},
{type:"string",dataIndex:"department"},{type:"string",dataIndex:"groupLabel"},{type:"string",dataIndex:"activeLabel"}]}]},getGroupingFeature:function(a){return a[0]},getDetailWidth:function(){return 600},getDetailHeight:function(){return 600},getMinWidth:function(){return 425}});
Ext.define("com.trackplus.admin.action.ImportWizard",{extend:"Ext.Base",config:{},wizardPanel:null,fileName:null,uploadDone:!1,constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},getToolbarActions:function(){return[]},getWizardPanel:function(){var a=[];1<this.getNumberOfCards()?(a.push({xtype:"button",itemId:"previous",text:"\x26laquo; "+getText("common.lbl.wizard.previous"),scope:this,handler:function(a){this.onNavigate(a,a.up("panel"))},disabled:!0}),a.push("-"),a.push({xtype:"button",
itemId:"next",text:getText("common.lbl.wizard.next")+" \x26raquo;",scope:this,handler:function(a){this.onNavigate(a,a.up("panel"))}}),a.push("-"),a.push({xtype:"button",itemId:"finish",iconCls:"import16",text:getText("common.btn.import"),scope:this,handler:function(a){this.onNavigate(a,a.up("panel"))},disabled:!0}),a.push("-\x3e"),a.push({xtype:"box",itemId:"indicator",style:"margin-right: 5px",width:100,autoEl:{tag:"div",html:""}})):a.push({itemId:"finish",text:getText("common.btn.import"),scope:this,
handler:function(a){this.loadDataForCard(1,!0)},disabled:!1});this.wizardPanel=Ext.create("Ext.panel.Panel",{title:"",layout:"card",region:"center",cls:"importWizard",defaults:{border:!1},items:[this.createEmptyCard("card1",!0)],dockedItems:[{xtype:"toolbar",cls:"importWizard",dock:"top",items:a}]});this.initCards(2);this.loadDataForCard(1);return this.wizardPanel},initCards:function(a){var b=this.wizardPanel.getLayout().getLayoutItems();if(1<b.length)for(var c=a-1;c<b.length;c++)this.wizardPanel.remove(b[c],
!0);for(c=a;c<=this.getNumberOfCards();c++)this.wizardPanel.add(this.createEmptyCard("card"+c,!1));this.actualizeToolbar(this.wizardPanel)},removeCard:function(a){this.wizardPanel.getLayout().getLayoutItems().length>=a&&this.wizardPanel.remove(a-1,!0);this.actualizeToolbar(this.wizardPanel)},getNumberOfCards:function(){return 1},createEmptyCard:function(a,b){return Ext.create("Ext.form.Panel",{itemId:a,componentCls:"importWizard",fileUpload:b,border:!1,autoScroll:!0,defaults:{labelStyle:"overflow: hidden;",
msgTarget:"side"},method:"POST",items:[]})},onNavigate:function(a,b){var c=b.getLayout(),e=c.getActiveItem(),f=b.items.indexOf(e),e=b.items.getCount()-1;if(null!=a){var g=null;"next"==a.itemId||"finish"==a.itemId&&f<=e?(c=!1,f==e&&(f-=1,c=!0,g=this.getDataBeforeCardDelete(f+2,c)),this.initCards(f+2),!1!=this.loadDataForCard(f+2,c,g)&&b.layout.setActiveItem(f+1)):"previous"==a.itemId&&0<f&&(e=c.getActiveItem(),e.removeAll(),b.layout.setActiveItem(f-1))}this.actualizeToolbar(b)},goPrevious:function(){var a=
this.wizardPanel.getLayout().getActiveItem(),a=this.wizardPanel.items.indexOf(a);0<a&&this.wizardPanel.layout.setActiveItem(a-1);this.actualizeToolbar(this.wizardPanel)},goNext:function(){var a=this.wizardPanel.getLayout().getActiveItem(),a=this.wizardPanel.items.indexOf(a);0<a&&this.wizardPanel.layout.setActiveItem(a+1);this.actualizeToolbar(this.wizardPanel)},actualizeToolbar:function(a){var b=a.getLayout(),c=b.getActiveItem(),c=a.items.indexOf(c),e=a.items.getCount(),f=a.getDockedItems('toolbar[dock\x3d"top"]'),
g=f[0].getComponent("previous");null!=g&&g.setDisabled(!b.getPrev());b=f[0].getComponent("next");null!=b&&b.setDisabled(c+1>=e-1);b=f[0].getComponent("finish");null!=b&&b.setDisabled(c+1!=e-1);f=f[0].getComponent("indicator");null!=f&&(e=getText("common.lbl.wizard.step",c+1,e),a.setTitle(this.getTitle(c+1)),f.update(e))},getTitle:function(a){return""},validateFileExtension:function(a){return this.getFilePattern().test(a)},getFilePattern:function(){return/^.*$/},getFileTypeLabel:function(){return""},
getFileEmptyText:function(){return""},loadDataForCard:function(a,b,c){},getDataBeforeCardDelete:function(a,b){},submitFromCardToCard:function(a,b,c,e,f){var g=this.wizardPanel.getComponent("card"+a),h=this.wizardPanel.getComponent("card"+b);if(!g.getForm().isValid())return!1;h.setLoading(getText("common.lbl.loading"));null!=f&&(g.getForm().timeout=f);g.getForm().submit({url:this.getImportWizardUrl(b,e),params:c,scope:this,method:"POST",success:function(c,e){h.setLoading(!1);h.removeAll(!0);h.add(this.getImportWizardItemsForCard(b));
this.postDataProcess(h,e.result,b,a)},failure:function(c,e){h.setLoading(!1);h.removeAll();h.add(this.getImportWizardItemsForCard(b));var f=e.result;null==f&&(f=e.response);this.postDataProcess(h,f,b,a)}})},submitFromCardToCardMessageOnFailure:function(a,b,c,e,f){var g=this.wizardPanel.getComponent("card"+a),h=this.wizardPanel.getComponent("card"+b);h.setLoading(getText("common.lbl.loading"));g.getForm().submit({url:this.getImportWizardUrl(b,e),params:c,scope:this,method:"POST",success:function(c,
e){h.setLoading(!1);if(a!=b){h.removeAll(!0);var f=this.getImportWizardItemsForCard(b);h.add(f)}this.postDataProcess(h,e.result,b,a)},failure:function(a,b){h.setLoading(!1);f&&this.goPrevious();com.trackplus.util.submitFailureHandler(a,b)}})},getImportWizardUrl:function(a,b){return""},getImportWizardItemsForCard:function(a){return this.getImportWizardCard1Items()},postDataProcess:function(a,b,c,e){this.postProcessCard1(a,b)},getImportWizardCard1Items:function(){var a=[CWHF.createFileField(getText("common.lbl.file",
this.getFileTypeLabel()),"uploadFile",{allowBlank:!1,labelWidth:250,width:700,labelIsLocalized:!0,emptyText:this.getFileEmptyText()},{change:{fn:function(){this.uploadDone=!1},scope:this}})];a.push({xtype:"label",itemId:"importSourceError"});return a},postProcessCard1:function(a,b){a.getComponent("uploadFile").setRawValue("")}});
Ext.define("com.trackplus.admin.action.ImportExcel",{extend:"com.trackplus.admin.action.ImportWizard",config:{},itemNavigatorController:null,selectedSheet:null,workItemIDFieldIDs:null,window:null,dialogHeight:470,dialogWidth:850,getNumberOfCards:function(){return 4},getTitle:function(a){var b=null;switch(a){case 1:b="admin.actions.importExcel.title.upload";break;case 2:b="admin.actions.importExcel.title.excelFieldMatch";break;case 3:b="admin.actions.importExcel.invalidValueHadling.title";break;case 4:b=
"admin.actions.importExcel.title.errorAndConflict"}return null!=b?getText(b):""},getFilePattern:function(a){return/^.*\.(xls|XLS|xlsx|XLSX)$/},getFileTypeLabel:function(){return getText("admin.actions.importExcel.lbl.uploadFile")},getFileEmptyText:function(){return""},getImportWizardUrl:function(a,b){if(1==a)return"excelUploadRender.action";if(2==a)return"excelUpload.action";if(3==a)return b?"excelInvalidValueHandling.action":"excelFieldMatch!save.action";if(4==a)return"excelImport.action"},getDataBeforeCardDelete:function(a,
b){var c=null;if(4==a&&(c={fileName:this.fileName,selectedSheet:this.selectedSheet},b&&null!=this.workItemIDFieldIDs)){var e=this.wizardPanel.getComponent("card4").getComponent("errorAndConflict").getComponent("conflictPanel");Ext.Array.forEach(this.workItemIDFieldIDs,function(a){var b=e.getComponent("conflictResoultion"+a);a="overwriteMap['"+a+"']";b=CWHF.getSelectedRadioButtonValue(b);c[a]=b},this)}return c},loadDataForCard:function(a,b,c){if(1==a){var e=this.wizardPanel.getComponent("card1");e.add(this.getImportWizardItemsForCard(a));
e.getForm().load({url:this.getImportWizardUrl(a,b),scope:this,success:function(a,b){try{this.postDataProcess(e,b.result.data,1)}catch(c){}},failure:function(a,b){Ext.MessageBox.alert(this.failureTitle,b.response.responseText)}})}else if(2==a){e=this.wizardPanel.getComponent("card1");if(!e.getForm().isValid())return Ext.MessageBox.show({title:"",msg:getText("admin.actions.importTp.lbl.uploadFileNotSpecified"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR}),!1;c=e.getComponent("uploadFile");if(!this.validateFileExtension(c.getRawValue()))return Ext.MessageBox.alert(getText("admin.actions.importTp.lbl.uploadFileWrongType"),
getText("common.err.fileExpectedType",this.getFileTypeLabel())),!1;if(this.uploadDone)return Ext.MessageBox.alert(getText("admin.actions.importTp.err.uploadAgain"),getText("admin.actions.importTp.err.uploadAgain",this.getFileTypeLabel())),!1;this.uploadDone=!0;this.submitFromCardToCardMessageOnFailure(1,2,null,b,!0)}else 3==a?(a=2,b&&(a=3),c={fileName:this.fileName,selectedSheet:this.selectedSheet,reload:b},this.submitFromCardToCardMessageOnFailure(a,3,c,b,!0)):4==a&&(null==c&&(c={fileName:this.fileName,
selectedSheet:this.selectedSheet}),this.submitFromCardToCard(3,4,c,!1,3E5))},getImportWizardItemsForCard:function(a){if(1==a)return this.getImportWizardCard1Items();if(2==a)return this.getExcelMappingItems();if(3==a)return this.getExcelInvalidHandlingItems();if(4==a)return this.getExcelErrorAndConflictHandlingItems()},postDataProcess:function(a,b,c,e){1==c?this.postProcessCard1(a,b):2==c?(this.postProcessExcelMapping(a,b),this.actualizeToolbar(this.wizardPanel)):3==c?this.postProcessInvalidHandling(a,
b,c,e):4==c&&this.postProcessExcelErrorAndConflictHandling(a,b)},getExcelMappingItems:function(){return[{xtype:"component",cls:"infoBox_bottomBorder",border:!0,anchor:"100%",margin:"0 0 0 0",html:getText("admin.actions.importExcel.fieldMatch.message")},CWHF.createCombo("admin.actions.importExcel.fieldMatch.lbl.sheet","selectedSheet",{labelWidth:250,width:470,margin:"5 0 0 70",labelAlign:"right"},{select:{fn:this.reloadExcelFieldMapping,scope:this}}),Ext.create("Ext.form.Panel",{itemId:"mappings",
layout:{type:"table",columns:4,tdAttrs:{style:{padding:"5px 15px 0 0"}}},bodyStyle:"margin: 0 0 0 35px;",border:!1,method:"POST",autoScroll:!0,items:[]})]},postProcessExcelMapping:function(a,b){var c=b.data;this.fileName=c.fileName;var e=c.mappingExpressions,f=a.getComponent("selectedSheet");f.store.loadData(c.sheetNames);this.selectedSheet=c.selectedSheet;f.setValue(c.selectedSheet);var g=c.fieldList;items=[];items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.fieldMatch.lbl.columnNumber")+
"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.fieldMatch.lbl.columnLabel")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.fieldMatch.lbl.field")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.fieldMatch.lbl.isIdentifier")+"\x3c/b\x3e"});null!=a&&null!=e&&Ext.Array.forEach(e,function(b){var e=b.columnIndex;items.push({xtype:"label",html:b.columnLetter,width:200});
items.push({xtype:"label",html:b.columnName,width:200});items.push(CWHF.createCombo(null,"columnIndexToFieldIDMap["+e+"]",{width:200,data:g,value:b.fieldID},{select:{fn:this.setIsIdentifier,scope:this,panel:a,columnIndex:e,possibleIdentifiers:c.possibleIdentifiers,mandatoryIdentifiers:c.mandatoryIdentifiers}},"columnMapping"+e));items.push(CWHF.createCheckbox("","columnIndexIsIdentifierMap["+e+"]",{itemId:"columnIsIdentifier"+e,width:100,padding:"0 0 0 20",disabled:b.identifierDisabled,value:b.isIdentifier}))},
this);e=a.getComponent("mappings");e.removeAll(!0);e.add(items)},reloadExcelFieldMapping:function(a,b,c){var e=this.wizardPanel.getComponent("card2");e.setLoading(getText("common.lbl.loading"));this.selectedSheet=a.getValue();Ext.Ajax.request({url:"excelFieldMatch.action",params:{fileName:this.fileName,selectedSheet:this.selectedSheet},disableCaching:!0,scope:this,success:function(a){a=Ext.decode(a.responseText);this.postProcessExcelMapping(e,a);e.setLoading(!1)},failure:function(a){com.trackplus.util.requestFailureHandler(a);
e.setLoading(!1)}})},setIsIdentifier:function(a,b,c){var e=c.columnIndex;b=c.possibleIdentifiers;a=c.mandatoryIdentifiers;var f=c.panel.getComponent("mappings");null!=f&&(c=f.getComponent("columnMapping"+e),e=f.getComponent("columnIsIdentifier"+e),c=c.getValue(),null==c||""==c?(e.setValue(!1),e.setDisabled(!0)):(b=Ext.Array.contains(b,c),Ext.Array.contains(a,c)?(e.setValue(!0),e.setDisabled(!0)):b?e.setDisabled(!1):(e.setValue(!1),e.setDisabled(!0))))},getExcelInvalidHandlingItems:function(){return[{xtype:"component",
cls:"infoBox_bottomBorder",border:!0,anchor:"100%",margin:"0 0 0 0",html:getText("admin.actions.importExcel.invalidValueHadling.message")},Ext.create("Ext.form.Panel",{itemId:"invalidValueHandlingPanel",layout:{type:"table",columns:3,tdAttrs:{style:{padding:"5px 15px 0 0"}}},bodyStyle:"padding: 5px",border:!1,method:"POST",autoScroll:!0,items:[]})]},postProcessInvalidHandling:function(a,b,c,e){2==e?this.postProcessInvalidHandlingFirstTime(a,b):this.postProcessInvalidHandlingUpdate(a,b)},postProcessInvalidHandlingFirstTime:function(a,
b,c,e){b=b.data;c=b.fieldList;var f=b.possibleValues,g=b.invalidValueHandlingList;if(null!=a){var h=a.getComponent("invalidValueHandlingPanel");items=[];items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.invalidValueHadling.lbl.fieldName")+"\x3c/b\x3e",width:150});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.invalidValueHadling.lbl.defaultfieldValue")+"\x3c/b\x3e",colspan:2});null!=c&&Ext.Array.forEach(c,function(a){var b=a.id,c=f["fieldID"+
b],e=c.invalidValueHandlingValue,p=c.possibleFieldValues,c=c.defaultFieldValue;items.push({xtype:"label",html:a.label,width:150,padding:"10 0 0 0"});a=CWHF.getRadioButtonItems(g,"invalidValueHandlingMap["+b+"]","id","label",e,!1,!0);a=CWHF.getRadioGroup("invalidValueHandling"+b,"",250,a,null,{change:{fn:this.onInvalidHandlingChange,scope:this,panel:h,fieldId:b}});items.push(a);b=1==b?CWHF.createSingleTreePicker(null,"defaultValuesMap["+b+"]",p,c,{allowBlank:!1,disabled:2==e,itemId:"defaultValues"+
b},{select:{fn:this.onProjectSelect,scope:this,fieldId:b}}):CWHF.createCombo(null,"defaultValuesMap["+b+"]",{disabled:2==e,width:200,maxWidth:250,data:p,value:c},{select:{fn:this.onSelectDefaultValue,scope:this,fieldId:b}},"defaultValues"+b);items.push(b)},this);h.removeAll(!0);h.add(items)}},onProjectSelect:function(a,b,c){this.onRefreshInvalidHandling(c.fieldId)},onSelectDefaultValue:function(a,b,c){this.onRefreshInvalidHandling(c.fieldId)},postProcessInvalidHandlingUpdate:function(a,b){var c=b.data,
e=c.fieldList,f=c.possibleValues;if(null!=a){var g=a.getComponent("invalidValueHandlingPanel");null!=e&&Ext.Array.forEach(e,function(a){var b=f["fieldID"+a],c=b.possibleFieldValues,b=b.defaultFieldValue;1!=a&&(control=g.getComponent("defaultValues"+a),null!=control&&(control.getStore().loadData(c),control.setValue(b)))},this)}},onInvalidHandlingChange:function(a,b,c,e){a=e.fieldId;e=e.panel;b=e.getComponent("invalidValueHandling"+a);e=e.getComponent("defaultValues"+a);b=b.getChecked();c=null;0<b.length&&
(checkedRadio=b[0],null!=checkedRadio&&(c=checkedRadio.getSubmitValue()));e.setDisabled(2==c);this.onRefreshInvalidHandling(a)},onRefreshInvalidHandling:function(a){1!=a&&2!=a||this.loadDataForCard(3,!0)},getExcelErrorAndConflictHandlingItems:function(){var a={itemId:"errorAndConflict",bodyStyle:"padding: 5px",border:!1,method:"POST",items:[Ext.create("Ext.panel.Panel",{itemId:"errorPanel",border:!1,defaults:{labelStyle:"overflow: hidden;",margin:"0 5 0 0"},layout:{type:"table",columns:1}}),Ext.create("Ext.form.Panel",
{itemId:"conflictPanel",defaults:{labelStyle:"overflow: hidden;",margin:"0 5 0 0"},layout:{type:"table",columns:7,tdAttrs:{style:{padding:"5px 15px 0 0","vertical-align":"top"}}},border:!1})]};return[Ext.create("Ext.form.Panel",a)]},postProcessExcelErrorAndConflictHandling:function(a,b){var c=b.disableFinal,e=this.win.getDockedItems('toolbar[dock\x3d"bottom"]'),f=e[0].getComponent("finish");e[0].getComponent("previous");f.setDisabled(c);e=a.getComponent("errorAndConflict");c=b.errorCode;if(null==
c)f=b.message,null!=f&&(c=e.getComponent("errorPanel"),c.add({xtype:"label",html:"\x3cb\x3e"+f+"\x3c/b\x3e"}));else switch(c){case 1:c=e.getComponent("errorPanel");c.add({xtype:"label",html:"\x3cb\x3e"+b.errorMessage+"\x3c/b\x3e"});break;case 2:c=e.getComponent("errorPanel");f=b.errorMessage;for(e=0;e<f.length;e++)c.add({xtype:"label",html:f[e]});break;case 3:var c=e.getComponent("errorPanel"),g=b.gridErrors;if(null!=g)for(e=0;e<g.length;e++){var h=g[e],f=h.errorMessage,k=h.locationList;if(null!=
k)for(c.add({xtype:"label",html:"\x3cb\x3e"+f+"\x3c/b\x3e"}),f=0;f<k.length;f++)c.add({xtype:"label",html:k[f]});f=h.solutionMessage;null!=f&&c.add({xtype:"label",html:"\x3cbr\x3e\x3cb\x3e"+f+"\x3c/b\x3e"})}g=b.rowErrors;if(null!=g)for(e=0;e<g.length;e++)k=g[e],f=k.errorMessage,k=k.locationList,c.add({xtype:"label",html:"\x3cb\x3e"+f+"\x3c/b\x3e"}),c.add({xtype:"label",html:k});break;case 4:if(f=b.errorMessage,c=b.conflicts,null!=c){var e=e.getComponent("conflictPanel"),l=b.conflictResolutionList;
items=[];null!=f&&items.push({xtype:"label",html:f,colspan:7});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.row")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+b.issueNoLabel+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.column")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.field")+"\x3c/b\x3e"});items.push({xtype:"label",
html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.excelValue")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.trackplusValue")+"\x3c/b\x3e"});var m=[];Ext.Array.forEach(l,function(a){m.push({id:a.id,label:"\x3cb\x3e"+a.label+"\x3c/b\x3e"})},this);f=CWHF.getRadioButtonItems(m,"conflictResoultionEntry","id","label",!1,!1,!0);f=CWHF.getRadioGroup("conflictResoultionRadioGroup","",300,f,null,{change:{fn:this.onExcelConflictHandlingForAll,
scope:this,panel:e,conflicts:c}});items.push(f);this.workItemIDFieldIDs=[];Ext.Array.forEach(c,function(a){var b=a.row,c=a.fields;Ext.Array.forEach(c,function(a,e){0==e&&(items.push({xtype:"label",html:b,rowspan:c.length}),items.push({xtype:"label",html:a.workItemID,rowspan:c.length}));items.push({xtype:"label",html:a.columnLetter});items.push({xtype:"label",html:a.fieldName});items.push({xtype:"label",html:a.excelValue});items.push({xtype:"label",html:a.trackplusValue});var f=a.workItemIDFieldID;
this.workItemIDFieldIDs.push(f);var g=CWHF.getRadioButtonItems(l,"overwriteMap["+f+"]","id","label",!1,!1,!0),f=CWHF.getRadioGroup("conflictResoultion"+f,"",300,g);items.push(f)},this)},this);e.add(items)}}},onExcelConflictHandlingForAll:function(a,b,c,e){var f=e.panel;a=f.getComponent("conflictResoultionRadioGroup");e=e.conflicts;var g=CWHF.getSelectedRadioButtonValue(a);Ext.Array.forEach(e,function(a){Ext.Array.forEach(a.fields,function(a,b){var c=f.getComponent("conflictResoultion"+a.workItemIDFieldID);
Ext.Array.forEach(c.items.items,function(a,b){a.setRawValue(a.inputValue==g)})},this)},this)},actualizeToolbar:function(a){if(null!=this.win){var b=a.getLayout(),c=b.getActiveItem(),c=a.items.indexOf(c);a=a.items.getCount();var e=this.win.getDockedItems('toolbar[dock\x3d"bottom"]'),f=e[0].getComponent("previous");null!=f&&f.setDisabled(!b.getPrev());b=e[0].getComponent("next");null!=b&&b.setDisabled(c+1>=a-1);b=e[0].getComponent("finish");null!=b&&b.setDisabled(c+1!=a-1);null!=this.win&&this.win.setTitle(this.getTitle(c+
1))}},getWizardPanel:function(){this.wizardPanel=Ext.create("Ext.panel.Panel",{title:"",layout:"card",region:"left",cls:"importWizard",defaults:{border:!1},items:[this.createEmptyCard("card1",!0)]});this.initCards(2);this.loadDataForCard(1);return this.wizardPanel},getDialogButtons:function(){var a=this,b=[];1<this.getNumberOfCards()?(b.push({itemId:"previous",text:"\x26laquo; "+getText("common.lbl.wizard.previous"),scope:this,handler:function(b){this.onNavigate(b,a.wizardPanel)},disabled:!0}),b.push("-"),
b.push({itemId:"next",text:getText("common.lbl.wizard.next")+" \x26raquo;",scope:this,handler:function(b){this.onNavigate(b,a.wizardPanel)}}),b.push("-"),a.importButton={itemId:"finish",iconCls:"import16",text:getText("common.btn.import"),scope:this,handler:function(b){this.onNavigate(b,a.wizardPanel)},disabled:!0},b.push(a.importButton),b.push({text:getText("common.btn.done"),scope:this,handler:function(){a.doneHandler(a)}})):b.push({itemId:"finish",text:getText("common.btn.import"),scope:this,handler:function(a){this.loadDataForCard(1,
!0)},disabled:!1});return b},doneHandler:function(a){null!=this.itemNavigatorController&&this.itemNavigatorController.refresh.call(this.itemNavigatorController);this.win.close()},createPopUpDialog:function(a,b){this.itemNavigatorController=b;if(null==a){var c={title:"",width:this.dialogWidth,height:this.dialogHeight,overrideButtons:this.getDialogButtons(),items:this.getWizardPanel()};Ext.create("com.trackplus.util.WindowConfig",c).showWindowByConfig(this)}else{c=null;null!=a&&0<a.length&&(c=a[0]);
var e=!0;this.validateFileExtension(c.name)||(Ext.MessageBox.alert(getText("admin.actions.importTp.lbl.uploadFileWrongType"),getText("common.err.fileExpectedType",this.importExcelWizard.getFileTypeLabel())),e=!1);this.uploadDone&&(Ext.MessageBox.alert(getText("admin.actions.importTp.err.uploadAgain"),getText("admin.actions.importTp.err.uploadAgain",this.getFileTypeLabel())),e=!1);e&&(this.uploadDone=!0,e=new FormData,e.append("uploadFile",c),e.append("uploadFileFileName",c.name),borderLayout.setLoading(!0),
this.uploadExcelFile(e))}},uploadExcelFile:function(a){var b=this,c=new XMLHttpRequest;c.open("POST","excelUpload.action");c.onload=function(){if(200===c.status){borderLayout.setLoading(!1);var a={title:"",width:b.dialogWidth,height:b.dialogHeight,overrideButtons:b.getDialogButtons(),items:b.getWizardPanel()},a=Ext.create("com.trackplus.util.WindowConfig",a);b.wizardPanel.getComponent("card1");var f=b.wizardPanel.getComponent("card2");f.removeAll(!0);var g=b.getImportWizardItemsForCard(2);f.add(g);
var g=Ext.decode(c.response),h={};h.data=g.data;b.postDataProcess(f,h,2,1);b.uploadDone=!0;b.wizardPanel.layout.setActiveItem(1);a.showWindowByConfig(b);b.actualizeToolbar(b.wizardPanel)}else alert("Something went terribly wrong...")};c.onerror=function(a){borderLayout.setLoading(!1);alert("Error uploading!"+a)};c.upload.onprogress=function(a){};c.onerror=function(a){borderLayout.setLoading(!1);alert("Error: "+a)};c.send(a)}});
Ext.define("com.trackplus.admin.action.ImportDocx",{extend:"com.trackplus.admin.action.ImportWizard",config:{},fileName:null,addTo:null,workItemID:null,parentID:null,projectOrReleaseID:null,getNumberOfCards:function(){return 4},getTitle:function(a){var b=null;switch(a){case 1:b="admin.actions.importDocx.title.upload";break;case 2:b="admin.actions.importDocx.title.addTo";break;case 3:b="admin.actions.importDocx.title.preview";break;case 4:b="admin.actions.importDocx.title.result";break;default:b=""}return null!=
b?getText(b):""},getFilePattern:function(a){return/^.*\.(docx|DOCX)$/},getFileTypeLabel:function(){return getText("admin.actions.importDocx.lbl.uploadFile")},getFileEmptyText:function(){return getText("admin.actions.importDocx.lbl.fileEmptyText")},getImportWizardUrl:function(a,b){if(1==a)return"docxlUploadRender.action";if(2==a)return"docxUpload.action";if(3==a)return"docxPreview.action";if(4==a)return"docxImport.action"},loadDataForCard:function(a,b,c){if(1==a){var e=this.wizardPanel.getComponent("card1");
e.add(this.getImportWizardItemsForCard(a));e.getForm().load({url:this.getImportWizardUrl(a,b),scope:this,success:function(a,b){try{this.postDataProcess(e,b.result.data,1)}catch(c){}},failure:function(a,b){Ext.MessageBox.alert(this.failureTitle,b.response.responseText)}})}else if(2==a){e=this.wizardPanel.getComponent("card1");if(!e.getForm().isValid())return Ext.MessageBox.show({title:"",msg:getText("admin.actions.importTp.lbl.uploadFileNotSpecified"),buttons:Ext.Msg.OK,icon:Ext.MessageBox.ERROR}),
!1;a=e.getComponent("uploadFile");if(!this.validateFileExtension(a.getRawValue()))return Ext.MessageBox.alert(getText("admin.actions.importDocx.err.uploadFileWrongType"),getText("common.err.fileExpectedType",this.getFileTypeLabel())),!1;if(this.uploadDone)return Ext.MessageBox.alert(getText("admin.actions.importTp.err.uploadAgain"),getText("admin.actions.importTp.err.uploadAgain",this.getFileTypeLabel())),!1;this.uploadDone=!0;c={fileName:this.fileName};this.submitFromCardToCard(1,2,c)}else 3==a?
(c={fileName:this.fileName,workItemID:this.workItemID,parentID:this.parentID,projectOrReleaseID:this.projectOrReleaseID},this.submitFromCardToCard(2,3,c,!1,300)):4==a&&(null==c&&(c={fileName:this.fileName}),this.submitFromCardToCard(3,4,c,!1,300))},getImportWizardItemsForCard:function(a){if(1==a)return this.getImportWizardUploadItems();if(2==a)return this.getImportWizardAddToItems();if(3==a)return this.createPreviewPanel();if(4==a)return this.getExcelErrorAndConflictHandlingItems()},postDataProcess:function(a,
b,c,e){1==c?this.postProcessUpload(a,b):2==c?this.postProcessAddTo(a,b):3==c?this.postProcessPreview(a,b):4==c&&this.postProcessInvalidHandling(a,b,c,e)},getImportWizardUploadItems:function(){var a=[CWHF.createFileField(getText("common.lbl.file",this.getFileTypeLabel()),"uploadFile",{allowBlank:!1,labelWidth:150,width:500,labelIsLocalized:!0},{change:{fn:function(){this.uploadDone=!1},scope:this}})];a.push({xtype:"label",itemId:"importSourceError"});return a},postProcessUpload:function(a,b){a.getComponent("uploadFile").setRawValue("");
this.initCards(2)},getImportWizardAddToItems:function(){if(null==this.workItemID){var a=CWHF.getRadioButtonItems([{id:1,label:"admin.actions.importDocx.lbl.projectRelease"},{id:2,label:"admin.actions.importDocx.lbl.parent"}],"addTo","id","label",1,!1,!1),a=CWHF.getRadioGroup("addToType","admin.actions.importDocx.lbl.addTo",350,a,null,{change:{fn:this.addToTypeChanged,scope:this}}),b=CWHF.createSingleTreePicker("admin.actions.importDocx.lbl.projectRelease","projectOrReleaseID",null,null,{activeFlag:!0,
inactiveFlag:!0,notPlannedFlag:!0,closedFlag:!1,projectIsSelectable:!0,labelWidth:150,width:400}),c=CWHF.createHiddenField("parentID"),e=CWHF.createTextField(null,"txtIssueNo",{disabled:!0,readOnly:!0,width:50}),f=CWHF.createTextField(null,"txtIssueTitle",{disabled:!0,readOnly:!0,margin:"0 5 0 5",width:300}),g={xtype:"button",text:getText("common.btn.search"),itemId:"searchParent",disabled:!0,scope:this,handler:function(){this.chooseParent.call(this)}},c=Ext.create("Ext.form.FieldContainer",{combineErrors:!0,
itemId:"parentPanel",fieldLabel:getText("admin.actions.importDocx.lbl.parent"),labelWidth:150,labelAlign:"right",labelStyle:{overflow:"hidden"},layout:"hbox",items:[c,e,f,g]});return[a,b,c]}a=CWHF.createTextField(null,"txtIssueNo",{readOnly:!0,width:50});b=CWHF.createTextField(null,"txtIssueTitle",{readOnly:!0,margin:"0 5 0 5",width:300});return[a,b]},chooseParent:function(){Ext.create("com.trackplus.util.IssuePicker",{title:getText("common.btn.chooseParent"),handler:this.setParent,scope:this}).showDialog()},
setParent:function(a){var b=this.wizardPanel.getComponent("card2").getComponent("parentPanel");this.parentID=a.objectID;var c=b.getComponent("txtIssueNo");null!=c&&c.setValue(a.id);b=b.getComponent("txtIssueTitle");null!=b&&b.setValue(a.title)},addToTypeChanged:function(a,b,c,e){b=a.ownerCt;a=a.getChecked();1==a.length&&(a=a[0].getSubmitValue(),b.getComponent("projectOrReleaseID").setDisabled(1!=a),b.getComponent("parentPanel").getComponent("searchParent").setDisabled(1==a))},postProcessAddTo:function(a,
b){this.workItemID=b.workItemID;this.fileName=b.fileName;null==this.workItemID?a.getComponent("projectOrReleaseID").updateData(b.projectReleaseTree):(a.getComponent("txtIssueNo").setValue(b.itemID),a.getComponent("txtIssueTitle").setValue(b.itemTitle));this.initCards(3)},createPreviewPanel:function(){var a=Ext.create("Ext.data.TreeStore",{fields:"id text type canEdit icon leaf".split(" "),root:{expanded:!0,children:[]}});return Ext.create("Ext.tree.Panel",{region:"center",itemId:"itemTree",useArrows:!0,
autoScroll:!0,store:a,rootVisible:!1,border:!1,margins:"0 0 0 0",baseCls:"x-plain",bodyStyle:{border:"none"},cls:"westTreeNavigator"})},postProcessPreview:function(a,b){var c=a.getComponent("itemTree").store.getRootNode();c.removeAll(!0);var e=b.data;null!=e&&c.appendChild(e.itemTree)},getExcelInvalidHandlingItems:function(){return[{xtype:"component",cls:"infoBox_bottomBorder",border:!0,anchor:"100%",margin:"0 0 0 0",html:getText("admin.actions.importExcel.invalidValueHadling.message")},Ext.create("Ext.form.Panel",
{itemId:"invalidValueHandlingPanel",layout:{type:"table",columns:3,tdAttrs:{style:{padding:"5px 15px 0 0"}}},bodyStyle:"padding: 5px",border:!1,method:"POST",autoScroll:!0,items:[]})]},postProcessInvalidHandling:function(a,b,c,e){2==e?this.postProcessInvalidHandlingFirstTime(a,b):this.postProcessInvalidHandlingUpdate(a,b)},postProcessInvalidHandlingFirstTime:function(a,b,c,e){b=b.data;c=b.fieldList;var f=b.possibleValues,g=b.invalidValueHandlingList;if(null!=a){var h=a.getComponent("invalidValueHandlingPanel");
items=[];items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.invalidValueHadling.lbl.fieldName")+"\x3c/b\x3e",width:150});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.invalidValueHadling.lbl.defaultfieldValue")+"\x3c/b\x3e",colspan:2});null!=c&&Ext.Array.forEach(c,function(a){var b=a.id,c=f["fieldID"+b],e=c.invalidValueHandlingValue,p=c.possibleFieldValues,c=c.defaultFieldValue;items.push({xtype:"label",html:a.label,width:150,padding:"10 0 0 0"});
a=CWHF.getRadioButtonItems(g,"invalidValueHandlingMap["+b+"]","id","label",e,!1,!0);a=CWHF.getRadioGroup("invalidValueHandling"+b,"",250,a,null,{change:{fn:this.onInvalidHandlingChange,scope:this,panel:h,fieldId:b}});items.push(a);b=1==b?CWHF.createSingleTreePicker(null,"defaultValuesMap["+b+"]",p,c,{allowBlank:!1,disabled:2==e,itemId:"defaultValues"+b},{select:{fn:this.onProjectSelect,scope:this,fieldId:b}}):CWHF.createCombo(null,"defaultValuesMap["+b+"]",{disabled:2==e,width:200,maxWidth:250,data:p,
value:c},{select:{fn:this.onSelectDefaultValue,scope:this,fieldId:b}},"defaultValues"+b);items.push(b)},this);h.removeAll(!0);h.add(items)}},onProjectSelect:function(a,b,c){this.onRefreshInvalidHandling(c.fieldId)},onSelectDefaultValue:function(a,b,c){this.onRefreshInvalidHandling(c.fieldId)},postProcessInvalidHandlingUpdate:function(a,b){var c=b.data,e=c.fieldList,f=c.possibleValues;if(null!=a){var g=a.getComponent("invalidValueHandlingPanel");null!=e&&Ext.Array.forEach(e,function(a){var b=f["fieldID"+
a],c=b.possibleFieldValues,b=b.defaultFieldValue;1!=a&&(control=g.getComponent("defaultValues"+a),null!=control&&(control.getStore().loadData(c),control.setValue(b)))},this)}},onInvalidHandlingChange:function(a,b,c,e){a=e.fieldId;e=e.panel;b=e.getComponent("invalidValueHandling"+a);e=e.getComponent("defaultValues"+a);b=b.getChecked();c=null;0<b.length&&(checkedRadio=b[0],null!=checkedRadio&&(c=checkedRadio.getSubmitValue()));e.setDisabled(2==c);this.onRefreshInvalidHandling(a)},onRefreshInvalidHandling:function(a){1!=
a&&2!=a||this.loadDataForCard(3,!0)},getExcelErrorAndConflictHandlingItems:function(){var a={itemId:"errorAndConflict",bodyStyle:"padding: 5px",border:!1,method:"POST",items:[Ext.create("Ext.panel.Panel",{itemId:"errorPanel",border:!1,defaults:{labelStyle:"overflow: hidden;",margin:"0 5 0 0"},layout:{type:"table",columns:1}}),Ext.create("Ext.form.Panel",{itemId:"conflictPanel",defaults:{labelStyle:"overflow: hidden;",margin:"0 5 0 0"},layout:{type:"table",columns:7,tdAttrs:{style:{padding:"5px 15px 0 0",
"vertical-align":"top"}}},border:!1})]};return[Ext.create("Ext.form.Panel",a)]},postProcessExcelErrorAndConflictHandling:function(a,b){var c=b.disableFinal,e=this.wizardPanel.getDockedItems('toolbar[dock\x3d"top"]'),f=e[0].getComponent("finish");e[0].getComponent("previous");f.setDisabled(c);f=a.getComponent("errorAndConflict");c=b.errorCode;if(null==c)e=b.message,null!=e&&(c=f.getComponent("errorPanel"),c.add({xtype:"label",html:"\x3cb\x3e"+e+"\x3c/b\x3e"}));else switch(c){case 1:c=f.getComponent("errorPanel");
c.add({xtype:"label",html:"\x3cb\x3e"+b.errorMessage+"\x3c/b\x3e"});break;case 2:c=f.getComponent("errorPanel");e=b.errorMessage;for(f=0;f<e.length;f++)c.add({xtype:"label",html:e[f]});break;case 3:var c=f.getComponent("errorPanel"),g=b.gridErrors;if(null!=g)for(f=0;f<g.length;f++){var h=g[f],e=h.errorMessage,h=h.locationList;if(null!=h)for(c.add({xtype:"label",html:"\x3cb\x3e"+e+"\x3c/b\x3e"}),e=0;e<h.length;e++)c.add({xtype:"label",html:h[e]})}g=b.rowErrors;if(null!=g)for(f=0;f<g.length;f++)h=g[f],
e=h.errorMessage,h=h.locationList,c.add({xtype:"label",html:"\x3cb\x3e"+e+"\x3c/b\x3e"}),c.add({xtype:"label",html:h});break;case 4:if(e=b.errorMessage,c=b.conflicts,null!=c){var f=f.getComponent("conflictPanel"),k=b.conflictResolutionList;items=[];null!=e&&items.push({xtype:"label",html:e,colspan:7});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.row")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+b.issueNoLabel+"\x3c/b\x3e"});items.push({xtype:"label",
html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.column")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.field")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.excelValue")+"\x3c/b\x3e"});items.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importExcel.conflict.lbl.trackplusValue")+"\x3c/b\x3e"});var l=[];Ext.Array.forEach(k,function(a){l.push({id:a.id,
label:"\x3cb\x3e"+a.label+"\x3c/b\x3e"})},this);e=CWHF.getRadioButtonItems(l,"conflictResoultionEntry","id","label",!1,!1,!0);e=CWHF.getRadioGroup("conflictResoultionRadioGroup","",300,e,null,{change:{fn:this.onExcelConflictHandlingForAll,scope:this,panel:f,conflicts:c}});items.push(e);this.workItemIDFieldIDs=[];Ext.Array.forEach(c,function(a){var b=a.row,c=a.fields;Ext.Array.forEach(c,function(a,e){0==e&&(items.push({xtype:"label",html:b,rowspan:c.length}),items.push({xtype:"label",html:a.workItemID,
rowspan:c.length}));items.push({xtype:"label",html:a.columnLetter});items.push({xtype:"label",html:a.fieldName});items.push({xtype:"label",html:a.excelValue});items.push({xtype:"label",html:a.trackplusValue});var f=a.workItemIDFieldID;this.workItemIDFieldIDs.push(f);var g=CWHF.getRadioButtonItems(k,"overwriteMap["+f+"]","id","label",!1,!1,!0),f=CWHF.getRadioGroup("conflictResoultion"+f,"",300,g);items.push(f)},this)},this);f.add(items)}}},onExcelConflictHandlingForAll:function(a,b,c,e){var f=e.panel;
a=f.getComponent("conflictResoultionRadioGroup");e=e.conflicts;var g=CWHF.getSelectedRadioButtonValue(a);Ext.Array.forEach(e,function(a){Ext.Array.forEach(a.fields,function(a,b){f.getComponent("conflictResoultion"+a.workItemIDFieldID).items.each(function(a){a.setValue(a.inputValue==g)})},this)},this)}});
Ext.define("com.trackplus.admin.action.ExportDocx",{extend:"Ext.container.Container",config:{workItemID:null,workItemIDs:null},initComponent:function(){this.callParent()},createExportForm:function(a,b){var c=[{submitUrl:"docxExport.action",submitUrlParams:{workItemID:this.workItemID,workItemIDs:this.workItemIDs},submitButtonText:getText("common.btn.export"),submitHandler:this.exportHandler},{submitUrl:"docxTemplate!upload.action",submitButtonText:getText("common.btn.upload"),submitHandler:this.uploadFileHandler},
{submitUrl:"docxTemplate!download.action",submitButtonText:getText("common.btn.download"),submitHandler:this.downloadFileHandler},{submitUrl:"docxTemplate!delete.action",submitButtonText:getText("common.btn.delete"),submitHandler:this.deleteUploadedFileHandler}],e=this.renderUploadPostDataProcess,c={title:getText("admin.actions.exportDocx.chooseTemplate"),width:500,height:150,load:{loadUrl:"docxTemplate.action"},submit:c,formPanel:this.getFormPanel(),postDataProcess:e,cancelButtonText:getText("common.btn.cancel")};
Ext.create("com.trackplus.util.WindowConfig",c).showWindowByConfig(this)},getFormPanel:function(a,b){var c=[CWHF.createCombo("admin.actions.exportDocx.templates","docxTemplateList",{idType:"string",labelWidth:150,blankText:getText("admin.actions.exportDocx.docxTemplateNotSelected")}),CWHF.createFileField("admin.actions.exportDocx.newTemplate","docxTemplate",{labelWidth:150,blankText:getText("admin.actions.exportDocx.docxTemplateNotBrowsed")})];return Ext.create("Ext.form.Panel",{bodyStyle:"padding:5px",
defaults:{labelStyle:"overflow: hidden;",margin:"5 5 0 0",msgTarget:"side",anchor:"-20"},method:"POST",fileUpload:!0,items:c})},exportHandler:function(a,b,c){b=this.getUrlWithTemplate(b);if(null!=c)for(submitUrlParam in c)b=b+"\x26"+submitUrlParam+"\x3d"+c[submitUrlParam];window.open(b);a.close()},downloadFileHandler:function(a,b){b=this.getUrlWithTemplate(b);window.open(b)},getUrlWithTemplate:function(a){var b=this.formEdit.getForm(),c=this.formEdit.getComponent("docxTemplateList"),e=c.getValue();
if(null==e)c.allowBlank=!1,a=this.formEdit.getComponent("docxTemplate"),null!=a&&(a.allowBlank=!0),b.isValid(),Ext.MessageBox.alert(getText("admin.actions.exportDocx.chooseTemplate"),getText("admin.actions.exportDocx.docxTemplateNotSelected")),c.allowBlank=!0;else return a+"?docxTemplateFileName\x3d"+e},renderUploadPostDataProcess:function(a,b){var c=b.getComponent("docxTemplateList");c.store.loadData(a.existingTemplates);var e=a.docxTemplateList;c.setValue(e);b.getComponent("docxTemplate").setValue("");
c=this.win.getDockedItems('toolbar[dock\x3d"bottom"]');null!=c&&(c[0].getComponent(0).setDisabled(null==e),c[0].getComponent(2).setDisabled(null==e),c[0].getComponent(3).setDisabled(null==e))},uploadFileHandler:function(a,b,c){a=this.formEdit.getForm();var e=this.formEdit.getComponent("docxTemplate"),f=e.getValue();null==f||""==f?(e.allowBlank=!1,b=this.formEdit.getComponent("docxTemplateList"),null!=b&&(b.allowBlank=!0),a.isValid(),Ext.MessageBox.alert(getText("admin.actions.exportDocx.chooseTemplate"),
getText("admin.actions.exportDocx.docxTemplateNotBrowsed")),e.allowBlank=!0):/^.*\.(docx|DOCX|tex|TEX|tlx|zip)$/.test(f)?a.submit({scope:this,url:b,params:c,success:function(a,b){this.renderUploadPostDataProcess(b.result.data,this.formEdit)},failure:function(a,b){com.trackplus.util.submitFailureHandler(a,b)}}):Ext.MessageBox.alert(getText("admin.actions.exportDocx.chooseTemplate"),getText("admin.actions.exportDocx.docxTemplateWrongType"))},deleteUploadedFileHandler:function(a,b,c){a=this.formEdit.getForm();
c=this.formEdit.getComponent("docxTemplateList");null==c.getValue()?(c.allowBlank=!1,b=this.formEdit.getComponent("docxTemplate"),null!=b&&(b.allowBlank=!0),a.isValid(),Ext.MessageBox.alert(getText("admin.actions.exportDocx.chooseTemplate"),getText("admin.actions.exportDocx.docxTemplateNotSelected")),c.allowBlank=!0):a.submit({scope:this,url:b,success:function(a,b){this.renderUploadPostDataProcess(b.result.data,this.formEdit)},failure:function(a,b){com.trackplus.util.submitFailureHandler(a,b)}})}});
Ext.define("com.trackplus.admin.action.ImportMsProject",{extend:"com.trackplus.admin.action.ImportWizard",config:{projectID:null},conflictParameterNames:null,dialogHeight:470,dialogWidth:820,isFromDragAndDrop:!1,getNumberOfCards:function(){return 3},getTitle:function(a){var b=null;switch(a){case 1:b="admin.actions.importMSProject.title.upload";break;case 2:b="admin.actions.importMSProject.title.resourceMappings";break;case 3:b="admin.actions.importMSProject.title.importResult"}return null!=b?getText(b):
""},getFilePattern:function(a,b){return/^.*\.(xml|XML|MPP|mpp|MPT|mpt)$/},getFileTypeLabel:function(){return getText("admin.actions.importMSProject.lbl.uploadFile")},getImportWizardUrl:function(a,b){if(1==a)return"msProjectUploadRender.action";if(2==a)return"msProjectUpload.action";if(3==a)return"msProjectImport!submitResourceMapping.action"},loadDataForCard:function(a,b,c){if(1==a){var e=this.wizardPanel.getComponent("card1");e.add(this.getImportWizardItemsForCard(a));c=null;null!=this.projectID&&
(c={projectOrReleaseID:-this.projectID});e.getForm().load({url:this.getImportWizardUrl(a,b),scope:this,params:c,success:function(a,b){try{this.postDataProcess(e,b.result.data,1)}catch(c){}},failure:function(a,b){Ext.MessageBox.alert(this.failureTitle,b.response.responseText)}});return!0}if(2==a){e=this.wizardPanel.getComponent("card1");if(!e.getForm().isValid())return Ext.MessageBox.alert(getText("admin.actions.importTp.lbl.uploadFileNotSpecified"),getText("admin.actions.importTp.lbl.uploadFileNotSpecified")),
!1;a=e.getComponent("uploadFile");if(!this.validateFileExtension(a.getRawValue()))return Ext.MessageBox.alert(getText("admin.actions.importTp.lbl.uploadFileWrongType"),getText("common.err.fileExpectedType",this.getFileTypeLabel())),!1;if(this.uploadDone)return Ext.MessageBox.alert(getText("admin.actions.importTp.err.uploadAgain"),getText("admin.actions.importTp.err.uploadAgain",this.getFileTypeLabel())),!1;this.uploadDone=!0;c={fileName:this.fileName};this.submitFromCardToCard(1,2,c,b,!0)}else if(3==
a)return null==c&&(c={}),c.fileName=this.fileName,this.submitFromCardToCard(2,3,c,b,240)},getImportWizardItemsForCard:function(a){if(1==a)return this.getImportWizardCard1Items();if(2==a)return this.getMsProjectResourceMappingItems();if(3==a)return this.getMsProjectConflictHandlingItems()},postDataProcess:function(a,b,c){1==c?this.postProcessCard1(a,b):2==c?null!=b.data?(this.postProcessMsProjectResourceMapping(a,b),this.actualizeToolbar(this.wizardPanel)):(this.goNext(),a=this.wizardPanel.getComponent("card3"),
a.removeAll(),a.add(this.getImportWizardItemsForCard(3)),this.postProcessMsProjectConflictHandling(a,b)):3==c&&this.postProcessMsProjectConflictHandling(a,b)},getImportWizardCard1Items:function(){var a=[];this.isFromDragAndDrop||(a=[CWHF.createFileField(getText("common.lbl.file",this.getFileTypeLabel()),"uploadFile",{allowBlank:!1,labelWidth:250,width:700,labelIsLocalized:!0},{change:{fn:function(){this.uploadDone=!1},scope:this}})]);a.push({xtype:"label",itemId:"importSourceError"});a.push(CWHF.createSingleTreePicker("admin.actions.importTp.lbl.projectRelease",
"projectOrReleaseID",[],null,{allowBlank:!1,labelWidth:250,width:500,margin:"10 0 10 0"}));return a},postProcessCard1:function(a,b){var c=a.getComponent("projectOrReleaseID");c.updateData(b.projectReleaseTree);c.setValue(b.selectedProjectReleaseID);a.getComponent("uploadFile").setRawValue("");this.initCards(2)},getMsProjectResourceMappingItems:function(){return[Ext.create("Ext.form.Panel",{itemId:"resourceMappings",layout:{type:"table",columns:4,style:{width:"100%"}},bodyStyle:"padding: 5px",border:!1,
method:"POST",autoScroll:!1,items:[]}),Ext.create("Ext.form.Panel",{itemId:"newUserErrors",layout:{type:"table",columns:1,style:{width:"100%"}},bodyStyle:"padding: 5px",border:!1,method:"POST",autoScroll:!1,items:[]})]},postProcessMsProjectResourceMapping:function(a,b){var c=b.data;this.fileName=c.fileName;var e=c.resourceMappings,f=c.trackplusPersons;items=[];items.push({xtype:"label",html:getText("admin.actions.importMSProject.lbl.resourceName")});items.push({xtype:"label",html:getText("admin.actions.importMSProject.lbl.personName"),
colspan:3});null!=a&&null!=e&&Ext.Array.forEach(e,function(b){var c=b.resourceUID,e=b.personID;items.push({xtype:"label",html:b.resourceName,width:200});items.push(CWHF.createCombo(null,"resourceUIDToPersonIDMap["+c+"]",{width:150,data:f,value:e},{select:{fn:this.showHide,scope:this,panel:a,resourceUID:c}},"resourceUIDToPersonID"+c));b=CWHF.createTextField("admin.actions.importMSProject.lbl.userName","resourceUIDToUsernameMap["+c+"]",{itemId:"resourceUIDToUsername"+c,allowBlank:!1,width:250,labelWidth:100});
b.setDisabled(0!=e);items.push(b);c=CWHF.createTextField("admin.actions.importMSProject.lbl.email","resourceUIDToEmailMap["+c+"]",{itemId:"resourceUIDToEmail"+c,allowBlank:!1,width:250,labelWidth:75});c.setDisabled(0!=e);items.push(c)},this);e=a.getComponent("resourceMappings");e.removeAll(!0);e.add(items);e=a.getComponent("newUserErrors");e.removeAll(!0);c=c.errorMessage;null!=c&&e.add(c)},showHide:function(a,b,c){a=c.resourceUID;var e=c.panel.getComponent("resourceMappings");null!=e&&(b=e.getComponent("resourceUIDToPersonID"+
a),c=e.getComponent("resourceUIDToUsername"+a),a=e.getComponent("resourceUIDToEmail"+a),b=0!=b.getValue(),c.setDisabled(b),a.setDisabled(b))},getMsProjectConflictHandlingItems:function(){var a={itemId:"errorAndConflict",bodyStyle:"padding: 5px",border:!1,method:"POST",autoScroll:!1,items:[Ext.create("Ext.panel.Panel",{itemId:"errorPanel",border:!1,defaults:{labelStyle:"overflow: hidden;",margin:"0 5 0 0"},layout:{type:"table",columns:1}}),Ext.create("Ext.form.Panel",{itemId:"conflictPanel",defaults:{labelStyle:"overflow: hidden;",
margin:"0 5 0 0"},layout:{type:"table",columns:6},border:!1})]};return[Ext.create("Ext.form.Panel",a)]},postProcessMsProjectConflictHandling:function(a,b){var c=this,e=b.errorCode,f=b.disableFinal,g=c.win.getDockedItems('toolbar[dock\x3d"bottom"]'),g=g[0].getComponent("finish");g.setDisabled(f);f=a.getComponent("errorAndConflict");e=b.errorCode;if(null==e)e=b.message,null!=e?(f=f.getComponent("errorPanel"),f.add({xtype:"label",html:e}),g.setText(getText("common.lbl.wizard.finish")),g.setDisabled(!1),
g.setIconCls(""),g.handler=function(){c.win.close()},g=c.win.getDockedItems('toolbar[dock\x3d"bottom"]'),g=g[0].getComponent("previous"),null!=g&&g.setDisabled(!0)):(g=b.statusText,null!=g&&(f=f.getComponent("errorPanel"),f.add({xtype:"label",html:g})));else{var h=a.getComponent("conflictPanel");switch(e){case 2:f=f.getComponent("errorPanel");g=b.errorMessage;for(e=0;e<g.length;e++)f.add({xtype:"label",html:g[e]});break;case 4:this.conflictParameterNames=[],g=b.errorMessage,h=f.getComponent("conflictPanel"),
h.add({xtype:"label",html:g,colspan:6}),g=b.conflicts,null!=g&&Ext.Array.forEach(g,function(a){var c=a.conflictMessage,e=null,f=1,g=!0;switch(a.conflictType){case 1:case 2:case 3:e=b.leaveOverwriteList;break;case 4:e=b.leaveDeleteList;f=3;g=!1;break;case 5:e=b.leaveUndeleteList,g=!1,f=3}var q=a.conflictMapName;h.add({xtype:"label",html:c,colspan:6});c=[];c.push({xtype:"label",html:"\x3cb\x3eUID\x3c/b\x3e"});c.push({xtype:"label",html:"\x3cb\x3e"+b.issueNoLabel+"\x3c/b\x3e"});c.push({xtype:"label",
html:"\x3cb\x3e"+getText("common.lbl.name")+"\x3c/b\x3e",colspan:f});g&&(c.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importMSProject.conflict.lbl.msProjectValue")+"\x3c/b\x3e"}),c.push({xtype:"label",html:"\x3cb\x3e"+getText("admin.actions.importMSProject.conflict.lbl.trackplusValue")+"\x3c/b\x3e"}));var t=CWHF.getRadioButtonItems(e,q,"id","label",!1,!1,!0),t=CWHF.getRadioGroup(q+"RadioGroup","",300,t,null,{change:{fn:this.onMsProjectConflictHandlingForAll,scope:this,panel:h,conflictValues:a.conflictValues,
conflictMapName:q}});c.push(t);h.add(c);Ext.Array.forEach(a.conflictValues,function(a,b){var c=a.workItemID,k=[];k.push({xtype:"label",html:a.uid});k.push({xtype:"label",html:a.itemID});k.push({xtype:"label",html:a.title,colspan:f});g&&(k.push({xtype:"label",html:a.msProjectValue}),k.push({xtype:"label",html:a.trackplusValue}));var c=q+"["+c+"]",l=CWHF.getRadioButtonItems(e,c,"id","label",!1,!1,!0),l=CWHF.getRadioGroup(c,"",300,l);this.conflictParameterNames.push(c);k.push(l);h.add(k)},this)},this)}}},
onMsProjectConflictHandlingForAll:function(a,b,c,e){var f=e.panel,g=e.conflictMapName,h=b[g];Ext.Array.forEach(e.conflictValues,function(a){f.getComponent(g+"["+a.workItemID+"]").items.each(function(a){a.setValue(a.inputValue==h)})},this)},getDataBeforeCardDelete:function(a,b){var c=null;if(3==a&&(c={},b&&null!=this.conflictParameterNames)){var e=this.wizardPanel.getComponent("card3").getComponent("errorAndConflict").getComponent("conflictPanel");Ext.Array.forEach(this.conflictParameterNames,function(a){var b=
e.getComponent(a),b=CWHF.getSelectedRadioButtonValue(b);c[a]=b},this)}return c},createPopUpDialog:function(a){null==a?(this.isFromDragAndDrop=!1,a={title:"",width:this.dialogWidth,height:this.dialogHeight,overrideButtons:this.getDialogButtons(),items:this.getWizardPanel()},a=Ext.create("com.trackplus.util.WindowConfig",a),a.showWindowByConfig(this),this.actualizeToolbar(this.wizardPanel)):(this.file=null,this.isFromDragAndDrop=!0,null!=a&&0<a.length&&(this.file=a[0]),a=!0,this.validateFileExtension(this.file.name)||
(Ext.MessageBox.alert(getText("admin.actions.importTp.lbl.uploadFileWrongType"),getText("common.err.fileExpectedType",this.importExcelWizard.getFileTypeLabel())),a=!1),this.uploadDone&&(Ext.MessageBox.alert(getText("admin.actions.importTp.err.uploadAgain"),getText("admin.actions.importTp.err.uploadAgain",this.getFileTypeLabel())),a=!1),a&&(this.uploadDone=!0,a=new FormData,a.append("uploadFile",this.file),a.append("uploadFileFileName","MyName!"),a={title:"",width:this.dialogWidth,height:this.dialogHeight,
overrideButtons:this.getDialogButtons(),items:this.getWizardPanel()},a=Ext.create("com.trackplus.util.WindowConfig",a),this.wizardPanel.getComponent("card1").getComponent("uploadFile"),a.showWindowByConfig(this),this.actualizeToolbar(this.wizardPanel)))},uploadMsProjFile:function(){var a=this,b=new FormData;b.append("uploadFile",a.file);b.append("uploadFileFileName",a.file.name);var c=a.wizardPanel.getComponent("card1").getComponent("projectOrReleaseID");a.projectID=c.getValue();b.append("projectOrReleaseID",
a.projectID);var e=new XMLHttpRequest;e.open("POST","msProjectUpload.action");e.onload=function(){if(200===e.status){a.wizardPanel.getComponent("card1");var b=a.wizardPanel.getComponent("card2");b.removeAll(!0);var c=a.getImportWizardItemsForCard(2);b.add(c);var c=Ext.decode(e.response),h={};h.data=c.data;a.postDataProcess(b,h,2,1);a.uploadDone=!0;a.wizardPanel.layout.setActiveItem(1);a.actualizeToolbar(a.wizardPanel)}else alert("Something went terribly wrong...")};e.onerror=function(a){borderLayout.setLoading(!1);
alert("Error uploading!"+a)};e.upload.onprogress=function(a){};e.onerror=function(a){borderLayout.setLoading(!1);alert("Error: "+a)};e.send(b)},onNavigate:function(a,b){var c=b.getLayout(),e=c.getActiveItem(),f=b.items.indexOf(e),e=b.items.getCount()-1;if(null!=a){var g=null;"next"==a.itemId||"finish"==a.itemId&&f<=e?0==f&&this.isFromDragAndDrop?this.uploadMsProjFile():(c=!1,f==e&&(f-=1,c=!0,g=this.getDataBeforeCardDelete(f+2,c)),this.initCards(f+2),!1!=this.loadDataForCard(f+2,c,g)&&b.layout.setActiveItem(f+
1)):"previous"==a.itemId&&0<f&&(e=c.getActiveItem(),e.removeAll(),b.layout.setActiveItem(f-1))}this.actualizeToolbar(b)},getWizardPanel:function(){this.wizardPanel=Ext.create("Ext.panel.Panel",{title:"",layout:"card",region:"left",cls:"importWizard",defaults:{border:!1},items:[this.createEmptyCard("card1",!0)]});this.initCards(2);this.loadDataForCard(1);return this.wizardPanel},getDialogButtons:function(){var a=this,b=[];1<this.getNumberOfCards()?(b.push({itemId:"previous",text:"\x26laquo; "+getText("common.lbl.wizard.previous"),
scope:this,handler:function(b){this.onNavigate(b,a.wizardPanel)},disabled:!0}),b.push("-"),b.push({itemId:"next",text:getText("common.lbl.wizard.next")+" \x26raquo;",scope:this,handler:function(b){this.onNavigate(b,a.wizardPanel)}}),b.push("-"),b.push({itemId:"finish",iconCls:"import16",text:getText("common.btn.import"),scope:this,handler:function(b){this.onNavigate(b,a.wizardPanel)},disabled:!0})):b.push({itemId:"finish",text:getText("common.btn.import"),scope:this,handler:function(a){this.loadDataForCard(1,
!0)},disabled:!1});return b},actualizeToolbar:function(a){if(null!=this.win){var b=a.getLayout(),c=b.getActiveItem(),c=a.items.indexOf(c);a=a.items.getCount();var e=this.win.getDockedItems('toolbar[dock\x3d"bottom"]'),f=e[0].getComponent("previous");null!=f&&f.setDisabled(!b.getPrev());b=e[0].getComponent("next");null!=b&&b.setDisabled(c+1>=a-1);b=e[0].getComponent("finish");null!=b&&b.setDisabled(c+1!=a-1)}null!=this.win&&this.win.setTitle(this.getTitle(c+1))},closeWindow:function(){alert("CLOSE!")}});
Ext.define("com.trackplus.admin.action.ExportMsProject",{extend:"Ext.Base",config:{projectID:null},constructor:function(a){this.initialConfig=a=a||{};Ext.apply(this,a)},exportButton:null,panelForm:null,dialogHeight:470,dialogWidth:785,getToolbarActions:function(){null==this.exportButton&&(this.exportButton=new Ext.Button({text:getText("common.btn.export"),tooltip:getText("common.btn.export"),iconCls:"export",disabled:!1,scope:this,handler:function(){this.exportToMsProject.call(this)}}));return[this.exportButton]},
exportToMsProject:function(){this.panelForm.getForm().submit({method:"POST",scope:this})},getDetailPanel:function(){var a=CWHF.createSingleTreePicker("admin.actions.importTp.lbl.fromProjectRelease","projectOrReleaseID",[],null,{allowBlank:!1,labelWidth:200,width:500,padding:"10 0 0 0"},{select:{fn:this.onProjectReleaseSelect,scope:this}}),b=CWHF.createCheckbox("admin.actions.exportMSProject.lbl.notClosed","notClosed",{labelWidth:200,width:250});this.panelForm=new Ext.form.FormPanel({url:"msProjectExport!export.action",
region:"center",border:!1,standardSubmit:!0,margin:"-10 0 0 -10",items:[{xtype:"label",itemId:"importFileInfo",cls:"infoBox_bottomBorder",border:!0,html:"MsProject",anchor:"100%"},a,b]});this.panelLoad();return this.panelForm},onProjectReleaseSelect:function(a,b,c){Ext.Ajax.request({url:"msProjectExport!importFileInfo.action",params:{projectOrReleaseID:a.getValue()},scope:this,disableCaching:!0,success:function(b){var c=a.up("panel");b=Ext.decode(b.responseText);this.replaceImportFileInfo(c,b.importFileInfo)},
failure:function(a){com.trackplus.util.requestFailureHandler(response)}})},panelLoad:function(){params={projectOrReleaseID:-this.projectID};this.panelForm.getForm().load({url:"msProjectExport.action",scope:this,params:params,success:function(a,b){try{this.postLoadProcess(this.panelForm,b.result.data)}catch(c){}},failure:function(a,b){Ext.MessageBox.show(getText("common.err.failure"),b.response.responseText)}})},postLoadProcess:function(a,b){var c=a.getComponent("projectOrReleaseID");c.updateData(b.projectReleaseTree);
c.setValue(b.selectedProjectReleaseID);this.replaceImportFileInfo(a,b.importFileInfo)},replaceImportFileInfo:function(a,b){var c=a.getComponent("importFileInfo");null!=c&&a.remove(c);a.insert(0,{xtype:"component",itemId:"importFileInfo",cls:"infoBox_bottomBorder",border:!0,html:b})},createPopUpDialog:function(){this.isFromDragAndDrop=!1;var a={title:getText("itemov.btn.exportMSProject"),width:this.dialogWidth,height:this.dialogHeight,overrideButtons:this.getToolbarActions(),items:this.getDetailPanel()};
Ext.create("com.trackplus.util.WindowConfig",a).showWindowByConfig(this)}});
Ext.define("com.trackplus.admin.action.ImportTrackplus",{extend:"Ext.Base",config:{},mainComponent:null,createToolbar:function(){return[new Ext.Button({text:getText("common.btn.import"),overflowText:getText("common.btn.import"),tooltip:getText("common.btn.import"),iconCls:"import",disabled:!1,scope:this,handler:function(){this.startImport()}})]},createMainComponent:function(){var a={fileUpload:!0,border:!1,method:"POST",autoScroll:!0,items:[{xtype:"component",cls:"infoBox_bottomBorder",border:!0,
html:getText("admin.actions.importTp.warning")},CWHF.createFileField(getText("common.lbl.file",getText("admin.actions.importTp.lbl.uploadFile")),"uploadFile",{allowBlank:!1,labelWidth:250,width:700,labelIsLocalized:!0,padding:"5 5 5 5"})]};return this.mainComponent=Ext.create("Ext.form.Panel",a)},validateFileExtension:function(a){return/^.*\.(zip|ZIP)$/.test(a)},startImport:function(){if(!this.mainComponent.getForm().isValid())return Ext.MessageBox.alert(getText("admin.actions.importTp.lbl.uploadFileNotSpecified"),
getText("admin.actions.importTp.lbl.uploadFileNotSpecified")),!1;var a=this.mainComponent.getComponent("uploadFile");if(!this.validateFileExtension(a.getRawValue()))return Ext.MessageBox.alert(getText("admin.actions.importTp.lbl.uploadFileWrongType"),getText("common.err.fileExpectedType","zip")),!1;this.mainComponent.setLoading(getText("admin.actions.importTp.lbl.waitMessage"));this.mainComponent.getForm().submit({url:"trackplusUpload.action",scope:this,method:"POST",success:function(a,c){this.mainComponent.setLoading(!1);
Ext.MessageBox.alert(c.result.title,c.result.message)},failure:function(a,c){this.mainComponent.setLoading(!1);com.trackplus.util.submitFailureHandler(a,c)}})}});
Ext.define("com.trackplus.layout.MasterHomeLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.borderLayoutController.setHelpContext("masterHome");this.onReady(function(){})},createCenterPanel:function(){for(var a=this.initData.modules,b=[],c=0;c<a.length;c++)b.push(Ext.create("com.trackplus.master.AppBoxView",{width:100,height:100,appID:a[c].id,appUrl:a[c].url,appTitle:a[c].name,appIcon:"appJenkins"}));this.view=Ext.create("Ext.panel.Panel",
{border:!1,bodyBorder:!1,bodyCls:"appPanel",height:200,layout:"column",items:b});a=125*a.length;1E3<a&&(a=1E3);return Ext.create("Ext.panel.Panel",{region:"center",border:!1,baseCls:"x-plain",unstyled:!0,layout:{type:"ux.center",maxWidth:a},items:[this.view]})}});
Ext.define("com.trackplus.master.AppBoxView",{extend:"Ext.panel.Panel",layout:"border",border:!1,bodyBorder:!1,cls:"appBox",overCls:"appBoxOver",config:{appID:null,appUrl:null,appTitle:null,appIcon:null},initComponent:function(){var a=this;a.items=a.createChildren();a.addListener("afterrender",function(b){b.getEl().addListener("click",a.clickHandler,a)});a.callParent()},clickHandler:function(){window.location.href=this.appUrl},createChildren:function(){var a=[],b=Ext.create("Ext.panel.Panel",{region:"center",
border:!1,bodyBorder:!1,layout:"fit",id:"XXX",cls:"appBoxImage",items:[{xtype:"component",cls:this.appIcon}]});a.push(b);a.push({xtype:"component",cls:"appBoxTitle",html:this.appTitle,iconCls:this.appIcon,region:"south"});return a}});
Ext.define("com.trackplus.layout.ExternalActionLayout",{extend:"com.trackplus.layout.BaseLayout",useToolbar:!1,constructor:function(a){this.callParent(arguments);this.onReady(function(){})},createCenterPanel:function(){return this.getPanel(this.initData.module.url)},createJenkinsSessionCookie:function(a){},getPanel:function(a){return Ext.create("Ext.panel.Panel",{region:"center",border:!1,baseCls:"x-plain",layout:"fit",items:[{xtype:"box",autoEl:{tag:"iframe",style:"width: 100%;height: 100%;border: medium none;",
src:a}}]})}});